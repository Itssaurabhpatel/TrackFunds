{"ast":null,"code":"/*!\n * @antv/g-lite\n * @description A core module for rendering engine implements DOM API.\n * @version 2.1.3\n * @date 10/24/2024, 7:56:07 AM\n * @author AntVis\n * @docs https://g.antv.antgroup.com/\n */\nimport _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport _classCallCheck from '@babel/runtime/helpers/classCallCheck';\nimport _createClass from '@babel/runtime/helpers/createClass';\nimport _toConsumableArray from '@babel/runtime/helpers/toConsumableArray';\nimport _callSuper from '@babel/runtime/helpers/callSuper';\nimport _inherits from '@babel/runtime/helpers/inherits';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport EventEmitter from 'eventemitter3';\nimport { vec3, vec4, mat4, mat3, quat as quat$1, vec2 } from 'gl-matrix';\nimport '@babel/runtime/helpers/readOnlyError';\nimport { isNumber, distanceSquareRoot, isString, isNil, clamp, getTotalLength, min, max, isNumberEqual, mod, normalizePath, path2Curve, equalizeSegments, getDrawDirection, reverseCurve, clonePath, getRotatedCurve, isUndefined, isArray, isBoolean, isFunction, isObject, getPointAtLength } from '@antv/util';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _superPropGet from '@babel/runtime/helpers/superPropGet';\nimport * as d3 from 'd3-color';\nimport { polylineLength, arcBox, cubicBox, quadBox, linePointAt, lineLength } from '@antv/g-math';\nimport _regeneratorRuntime from '@babel/runtime/helpers/regeneratorRuntime';\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _createForOfIteratorHelper from '@babel/runtime/helpers/createForOfIteratorHelper';\nimport _objectWithoutProperties from '@babel/runtime/helpers/objectWithoutProperties';\nvar commonjsGlobal = typeof globalThis !== 'undefined' ? globalThis : typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\nvar rbush = {\n  exports: {}\n};\n(function (module, exports) {\n  (function (global, factory) {\n    module.exports = factory();\n  })(commonjsGlobal, function () {\n    function quickselect(arr, k, left, right, compare) {\n      quickselectStep(arr, k, left || 0, right || arr.length - 1, compare || defaultCompare);\n    }\n    function quickselectStep(arr, k, left, right, compare) {\n      while (right > left) {\n        if (right - left > 600) {\n          var n = right - left + 1;\n          var m = k - left + 1;\n          var z = Math.log(n);\n          var s = 0.5 * Math.exp(2 * z / 3);\n          var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n          var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n          var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n          quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n        var t = arr[k];\n        var i = left;\n        var j = right;\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) {\n          swap(arr, left, right);\n        }\n        while (i < j) {\n          swap(arr, i, j);\n          i++;\n          j--;\n          while (compare(arr[i], t) < 0) {\n            i++;\n          }\n          while (compare(arr[j], t) > 0) {\n            j--;\n          }\n        }\n        if (compare(arr[left], t) === 0) {\n          swap(arr, left, j);\n        } else {\n          j++;\n          swap(arr, j, right);\n        }\n        if (j <= k) {\n          left = j + 1;\n        }\n        if (k <= j) {\n          right = j - 1;\n        }\n      }\n    }\n    function swap(arr, i, j) {\n      var tmp = arr[i];\n      arr[i] = arr[j];\n      arr[j] = tmp;\n    }\n    function defaultCompare(a, b) {\n      return a < b ? -1 : a > b ? 1 : 0;\n    }\n    var RBush = function RBush(maxEntries) {\n      if (maxEntries === void 0) maxEntries = 9;\n\n      // max entries in a node is 9 by default; min node fill is 40% for best performance\n      this._maxEntries = Math.max(4, maxEntries);\n      this._minEntries = Math.max(2, Math.ceil(this._maxEntries * 0.4));\n      this.clear();\n    };\n    RBush.prototype.all = function all() {\n      return this._all(this.data, []);\n    };\n    RBush.prototype.search = function search(bbox) {\n      var node = this.data;\n      var result = [];\n      if (!intersects(bbox, node)) {\n        return result;\n      }\n      var toBBox = this.toBBox;\n      var nodesToSearch = [];\n      while (node) {\n        for (var i = 0; i < node.children.length; i++) {\n          var child = node.children[i];\n          var childBBox = node.leaf ? toBBox(child) : child;\n          if (intersects(bbox, childBBox)) {\n            if (node.leaf) {\n              result.push(child);\n            } else if (contains(bbox, childBBox)) {\n              this._all(child, result);\n            } else {\n              nodesToSearch.push(child);\n            }\n          }\n        }\n        node = nodesToSearch.pop();\n      }\n      return result;\n    };\n    RBush.prototype.collides = function collides(bbox) {\n      var node = this.data;\n      if (!intersects(bbox, node)) {\n        return false;\n      }\n      var nodesToSearch = [];\n      while (node) {\n        for (var i = 0; i < node.children.length; i++) {\n          var child = node.children[i];\n          var childBBox = node.leaf ? this.toBBox(child) : child;\n          if (intersects(bbox, childBBox)) {\n            if (node.leaf || contains(bbox, childBBox)) {\n              return true;\n            }\n            nodesToSearch.push(child);\n          }\n        }\n        node = nodesToSearch.pop();\n      }\n      return false;\n    };\n    RBush.prototype.load = function load(data) {\n      if (!(data && data.length)) {\n        return this;\n      }\n      if (data.length < this._minEntries) {\n        for (var i = 0; i < data.length; i++) {\n          this.insert(data[i]);\n        }\n        return this;\n      }\n\n      // recursively build the tree with the given data from scratch using OMT algorithm\n      var node = this._build(data.slice(), 0, data.length - 1, 0);\n      if (!this.data.children.length) {\n        // save as is if tree is empty\n        this.data = node;\n      } else if (this.data.height === node.height) {\n        // split root if trees have the same height\n        this._splitRoot(this.data, node);\n      } else {\n        if (this.data.height < node.height) {\n          // swap trees if inserted one is bigger\n          var tmpNode = this.data;\n          this.data = node;\n          node = tmpNode;\n        }\n\n        // insert the small tree into the large tree at appropriate level\n        this._insert(node, this.data.height - node.height - 1, true);\n      }\n      return this;\n    };\n    RBush.prototype.insert = function insert(item) {\n      if (item) {\n        this._insert(item, this.data.height - 1);\n      }\n      return this;\n    };\n    RBush.prototype.clear = function clear() {\n      this.data = createNode([]);\n      return this;\n    };\n    RBush.prototype.remove = function remove(item, equalsFn) {\n      if (!item) {\n        return this;\n      }\n      var node = this.data;\n      var bbox = this.toBBox(item);\n      var path = [];\n      var indexes = [];\n      var i, parent, goingUp;\n\n      // depth-first iterative tree traversal\n      while (node || path.length) {\n        if (!node) {\n          // go up\n          node = path.pop();\n          parent = path[path.length - 1];\n          i = indexes.pop();\n          goingUp = true;\n        }\n        if (node.leaf) {\n          // check current node\n          var index = findItem(item, node.children, equalsFn);\n          if (index !== -1) {\n            // item found, remove the item and condense tree upwards\n            node.children.splice(index, 1);\n            path.push(node);\n            this._condense(path);\n            return this;\n          }\n        }\n        if (!goingUp && !node.leaf && contains(node, bbox)) {\n          // go down\n          path.push(node);\n          indexes.push(i);\n          i = 0;\n          parent = node;\n          node = node.children[0];\n        } else if (parent) {\n          // go right\n          i++;\n          node = parent.children[i];\n          goingUp = false;\n        } else {\n          node = null;\n        } // nothing found\n      }\n      return this;\n    };\n    RBush.prototype.toBBox = function toBBox(item) {\n      return item;\n    };\n    RBush.prototype.compareMinX = function compareMinX(a, b) {\n      return a.minX - b.minX;\n    };\n    RBush.prototype.compareMinY = function compareMinY(a, b) {\n      return a.minY - b.minY;\n    };\n    RBush.prototype.toJSON = function toJSON() {\n      return this.data;\n    };\n    RBush.prototype.fromJSON = function fromJSON(data) {\n      this.data = data;\n      return this;\n    };\n    RBush.prototype._all = function _all(node, result) {\n      var nodesToSearch = [];\n      while (node) {\n        if (node.leaf) {\n          result.push.apply(result, node.children);\n        } else {\n          nodesToSearch.push.apply(nodesToSearch, node.children);\n        }\n        node = nodesToSearch.pop();\n      }\n      return result;\n    };\n    RBush.prototype._build = function _build(items, left, right, height) {\n      var N = right - left + 1;\n      var M = this._maxEntries;\n      var node;\n      if (N <= M) {\n        // reached leaf level; return leaf\n        node = createNode(items.slice(left, right + 1));\n        calcBBox(node, this.toBBox);\n        return node;\n      }\n      if (!height) {\n        // target height of the bulk-loaded tree\n        height = Math.ceil(Math.log(N) / Math.log(M));\n\n        // target number of root entries to maximize storage utilization\n        M = Math.ceil(N / Math.pow(M, height - 1));\n      }\n      node = createNode([]);\n      node.leaf = false;\n      node.height = height;\n\n      // split the items into M mostly square tiles\n\n      var N2 = Math.ceil(N / M);\n      var N1 = N2 * Math.ceil(Math.sqrt(M));\n      multiSelect(items, left, right, N1, this.compareMinX);\n      for (var i = left; i <= right; i += N1) {\n        var right2 = Math.min(i + N1 - 1, right);\n        multiSelect(items, i, right2, N2, this.compareMinY);\n        for (var j = i; j <= right2; j += N2) {\n          var right3 = Math.min(j + N2 - 1, right2);\n\n          // pack each entry recursively\n          node.children.push(this._build(items, j, right3, height - 1));\n        }\n      }\n      calcBBox(node, this.toBBox);\n      return node;\n    };\n    RBush.prototype._chooseSubtree = function _chooseSubtree(bbox, node, level, path) {\n      while (true) {\n        path.push(node);\n        if (node.leaf || path.length - 1 === level) {\n          break;\n        }\n        var minArea = Infinity;\n        var minEnlargement = Infinity;\n        var targetNode = void 0;\n        for (var i = 0; i < node.children.length; i++) {\n          var child = node.children[i];\n          var area = bboxArea(child);\n          var enlargement = enlargedArea(bbox, child) - area;\n\n          // choose entry with the least area enlargement\n          if (enlargement < minEnlargement) {\n            minEnlargement = enlargement;\n            minArea = area < minArea ? area : minArea;\n            targetNode = child;\n          } else if (enlargement === minEnlargement) {\n            // otherwise choose one with the smallest area\n            if (area < minArea) {\n              minArea = area;\n              targetNode = child;\n            }\n          }\n        }\n        node = targetNode || node.children[0];\n      }\n      return node;\n    };\n    RBush.prototype._insert = function _insert(item, level, isNode) {\n      var bbox = isNode ? item : this.toBBox(item);\n      var insertPath = [];\n\n      // find the best node for accommodating the item, saving all nodes along the path too\n      var node = this._chooseSubtree(bbox, this.data, level, insertPath);\n\n      // put the item into the node\n      node.children.push(item);\n      extend(node, bbox);\n\n      // split on node overflow; propagate upwards if necessary\n      while (level >= 0) {\n        if (insertPath[level].children.length > this._maxEntries) {\n          this._split(insertPath, level);\n          level--;\n        } else {\n          break;\n        }\n      }\n\n      // adjust bboxes along the insertion path\n      this._adjustParentBBoxes(bbox, insertPath, level);\n    };\n\n    // split overflowed node into two\n    RBush.prototype._split = function _split(insertPath, level) {\n      var node = insertPath[level];\n      var M = node.children.length;\n      var m = this._minEntries;\n      this._chooseSplitAxis(node, m, M);\n      var splitIndex = this._chooseSplitIndex(node, m, M);\n      var newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));\n      newNode.height = node.height;\n      newNode.leaf = node.leaf;\n      calcBBox(node, this.toBBox);\n      calcBBox(newNode, this.toBBox);\n      if (level) {\n        insertPath[level - 1].children.push(newNode);\n      } else {\n        this._splitRoot(node, newNode);\n      }\n    };\n    RBush.prototype._splitRoot = function _splitRoot(node, newNode) {\n      // split root node\n      this.data = createNode([node, newNode]);\n      this.data.height = node.height + 1;\n      this.data.leaf = false;\n      calcBBox(this.data, this.toBBox);\n    };\n    RBush.prototype._chooseSplitIndex = function _chooseSplitIndex(node, m, M) {\n      var index;\n      var minOverlap = Infinity;\n      var minArea = Infinity;\n      for (var i = m; i <= M - m; i++) {\n        var bbox1 = distBBox(node, 0, i, this.toBBox);\n        var bbox2 = distBBox(node, i, M, this.toBBox);\n        var overlap = intersectionArea(bbox1, bbox2);\n        var area = bboxArea(bbox1) + bboxArea(bbox2);\n\n        // choose distribution with minimum overlap\n        if (overlap < minOverlap) {\n          minOverlap = overlap;\n          index = i;\n          minArea = area < minArea ? area : minArea;\n        } else if (overlap === minOverlap) {\n          // otherwise choose distribution with minimum area\n          if (area < minArea) {\n            minArea = area;\n            index = i;\n          }\n        }\n      }\n      return index || M - m;\n    };\n\n    // sorts node children by the best axis for split\n    RBush.prototype._chooseSplitAxis = function _chooseSplitAxis(node, m, M) {\n      var compareMinX = node.leaf ? this.compareMinX : compareNodeMinX;\n      var compareMinY = node.leaf ? this.compareMinY : compareNodeMinY;\n      var xMargin = this._allDistMargin(node, m, M, compareMinX);\n      var yMargin = this._allDistMargin(node, m, M, compareMinY);\n\n      // if total distributions margin value is minimal for x, sort by minX,\n      // otherwise it's already sorted by minY\n      if (xMargin < yMargin) {\n        node.children.sort(compareMinX);\n      }\n    };\n\n    // total margin of all possible split distributions where each node is at least m full\n    RBush.prototype._allDistMargin = function _allDistMargin(node, m, M, compare) {\n      node.children.sort(compare);\n      var toBBox = this.toBBox;\n      var leftBBox = distBBox(node, 0, m, toBBox);\n      var rightBBox = distBBox(node, M - m, M, toBBox);\n      var margin = bboxMargin(leftBBox) + bboxMargin(rightBBox);\n      for (var i = m; i < M - m; i++) {\n        var child = node.children[i];\n        extend(leftBBox, node.leaf ? toBBox(child) : child);\n        margin += bboxMargin(leftBBox);\n      }\n      for (var i$1 = M - m - 1; i$1 >= m; i$1--) {\n        var child$1 = node.children[i$1];\n        extend(rightBBox, node.leaf ? toBBox(child$1) : child$1);\n        margin += bboxMargin(rightBBox);\n      }\n      return margin;\n    };\n    RBush.prototype._adjustParentBBoxes = function _adjustParentBBoxes(bbox, path, level) {\n      // adjust bboxes along the given tree path\n      for (var i = level; i >= 0; i--) {\n        extend(path[i], bbox);\n      }\n    };\n    RBush.prototype._condense = function _condense(path) {\n      // go through the path, removing empty nodes and updating bboxes\n      for (var i = path.length - 1, siblings = void 0; i >= 0; i--) {\n        if (path[i].children.length === 0) {\n          if (i > 0) {\n            siblings = path[i - 1].children;\n            siblings.splice(siblings.indexOf(path[i]), 1);\n          } else {\n            this.clear();\n          }\n        } else {\n          calcBBox(path[i], this.toBBox);\n        }\n      }\n    };\n    function findItem(item, items, equalsFn) {\n      if (!equalsFn) {\n        return items.indexOf(item);\n      }\n      for (var i = 0; i < items.length; i++) {\n        if (equalsFn(item, items[i])) {\n          return i;\n        }\n      }\n      return -1;\n    }\n\n    // calculate node's bbox from bboxes of its children\n    function calcBBox(node, toBBox) {\n      distBBox(node, 0, node.children.length, toBBox, node);\n    }\n\n    // min bounding rectangle of node children from k to p-1\n    function distBBox(node, k, p, toBBox, destNode) {\n      if (!destNode) {\n        destNode = createNode(null);\n      }\n      destNode.minX = Infinity;\n      destNode.minY = Infinity;\n      destNode.maxX = -Infinity;\n      destNode.maxY = -Infinity;\n      for (var i = k; i < p; i++) {\n        var child = node.children[i];\n        extend(destNode, node.leaf ? toBBox(child) : child);\n      }\n      return destNode;\n    }\n    function extend(a, b) {\n      a.minX = Math.min(a.minX, b.minX);\n      a.minY = Math.min(a.minY, b.minY);\n      a.maxX = Math.max(a.maxX, b.maxX);\n      a.maxY = Math.max(a.maxY, b.maxY);\n      return a;\n    }\n    function compareNodeMinX(a, b) {\n      return a.minX - b.minX;\n    }\n    function compareNodeMinY(a, b) {\n      return a.minY - b.minY;\n    }\n    function bboxArea(a) {\n      return (a.maxX - a.minX) * (a.maxY - a.minY);\n    }\n    function bboxMargin(a) {\n      return a.maxX - a.minX + (a.maxY - a.minY);\n    }\n    function enlargedArea(a, b) {\n      return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) * (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));\n    }\n    function intersectionArea(a, b) {\n      var minX = Math.max(a.minX, b.minX);\n      var minY = Math.max(a.minY, b.minY);\n      var maxX = Math.min(a.maxX, b.maxX);\n      var maxY = Math.min(a.maxY, b.maxY);\n      return Math.max(0, maxX - minX) * Math.max(0, maxY - minY);\n    }\n    function contains(a, b) {\n      return a.minX <= b.minX && a.minY <= b.minY && b.maxX <= a.maxX && b.maxY <= a.maxY;\n    }\n    function intersects(a, b) {\n      return b.minX <= a.maxX && b.minY <= a.maxY && b.maxX >= a.minX && b.maxY >= a.minY;\n    }\n    function createNode(children) {\n      return {\n        children: children,\n        height: 1,\n        leaf: true,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n      };\n    }\n\n    // sort an array so that items come in groups of n unsorted items, with groups sorted between each other;\n    // combines selection algorithm with binary divide & conquer approach\n\n    function multiSelect(arr, left, right, n, compare) {\n      var stack = [left, right];\n      while (stack.length) {\n        right = stack.pop();\n        left = stack.pop();\n        if (right - left <= n) {\n          continue;\n        }\n        var mid = left + Math.ceil((right - left) / n / 2) * n;\n        quickselect(arr, mid, left, right, compare);\n        stack.push(left, mid, mid, right);\n      }\n    }\n    return RBush;\n  });\n})(rbush);\nvar RBush = rbush.exports;\nvar Shape = /*#__PURE__*/function (Shape) {\n  Shape[\"GROUP\"] = \"g\";\n  Shape[\"FRAGMENT\"] = \"fragment\";\n  Shape[\"CIRCLE\"] = \"circle\";\n  Shape[\"ELLIPSE\"] = \"ellipse\";\n  Shape[\"IMAGE\"] = \"image\";\n  Shape[\"RECT\"] = \"rect\";\n  Shape[\"LINE\"] = \"line\";\n  Shape[\"POLYLINE\"] = \"polyline\";\n  Shape[\"POLYGON\"] = \"polygon\";\n  Shape[\"TEXT\"] = \"text\";\n  Shape[\"PATH\"] = \"path\";\n  Shape[\"HTML\"] = \"html\";\n  Shape[\"MESH\"] = \"mesh\";\n  return Shape;\n}({});\n\n// prettier-ignore\n\n// prettier-ignore\n\n// Cursor style\n// See: https://developer.mozilla.org/en-US/docs/Web/CSS/cursor\n\nvar ClipSpaceNearZ = /*#__PURE__*/function (ClipSpaceNearZ) {\n  ClipSpaceNearZ[ClipSpaceNearZ[\"ZERO\"] = 0] = \"ZERO\";\n  ClipSpaceNearZ[ClipSpaceNearZ[\"NEGATIVE_ONE\"] = 1] = \"NEGATIVE_ONE\";\n  return ClipSpaceNearZ;\n}({});\n\n/**\n * eg. NodeCanvas, OffscreenCanvas, HTMLCanvasElement\n */\n\n/**\n * The format to use when defining custom easing functions\n */\n\n// @see https://github.com/zhanba/pailye/blob/master/packages/flex/src/types.ts\n\nvar AbstractRendererPlugin = /*#__PURE__*/function () {\n  function AbstractRendererPlugin() {\n    _classCallCheck(this, AbstractRendererPlugin);\n    this.plugins = [];\n  }\n  return _createClass(AbstractRendererPlugin, [{\n    key: \"addRenderingPlugin\",\n    value: function addRenderingPlugin(plugin) {\n      this.plugins.push(plugin);\n      this.context.renderingPlugins.push(plugin);\n    }\n  }, {\n    key: \"removeAllRenderingPlugins\",\n    value: function removeAllRenderingPlugins() {\n      var _this = this;\n      this.plugins.forEach(function (plugin) {\n        var index = _this.context.renderingPlugins.indexOf(plugin);\n        if (index >= 0) {\n          _this.context.renderingPlugins.splice(index, 1);\n        }\n      });\n    }\n  }]);\n}();\nvar AbstractRenderer = /*#__PURE__*/function () {\n  function AbstractRenderer(config) {\n    _classCallCheck(this, AbstractRenderer);\n    this.clipSpaceNearZ = ClipSpaceNearZ.NEGATIVE_ONE;\n    this.plugins = [];\n    this.config = _objectSpread({\n      /**\n       * only dirty object will cause re-render\n       */\n      enableDirtyCheck: true,\n      enableCulling: false,\n      /**\n       * enable auto rendering by default\n       */\n      enableAutoRendering: true,\n      /**\n       * enable dirty rectangle rendering by default\n       */\n      enableDirtyRectangleRendering: true,\n      enableDirtyRectangleRenderingDebug: false,\n      enableSizeAttenuation: true\n    }, config);\n  }\n  return _createClass(AbstractRenderer, [{\n    key: \"registerPlugin\",\n    value: function registerPlugin(plugin) {\n      var index = this.plugins.findIndex(function (p) {\n        return p === plugin;\n      });\n      if (index === -1) {\n        this.plugins.push(plugin);\n      }\n    }\n  }, {\n    key: \"unregisterPlugin\",\n    value: function unregisterPlugin(plugin) {\n      var index = this.plugins.findIndex(function (p) {\n        return p === plugin;\n      });\n      if (index > -1) {\n        this.plugins.splice(index, 1);\n      }\n    }\n  }, {\n    key: \"getPlugins\",\n    value: function getPlugins() {\n      return this.plugins;\n    }\n  }, {\n    key: \"getPlugin\",\n    value: function getPlugin(name) {\n      return this.plugins.find(function (plugin) {\n        return plugin.name === name;\n      });\n    }\n  }, {\n    key: \"getConfig\",\n    value: function getConfig() {\n      return this.config;\n    }\n  }, {\n    key: \"setConfig\",\n    value: function setConfig(config) {\n      Object.assign(this.config, config);\n    }\n  }]);\n}();\nvar addVec3 = vec3.add,\n  copyVec3 = vec3.copy,\n  maxVec3 = vec3.max,\n  minVec3 = vec3.min,\n  scaleVec3 = vec3.scale,\n  subVec3 = vec3.sub;\n\n/**\n * Axis-Aligned Bounding Box\n * 为了便于后续 Frustum Culling，通过查找表定义 p-vertex 和 n-vertex\n * @see https://github.com/antvis/GWebGPUEngine/issues/3\n */\nvar AABB = /*#__PURE__*/function () {\n  function AABB() {\n    _classCallCheck(this, AABB);\n    this.center = [0, 0, 0];\n    this.halfExtents = [0, 0, 0];\n    this.min = [0, 0, 0];\n    this.max = [0, 0, 0];\n  }\n  return _createClass(AABB, [{\n    key: \"update\",\n    value: function update(center, halfExtents) {\n      copyVec3(this.center, center);\n      copyVec3(this.halfExtents, halfExtents);\n      subVec3(this.min, this.center, this.halfExtents);\n      addVec3(this.max, this.center, this.halfExtents);\n    }\n  }, {\n    key: \"setMinMax\",\n    value: function setMinMax(min, max) {\n      addVec3(this.center, max, min);\n      scaleVec3(this.center, this.center, 0.5);\n      subVec3(this.halfExtents, max, min);\n      scaleVec3(this.halfExtents, this.halfExtents, 0.5);\n      copyVec3(this.min, min);\n      copyVec3(this.max, max);\n    }\n  }, {\n    key: \"getMin\",\n    value: function getMin() {\n      return this.min;\n    }\n  }, {\n    key: \"getMax\",\n    value: function getMax() {\n      return this.max;\n    }\n  }, {\n    key: \"add\",\n    value: function add(aabb) {\n      if (AABB.isEmpty(aabb)) {\n        return;\n      }\n      if (AABB.isEmpty(this)) {\n        this.setMinMax(aabb.getMin(), aabb.getMax());\n        return;\n      }\n      var tc = this.center;\n      var tcx = tc[0];\n      var tcy = tc[1];\n      var tcz = tc[2];\n      var th = this.halfExtents;\n      var thx = th[0];\n      var thy = th[1];\n      var thz = th[2];\n      var tminx = tcx - thx;\n      var tmaxx = tcx + thx;\n      var tminy = tcy - thy;\n      var tmaxy = tcy + thy;\n      var tminz = tcz - thz;\n      var tmaxz = tcz + thz;\n      var oc = aabb.center;\n      var ocx = oc[0];\n      var ocy = oc[1];\n      var ocz = oc[2];\n      var oh = aabb.halfExtents;\n      var ohx = oh[0];\n      var ohy = oh[1];\n      var ohz = oh[2];\n      var ominx = ocx - ohx;\n      var omaxx = ocx + ohx;\n      var ominy = ocy - ohy;\n      var omaxy = ocy + ohy;\n      var ominz = ocz - ohz;\n      var omaxz = ocz + ohz;\n      if (ominx < tminx) {\n        tminx = ominx;\n      }\n      if (omaxx > tmaxx) {\n        tmaxx = omaxx;\n      }\n      if (ominy < tminy) {\n        tminy = ominy;\n      }\n      if (omaxy > tmaxy) {\n        tmaxy = omaxy;\n      }\n      if (ominz < tminz) {\n        tminz = ominz;\n      }\n      if (omaxz > tmaxz) {\n        tmaxz = omaxz;\n      }\n      tc[0] = (tminx + tmaxx) * 0.5;\n      tc[1] = (tminy + tmaxy) * 0.5;\n      tc[2] = (tminz + tmaxz) * 0.5;\n      th[0] = (tmaxx - tminx) * 0.5;\n      th[1] = (tmaxy - tminy) * 0.5;\n      th[2] = (tmaxz - tminz) * 0.5;\n      this.min[0] = tminx;\n      this.min[1] = tminy;\n      this.min[2] = tminz;\n      this.max[0] = tmaxx;\n      this.max[1] = tmaxy;\n      this.max[2] = tmaxz;\n    }\n  }, {\n    key: \"setFromTransformedAABB\",\n    value: function setFromTransformedAABB(aabb, m) {\n      var bc = this.center;\n      var br = this.halfExtents;\n      var ac = aabb.center;\n      var ar = aabb.halfExtents;\n      var mx0 = m[0];\n      var mx1 = m[4];\n      var mx2 = m[8];\n      var my0 = m[1];\n      var my1 = m[5];\n      var my2 = m[9];\n      var mz0 = m[2];\n      var mz1 = m[6];\n      var mz2 = m[10];\n      var mx0a = Math.abs(mx0);\n      var mx1a = Math.abs(mx1);\n      var mx2a = Math.abs(mx2);\n      var my0a = Math.abs(my0);\n      var my1a = Math.abs(my1);\n      var my2a = Math.abs(my2);\n      var mz0a = Math.abs(mz0);\n      var mz1a = Math.abs(mz1);\n      var mz2a = Math.abs(mz2);\n      bc[0] = m[12] + mx0 * ac[0] + mx1 * ac[1] + mx2 * ac[2];\n      bc[1] = m[13] + my0 * ac[0] + my1 * ac[1] + my2 * ac[2];\n      bc[2] = m[14] + mz0 * ac[0] + mz1 * ac[1] + mz2 * ac[2];\n\n      // vec3.set(\n      //   bc,\n      //   m[12] + mx0 * ac[0] + mx1 * ac[1] + mx2 * ac[2],\n      //   m[13] + my0 * ac[0] + my1 * ac[1] + my2 * ac[2],\n      //   m[14] + mz0 * ac[0] + mz1 * ac[1] + mz2 * ac[2],\n      // );\n\n      br[0] = mx0a * ar[0] + mx1a * ar[1] + mx2a * ar[2];\n      br[1] = my0a * ar[0] + my1a * ar[1] + my2a * ar[2];\n      br[2] = mz0a * ar[0] + mz1a * ar[1] + mz2a * ar[2];\n\n      // vec3.set(\n      //   br,\n      //   mx0a * ar[0] + mx1a * ar[1] + mx2a * ar[2],\n      //   my0a * ar[0] + my1a * ar[1] + my2a * ar[2],\n      //   mz0a * ar[0] + mz1a * ar[1] + mz2a * ar[2],\n      // );\n\n      // this.min = vec3.sub(this.min, bc, br);\n      // this.max = vec3.add(this.max, bc, br);\n\n      subVec3(this.min, bc, br);\n      addVec3(this.max, bc, br);\n    }\n  }, {\n    key: \"intersects\",\n    value: function intersects(aabb) {\n      var aMax = this.getMax();\n      var aMin = this.getMin();\n      var bMax = aabb.getMax();\n      var bMin = aabb.getMin();\n      return aMin[0] <= bMax[0] && aMax[0] >= bMin[0] && aMin[1] <= bMax[1] && aMax[1] >= bMin[1] && aMin[2] <= bMax[2] && aMax[2] >= bMin[2];\n    }\n  }, {\n    key: \"intersection\",\n    value: function intersection(aabb) {\n      if (!this.intersects(aabb)) {\n        return null;\n      }\n      var intersection = new AABB();\n      var min = maxVec3([0, 0, 0], this.getMin(), aabb.getMin());\n      var max = minVec3([0, 0, 0], this.getMax(), aabb.getMax());\n      intersection.setMinMax(min, max);\n      return intersection;\n    }\n\n    /**\n     * get n-vertex\n     * @param plane plane of CullingVolume\n     */\n  }, {\n    key: \"getNegativeFarPoint\",\n    value: function getNegativeFarPoint(plane) {\n      if (plane.pnVertexFlag === 0x111) {\n        return copyVec3([0, 0, 0], this.min);\n        // return vec3.copy(vec3.create(), this.min);\n      }\n      if (plane.pnVertexFlag === 0x110) {\n        return [this.min[0], this.min[1], this.max[2]];\n        // return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n      }\n      if (plane.pnVertexFlag === 0x101) {\n        return [this.min[0], this.max[1], this.min[2]];\n        // return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n      }\n      if (plane.pnVertexFlag === 0x100) {\n        return [this.min[0], this.max[1], this.max[2]];\n        // return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n      }\n      if (plane.pnVertexFlag === 0x011) {\n        return [this.max[0], this.min[1], this.min[2]];\n        // return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n      }\n      if (plane.pnVertexFlag === 0x010) {\n        return [this.max[0], this.min[1], this.max[2]];\n        // return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n      }\n      if (plane.pnVertexFlag === 0x001) {\n        return [this.max[0], this.max[1], this.min[2]];\n        // return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n      }\n      return [this.max[0], this.max[1], this.max[2]];\n      // return vec3.fromValues(this.max[0], this.max[1], this.max[2]);\n    }\n\n    /**\n     * get p-vertex\n     * @param plane plane of CullingVolume\n     */\n  }, {\n    key: \"getPositiveFarPoint\",\n    value: function getPositiveFarPoint(plane) {\n      if (plane.pnVertexFlag === 0x111) {\n        return copyVec3([0, 0, 0], this.max);\n        // return vec3.copy(vec3.create(), this.max);\n      }\n      if (plane.pnVertexFlag === 0x110) {\n        return [this.max[0], this.max[1], this.min[2]];\n        // return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n      }\n      if (plane.pnVertexFlag === 0x101) {\n        return [this.max[0], this.min[1], this.max[2]];\n        // return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n      }\n      if (plane.pnVertexFlag === 0x100) {\n        return [this.max[0], this.min[1], this.min[2]];\n        // return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n      }\n      if (plane.pnVertexFlag === 0x011) {\n        return [this.min[0], this.max[1], this.max[2]];\n        // return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n      }\n      if (plane.pnVertexFlag === 0x010) {\n        return [this.min[0], this.max[1], this.min[2]];\n        // return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n      }\n      if (plane.pnVertexFlag === 0x001) {\n        return [this.min[0], this.min[1], this.max[2]];\n        // return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n      }\n      return [this.min[0], this.min[1], this.min[2]];\n      // return vec3.fromValues(this.min[0], this.min[1], this.min[2]);\n    }\n  }], [{\n    key: \"isEmpty\",\n    value: function isEmpty(aabb) {\n      return !aabb || aabb.halfExtents[0] === 0 && aabb.halfExtents[1] === 0 && aabb.halfExtents[2] === 0;\n    }\n  }]);\n}();\nvar Plane = /*#__PURE__*/function () {\n  /**\n   * lookup table for p-vertex & n-vertex when doing frustum culling\n   */\n\n  function Plane(distance, normal) {\n    _classCallCheck(this, Plane);\n    this.distance = distance || 0;\n    this.normal = normal || vec3.fromValues(0, 1, 0);\n    this.updatePNVertexFlag();\n  }\n  return _createClass(Plane, [{\n    key: \"updatePNVertexFlag\",\n    value: function updatePNVertexFlag() {\n      this.pnVertexFlag = (Number(this.normal[0] >= 0) << 8) + (Number(this.normal[1] >= 0) << 4) + Number(this.normal[2] >= 0);\n    }\n  }, {\n    key: \"distanceToPoint\",\n    value: function distanceToPoint(point) {\n      return vec3.dot(point, this.normal) - this.distance;\n    }\n  }, {\n    key: \"normalize\",\n    value: function normalize() {\n      var invLen = 1 / vec3.len(this.normal);\n      vec3.scale(this.normal, this.normal, invLen);\n      this.distance *= invLen;\n    }\n  }, {\n    key: \"intersectsLine\",\n    value: function intersectsLine(start, end, point) {\n      var d0 = this.distanceToPoint(start);\n      var d1 = this.distanceToPoint(end);\n      var t = d0 / (d0 - d1);\n      var intersects = t >= 0 && t <= 1;\n      if (intersects && point) {\n        vec3.lerp(point, start, end, t);\n      }\n      return intersects;\n    }\n  }]);\n}();\nvar Mask = /*#__PURE__*/function (Mask) {\n  Mask[Mask[\"OUTSIDE\"] = 4294967295] = \"OUTSIDE\";\n  Mask[Mask[\"INSIDE\"] = 0] = \"INSIDE\";\n  Mask[Mask[\"INDETERMINATE\"] = 2147483647] = \"INDETERMINATE\";\n  return Mask;\n}({});\nvar Frustum = /*#__PURE__*/function () {\n  function Frustum(planes) {\n    _classCallCheck(this, Frustum);\n    this.planes = [];\n    if (planes) {\n      this.planes = planes;\n    } else {\n      for (var i = 0; i < 6; i++) {\n        this.planes.push(new Plane());\n      }\n    }\n  }\n\n  /**\n   * extract 6 planes from projectionMatrix\n   * @see http://www8.cs.umu.se/kurser/5DV051/HT12/lab/plane_extraction.pdf\n   */\n  return _createClass(Frustum, [{\n    key: \"extractFromVPMatrix\",\n    value: function extractFromVPMatrix(projectionMatrix) {\n      // @ts-ignore\n      var _projectionMatrix = _slicedToArray(projectionMatrix, 16),\n        m0 = _projectionMatrix[0],\n        m1 = _projectionMatrix[1],\n        m2 = _projectionMatrix[2],\n        m3 = _projectionMatrix[3],\n        m4 = _projectionMatrix[4],\n        m5 = _projectionMatrix[5],\n        m6 = _projectionMatrix[6],\n        m7 = _projectionMatrix[7],\n        m8 = _projectionMatrix[8],\n        m9 = _projectionMatrix[9],\n        m10 = _projectionMatrix[10],\n        m11 = _projectionMatrix[11],\n        m12 = _projectionMatrix[12],\n        m13 = _projectionMatrix[13],\n        m14 = _projectionMatrix[14],\n        m15 = _projectionMatrix[15];\n\n      // right\n      vec3.set(this.planes[0].normal, m3 - m0, m7 - m4, m11 - m8);\n      this.planes[0].distance = m15 - m12;\n\n      // left\n      vec3.set(this.planes[1].normal, m3 + m0, m7 + m4, m11 + m8);\n      this.planes[1].distance = m15 + m12;\n\n      // bottom\n      vec3.set(this.planes[2].normal, m3 + m1, m7 + m5, m11 + m9);\n      this.planes[2].distance = m15 + m13;\n\n      // top\n      vec3.set(this.planes[3].normal, m3 - m1, m7 - m5, m11 - m9);\n      this.planes[3].distance = m15 - m13;\n\n      // far\n      vec3.set(this.planes[4].normal, m3 - m2, m7 - m6, m11 - m10);\n      this.planes[4].distance = m15 - m14;\n\n      // near\n      vec3.set(this.planes[5].normal, m3 + m2, m7 + m6, m11 + m10);\n      this.planes[5].distance = m15 + m14;\n      this.planes.forEach(function (plane) {\n        plane.normalize();\n        plane.updatePNVertexFlag();\n      });\n    }\n  }]);\n}();\nvar Point = /*#__PURE__*/function () {\n  function Point() {\n    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    _classCallCheck(this, Point);\n    this.x = 0;\n    this.y = 0;\n    this.x = x;\n    this.y = y;\n  }\n  return _createClass(Point, [{\n    key: \"clone\",\n    value: function clone() {\n      return new Point(this.x, this.y);\n    }\n  }, {\n    key: \"copyFrom\",\n    value: function copyFrom(p) {\n      this.x = p.x;\n      this.y = p.y;\n    }\n  }]);\n}();\nvar Rectangle = /*#__PURE__*/function () {\n  function Rectangle(x, y, width, height) {\n    _classCallCheck(this, Rectangle);\n    this.x = x;\n    this.y = y;\n    this.width = width;\n    this.height = height;\n    this.left = x;\n    this.right = x + width;\n    this.top = y;\n    this.bottom = y + height;\n  }\n  return _createClass(Rectangle, [{\n    key: \"toJSON\",\n    value: function toJSON() {}\n  }], [{\n    key: \"fromRect\",\n    value:\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMRect/fromRect_static\n     */\n    function fromRect(rect) {\n      return new Rectangle(rect.x, rect.y, rect.width, rect.height);\n    }\n\n    /**\n     * will return a new rect instance\n     */\n  }, {\n    key: \"applyTransform\",\n    value: function applyTransform(rect, matrix) {\n      var topLeft = vec4.fromValues(rect.x, rect.y, 0, 1);\n      var topRight = vec4.fromValues(rect.x + rect.width, rect.y, 0, 1);\n      var bottomLeft = vec4.fromValues(rect.x, rect.y + rect.height, 0, 1);\n      var bottomRight = vec4.fromValues(rect.x + rect.width, rect.y + rect.height, 0, 1);\n      var transformedTopLeft = vec4.create();\n      var transformedTopRight = vec4.create();\n      var transformedBottomLeft = vec4.create();\n      var transformedBottomRight = vec4.create();\n      vec4.transformMat4(transformedTopLeft, topLeft, matrix);\n      vec4.transformMat4(transformedTopRight, topRight, matrix);\n      vec4.transformMat4(transformedBottomLeft, bottomLeft, matrix);\n      vec4.transformMat4(transformedBottomRight, bottomRight, matrix);\n      var minX = Math.min(transformedTopLeft[0], transformedTopRight[0], transformedBottomLeft[0], transformedBottomRight[0]);\n      var minY = Math.min(transformedTopLeft[1], transformedTopRight[1], transformedBottomLeft[1], transformedBottomRight[1]);\n      var maxX = Math.max(transformedTopLeft[0], transformedTopRight[0], transformedBottomLeft[0], transformedBottomRight[0]);\n      var maxY = Math.max(transformedTopLeft[1], transformedTopRight[1], transformedBottomLeft[1], transformedBottomRight[1]);\n      return Rectangle.fromRect({\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY\n      });\n    }\n  }]);\n}();\nvar ERROR_MSG_METHOD_NOT_IMPLEMENTED = 'Method not implemented.';\nvar ERROR_MSG_USE_DOCUMENT_ELEMENT = 'Use document.documentElement instead.';\nvar ERROR_MSG_APPEND_DESTROYED_ELEMENT = 'Cannot append a destroyed element.';\nfunction getAngle(angle) {\n  if (angle === undefined) {\n    return 0;\n  }\n  if (angle > 360 || angle < -360) {\n    return angle % 360;\n  }\n  return angle;\n}\nvar $vec3$2 = vec3.create();\nfunction createVec3(x) {\n  var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var clone = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n  if (Array.isArray(x) && x.length === 3) {\n    return clone ? vec3.clone(x) : vec3.copy($vec3$2, x);\n  }\n  if (isNumber(x)) {\n    return clone ? vec3.fromValues(x, y, z) : vec3.set($vec3$2, x, y, z);\n  }\n  return clone ? vec3.fromValues(x[0], x[1] || y, x[2] || z) : vec3.set($vec3$2, x[0], x[1] || y, x[2] || z);\n}\nvar DEG_RAD = Math.PI / 180;\nfunction deg2rad(deg) {\n  return deg * DEG_RAD;\n}\nvar RAD_DEG = 180 / Math.PI;\nfunction rad2deg(rad) {\n  return rad * RAD_DEG;\n}\nvar GRAD_DEG = 0.9; // 360 / 400;\nfunction grad2deg(grads) {\n  grads %= 400;\n  if (grads < 0) {\n    grads += 400;\n  }\n  return grads * GRAD_DEG;\n}\nfunction deg2turn(deg) {\n  return deg / 360;\n}\nfunction turn2deg(turn) {\n  return 360 * turn;\n}\nvar HALF_PI = Math.PI / 2;\nfunction getEulerFromQuat(out, quat) {\n  var x = quat[0];\n  var y = quat[1];\n  var z = quat[2];\n  var w = quat[3];\n  var x2 = x * x;\n  var y2 = y * y;\n  var z2 = z * z;\n  var w2 = w * w;\n  var unit = x2 + y2 + z2 + w2;\n  var test = x * w - y * z;\n  if (test > 0.499995 * unit) {\n    // TODO: Use glmatrix.EPSILON\n    // singularity at the north pole\n    out[0] = HALF_PI;\n    out[1] = 2 * Math.atan2(y, x);\n    out[2] = 0;\n  } else if (test < -0.499995 * unit) {\n    // TODO: Use glmatrix.EPSILON\n    // singularity at the south pole\n    out[0] = -HALF_PI;\n    out[1] = 2 * Math.atan2(y, x);\n    out[2] = 0;\n  } else {\n    out[0] = Math.asin(2 * (x * z - w * y));\n    out[1] = Math.atan2(2 * (x * w + y * z), 1 - 2 * (z2 + w2));\n    out[2] = Math.atan2(2 * (x * y + z * w), 1 - 2 * (y2 + z2));\n  }\n  // TODO: Return them as degrees and not as radians\n  return out;\n}\nfunction getEulerFromMat4(out, m) {\n  var x;\n  var z;\n  var _mat4$getScaling = mat4.getScaling(vec3.create(), m),\n    _mat4$getScaling2 = _slicedToArray(_mat4$getScaling, 3),\n    sx = _mat4$getScaling2[0],\n    sy = _mat4$getScaling2[1],\n    sz = _mat4$getScaling2[2];\n  var y = Math.asin(-m[2] / sx);\n  if (y < HALF_PI) {\n    if (y > -HALF_PI) {\n      x = Math.atan2(m[6] / sy, m[10] / sz);\n      z = Math.atan2(m[1] / sx, m[0] / sx);\n    } else {\n      // Not a unique solution\n      z = 0;\n      x = -Math.atan2(m[4] / sy, m[5] / sy);\n    }\n  } else {\n    // Not a unique solution\n    z = 0;\n    x = Math.atan2(m[4] / sy, m[5] / sy);\n  }\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n\n/**\n * @see https://github.com/toji/gl-matrix/issues/329\n * @see https://doc.babylonjs.com/divingDeeper/mesh/transforms/center_origin/rotation_conventions\n */\nfunction getEuler(out, quat) {\n  if (quat.length === 16) {\n    return getEulerFromMat4(out, quat);\n  }\n  return getEulerFromQuat(out, quat);\n}\nfunction fromRotationTranslationScale(rotation, x, y, scaleX, scaleY) {\n  var cos = Math.cos(rotation);\n  var sin = Math.sin(rotation);\n  return mat3.fromValues(scaleX * cos, scaleY * sin, 0, -scaleX * sin, scaleY * cos, 0, x, y, 1);\n}\nfunction makePerspective(out, left, right, top, bottom, near, far) {\n  var zero = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : false;\n  var twoNear = 2 * near;\n  var rightMinusLeft = right - left;\n  var topMinusBottom = top - bottom;\n  var x = twoNear / rightMinusLeft;\n  var y = twoNear / topMinusBottom;\n  var a = (right + left) / rightMinusLeft;\n  var b = (top + bottom) / topMinusBottom;\n  var c;\n  var d;\n  var farMinusNear = far - near;\n  var farMulNear = far * near;\n  if (zero) {\n    c = -far / farMinusNear;\n    d = -farMulNear / farMinusNear;\n  } else {\n    c = -(far + near) / farMinusNear;\n    d = -2 * farMulNear / farMinusNear;\n  }\n  out[0] = x;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = y;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = a;\n  out[9] = b;\n  out[10] = c;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = d;\n  out[15] = 0;\n  return out;\n}\nfunction decompose(mat) {\n  var row0x = mat[0];\n  var row0y = mat[1];\n  var row1x = mat[3];\n  var row1y = mat[4];\n  // decompose 3x3 matrix\n  // @see https://www.w3.org/TR/css-transforms-1/#decomposing-a-2d-matrix\n  var scalingX = Math.sqrt(row0x * row0x + row0y * row0y);\n  var scalingY = Math.sqrt(row1x * row1x + row1y * row1y);\n\n  // If determinant is negative, one axis was flipped.\n  var determinant = row0x * row1y - row0y * row1x;\n  if (determinant < 0) {\n    // Flip axis with minimum unit vector dot product.\n    if (row0x < row1y) {\n      scalingX = -scalingX;\n    } else {\n      scalingY = -scalingY;\n    }\n  }\n\n  // Renormalize matrix to remove scale.\n  if (scalingX) {\n    var invScalingX = 1 / scalingX;\n    row0x *= invScalingX;\n    row0y *= invScalingX;\n  }\n  if (scalingY) {\n    var invScalingY = 1 / scalingY;\n    row1x *= invScalingY;\n    row1y *= invScalingY;\n  }\n\n  // Compute rotation and renormalize matrix.\n  var rotation = Math.atan2(row0y, row0x);\n  var angle = rad2deg(rotation);\n  return [mat[6], mat[7], scalingX, scalingY, angle];\n}\nvar tmp = mat4.create();\nvar perspectiveMatrix = mat4.create();\nvar tmpVec4 = vec4.create();\nvar row = [vec3.create(), vec3.create(), vec3.create()];\nvar pdum3 = vec3.create();\n\n/*\nInput:  matrix      ; a 4x4 matrix\nOutput: translation ; a 3 component vector\n        scale       ; a 3 component vector\n        skew        ; skew factors XY,XZ,YZ represented as a 3 component vector\n        perspective ; a 4 component vector\n        quaternion  ; a 4 component vector\nReturns false if the matrix cannot be decomposed, true if it can\n\n\nReferences:\nhttps://github.com/kamicane/matrix3d/blob/master/lib/Matrix3d.js\nhttps://github.com/ChromiumWebApps/chromium/blob/master/ui/gfx/transform_util.cc\nhttp://www.w3.org/TR/css3-transforms/#decomposing-a-3d-matrix\n*/\nfunction decomposeMat4(matrix, translation, scale, skew, perspective, quaternion) {\n  // normalize, if not possible then bail out early\n  if (!normalize(tmp, matrix)) return false;\n\n  // perspectiveMatrix is used to solve for perspective, but it also provides\n  // an easy way to test for singularity of the upper 3x3 component.\n  mat4.copy(perspectiveMatrix, tmp);\n  perspectiveMatrix[3] = 0;\n  perspectiveMatrix[7] = 0;\n  perspectiveMatrix[11] = 0;\n  perspectiveMatrix[15] = 1;\n\n  // If the perspectiveMatrix is not invertible, we are also unable to\n  // decompose, so we'll bail early. Constant taken from SkMatrix44::invert.\n  if (Math.abs(mat4.determinant(perspectiveMatrix)) < 1e-8) return false;\n  var a03 = tmp[3];\n  var a13 = tmp[7];\n  var a23 = tmp[11];\n  var a30 = tmp[12];\n  var a31 = tmp[13];\n  var a32 = tmp[14];\n  var a33 = tmp[15];\n\n  // First, isolate perspective.\n  if (a03 !== 0 || a13 !== 0 || a23 !== 0) {\n    tmpVec4[0] = a03;\n    tmpVec4[1] = a13;\n    tmpVec4[2] = a23;\n    tmpVec4[3] = a33;\n\n    // Solve the equation by inverting perspectiveMatrix and multiplying\n    // rightHandSide by the inverse.\n    // resuing the perspectiveMatrix here since it's no longer needed\n    var ret = mat4.invert(perspectiveMatrix, perspectiveMatrix);\n    if (!ret) return false;\n    mat4.transpose(perspectiveMatrix, perspectiveMatrix);\n\n    // multiply by transposed inverse perspective matrix, into perspective vec4\n    vec4.transformMat4(perspective, tmpVec4, perspectiveMatrix);\n  } else {\n    // no perspective\n    perspective[0] = perspective[1] = perspective[2] = 0;\n    perspective[3] = 1;\n  }\n\n  // Next take care of translation\n  translation[0] = a30;\n  translation[1] = a31;\n  translation[2] = a32;\n\n  // Now get scale and shear. 'row' is a 3 element array of 3 component vectors\n  mat3from4(row, tmp);\n\n  // Compute X scale factor and normalize first row.\n  scale[0] = vec3.length(row[0]);\n  vec3.normalize(row[0], row[0]);\n\n  // Compute XY shear factor and make 2nd row orthogonal to 1st.\n  skew[0] = vec3.dot(row[0], row[1]);\n  combine(row[1], row[1], row[0], 1.0, -skew[0]);\n\n  // Now, compute Y scale and normalize 2nd row.\n  scale[1] = vec3.length(row[1]);\n  vec3.normalize(row[1], row[1]);\n  skew[0] /= scale[1];\n\n  // Compute XZ and YZ shears, orthogonalize 3rd row\n  skew[1] = vec3.dot(row[0], row[2]);\n  combine(row[2], row[2], row[0], 1.0, -skew[1]);\n  skew[2] = vec3.dot(row[1], row[2]);\n  combine(row[2], row[2], row[1], 1.0, -skew[2]);\n\n  // Next, get Z scale and normalize 3rd row.\n  scale[2] = vec3.length(row[2]);\n  vec3.normalize(row[2], row[2]);\n  skew[1] /= scale[2];\n  skew[2] /= scale[2];\n\n  // At this point, the matrix (in rows) is orthonormal.\n  // Check for a coordinate system flip.  If the determinant\n  // is -1, then negate the matrix and the scaling factors.\n  vec3.cross(pdum3, row[1], row[2]);\n  if (vec3.dot(row[0], pdum3) < 0) {\n    for (var i = 0; i < 3; i++) {\n      scale[i] *= -1;\n      row[i][0] *= -1;\n      row[i][1] *= -1;\n      row[i][2] *= -1;\n    }\n  }\n\n  // Now, get the rotations out\n  quaternion[0] = 0.5 * Math.sqrt(Math.max(1 + row[0][0] - row[1][1] - row[2][2], 0));\n  quaternion[1] = 0.5 * Math.sqrt(Math.max(1 - row[0][0] + row[1][1] - row[2][2], 0));\n  quaternion[2] = 0.5 * Math.sqrt(Math.max(1 - row[0][0] - row[1][1] + row[2][2], 0));\n  quaternion[3] = 0.5 * Math.sqrt(Math.max(1 + row[0][0] + row[1][1] + row[2][2], 0));\n  if (row[2][1] > row[1][2]) quaternion[0] = -quaternion[0];\n  if (row[0][2] > row[2][0]) quaternion[1] = -quaternion[1];\n  if (row[1][0] > row[0][1]) quaternion[2] = -quaternion[2];\n  return true;\n}\nfunction normalize(out, mat) {\n  var m44 = mat[15];\n  // Cannot normalize.\n  if (m44 === 0) return false;\n  var scale = 1 / m44;\n  for (var i = 0; i < 16; i++) out[i] = mat[i] * scale;\n  return true;\n}\n\n// gets upper-left of a 4x4 matrix into a 3x3 of vectors\nfunction mat3from4(out, mat4x4) {\n  out[0][0] = mat4x4[0];\n  out[0][1] = mat4x4[1];\n  out[0][2] = mat4x4[2];\n  out[1][0] = mat4x4[4];\n  out[1][1] = mat4x4[5];\n  out[1][2] = mat4x4[6];\n  out[2][0] = mat4x4[8];\n  out[2][1] = mat4x4[9];\n  out[2][2] = mat4x4[10];\n}\nfunction combine(out, a, b, scale1, scale2) {\n  out[0] = a[0] * scale1 + b[0] * scale2;\n  out[1] = a[1] * scale1 + b[1] * scale2;\n  out[2] = a[2] * scale1 + b[2] * scale2;\n}\n\n/**\n * Different type of cameras, eg. simple camera used in 2D scene or\n * advanced camera which can do actions & switch between landmarks.\n */\n\nvar CameraType = /*#__PURE__*/function (CameraType) {\n  CameraType[CameraType[\"ORBITING\"] = 0] = \"ORBITING\";\n  CameraType[CameraType[\"EXPLORING\"] = 1] = \"EXPLORING\";\n  CameraType[CameraType[\"TRACKING\"] = 2] = \"TRACKING\";\n  return CameraType;\n}({});\n\n/**\n * CameraType must be TRACKING\n */\nvar CameraTrackingMode = /*#__PURE__*/function (CameraTrackingMode) {\n  CameraTrackingMode[CameraTrackingMode[\"DEFAULT\"] = 0] = \"DEFAULT\";\n  CameraTrackingMode[CameraTrackingMode[\"ROTATIONAL\"] = 1] = \"ROTATIONAL\";\n  CameraTrackingMode[CameraTrackingMode[\"TRANSLATIONAL\"] = 2] = \"TRANSLATIONAL\";\n  CameraTrackingMode[CameraTrackingMode[\"CINEMATIC\"] = 3] = \"CINEMATIC\";\n  return CameraTrackingMode;\n}({});\nvar CameraProjectionMode = /*#__PURE__*/function (CameraProjectionMode) {\n  CameraProjectionMode[CameraProjectionMode[\"ORTHOGRAPHIC\"] = 0] = \"ORTHOGRAPHIC\";\n  CameraProjectionMode[CameraProjectionMode[\"PERSPECTIVE\"] = 1] = \"PERSPECTIVE\";\n  return CameraProjectionMode;\n}({});\nvar CameraEvent = {\n  UPDATED: 'updated'\n};\nvar MIN_DISTANCE = 0.0002;\n\n/**\n * 参考「WebGL Insights - 23.Designing Cameras for WebGL Applications」，基于 Responsible Camera 思路设计\n * @see https://github.com/d13g0/nucleo.js/blob/master/source/camera/Camera.js\n *\n * 保存相机参数，定义相机动作：\n * 1. dolly 沿 n 轴移动\n * 2. pan 沿 u v 轴移动\n * 3. rotate 以方位角旋转\n * 4. 移动到 Landmark，具有平滑的动画效果，其间禁止其他用户交互\n */\n\nvar Camera = /*#__PURE__*/function () {\n  function Camera() {\n    _classCallCheck(this, Camera);\n    /**\n     * Clip space near Z, default to range `[-1, 1]`\n     */\n    this.clipSpaceNearZ = ClipSpaceNearZ.NEGATIVE_ONE;\n    this.eventEmitter = new EventEmitter();\n    /**\n     * Matrix of camera\n     */\n    this.matrix = mat4.create();\n    /**\n     * u axis +X is right\n     * @see http://learnwebgl.brown37.net/07_cameras/camera_introduction.html#a-camera-definition\n     */\n    this.right = vec3.fromValues(1, 0, 0);\n    /**\n     * v axis +Y is up\n     */\n    this.up = vec3.fromValues(0, 1, 0);\n    /**\n     * n axis +Z is inside\n     */\n    this.forward = vec3.fromValues(0, 0, 1);\n    /**\n     * Position of camera.\n     */\n    this.position = vec3.fromValues(0, 0, 1);\n    /**\n     * Position of focal point.\n     */\n    this.focalPoint = vec3.fromValues(0, 0, 0);\n    /**\n     * vector from focalPoint to position\n     */\n    this.distanceVector = vec3.fromValues(0, 0, -1);\n    /**\n     * length(focalPoint - position)\n     */\n    this.distance = 1;\n    /**\n     * @see https://en.wikipedia.org/wiki/Azimuth\n     */\n    this.azimuth = 0;\n    this.elevation = 0;\n    this.roll = 0;\n    this.relAzimuth = 0;\n    this.relElevation = 0;\n    this.relRoll = 0;\n    /**\n     * 沿 n 轴移动时，保证移动速度从快到慢\n     */\n    this.dollyingStep = 0;\n    this.maxDistance = Infinity;\n    this.minDistance = -Infinity;\n    /**\n     * zoom factor of the camera, default is 1\n     * eg. https://threejs.org/docs/#api/en/cameras/OrthographicCamera.zoom\n     */\n    this.zoom = 1;\n    /**\n     * invert the horizontal coordinate system HCS\n     */\n    this.rotateWorld = false;\n    /**\n     * 投影矩阵参数\n     */\n    /**\n     * field of view [0-360]\n     * @see http://en.wikipedia.org/wiki/Angle_of_view\n     */\n    this.fov = 30;\n    this.near = 0.1;\n    this.far = 1000;\n    this.aspect = 1;\n    this.projectionMatrix = mat4.create();\n    this.projectionMatrixInverse = mat4.create();\n    this.jitteredProjectionMatrix = undefined;\n    this.enableUpdate = true;\n    // protected following = undefined;\n    this.type = CameraType.EXPLORING;\n    this.trackingMode = CameraTrackingMode.DEFAULT;\n    this.projectionMode = CameraProjectionMode.PERSPECTIVE;\n    /**\n     * for culling use\n     */\n    this.frustum = new Frustum();\n    /**\n     * ortho matrix for Canvas2D & SVG\n     */\n    this.orthoMatrix = mat4.create();\n  }\n  return _createClass(Camera, [{\n    key: \"isOrtho\",\n    value:\n    // constructor(type = CameraType.EXPLORING, trackingMode = CameraTrackingMode.DEFAULT) {\n    //   this.setType(type, trackingMode);\n    // }\n\n    function isOrtho() {\n      return this.projectionMode === CameraProjectionMode.ORTHOGRAPHIC;\n    }\n  }, {\n    key: \"getProjectionMode\",\n    value: function getProjectionMode() {\n      return this.projectionMode;\n    }\n  }, {\n    key: \"getPerspective\",\n    value: function getPerspective() {\n      // account for TAA\n      return this.jitteredProjectionMatrix || this.projectionMatrix;\n    }\n  }, {\n    key: \"getPerspectiveInverse\",\n    value: function getPerspectiveInverse() {\n      return this.projectionMatrixInverse;\n    }\n  }, {\n    key: \"getFrustum\",\n    value: function getFrustum() {\n      return this.frustum;\n    }\n  }, {\n    key: \"getPosition\",\n    value: function getPosition() {\n      return this.position;\n    }\n  }, {\n    key: \"getFocalPoint\",\n    value: function getFocalPoint() {\n      return this.focalPoint;\n    }\n  }, {\n    key: \"getDollyingStep\",\n    value: function getDollyingStep() {\n      return this.dollyingStep;\n    }\n  }, {\n    key: \"getNear\",\n    value: function getNear() {\n      return this.near;\n    }\n  }, {\n    key: \"getFar\",\n    value: function getFar() {\n      return this.far;\n    }\n  }, {\n    key: \"getZoom\",\n    value: function getZoom() {\n      return this.zoom;\n    }\n  }, {\n    key: \"getOrthoMatrix\",\n    value: function getOrthoMatrix() {\n      return this.orthoMatrix;\n    }\n  }, {\n    key: \"getView\",\n    value: function getView() {\n      return this.view;\n    }\n  }, {\n    key: \"setEnableUpdate\",\n    value: function setEnableUpdate(enabled) {\n      this.enableUpdate = enabled;\n    }\n  }, {\n    key: \"setType\",\n    value: function setType(type, trackingMode) {\n      this.type = type;\n      if (this.type === CameraType.EXPLORING) {\n        this.setWorldRotation(true);\n      } else {\n        this.setWorldRotation(false);\n      }\n      this._getAngles();\n      if (this.type === CameraType.TRACKING && trackingMode !== undefined) {\n        this.setTrackingMode(trackingMode);\n      }\n      return this;\n    }\n  }, {\n    key: \"setProjectionMode\",\n    value: function setProjectionMode(projectionMode) {\n      this.projectionMode = projectionMode;\n      return this;\n    }\n  }, {\n    key: \"setTrackingMode\",\n    value: function setTrackingMode(trackingMode) {\n      if (this.type !== CameraType.TRACKING) {\n        throw new Error('Impossible to set a tracking mode if the camera is not of tracking type');\n      }\n      this.trackingMode = trackingMode;\n      return this;\n    }\n\n    /**\n     * If flag is true, it reverses the azimuth and elevation angles.\n     * Subsequent calls to rotate, setAzimuth, setElevation,\n     * changeAzimuth or changeElevation will cause the inverted effect.\n     * setRoll or changeRoll is not affected by this method.\n     *\n     * This inversion is useful when one wants to simulate that the world\n     * is moving, instead of the camera.\n     *\n     * By default the camera angles are not reversed.\n     * @param {Boolean} flag the boolean flag to reverse the angles.\n     */\n  }, {\n    key: \"setWorldRotation\",\n    value: function setWorldRotation(flag) {\n      this.rotateWorld = flag;\n      this._getAngles();\n      return this;\n    }\n\n    /**\n     * 计算 MV 矩阵，为相机矩阵的逆矩阵\n     */\n  }, {\n    key: \"getViewTransform\",\n    value: function getViewTransform() {\n      // mat4.scale(this.matrix, this.matrix, vec3.fromValues(1, -1, 1));\n\n      return mat4.invert(mat4.create(), this.matrix);\n    }\n  }, {\n    key: \"getWorldTransform\",\n    value: function getWorldTransform() {\n      return this.matrix;\n    }\n  }, {\n    key: \"jitterProjectionMatrix\",\n    value: function jitterProjectionMatrix(x, y) {\n      var translation = mat4.fromTranslation(mat4.create(), [x, y, 0]);\n      this.jitteredProjectionMatrix = mat4.multiply(mat4.create(), translation, this.projectionMatrix);\n    }\n  }, {\n    key: \"clearJitterProjectionMatrix\",\n    value: function clearJitterProjectionMatrix() {\n      this.jitteredProjectionMatrix = undefined;\n    }\n\n    /**\n     * 设置相机矩阵\n     */\n  }, {\n    key: \"setMatrix\",\n    value: function setMatrix(matrix) {\n      this.matrix = matrix;\n      this._update();\n      return this;\n    }\n\n    /**\n     * Set projection matrix manually.\n     */\n  }, {\n    key: \"setProjectionMatrix\",\n    value: function setProjectionMatrix(matrix) {\n      this.projectionMatrix = matrix;\n    }\n  }, {\n    key: \"setFov\",\n    value: function setFov(fov) {\n      this.setPerspective(this.near, this.far, fov, this.aspect);\n      return this;\n    }\n  }, {\n    key: \"setAspect\",\n    value: function setAspect(aspect) {\n      this.setPerspective(this.near, this.far, this.fov, aspect);\n      return this;\n    }\n  }, {\n    key: \"setNear\",\n    value: function setNear(near) {\n      if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n        this.setPerspective(near, this.far, this.fov, this.aspect);\n      } else {\n        this.setOrthographic(this.left, this.rright, this.top, this.bottom, near, this.far);\n      }\n      return this;\n    }\n  }, {\n    key: \"setFar\",\n    value: function setFar(far) {\n      if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n        this.setPerspective(this.near, far, this.fov, this.aspect);\n      } else {\n        this.setOrthographic(this.left, this.rright, this.top, this.bottom, this.near, far);\n      }\n      return this;\n    }\n\n    /**\n     * Sets an offset in a larger frustum, used in PixelPicking\n     */\n  }, {\n    key: \"setViewOffset\",\n    value: function setViewOffset(fullWidth, fullHeight, x, y, width, height) {\n      this.aspect = fullWidth / fullHeight;\n      if (this.view === undefined) {\n        this.view = {\n          enabled: true,\n          fullWidth: 1,\n          fullHeight: 1,\n          offsetX: 0,\n          offsetY: 0,\n          width: 1,\n          height: 1\n        };\n      }\n      this.view.enabled = true;\n      this.view.fullWidth = fullWidth;\n      this.view.fullHeight = fullHeight;\n      this.view.offsetX = x;\n      this.view.offsetY = y;\n      this.view.width = width;\n      this.view.height = height;\n      if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n        this.setPerspective(this.near, this.far, this.fov, this.aspect);\n      } else {\n        this.setOrthographic(this.left, this.rright, this.top, this.bottom, this.near, this.far);\n      }\n      return this;\n    }\n  }, {\n    key: \"clearViewOffset\",\n    value: function clearViewOffset() {\n      if (this.view !== undefined) {\n        this.view.enabled = false;\n      }\n      if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n        this.setPerspective(this.near, this.far, this.fov, this.aspect);\n      } else {\n        this.setOrthographic(this.left, this.rright, this.top, this.bottom, this.near, this.far);\n      }\n      return this;\n    }\n  }, {\n    key: \"setZoom\",\n    value: function setZoom(zoom) {\n      this.zoom = zoom;\n      if (this.projectionMode === CameraProjectionMode.ORTHOGRAPHIC) {\n        this.setOrthographic(this.left, this.rright, this.top, this.bottom, this.near, this.far);\n      } else if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n        this.setPerspective(this.near, this.far, this.fov, this.aspect);\n      }\n      return this;\n    }\n\n    /**\n     * Zoom by specified point in viewport coordinates.\n     */\n  }, {\n    key: \"setZoomByViewportPoint\",\n    value: function setZoomByViewportPoint(zoom, viewportPoint) {\n      var _this$canvas$viewport = this.canvas.viewport2Canvas({\n          x: viewportPoint[0],\n          y: viewportPoint[1]\n        }),\n        ox = _this$canvas$viewport.x,\n        oy = _this$canvas$viewport.y;\n      var roll = this.roll;\n      this.rotate(0, 0, -roll);\n      this.setPosition(ox, oy);\n      this.setFocalPoint(ox, oy);\n      this.setZoom(zoom);\n      this.rotate(0, 0, roll);\n      var _this$canvas$viewport2 = this.canvas.viewport2Canvas({\n          x: viewportPoint[0],\n          y: viewportPoint[1]\n        }),\n        cx = _this$canvas$viewport2.x,\n        cy = _this$canvas$viewport2.y;\n\n      // project to rotated axis\n      var dvec = vec3.fromValues(cx - ox, cy - oy, 0);\n      var dx = vec3.dot(dvec, this.right) / vec3.length(this.right);\n      var dy = vec3.dot(dvec, this.up) / vec3.length(this.up);\n      var _this$getPosition = this.getPosition(),\n        _this$getPosition2 = _slicedToArray(_this$getPosition, 2),\n        px = _this$getPosition2[0],\n        py = _this$getPosition2[1];\n      var _this$getFocalPoint = this.getFocalPoint(),\n        _this$getFocalPoint2 = _slicedToArray(_this$getFocalPoint, 2),\n        fx = _this$getFocalPoint2[0],\n        fy = _this$getFocalPoint2[1];\n      this.setPosition(px - dx, py - dy);\n      this.setFocalPoint(fx - dx, fy - dy);\n      return this;\n    }\n  }, {\n    key: \"setPerspective\",\n    value: function setPerspective(near, far, fov, aspect) {\n      var _this$view;\n      this.projectionMode = CameraProjectionMode.PERSPECTIVE;\n      this.fov = fov;\n      this.near = near;\n      this.far = far;\n      this.aspect = aspect;\n      var top = this.near * Math.tan(deg2rad(0.5 * this.fov)) / this.zoom;\n      var height = 2 * top;\n      var width = this.aspect * height;\n      var left = -0.5 * width;\n      if ((_this$view = this.view) !== null && _this$view !== void 0 && _this$view.enabled) {\n        var fullWidth = this.view.fullWidth;\n        var fullHeight = this.view.fullHeight;\n        left += this.view.offsetX * width / fullWidth;\n        top -= this.view.offsetY * height / fullHeight;\n        width *= this.view.width / fullWidth;\n        height *= this.view.height / fullHeight;\n      }\n      makePerspective(this.projectionMatrix, left, left + width, top - height, top, near, this.far, this.clipSpaceNearZ === ClipSpaceNearZ.ZERO);\n      mat4.invert(this.projectionMatrixInverse, this.projectionMatrix);\n      this.triggerUpdate();\n      return this;\n    }\n  }, {\n    key: \"setOrthographic\",\n    value: function setOrthographic(l, r, t, b, near, far) {\n      var _this$view2;\n      this.projectionMode = CameraProjectionMode.ORTHOGRAPHIC;\n      this.rright = r;\n      this.left = l;\n      this.top = t;\n      this.bottom = b;\n      this.near = near;\n      this.far = far;\n      var dx = (this.rright - this.left) / (2 * this.zoom);\n      var dy = (this.top - this.bottom) / (2 * this.zoom);\n      var cx = (this.rright + this.left) / 2;\n      var cy = (this.top + this.bottom) / 2;\n      var left = cx - dx;\n      var right = cx + dx;\n      var top = cy + dy;\n      var bottom = cy - dy;\n      if ((_this$view2 = this.view) !== null && _this$view2 !== void 0 && _this$view2.enabled) {\n        var scaleW = (this.rright - this.left) / this.view.fullWidth / this.zoom;\n        var scaleH = (this.top - this.bottom) / this.view.fullHeight / this.zoom;\n        left += scaleW * this.view.offsetX;\n        right = left + scaleW * this.view.width;\n        top -= scaleH * this.view.offsetY;\n        bottom = top - scaleH * this.view.height;\n      }\n      if (this.clipSpaceNearZ === ClipSpaceNearZ.NEGATIVE_ONE) {\n        // FlipY with switching bottom & top.\n        // @see https://stackoverflow.com/a/4886656\n        mat4.ortho(this.projectionMatrix, left, right, top, bottom, near, far);\n      } else {\n        mat4.orthoZO(this.projectionMatrix, left, right, top, bottom, near, far);\n      }\n      mat4.invert(this.projectionMatrixInverse, this.projectionMatrix);\n      this._getOrthoMatrix();\n      this.triggerUpdate();\n      return this;\n    }\n\n    /**\n     * Move the camera in world coordinates.\n     * It will keep looking at the current focal point.\n     *\n     * support scalars or vectors.\n     * @example\n     * setPosition(1, 2, 3);\n     * setPosition([1, 2, 3]);\n     */\n  }, {\n    key: \"setPosition\",\n    value: function setPosition(x) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.position[1];\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.position[2];\n      var position = createVec3(x, y, z);\n      this._setPosition(position);\n      this.setFocalPoint(this.focalPoint);\n      this.triggerUpdate();\n      return this;\n    }\n\n    /**\n     * Sets the focal point of this camera in world coordinates.\n     *\n     * support scalars or vectors.\n     * @example\n     * setFocalPoint(1, 2, 3);\n     * setFocalPoint([1, 2, 3]);\n     */\n  }, {\n    key: \"setFocalPoint\",\n    value: function setFocalPoint(x) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.focalPoint[1];\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : this.focalPoint[2];\n      var up = vec3.fromValues(0, 1, 0);\n      this.focalPoint = createVec3(x, y, z);\n      if (this.trackingMode === CameraTrackingMode.CINEMATIC) {\n        var d = vec3.subtract(vec3.create(), this.focalPoint, this.position);\n        x = d[0];\n        y = d[1];\n        z = d[2];\n        var r = vec3.length(d);\n        var el = rad2deg(Math.asin(y / r));\n        var az = 90 + rad2deg(Math.atan2(z, x));\n        var m = mat4.create();\n        mat4.rotateY(m, m, deg2rad(az));\n        mat4.rotateX(m, m, deg2rad(el));\n        up = vec3.transformMat4(vec3.create(), [0, 1, 0], m);\n      }\n      mat4.invert(this.matrix, mat4.lookAt(mat4.create(), this.position, this.focalPoint, up));\n      this._getAxes();\n      this._getDistance();\n      this._getAngles();\n      this.triggerUpdate();\n      return this;\n    }\n  }, {\n    key: \"getDistance\",\n    value: function getDistance() {\n      return this.distance;\n    }\n  }, {\n    key: \"getDistanceVector\",\n    value: function getDistanceVector() {\n      return this.distanceVector;\n    }\n\n    /**\n     * Moves the camera towards/from the focal point.\n     */\n  }, {\n    key: \"setDistance\",\n    value: function setDistance(d) {\n      if (this.distance === d || d < 0) {\n        return this;\n      }\n      this.distance = d;\n      if (this.distance < MIN_DISTANCE) {\n        this.distance = MIN_DISTANCE;\n      }\n      this.dollyingStep = this.distance / 100;\n      var pos = vec3.create();\n      d = this.distance;\n      var n = this.forward;\n      var f = this.focalPoint;\n      pos[0] = d * n[0] + f[0];\n      pos[1] = d * n[1] + f[1];\n      pos[2] = d * n[2] + f[2];\n      this._setPosition(pos);\n      this.triggerUpdate();\n      return this;\n    }\n  }, {\n    key: \"setMaxDistance\",\n    value: function setMaxDistance(d) {\n      this.maxDistance = d;\n      return this;\n    }\n  }, {\n    key: \"setMinDistance\",\n    value: function setMinDistance(d) {\n      this.minDistance = d;\n      return this;\n    }\n\n    /**\n     * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n     * the azimuth in degrees\n     */\n  }, {\n    key: \"setAzimuth\",\n    value: function setAzimuth(az) {\n      this.azimuth = getAngle(az);\n      this.computeMatrix();\n      this._getAxes();\n      if (this.type === CameraType.ORBITING || this.type === CameraType.EXPLORING) {\n        this._getPosition();\n      } else if (this.type === CameraType.TRACKING) {\n        this._getFocalPoint();\n      }\n      this.triggerUpdate();\n      return this;\n    }\n  }, {\n    key: \"getAzimuth\",\n    value: function getAzimuth() {\n      return this.azimuth;\n    }\n\n    /**\n     * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n     */\n  }, {\n    key: \"setElevation\",\n    value: function setElevation(el) {\n      this.elevation = getAngle(el);\n      this.computeMatrix();\n      this._getAxes();\n      if (this.type === CameraType.ORBITING || this.type === CameraType.EXPLORING) {\n        this._getPosition();\n      } else if (this.type === CameraType.TRACKING) {\n        this._getFocalPoint();\n      }\n      this.triggerUpdate();\n      return this;\n    }\n  }, {\n    key: \"getElevation\",\n    value: function getElevation() {\n      return this.elevation;\n    }\n\n    /**\n     * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n     */\n  }, {\n    key: \"setRoll\",\n    value: function setRoll(angle) {\n      this.roll = getAngle(angle);\n      this.computeMatrix();\n      this._getAxes();\n      if (this.type === CameraType.ORBITING || this.type === CameraType.EXPLORING) {\n        this._getPosition();\n      } else if (this.type === CameraType.TRACKING) {\n        this._getFocalPoint();\n      }\n      this.triggerUpdate();\n      return this;\n    }\n  }, {\n    key: \"getRoll\",\n    value: function getRoll() {\n      return this.roll;\n    }\n\n    /**\n     * 根据相机矩阵重新计算各种相机参数\n     */\n  }, {\n    key: \"_update\",\n    value: function _update() {\n      this._getAxes();\n      this._getPosition();\n      this._getDistance();\n      this._getAngles();\n      this._getOrthoMatrix();\n      this.triggerUpdate();\n    }\n\n    /**\n     * 计算相机矩阵\n     */\n  }, {\n    key: \"computeMatrix\",\n    value: function computeMatrix() {\n      // 使用四元数描述 3D 旋转\n      // @see https://xiaoiver.github.io/coding/2018/12/28/Camera-%E8%AE%BE%E8%AE%A1-%E4%B8%80.html\n      var rotZ = quat$1.setAxisAngle(quat$1.create(), [0, 0, 1], deg2rad(this.roll));\n      mat4.identity(this.matrix);\n\n      // only consider HCS for EXPLORING and ORBITING cameras\n      var rotX = quat$1.setAxisAngle(quat$1.create(), [1, 0, 0], deg2rad((this.rotateWorld && this.type !== CameraType.TRACKING || this.type === CameraType.TRACKING ? 1 : -1) * this.elevation));\n      var rotY = quat$1.setAxisAngle(quat$1.create(), [0, 1, 0], deg2rad((this.rotateWorld && this.type !== CameraType.TRACKING || this.type === CameraType.TRACKING ? 1 : -1) * this.azimuth));\n      var rotQ = quat$1.multiply(quat$1.create(), rotY, rotX);\n      rotQ = quat$1.multiply(quat$1.create(), rotQ, rotZ);\n      var rotMatrix = mat4.fromQuat(mat4.create(), rotQ);\n      if (this.type === CameraType.ORBITING || this.type === CameraType.EXPLORING) {\n        mat4.translate(this.matrix, this.matrix, this.focalPoint);\n        mat4.multiply(this.matrix, this.matrix, rotMatrix);\n        mat4.translate(this.matrix, this.matrix, [0, 0, this.distance]);\n      } else if (this.type === CameraType.TRACKING) {\n        mat4.translate(this.matrix, this.matrix, this.position);\n        mat4.multiply(this.matrix, this.matrix, rotMatrix);\n      }\n    }\n\n    /**\n     * Sets the camera position in the camera matrix\n     */\n  }, {\n    key: \"_setPosition\",\n    value: function _setPosition(x, y, z) {\n      this.position = createVec3(x, y, z);\n      var m = this.matrix;\n      m[12] = this.position[0];\n      m[13] = this.position[1];\n      m[14] = this.position[2];\n      m[15] = 1;\n      this._getOrthoMatrix();\n    }\n\n    /**\n     * Recalculates axes based on the current matrix\n     */\n  }, {\n    key: \"_getAxes\",\n    value: function _getAxes() {\n      vec3.copy(this.right, createVec3(vec4.transformMat4(vec4.create(), [1, 0, 0, 0], this.matrix)));\n      vec3.copy(this.up, createVec3(vec4.transformMat4(vec4.create(), [0, 1, 0, 0], this.matrix)));\n      vec3.copy(this.forward, createVec3(vec4.transformMat4(vec4.create(), [0, 0, 1, 0], this.matrix)));\n      vec3.normalize(this.right, this.right);\n      vec3.normalize(this.up, this.up);\n      vec3.normalize(this.forward, this.forward);\n    }\n\n    /**\n     * Recalculates euler angles based on the current state\n     */\n  }, {\n    key: \"_getAngles\",\n    value: function _getAngles() {\n      // Recalculates angles\n      var x = this.distanceVector[0];\n      var y = this.distanceVector[1];\n      var z = this.distanceVector[2];\n      var r = vec3.length(this.distanceVector);\n\n      // FAST FAIL: If there is no distance we cannot compute angles\n      if (r === 0) {\n        this.elevation = 0;\n        this.azimuth = 0;\n        return;\n      }\n      if (this.type === CameraType.TRACKING) {\n        this.elevation = rad2deg(Math.asin(y / r));\n        this.azimuth = rad2deg(Math.atan2(-x, -z));\n      } else if (this.rotateWorld) {\n        this.elevation = rad2deg(Math.asin(y / r));\n        this.azimuth = rad2deg(Math.atan2(-x, -z));\n      } else {\n        this.elevation = -rad2deg(Math.asin(y / r));\n        this.azimuth = -rad2deg(Math.atan2(-x, -z));\n      }\n    }\n\n    /**\n     * 重新计算相机位置，只有 ORBITING 模式相机位置才会发生变化\n     */\n  }, {\n    key: \"_getPosition\",\n    value: function _getPosition() {\n      vec3.copy(this.position, createVec3(vec4.transformMat4(vec4.create(), [0, 0, 0, 1], this.matrix)));\n\n      // 相机位置变化，需要重新计算视距\n      this._getDistance();\n    }\n\n    /**\n     * 重新计算视点，只有 TRACKING 模式视点才会发生变化\n     */\n  }, {\n    key: \"_getFocalPoint\",\n    value: function _getFocalPoint() {\n      vec3.transformMat3(this.distanceVector, [0, 0, -this.distance], mat3.fromMat4(mat3.create(), this.matrix));\n      vec3.add(this.focalPoint, this.position, this.distanceVector);\n\n      // 视点变化，需要重新计算视距\n      this._getDistance();\n    }\n\n    /**\n     * 重新计算视距\n     */\n  }, {\n    key: \"_getDistance\",\n    value: function _getDistance() {\n      this.distanceVector = vec3.subtract(vec3.create(), this.focalPoint, this.position);\n      this.distance = vec3.length(this.distanceVector);\n      this.dollyingStep = this.distance / 100;\n    }\n  }, {\n    key: \"_getOrthoMatrix\",\n    value: function _getOrthoMatrix() {\n      if (this.projectionMode !== CameraProjectionMode.ORTHOGRAPHIC) {\n        return;\n      }\n      var position = this.position;\n      var rotZ = quat$1.setAxisAngle(quat$1.create(), [0, 0, 1], -this.roll * Math.PI / 180);\n      mat4.fromRotationTranslationScaleOrigin(this.orthoMatrix, rotZ, vec3.fromValues((this.rright - this.left) / 2 - position[0], (this.top - this.bottom) / 2 - position[1], 0), vec3.fromValues(this.zoom, this.zoom, 1), position);\n    }\n  }, {\n    key: \"triggerUpdate\",\n    value: function triggerUpdate() {\n      if (this.enableUpdate) {\n        // update frustum\n        var viewMatrix = this.getViewTransform();\n        var vpMatrix = mat4.multiply(mat4.create(), this.getPerspective(), viewMatrix);\n        this.getFrustum().extractFromVPMatrix(vpMatrix);\n        this.eventEmitter.emit(CameraEvent.UPDATED);\n      }\n    }\n  }, {\n    key: \"rotate\",\n    value: function rotate(azimuth, elevation, roll) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"pan\",\n    value: function pan(tx, ty) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"dolly\",\n    value: function dolly(value) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"createLandmark\",\n    value: function createLandmark(name, params) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"gotoLandmark\",\n    value: function gotoLandmark(name, options) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"cancelLandmarkAnimation\",\n    value: function cancelLandmarkAnimation() {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }]);\n}();\n\n/**\n * @see https://doc.babylonjs.com/how_to/optimizing_your_scene#changing-mesh-culling-strategy\n */\nvar Strategy = /*#__PURE__*/function (Strategy) {\n  Strategy[Strategy[\"Standard\"] = 0] = \"Standard\";\n  return Strategy;\n}({});\nvar SortReason = /*#__PURE__*/function (SortReason) {\n  SortReason[SortReason[\"ADDED\"] = 0] = \"ADDED\";\n  SortReason[SortReason[\"REMOVED\"] = 1] = \"REMOVED\";\n  SortReason[SortReason[\"Z_INDEX_CHANGED\"] = 2] = \"Z_INDEX_CHANGED\";\n  return SortReason;\n}({});\nvar EMPTY_PARSED_PATH = {\n  absolutePath: [],\n  hasArc: false,\n  segments: [],\n  polygons: [],\n  polylines: [],\n  curve: null,\n  totalLength: 0,\n  rect: new Rectangle(0, 0, 0, 0)\n};\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type\n */\nvar PropertySyntax = /*#__PURE__*/function (PropertySyntax) {\n  PropertySyntax[\"COORDINATE\"] = \"<coordinate>\";\n  PropertySyntax[\"COLOR\"] = \"<color>\";\n  PropertySyntax[\"PAINT\"] = \"<paint>\";\n  PropertySyntax[\"NUMBER\"] = \"<number>\";\n  PropertySyntax[\"ANGLE\"] = \"<angle>\";\n  PropertySyntax[\"OPACITY_VALUE\"] = \"<opacity-value>\";\n  PropertySyntax[\"SHADOW_BLUR\"] = \"<shadow-blur>\";\n  PropertySyntax[\"LENGTH\"] = \"<length>\";\n  PropertySyntax[\"PERCENTAGE\"] = \"<percentage>\";\n  PropertySyntax[\"LENGTH_PERCENTAGE\"] = \"<length> | <percentage>\";\n  PropertySyntax[\"LENGTH_PERCENTAGE_12\"] = \"[<length> | <percentage>]{1,2}\";\n  PropertySyntax[\"LENGTH_PERCENTAGE_14\"] = \"[<length> | <percentage>]{1,4}\";\n  PropertySyntax[\"LIST_OF_POINTS\"] = \"<list-of-points>\";\n  PropertySyntax[\"PATH\"] = \"<path>\";\n  PropertySyntax[\"FILTER\"] = \"<filter>\";\n  PropertySyntax[\"Z_INDEX\"] = \"<z-index>\";\n  PropertySyntax[\"OFFSET_DISTANCE\"] = \"<offset-distance>\";\n  PropertySyntax[\"DEFINED_PATH\"] = \"<defined-path>\";\n  PropertySyntax[\"MARKER\"] = \"<marker>\";\n  PropertySyntax[\"TRANSFORM\"] = \"<transform>\";\n  PropertySyntax[\"TRANSFORM_ORIGIN\"] = \"<transform-origin>\";\n  PropertySyntax[\"TEXT\"] = \"<text>\";\n  PropertySyntax[\"TEXT_TRANSFORM\"] = \"<text-transform>\";\n  return PropertySyntax;\n}({});\nfunction memoize(func, resolver) {\n  if (typeof func !== 'function' || resolver != null && typeof resolver !== 'function') {\n    throw new TypeError('Expected a function');\n  }\n  var _memoized = function memoized() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    var key = resolver ? resolver.apply(this, args) : args[0];\n    var cache = _memoized.cache;\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    var result = func.apply(this, args);\n    _memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  _memoized.cache = new (memoize.Cache || Map)();\n  return _memoized;\n}\nmemoize.Cache = Map;\n\n// These units are iterated through, so be careful when adding or changing the\n// order.\nvar UnitType = /*#__PURE__*/function (UnitType) {\n  UnitType[UnitType[\"kUnknown\"] = 0] = \"kUnknown\";\n  UnitType[UnitType[\"kNumber\"] = 1] = \"kNumber\";\n  UnitType[UnitType[\"kPercentage\"] = 2] = \"kPercentage\";\n  UnitType[UnitType[\"kEms\"] = 3] = \"kEms\";\n  UnitType[UnitType[\"kPixels\"] = 4] = \"kPixels\";\n  UnitType[UnitType[\"kRems\"] = 5] = \"kRems\";\n  UnitType[UnitType[\"kDegrees\"] = 6] = \"kDegrees\";\n  UnitType[UnitType[\"kRadians\"] = 7] = \"kRadians\";\n  UnitType[UnitType[\"kGradians\"] = 8] = \"kGradians\";\n  UnitType[UnitType[\"kTurns\"] = 9] = \"kTurns\";\n  UnitType[UnitType[\"kMilliseconds\"] = 10] = \"kMilliseconds\";\n  UnitType[UnitType[\"kSeconds\"] = 11] = \"kSeconds\";\n  UnitType[UnitType[\"kInteger\"] = 12] = \"kInteger\";\n  return UnitType;\n}({}); // This value is used to handle quirky margins in reflow roots (body, td,\n// and th) like WinIE. The basic idea is that a stylesheet can use the value\n// __qem (for quirky em) instead of em. When the quirky value is used, if\n// you're in quirks mode, the margin will collapse away inside a table cell.\n// This quirk is specified in the HTML spec but our impl is different.\n// TODO: Remove this. crbug.com/443952\n// kQuirkyEms,\nvar UnitCategory = /*#__PURE__*/function (UnitCategory) {\n  UnitCategory[UnitCategory[\"kUNumber\"] = 0] = \"kUNumber\";\n  UnitCategory[UnitCategory[\"kUPercent\"] = 1] = \"kUPercent\";\n  UnitCategory[UnitCategory[\"kULength\"] = 2] = \"kULength\";\n  UnitCategory[UnitCategory[\"kUAngle\"] = 3] = \"kUAngle\";\n  UnitCategory[UnitCategory[\"kUTime\"] = 4] = \"kUTime\";\n  UnitCategory[UnitCategory[\"kUOther\"] = 5] = \"kUOther\";\n  return UnitCategory;\n}({});\nvar Nested = /*#__PURE__*/function (Nested) {\n  Nested[Nested[\"kYes\"] = 0] = \"kYes\";\n  Nested[Nested[\"kNo\"] = 1] = \"kNo\";\n  return Nested;\n}({});\nvar ParenLess = /*#__PURE__*/function (ParenLess) {\n  ParenLess[ParenLess[\"kYes\"] = 0] = \"kYes\";\n  ParenLess[ParenLess[\"kNo\"] = 1] = \"kNo\";\n  return ParenLess;\n}({});\n\n// This file specifies the unit strings used in CSSPrimitiveValues.\nvar data = [{\n  name: 'em',\n  unit_type: UnitType.kEms\n},\n// {\n//   name: 'ex',\n//   unit_type: UnitType.kExs,\n// },\n{\n  name: 'px',\n  unit_type: UnitType.kPixels\n},\n// {\n//   name: \"cm\",\n//   unit_type: UnitType.kCentimeters,\n// },\n// {\n//   name: \"mm\",\n//   unit_type: UnitType.kMillimeters,\n// },\n// {\n//   name: \"q\",\n//   unit_type: UnitType.kQuarterMillimeters,\n// },\n// {\n//   name: \"in\",\n//   unit_type: UnitType.kInches,\n// },\n// {\n//   name: \"pt\",\n//   unit_type: UnitType.kPoints,\n// },\n// {\n//   name: \"pc\",\n//   unit_type: UnitType.kPicas,\n// },\n{\n  name: 'deg',\n  unit_type: UnitType.kDegrees\n}, {\n  name: 'rad',\n  unit_type: UnitType.kRadians\n}, {\n  name: 'grad',\n  unit_type: UnitType.kGradians\n}, {\n  name: 'ms',\n  unit_type: UnitType.kMilliseconds\n}, {\n  name: 's',\n  unit_type: UnitType.kSeconds\n},\n// {\n//   name: \"hz\",\n//   unit_type: UnitType.kHertz,\n// },\n// {\n//   name: \"khz\",\n//   unit_type: UnitType.kKilohertz,\n// },\n// {\n//   name: \"dpi\",\n//   unit_type: \"kDotsPerInch\",\n// },\n// {\n//   name: \"dpcm\",\n//   unit_type: \"kDotsPerCentimeter\",\n// },\n// {\n//   name: \"dppx\",\n//   unit_type: \"kDotsPerPixel\",\n// },\n// {\n//   name: \"x\",\n//   unit_type: \"kDotsPerPixel\",\n// },\n// {\n//   name: \"vw\",\n//   unit_type: \"kViewportWidth\",\n// },\n// {\n//   name: \"vh\",\n//   unit_type: \"kViewportHeight\",\n// },\n// {\n//   name: \"vi\",\n//   unit_type: \"kViewportInlineSize\",\n// },\n// {\n//   name: \"vb\",\n//   unit_type: \"kViewportBlockSize\",\n// },\n// {\n//   name: \"vmin\",\n//   unit_type: UnitType.kViewportMin,\n// },\n// {\n//   name: \"vmax\",\n//   unit_type: UnitType.kViewportMax,\n// },\n// {\n//   name: \"svw\",\n//   unit_type: \"kSmallViewportWidth\",\n// },\n// {\n//   name: \"svh\",\n//   unit_type: \"kSmallViewportHeight\",\n// },\n// {\n//   name: \"svi\",\n//   unit_type: \"kSmallViewportInlineSize\",\n// },\n// {\n//   name: \"svb\",\n//   unit_type: \"kSmallViewportBlockSize\",\n// },\n// {\n//   name: \"svmin\",\n//   unit_type: \"kSmallViewportMin\",\n// },\n// {\n//   name: \"svmax\",\n//   unit_type: \"kSmallViewportMax\",\n// },\n// {\n//   name: \"lvw\",\n//   unit_type: \"kLargeViewportWidth\",\n// },\n// {\n//   name: \"lvh\",\n//   unit_type: \"kLargeViewportHeight\",\n// },\n// {\n//   name: \"lvi\",\n//   unit_type: \"kLargeViewportInlineSize\",\n// },\n// {\n//   name: \"lvb\",\n//   unit_type: \"kLargeViewportBlockSize\",\n// },\n// {\n//   name: \"lvmin\",\n//   unit_type: UnitType.kLargeViewportMin,\n// },\n// {\n//   name: \"lvmax\",\n//   unit_type: UnitType.kLargeViewportMax,\n// },\n// {\n//   name: \"dvw\",\n//   unit_type: UnitType.kDynamicViewportWidth,\n// },\n// {\n//   name: \"dvh\",\n//   unit_type: UnitType.kDynamicViewportHeight,\n// },\n// {\n//   name: \"dvi\",\n//   unit_type: UnitType.kDynamicViewportInlineSize,\n// },\n// {\n//   name: \"dvb\",\n//   unit_type: UnitType.kDynamicViewportBlockSize,\n// },\n// {\n//   name: \"dvmin\",\n//   unit_type: UnitType.kDynamicViewportMin,\n// },\n// {\n//   name: \"dvmax\",\n//   unit_type: UnitType.kDynamicViewportMax,\n// },\n// {\n//   name: \"cqw\",\n//   unit_type: UnitType.kContainerWidth,\n// },\n// {\n//   name: \"cqh\",\n//   unit_type: UnitType.kContainerHeight,\n// },\n// {\n//   name: \"cqi\",\n//   unit_type: UnitType.kContainerInlineSize,\n// },\n// {\n//   name: \"cqb\",\n//   unit_type: UnitType.kContainerBlockSize,\n// },\n// {\n//   name: \"cqmin\",\n//   unit_type: UnitType.kContainerMin,\n// },\n// {\n//   name: \"cqmax\",\n//   unit_type: UnitType.kContainerMax,\n// },\n{\n  name: 'rem',\n  unit_type: UnitType.kRems\n},\n// {\n//   name: 'fr',\n//   unit_type: UnitType.kFraction,\n// },\n{\n  name: 'turn',\n  unit_type: UnitType.kTurns\n}\n// {\n//   name: 'ch',\n//   unit_type: UnitType.kChs,\n// },\n// {\n//   name: '__qem',\n//   unit_type: UnitType.kQuirkyEms,\n// },\n];\nvar CSSStyleValueType = /*#__PURE__*/function (CSSStyleValueType) {\n  CSSStyleValueType[CSSStyleValueType[\"kUnknownType\"] = 0] = \"kUnknownType\";\n  CSSStyleValueType[CSSStyleValueType[\"kUnparsedType\"] = 1] = \"kUnparsedType\";\n  CSSStyleValueType[CSSStyleValueType[\"kKeywordType\"] = 2] = \"kKeywordType\";\n  CSSStyleValueType[CSSStyleValueType[\"kUnitType\"] = 3] = \"kUnitType\";\n  CSSStyleValueType[CSSStyleValueType[\"kSumType\"] = 4] = \"kSumType\";\n  CSSStyleValueType[CSSStyleValueType[\"kProductType\"] = 5] = \"kProductType\";\n  CSSStyleValueType[CSSStyleValueType[\"kNegateType\"] = 6] = \"kNegateType\";\n  CSSStyleValueType[CSSStyleValueType[\"kInvertType\"] = 7] = \"kInvertType\";\n  CSSStyleValueType[CSSStyleValueType[\"kMinType\"] = 8] = \"kMinType\";\n  CSSStyleValueType[CSSStyleValueType[\"kMaxType\"] = 9] = \"kMaxType\";\n  CSSStyleValueType[CSSStyleValueType[\"kClampType\"] = 10] = \"kClampType\";\n  CSSStyleValueType[CSSStyleValueType[\"kTransformType\"] = 11] = \"kTransformType\";\n  CSSStyleValueType[CSSStyleValueType[\"kPositionType\"] = 12] = \"kPositionType\";\n  CSSStyleValueType[CSSStyleValueType[\"kURLImageType\"] = 13] = \"kURLImageType\";\n  CSSStyleValueType[CSSStyleValueType[\"kColorType\"] = 14] = \"kColorType\";\n  CSSStyleValueType[CSSStyleValueType[\"kUnsupportedColorType\"] = 15] = \"kUnsupportedColorType\";\n  return CSSStyleValueType;\n}({});\n\n// function parseCSSStyleValue(propertyName: string, value: string): CSSStyleValue[] {\n//   // const propertyId = cssPropertyID(propertyName);\n\n//   // if (propertyId === CSSPropertyID.kInvalid) {\n//   //   return [];\n//   // }\n\n//   // const customPropertyName = propertyId === CSSPropertyID.kVariable ? propertyName : null;\n//   // return fromString(propertyId, customPropertyName, value);\n//   return [];\n// }\n\nvar stringToUnitType = function stringToUnitType(name) {\n  return data.find(function (item) {\n    return item.name === name;\n  }).unit_type;\n};\nvar unitFromName = function unitFromName(name) {\n  if (!name) {\n    return UnitType.kUnknown;\n  }\n  if (name === 'number') {\n    return UnitType.kNumber;\n  }\n  if (name === 'percent' || name === '%') {\n    return UnitType.kPercentage;\n  }\n  return stringToUnitType(name);\n};\nvar unitTypeToUnitCategory = function unitTypeToUnitCategory(type) {\n  switch (type) {\n    case UnitType.kNumber:\n    case UnitType.kInteger:\n      return UnitCategory.kUNumber;\n    case UnitType.kPercentage:\n      return UnitCategory.kUPercent;\n    case UnitType.kPixels:\n      // case UnitType.kCentimeters:\n      // case UnitType.kMillimeters:\n      // case UnitType.kQuarterMillimeters:\n      // case UnitType.kInches:\n      // case UnitType.kPoints:\n      // case UnitType.kPicas:\n      // case UnitType.kUserUnits:\n      return UnitCategory.kULength;\n    case UnitType.kMilliseconds:\n    case UnitType.kSeconds:\n      return UnitCategory.kUTime;\n    case UnitType.kDegrees:\n    case UnitType.kRadians:\n    case UnitType.kGradians:\n    case UnitType.kTurns:\n      return UnitCategory.kUAngle;\n    // case UnitType.kHertz:\n    // case UnitType.kKilohertz:\n    //   return UnitCategory.kUFrequency;\n    // case UnitType.kDotsPerPixel:\n    // case UnitType.kDotsPerInch:\n    // case UnitType.kDotsPerCentimeter:\n    //   return UnitCategory.kUResolution;\n    default:\n      return UnitCategory.kUOther;\n  }\n};\nvar canonicalUnitTypeForCategory = function canonicalUnitTypeForCategory(category) {\n  // The canonical unit type is chosen according to the way\n  // CSSPropertyParser.ValidUnit() chooses the default unit in each category\n  // (based on unitflags).\n  switch (category) {\n    case UnitCategory.kUNumber:\n      return UnitType.kNumber;\n    case UnitCategory.kULength:\n      return UnitType.kPixels;\n    case UnitCategory.kUPercent:\n      return UnitType.kPercentage;\n    // return UnitType.kUnknown; // Cannot convert between numbers and percent.\n    case UnitCategory.kUTime:\n      return UnitType.kSeconds;\n    case UnitCategory.kUAngle:\n      return UnitType.kDegrees;\n    // case UnitCategory.kUFrequency:\n    //   return UnitType.kHertz;\n    // case UnitCategory.kUResolution:\n    //   return UnitType.kDotsPerPixel;\n    default:\n      return UnitType.kUnknown;\n  }\n};\n\n/**\n * @see https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/css/css_primitive_value.cc#353\n */\nvar conversionToCanonicalUnitsScaleFactor = function conversionToCanonicalUnitsScaleFactor(unit_type) {\n  var factor = 1.0;\n  // FIXME: the switch can be replaced by an array of scale factors.\n  switch (unit_type) {\n    // These are \"canonical\" units in their respective categories.\n    case UnitType.kPixels:\n    // case UnitType.kUserUnits:\n    case UnitType.kDegrees:\n    case UnitType.kSeconds:\n      // case UnitType.kHertz:\n      break;\n    case UnitType.kMilliseconds:\n      factor = 0.001;\n      break;\n    // case UnitType.kCentimeters:\n    //   // factor = kCssPixelsPerCentimeter;\n    //   break;\n    // case UnitType.kDotsPerCentimeter:\n    //   // factor = 1 / kCssPixelsPerCentimeter;\n    //   break;\n    // case UnitType.kMillimeters:\n    //   // factor = kCssPixelsPerMillimeter;\n    //   break;\n    // case UnitType.kQuarterMillimeters:\n    //   // factor = kCssPixelsPerQuarterMillimeter;\n    //   break;\n    // case UnitType.kInches:\n    //   // factor = kCssPixelsPerInch;\n    //   break;\n    // case UnitType.kDotsPerInch:\n    //   // factor = 1 / kCssPixelsPerInch;\n    //   break;\n    // case UnitType.kPoints:\n    //   // factor = kCssPixelsPerPoint;\n    //   break;\n    // case UnitType.kPicas:\n    //   // factor = kCssPixelsPerPica;\n    //   break;\n    case UnitType.kRadians:\n      factor = 180 / Math.PI;\n      break;\n    case UnitType.kGradians:\n      factor = 0.9;\n      break;\n    case UnitType.kTurns:\n      factor = 360;\n      break;\n  }\n  return factor;\n};\nvar unitTypeToString = function unitTypeToString(type) {\n  switch (type) {\n    case UnitType.kNumber:\n    case UnitType.kInteger:\n      // case UnitType.kUserUnits:\n      return '';\n    case UnitType.kPercentage:\n      return '%';\n    case UnitType.kEms:\n      // case UnitType.kQuirkyEms:\n      return 'em';\n    // case UnitType.kExs:\n    //   return 'ex';\n    case UnitType.kRems:\n      return 'rem';\n    // case UnitType.kChs:\n    //   return 'ch';\n    case UnitType.kPixels:\n      return 'px';\n    // case UnitType.kCentimeters:\n    //   return 'cm';\n    // case UnitType.kDotsPerPixel:\n    //   return 'dppx';\n    // case UnitType.kDotsPerInch:\n    //   return 'dpi';\n    // case UnitType.kDotsPerCentimeter:\n    //   return 'dpcm';\n    // case UnitType.kMillimeters:\n    //   return 'mm';\n    // case UnitType.kQuarterMillimeters:\n    //   return 'q';\n    // case UnitType.kInches:\n    //   return 'in';\n    // case UnitType.kPoints:\n    //   return 'pt';\n    // case UnitType.kPicas:\n    //   return 'pc';\n    case UnitType.kDegrees:\n      return 'deg';\n    case UnitType.kRadians:\n      return 'rad';\n    case UnitType.kGradians:\n      return 'grad';\n    case UnitType.kMilliseconds:\n      return 'ms';\n    case UnitType.kSeconds:\n      return 's';\n    // case UnitType.kHertz:\n    //   return 'hz';\n    // case UnitType.kKilohertz:\n    //   return 'khz';\n    case UnitType.kTurns:\n      return 'turn';\n  }\n  return '';\n};\n\n/**\n * CSSStyleValue is the base class for all CSS values accessible from Typed OM.\n * Values that are not yet supported as specific types are also returned as base CSSStyleValues.\n *\n * Spec @see https://drafts.css-houdini.org/css-typed-om/#stylevalue-objects\n * Docs @see https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleValue\n */\nvar CSSStyleValue = /*#__PURE__*/function () {\n  function CSSStyleValue() {\n    _classCallCheck(this, CSSStyleValue);\n  }\n  return _createClass(CSSStyleValue, [{\n    key: \"toString\",\n    value:\n    // protected abstract toCSSValue(): CSSValue;\n\n    function toString() {\n      return this.buildCSSText(Nested.kNo, ParenLess.kNo, '');\n    }\n  }, {\n    key: \"isNumericValue\",\n    value: function isNumericValue() {\n      return this.getType() >= CSSStyleValueType.kUnitType && this.getType() <= CSSStyleValueType.kClampType;\n    }\n  }], [{\n    key: \"isAngle\",\n    value:\n    // static parse(propertyName: string, value: string): CSSStyleValue {\n    //   return parseCSSStyleValue(propertyName, value)[0];\n    // }\n\n    // static parseAll(propertyName: string, value: string): CSSStyleValue[] {\n    //   return parseCSSStyleValue(propertyName, value);\n    // }\n\n    function isAngle(unit) {\n      return unit === UnitType.kDegrees || unit === UnitType.kRadians || unit === UnitType.kGradians || unit === UnitType.kTurns;\n    }\n\n    // static isViewportPercentageLength(type: UnitType) {\n    //   return type >= UnitType.kViewportWidth && type <= UnitType.kDynamicViewportMax;\n    // }\n\n    // static isContainerPercentageLength(type: UnitType) {\n    //   return type >= UnitType.kContainerWidth && type <= UnitType.kContainerMax;\n    // }\n  }, {\n    key: \"isLength\",\n    value: function isLength(type) {\n      // return (type >= UnitType.kEms && type <= UnitType.kUserUnits) || type == UnitType.kQuirkyEms;\n      return type >= UnitType.kEms && type < UnitType.kDegrees;\n    }\n  }, {\n    key: \"isRelativeUnit\",\n    value: function isRelativeUnit(type) {\n      return type === UnitType.kPercentage || type === UnitType.kEms ||\n      // type === UnitType.kExs ||\n      type === UnitType.kRems\n      // type === UnitType.kChs ||\n      // this.isViewportPercentageLength(type) ||\n      // this.isContainerPercentageLength(type)\n      ;\n    }\n  }, {\n    key: \"isTime\",\n    value: function isTime(unit) {\n      return unit === UnitType.kSeconds || unit === UnitType.kMilliseconds;\n    }\n\n    // static isFrequency(unit: UnitType) {\n    //   return unit == UnitType.kHertz || unit == UnitType.kKilohertz;\n    // }\n\n    // static isResolution(type: UnitType) {\n    //   return type >= UnitType.kDotsPerPixel && type <= UnitType.kDotsPerCentimeter;\n    // }\n\n    // static isFlex(unit: UnitType) {\n    //   return unit === UnitType.kFraction;\n    // }\n  }]);\n}();\n\n/**\n * @see https://drafts.css-houdini.org/css-typed-om-1/#dom-csscolorvalue-colorspace\n */\n\n/**\n * CSSColorValue is the base class used for the various CSS color interfaces.\n *\n * @see https://drafts.css-houdini.org/css-typed-om-1/#colorvalue-objects\n */\nvar CSSColorValue = /*#__PURE__*/function (_CSSStyleValue) {\n  function CSSColorValue(colorSpace) {\n    var _this;\n    _classCallCheck(this, CSSColorValue);\n    _this = _callSuper(this, CSSColorValue);\n    _this.colorSpace = colorSpace;\n    return _this;\n  }\n  _inherits(CSSColorValue, _CSSStyleValue);\n  return _createClass(CSSColorValue, [{\n    key: \"getType\",\n    value: function getType() {\n      return CSSStyleValueType.kColorType;\n    }\n\n    /**\n     * @see https://drafts.css-houdini.org/css-typed-om-1/#dom-csscolorvalue-to\n     */\n  }, {\n    key: \"to\",\n    value: function to(colorSpace) {\n      return this;\n    }\n  }]);\n}(CSSStyleValue);\nvar GradientType = /*#__PURE__*/function (GradientType) {\n  GradientType[GradientType[\"Constant\"] = 0] = \"Constant\";\n  GradientType[GradientType[\"LinearGradient\"] = 1] = \"LinearGradient\";\n  GradientType[GradientType[\"RadialGradient\"] = 2] = \"RadialGradient\";\n  return GradientType;\n}({});\nvar CSSGradientValue = /*#__PURE__*/function (_CSSStyleValue) {\n  function CSSGradientValue(type, value) {\n    var _this;\n    _classCallCheck(this, CSSGradientValue);\n    _this = _callSuper(this, CSSGradientValue);\n    _this.type = type;\n    _this.value = value;\n    return _this;\n  }\n  _inherits(CSSGradientValue, _CSSStyleValue);\n  return _createClass(CSSGradientValue, [{\n    key: \"clone\",\n    value: function clone() {\n      return new CSSGradientValue(this.type, this.value);\n    }\n  }, {\n    key: \"buildCSSText\",\n    value: function buildCSSText(n, p, result) {\n      return result;\n    }\n  }, {\n    key: \"getType\",\n    value: function getType() {\n      return CSSStyleValueType.kColorType;\n    }\n  }]);\n}(CSSStyleValue);\n\n/**\n * CSSKeywordValue represents CSS Values that are specified as keywords\n * eg. 'initial'\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSSKeywordValue\n * @see https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/css/cssom/css_keyword_value.idl\n */\nvar CSSKeywordValue = /*#__PURE__*/function (_CSSStyleValue) {\n  function CSSKeywordValue(value) {\n    var _this;\n    _classCallCheck(this, CSSKeywordValue);\n    _this = _callSuper(this, CSSKeywordValue);\n    _this.value = value;\n    return _this;\n  }\n  _inherits(CSSKeywordValue, _CSSStyleValue);\n  return _createClass(CSSKeywordValue, [{\n    key: \"clone\",\n    value: function clone() {\n      return new CSSKeywordValue(this.value);\n    }\n  }, {\n    key: \"getType\",\n    value: function getType() {\n      return CSSStyleValueType.kKeywordType;\n    }\n  }, {\n    key: \"buildCSSText\",\n    value: function buildCSSText(n, p, result) {\n      return result + this.value;\n    }\n  }]);\n}(CSSStyleValue);\nvar formatInfinityOrNaN = function formatInfinityOrNaN(number) {\n  var suffix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n  var result = '';\n  if (!Number.isFinite(number)) {\n    if (number > 0) result = 'infinity';else result = '-infinity';\n  } else {\n    result = 'NaN';\n  }\n  return result += suffix;\n};\nvar toCanonicalUnit = function toCanonicalUnit(unit) {\n  return canonicalUnitTypeForCategory(unitTypeToUnitCategory(unit));\n};\n\n/**\n * CSSNumericValue is the base class for numeric and length typed CSS Values.\n * @see https://drafts.css-houdini.org/css-typed-om/#numeric-objects\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSSNumericValue\n * @see https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/css/cssom/css_numeric_value.idl\n */\n\n/**\n * Represents numeric values that can be expressed as a single number plus a\n * unit (or a naked number or percentage).\n * @see https://drafts.css-houdini.org/css-typed-om/#cssunitvalue\n */\nvar CSSUnitValue = /*#__PURE__*/function (_CSSStyleValue) {\n  function CSSUnitValue(value) {\n    var _this;\n    var unitOrName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : UnitType.kNumber;\n    _classCallCheck(this, CSSUnitValue);\n    _this = _callSuper(this, CSSUnitValue);\n    var unit;\n    if (typeof unitOrName === 'string') {\n      unit = unitFromName(unitOrName);\n    } else {\n      unit = unitOrName;\n    }\n    _this.unit = unit;\n    _this.value = value;\n    return _this;\n  }\n  _inherits(CSSUnitValue, _CSSStyleValue);\n  return _createClass(CSSUnitValue, [{\n    key: \"clone\",\n    value: function clone() {\n      return new CSSUnitValue(this.value, this.unit);\n    }\n  }, {\n    key: \"equals\",\n    value: function equals(other) {\n      var other_unit_value = other;\n      return this.value === other_unit_value.value && this.unit === other_unit_value.unit;\n    }\n  }, {\n    key: \"getType\",\n    value: function getType() {\n      return CSSStyleValueType.kUnitType;\n    }\n  }, {\n    key: \"convertTo\",\n    value: function convertTo(target_unit) {\n      if (this.unit === target_unit) {\n        return new CSSUnitValue(this.value, this.unit);\n      }\n\n      // Instead of defining the scale factors for every unit to every other unit,\n      // we simply convert to the canonical unit and back since we already have\n      // the scale factors for canonical units.\n      var canonical_unit = toCanonicalUnit(this.unit);\n      if (canonical_unit !== toCanonicalUnit(target_unit) || canonical_unit === UnitType.kUnknown) {\n        return null;\n      }\n      var scale_factor = conversionToCanonicalUnitsScaleFactor(this.unit) / conversionToCanonicalUnitsScaleFactor(target_unit);\n      return new CSSUnitValue(this.value * scale_factor, target_unit);\n    }\n  }, {\n    key: \"buildCSSText\",\n    value: function buildCSSText(n, p, result) {\n      var text;\n      switch (this.unit) {\n        case UnitType.kUnknown:\n          // FIXME\n          break;\n        case UnitType.kInteger:\n          text = Number(this.value).toFixed(0);\n          break;\n        case UnitType.kNumber:\n        case UnitType.kPercentage:\n        case UnitType.kEms:\n        // case UnitType.kQuirkyEms:\n        // case UnitType.kExs:\n        case UnitType.kRems:\n        // case UnitType.kChs:\n        case UnitType.kPixels:\n        // case UnitType.kCentimeters:\n        // case UnitType.kDotsPerPixel:\n        // case UnitType.kDotsPerInch:\n        // case UnitType.kDotsPerCentimeter:\n        // case UnitType.kMillimeters:\n        // case UnitType.kQuarterMillimeters:\n        // case UnitType.kInches:\n        // case UnitType.kPoints:\n        // case UnitType.kPicas:\n        // case UnitType.kUserUnits:\n        case UnitType.kDegrees:\n        case UnitType.kRadians:\n        case UnitType.kGradians:\n        case UnitType.kMilliseconds:\n        case UnitType.kSeconds:\n        // case UnitType.kHertz:\n        // case UnitType.kKilohertz:\n        case UnitType.kTurns:\n          {\n            // case UnitType.kContainerMax: { // case UnitType.kContainerMin: // case UnitType.kContainerBlockSize: // case UnitType.kContainerInlineSize: // case UnitType.kContainerHeight: // case UnitType.kContainerWidth: // case UnitType.kDynamicViewportMax: // case UnitType.kDynamicViewportMin: // case UnitType.kDynamicViewportBlockSize: // case UnitType.kDynamicViewportInlineSize: // case UnitType.kDynamicViewportHeight: // case UnitType.kDynamicViewportWidth: // case UnitType.kLargeViewportMax: // case UnitType.kLargeViewportMin: // case UnitType.kLargeViewportBlockSize: // case UnitType.kLargeViewportInlineSize: // case UnitType.kLargeViewportHeight: // case UnitType.kLargeViewportWidth: // case UnitType.kSmallViewportMax: // case UnitType.kSmallViewportMin: // case UnitType.kSmallViewportBlockSize: // case UnitType.kSmallViewportInlineSize: // case UnitType.kSmallViewportHeight: // case UnitType.kSmallViewportWidth: // case UnitType.kViewportMax: // case UnitType.kViewportMin: // case UnitType.kViewportBlockSize: // case UnitType.kViewportInlineSize: // case UnitType.kViewportHeight: // case UnitType.kViewportWidth: // case UnitType.kFraction:\n            var kMinInteger = -999999;\n            var kMaxInteger = 999999;\n            var value = this.value;\n            var unit = unitTypeToString(this.unit);\n            if (value < kMinInteger || value > kMaxInteger) {\n              var _unit = unitTypeToString(this.unit);\n              if (!Number.isFinite(value) || Number.isNaN(value)) {\n                text = formatInfinityOrNaN(value, _unit);\n              } else {\n                text = value + (_unit || '');\n              }\n            } else {\n              text = \"\".concat(value).concat(unit);\n            }\n          }\n      }\n      result += text;\n      return result;\n    }\n  }]);\n}(CSSStyleValue);\nvar Opx = new CSSUnitValue(0, 'px');\nnew CSSUnitValue(1, 'px');\nvar Odeg = new CSSUnitValue(0, 'deg');\n\n/**\n * The CSSRGB class represents the CSS rgb()/rgba() functions.\n *\n * @see https://drafts.css-houdini.org/css-typed-om-1/#cssrgb\n */\nvar CSSRGB = /*#__PURE__*/function (_CSSColorValue) {\n  function CSSRGB(r, g, b) {\n    var _this;\n    var alpha = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n    var isNone = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n    _classCallCheck(this, CSSRGB);\n    _this = _callSuper(this, CSSRGB, ['rgb']);\n    _this.r = r;\n    _this.g = g;\n    _this.b = b;\n    _this.alpha = alpha;\n    _this.isNone = isNone;\n    return _this;\n  }\n  _inherits(CSSRGB, _CSSColorValue);\n  return _createClass(CSSRGB, [{\n    key: \"clone\",\n    value: function clone() {\n      return new CSSRGB(this.r, this.g, this.b, this.alpha);\n    }\n  }, {\n    key: \"buildCSSText\",\n    value: function buildCSSText(n, p, result) {\n      return \"\".concat(result, \"rgba(\").concat(this.r, \",\").concat(this.g, \",\").concat(this.b, \",\").concat(this.alpha, \")\");\n    }\n  }]);\n}(CSSColorValue);\n\n/**\n * CSSKeywordValue\n */\nvar unsetKeywordValue = new CSSKeywordValue('unset');\nvar initialKeywordValue = new CSSKeywordValue('initial');\nvar inheritKeywordValue = new CSSKeywordValue('inherit');\nvar keywordCache = {\n  '': unsetKeywordValue,\n  unset: unsetKeywordValue,\n  initial: initialKeywordValue,\n  inherit: inheritKeywordValue\n};\nvar getOrCreateKeyword = function getOrCreateKeyword(name) {\n  if (!keywordCache[name]) {\n    keywordCache[name] = new CSSKeywordValue(name);\n  }\n  return keywordCache[name];\n};\n\n/**\n * CSSColor\n */\nvar noneColor = new CSSRGB(0, 0, 0, 0, true);\nvar transparentColor = new CSSRGB(0, 0, 0, 0);\nvar getOrCreateRGBA = memoize(function (r, g, b, a) {\n  return new CSSRGB(r, g, b, a);\n}, function (r, g, b, a) {\n  return \"rgba(\".concat(r, \",\").concat(g, \",\").concat(b, \",\").concat(a, \")\");\n});\n\n// export const getOrCreateUnitValue = memoize(\n//   (value: number, unitOrName: UnitType | string = UnitType.kNumber) => {\n//     return new CSSUnitValue(value, unitOrName);\n//   },\n//   (value: number, unitOrName: UnitType | string = UnitType.kNumber) => {\n//     return `${value}${unitOrName}`;\n//   },\n// );\n\nvar getOrCreateUnitValue = function getOrCreateUnitValue(value) {\n  var unitOrName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : UnitType.kNumber;\n  return new CSSUnitValue(value, unitOrName);\n};\nnew CSSUnitValue(50, '%');\n\n/**\n * borrow from gradient-parser, but we delete some browser compatible prefix such as `-webkit-`\n * @see https://github.com/rafaelcaricio/gradient-parser\n */\n\nfunction colorStopToString(colorStop) {\n  var type = colorStop.type,\n    value = colorStop.value;\n  if (type === 'hex') {\n    return \"#\".concat(value);\n  }\n  if (type === 'literal') {\n    return value;\n  }\n  if (type === 'rgb') {\n    return \"rgb(\".concat(value.join(','), \")\");\n  }\n  return \"rgba(\".concat(value.join(','), \")\");\n}\nvar parseGradient$1 = function () {\n  var tokens = {\n    linearGradient: /^(linear\\-gradient)/i,\n    repeatingLinearGradient: /^(repeating\\-linear\\-gradient)/i,\n    radialGradient: /^(radial\\-gradient)/i,\n    repeatingRadialGradient: /^(repeating\\-radial\\-gradient)/i,\n    /**\n     * @see https://projects.verou.me/conic-gradient/\n     */\n    conicGradient: /^(conic\\-gradient)/i,\n    sideOrCorner: /^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,\n    extentKeywords: /^(closest\\-side|closest\\-corner|farthest\\-side|farthest\\-corner|contain|cover)/,\n    positionKeywords: /^(left|center|right|top|bottom)/i,\n    pixelValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))px/,\n    percentageValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))\\%/,\n    emValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))em/,\n    angleValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))deg/,\n    startCall: /^\\(/,\n    endCall: /^\\)/,\n    comma: /^,/,\n    hexColor: /^\\#([0-9a-fA-F]+)/,\n    literalColor: /^([a-zA-Z]+)/,\n    rgbColor: /^rgb/i,\n    rgbaColor: /^rgba/i,\n    number: /^(([0-9]*\\.[0-9]+)|([0-9]+\\.?))/\n  };\n  var input = '';\n  function error(msg) {\n    throw new Error(\"\".concat(input, \": \").concat(msg));\n  }\n  function getAST() {\n    var ast = matchListDefinitions();\n    if (input.length > 0) {\n      error('Invalid input not EOF');\n    }\n    return ast;\n  }\n  function matchListDefinitions() {\n    return matchListing(matchDefinition);\n  }\n  function matchDefinition() {\n    return matchGradient('linear-gradient', tokens.linearGradient, matchLinearOrientation) || matchGradient('repeating-linear-gradient', tokens.repeatingLinearGradient, matchLinearOrientation) || matchGradient('radial-gradient', tokens.radialGradient, matchListRadialOrientations) || matchGradient('repeating-radial-gradient', tokens.repeatingRadialGradient, matchListRadialOrientations) || matchGradient('conic-gradient', tokens.conicGradient, matchListRadialOrientations);\n  }\n  function matchGradient(gradientType, pattern, orientationMatcher) {\n    return matchCall(pattern, function (captures) {\n      var orientation = orientationMatcher();\n      if (orientation) {\n        if (!scan(tokens.comma)) {\n          error('Missing comma before color stops');\n        }\n      }\n      return {\n        type: gradientType,\n        orientation: orientation,\n        colorStops: matchListing(matchColorStop)\n      };\n    });\n  }\n  function matchCall(pattern, callback) {\n    var captures = scan(pattern);\n    if (captures) {\n      if (!scan(tokens.startCall)) {\n        error('Missing (');\n      }\n      var result = callback(captures);\n      if (!scan(tokens.endCall)) {\n        error('Missing )');\n      }\n      return result;\n    }\n  }\n  function matchLinearOrientation() {\n    return matchSideOrCorner() || matchAngle();\n  }\n  function matchSideOrCorner() {\n    return match('directional', tokens.sideOrCorner, 1);\n  }\n  function matchAngle() {\n    return match('angular', tokens.angleValue, 1);\n  }\n  function matchListRadialOrientations() {\n    var radialOrientations;\n    var radialOrientation = matchRadialOrientation();\n    var lookaheadCache;\n    if (radialOrientation) {\n      radialOrientations = [];\n      radialOrientations.push(radialOrientation);\n      lookaheadCache = input;\n      if (scan(tokens.comma)) {\n        radialOrientation = matchRadialOrientation();\n        if (radialOrientation) {\n          radialOrientations.push(radialOrientation);\n        } else {\n          input = lookaheadCache;\n        }\n      }\n    }\n    return radialOrientations;\n  }\n  function matchRadialOrientation() {\n    var radialType = matchCircle() || matchEllipse();\n    if (radialType) {\n      // @ts-ignore\n      radialType.at = matchAtPosition();\n    } else {\n      var extent = matchExtentKeyword();\n      if (extent) {\n        radialType = extent;\n        var positionAt = matchAtPosition();\n        if (positionAt) {\n          // @ts-ignore\n          radialType.at = positionAt;\n        }\n      } else {\n        var defaultPosition = matchPositioning();\n        if (defaultPosition) {\n          radialType = {\n            type: 'default-radial',\n            // @ts-ignore\n            at: defaultPosition\n          };\n        }\n      }\n    }\n    return radialType;\n  }\n  function matchCircle() {\n    var circle = match('shape', /^(circle)/i, 0);\n    if (circle) {\n      // @ts-ignore\n      circle.style = matchLength() || matchExtentKeyword();\n    }\n    return circle;\n  }\n  function matchEllipse() {\n    var ellipse = match('shape', /^(ellipse)/i, 0);\n    if (ellipse) {\n      // @ts-ignore\n      ellipse.style = matchDistance() || matchExtentKeyword();\n    }\n    return ellipse;\n  }\n  function matchExtentKeyword() {\n    return match('extent-keyword', tokens.extentKeywords, 1);\n  }\n  function matchAtPosition() {\n    if (match('position', /^at/, 0)) {\n      var positioning = matchPositioning();\n      if (!positioning) {\n        error('Missing positioning value');\n      }\n      return positioning;\n    }\n  }\n  function matchPositioning() {\n    var location = matchCoordinates();\n    if (location.x || location.y) {\n      return {\n        type: 'position',\n        value: location\n      };\n    }\n  }\n  function matchCoordinates() {\n    return {\n      x: matchDistance(),\n      y: matchDistance()\n    };\n  }\n  function matchListing(matcher) {\n    var captures = matcher();\n    var result = [];\n    if (captures) {\n      result.push(captures);\n      while (scan(tokens.comma)) {\n        captures = matcher();\n        if (captures) {\n          result.push(captures);\n        } else {\n          error('One extra comma');\n        }\n      }\n    }\n    return result;\n  }\n  function matchColorStop() {\n    var color = matchColor();\n    if (!color) {\n      error('Expected color definition');\n    }\n    color.length = matchDistance();\n    return color;\n  }\n  function matchColor() {\n    return matchHexColor() || matchRGBAColor() || matchRGBColor() || matchLiteralColor();\n  }\n  function matchLiteralColor() {\n    return match('literal', tokens.literalColor, 0);\n  }\n  function matchHexColor() {\n    return match('hex', tokens.hexColor, 1);\n  }\n  function matchRGBColor() {\n    return matchCall(tokens.rgbColor, function () {\n      return {\n        type: 'rgb',\n        value: matchListing(matchNumber)\n      };\n    });\n  }\n  function matchRGBAColor() {\n    return matchCall(tokens.rgbaColor, function () {\n      return {\n        type: 'rgba',\n        value: matchListing(matchNumber)\n      };\n    });\n  }\n  function matchNumber() {\n    return scan(tokens.number)[1];\n  }\n  function matchDistance() {\n    return match('%', tokens.percentageValue, 1) || matchPositionKeyword() || matchLength();\n  }\n  function matchPositionKeyword() {\n    return match('position-keyword', tokens.positionKeywords, 1);\n  }\n  function matchLength() {\n    return match('px', tokens.pixelValue, 1) || match('em', tokens.emValue, 1);\n  }\n  function match(type, pattern, captureIndex) {\n    var captures = scan(pattern);\n    if (captures) {\n      return {\n        type: type,\n        value: captures[captureIndex]\n      };\n    }\n  }\n  function scan(regexp) {\n    var blankCaptures = /^[\\n\\r\\t\\s]+/.exec(input);\n    if (blankCaptures) {\n      consume(blankCaptures[0].length);\n    }\n    var captures = regexp.exec(input);\n    if (captures) {\n      consume(captures[0].length);\n    }\n    return captures;\n  }\n  function consume(size) {\n    input = input.substring(size);\n  }\n  return function (code) {\n    input = code;\n    return getAST();\n  };\n}();\nfunction computeLinearGradient(min, width, height, angle) {\n  var rad = deg2rad(angle.value);\n  var rx = 0;\n  var ry = 0;\n  var rcx = rx + width / 2;\n  var rcy = ry + height / 2;\n  // get the length of gradient line\n  // @see https://observablehq.com/@danburzo/css-gradient-line\n  var length = Math.abs(width * Math.cos(rad)) + Math.abs(height * Math.sin(rad));\n  var x1 = min[0] + rcx - Math.cos(rad) * length / 2;\n  var y1 = min[1] + rcy - Math.sin(rad) * length / 2;\n  var x2 = min[0] + rcx + Math.cos(rad) * length / 2;\n  var y2 = min[1] + rcy + Math.sin(rad) * length / 2;\n  return {\n    x1: x1,\n    y1: y1,\n    x2: x2,\n    y2: y2\n  };\n}\nfunction computeRadialGradient(min, width, height, cx, cy, size) {\n  // 'px'\n  var x = cx.value;\n  var y = cy.value;\n\n  // TODO: 'em'\n\n  // '%'\n  if (cx.unit === UnitType.kPercentage) {\n    x = cx.value / 100 * width;\n  }\n  if (cy.unit === UnitType.kPercentage) {\n    y = cy.value / 100 * height;\n  }\n\n  // default to farthest-side\n  var r = Math.max(distanceSquareRoot([0, 0], [x, y]), distanceSquareRoot([0, height], [x, y]), distanceSquareRoot([width, height], [x, y]), distanceSquareRoot([width, 0], [x, y]));\n  if (size) {\n    if (size instanceof CSSUnitValue) {\n      r = size.value;\n    } else if (size instanceof CSSKeywordValue) {\n      // @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Images/Using_CSS_gradients#example_closest-side_for_circles\n      if (size.value === 'closest-side') {\n        r = Math.min(x, width - x, y, height - y);\n      } else if (size.value === 'farthest-side') {\n        r = Math.max(x, width - x, y, height - y);\n      } else if (size.value === 'closest-corner') {\n        r = Math.min(distanceSquareRoot([0, 0], [x, y]), distanceSquareRoot([0, height], [x, y]), distanceSquareRoot([width, height], [x, y]), distanceSquareRoot([width, 0], [x, y]));\n      }\n    }\n  }\n  return {\n    x: x + min[0],\n    y: y + min[1],\n    r: r\n  };\n}\nvar regexLG = /^l\\s*\\(\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nvar regexRG = /^r\\s*\\(\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nvar regexPR = /^p\\s*\\(\\s*([axyn])\\s*\\)\\s*(.*)/i;\nvar regexColorStop = /[\\d.]+:(#[^\\s]+|[^\\)]+\\))/gi;\nfunction spaceColorStops(colorStops) {\n  var _colorStops$length;\n  var length = colorStops.length;\n  colorStops[length - 1].length = (_colorStops$length = colorStops[length - 1].length) !== null && _colorStops$length !== void 0 ? _colorStops$length : {\n    type: '%',\n    value: '100'\n  };\n  if (length > 1) {\n    var _colorStops$0$length;\n    colorStops[0].length = (_colorStops$0$length = colorStops[0].length) !== null && _colorStops$0$length !== void 0 ? _colorStops$0$length : {\n      type: '%',\n      value: '0'\n    };\n  }\n  var previousIndex = 0;\n  var previousOffset = Number(colorStops[0].length.value);\n  for (var i = 1; i < length; i++) {\n    var _colorStops$i$length;\n    // support '%' & 'px'\n    var offset = (_colorStops$i$length = colorStops[i].length) === null || _colorStops$i$length === void 0 ? void 0 : _colorStops$i$length.value;\n    if (!isNil(offset) && !isNil(previousOffset)) {\n      for (var j = 1; j < i - previousIndex; j++) colorStops[previousIndex + j].length = {\n        type: '%',\n        value: \"\".concat(previousOffset + (Number(offset) - previousOffset) * j / (i - previousIndex))\n      };\n      previousIndex = i;\n      previousOffset = Number(offset);\n    }\n  }\n}\n\n// The position of the gradient line's starting point.\n// different from CSS side(to top) @see https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/linear-gradient#values\nvar SideOrCornerToDegMap = {\n  left: 270 - 90,\n  top: 0 - 90,\n  bottom: 180 - 90,\n  right: 90 - 90,\n  'left top': 315 - 90,\n  'top left': 315 - 90,\n  'left bottom': 225 - 90,\n  'bottom left': 225 - 90,\n  'right top': 45 - 90,\n  'top right': 45 - 90,\n  'right bottom': 135 - 90,\n  'bottom right': 135 - 90\n};\nvar angleToDeg = memoize(function (orientation) {\n  var angle;\n  if (orientation.type === 'angular') {\n    angle = Number(orientation.value);\n  } else {\n    angle = SideOrCornerToDegMap[orientation.value] || 0;\n  }\n  return getOrCreateUnitValue(angle, 'deg');\n});\nvar positonToCSSUnitValue = memoize(function (position) {\n  var cx = 50;\n  var cy = 50;\n  var unitX = '%';\n  var unitY = '%';\n  if ((position === null || position === void 0 ? void 0 : position.type) === 'position') {\n    var _position$value = position.value,\n      x = _position$value.x,\n      y = _position$value.y;\n    if ((x === null || x === void 0 ? void 0 : x.type) === 'position-keyword') {\n      if (x.value === 'left') {\n        cx = 0;\n      } else if (x.value === 'center') {\n        cx = 50;\n      } else if (x.value === 'right') {\n        cx = 100;\n      } else if (x.value === 'top') {\n        cy = 0;\n      } else if (x.value === 'bottom') {\n        cy = 100;\n      }\n    }\n    if ((y === null || y === void 0 ? void 0 : y.type) === 'position-keyword') {\n      if (y.value === 'left') {\n        cx = 0;\n      } else if (y.value === 'center') {\n        cy = 50;\n      } else if (y.value === 'right') {\n        cx = 100;\n      } else if (y.value === 'top') {\n        cy = 0;\n      } else if (y.value === 'bottom') {\n        cy = 100;\n      }\n    }\n    if ((x === null || x === void 0 ? void 0 : x.type) === 'px' || (x === null || x === void 0 ? void 0 : x.type) === '%' || (x === null || x === void 0 ? void 0 : x.type) === 'em') {\n      unitX = x === null || x === void 0 ? void 0 : x.type;\n      cx = Number(x.value);\n    }\n    if ((y === null || y === void 0 ? void 0 : y.type) === 'px' || (y === null || y === void 0 ? void 0 : y.type) === '%' || (y === null || y === void 0 ? void 0 : y.type) === 'em') {\n      unitY = y === null || y === void 0 ? void 0 : y.type;\n      cy = Number(y.value);\n    }\n  }\n  return {\n    cx: getOrCreateUnitValue(cx, unitX),\n    cy: getOrCreateUnitValue(cy, unitY)\n  };\n});\nvar parseGradient = memoize(function (colorStr) {\n  if (colorStr.indexOf('linear') > -1 || colorStr.indexOf('radial') > -1) {\n    var ast = parseGradient$1(colorStr);\n    return ast.map(function (_ref) {\n      var type = _ref.type,\n        orientation = _ref.orientation,\n        colorStops = _ref.colorStops;\n      spaceColorStops(colorStops);\n      var steps = colorStops.map(function (colorStop) {\n        // TODO: only support % for now, should calc percentage of axis length when using px/em\n        return {\n          offset: getOrCreateUnitValue(Number(colorStop.length.value), '%'),\n          color: colorStopToString(colorStop)\n        };\n      });\n      if (type === 'linear-gradient') {\n        return new CSSGradientValue(GradientType.LinearGradient, {\n          angle: orientation ? angleToDeg(orientation) : Odeg,\n          steps: steps\n        });\n      }\n      if (type === 'radial-gradient') {\n        if (!orientation) {\n          orientation = [{\n            type: 'shape',\n            value: 'circle'\n          }];\n        }\n        if (orientation[0].type === 'shape' && orientation[0].value === 'circle') {\n          var _positonToCSSUnitValu = positonToCSSUnitValue(orientation[0].at),\n            cx = _positonToCSSUnitValu.cx,\n            cy = _positonToCSSUnitValu.cy;\n          var size;\n          if (orientation[0].style) {\n            var _orientation$0$style = orientation[0].style,\n              _type = _orientation$0$style.type,\n              value = _orientation$0$style.value;\n            if (_type === 'extent-keyword') {\n              size = getOrCreateKeyword(value);\n            } else {\n              size = getOrCreateUnitValue(value, _type);\n            }\n          }\n          return new CSSGradientValue(GradientType.RadialGradient, {\n            cx: cx,\n            cy: cy,\n            size: size,\n            steps: steps\n          });\n        }\n        // TODO: support ellipse shape\n        // TODO: repeating-linear-gradient & repeating-radial-gradient\n        // } else if (type === 'repeating-linear-gradient') {\n        // } else if (type === 'repeating-radial-gradient') {\n      }\n      return undefined;\n    });\n  }\n\n  // legacy format, should be deprecated later\n  var type = colorStr[0];\n  if (colorStr[1] === '(' || colorStr[2] === '(') {\n    if (type === 'l') {\n      var arr = regexLG.exec(colorStr);\n      if (arr) {\n        var _arr$2$match;\n        var steps = ((_arr$2$match = arr[2].match(regexColorStop)) === null || _arr$2$match === void 0 ? void 0 : _arr$2$match.map(function (stop) {\n          return stop.split(':');\n        })) || [];\n        return [new CSSGradientValue(GradientType.LinearGradient, {\n          angle: getOrCreateUnitValue(parseFloat(arr[1]), 'deg'),\n          steps: steps.map(function (_ref2) {\n            var _ref3 = _slicedToArray(_ref2, 2),\n              offset = _ref3[0],\n              color = _ref3[1];\n            return {\n              offset: getOrCreateUnitValue(Number(offset) * 100, '%'),\n              color: color\n            };\n          })\n        })];\n      }\n    } else if (type === 'r') {\n      var parsedRadialGradient = parseRadialGradient(colorStr);\n      if (parsedRadialGradient) {\n        if (isString(parsedRadialGradient)) {\n          colorStr = parsedRadialGradient;\n        } else {\n          return [new CSSGradientValue(GradientType.RadialGradient, parsedRadialGradient)];\n        }\n      }\n    } else if (type === 'p') {\n      return parsePattern(colorStr);\n    }\n  }\n});\nfunction parseRadialGradient(gradientStr) {\n  var arr = regexRG.exec(gradientStr);\n  if (arr) {\n    var _arr$4$match;\n    var steps = ((_arr$4$match = arr[4].match(regexColorStop)) === null || _arr$4$match === void 0 ? void 0 : _arr$4$match.map(function (stop) {\n      return stop.split(':');\n    })) || [];\n    return {\n      cx: getOrCreateUnitValue(50, '%'),\n      cy: getOrCreateUnitValue(50, '%'),\n      steps: steps.map(function (_ref4) {\n        var _ref5 = _slicedToArray(_ref4, 2),\n          offset = _ref5[0],\n          color = _ref5[1];\n        return {\n          offset: getOrCreateUnitValue(Number(offset) * 100, '%'),\n          color: color\n        };\n      })\n    };\n  }\n  return null;\n}\nfunction parsePattern(patternStr) {\n  var arr = regexPR.exec(patternStr);\n  if (arr) {\n    var repetition = arr[1];\n    var src = arr[2];\n    switch (repetition) {\n      case 'a':\n        repetition = 'repeat';\n        break;\n      case 'x':\n        repetition = 'repeat-x';\n        break;\n      case 'y':\n        repetition = 'repeat-y';\n        break;\n      case 'n':\n        repetition = 'no-repeat';\n        break;\n      default:\n        repetition = 'no-repeat';\n    }\n    return {\n      image: src,\n      // @ts-ignore\n      repetition: repetition\n    };\n  }\n  return null;\n}\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/createPattern\n */\n\nfunction isCSSGradientValue(object) {\n  return !!object.type && !!object.value;\n}\nfunction isPattern(object) {\n  return object && !!object.image;\n}\nfunction isCSSRGB(object) {\n  return object && !isNil(object.r) && !isNil(object.g) && !isNil(object.b);\n}\n\n/**\n * @see https://github.com/WebKit/WebKit/blob/main/Source/WebCore/css/parser/CSSParser.cpp#L97\n */\nvar parseColor = memoize(function (colorStr) {\n  if (isPattern(colorStr)) {\n    return _objectSpread({\n      repetition: 'repeat'\n    }, colorStr);\n  }\n  if (isNil(colorStr)) {\n    colorStr = '';\n  }\n  if (colorStr === 'transparent') {\n    // transparent black\n    return transparentColor;\n  }\n  if (colorStr === 'currentColor') {\n    // @see https://github.com/adobe-webplatform/Snap.svg/issues/526\n    colorStr = 'black';\n  } else if (colorStr === 'none') {\n    return noneColor;\n  }\n\n  // support CSS gradient syntax\n  var g = parseGradient(colorStr);\n  if (g) {\n    return g;\n  }\n\n  // constants\n  var color = d3.color(colorStr);\n  var rgba = [0, 0, 0, 0];\n  if (color !== null) {\n    rgba[0] = color.r || 0;\n    rgba[1] = color.g || 0;\n    rgba[2] = color.b || 0;\n    rgba[3] = color.opacity;\n  }\n\n  // return new CSSRGB(...rgba);\n  return getOrCreateRGBA.apply(void 0, rgba);\n});\nfunction mergeColors(left, right) {\n  // only support constant value, exclude gradient & pattern\n  if (!isCSSRGB(left) || !isCSSRGB(right)) {\n    return;\n  }\n  return [[Number(left.r), Number(left.g), Number(left.b), Number(left.alpha)], [Number(right.r), Number(right.g), Number(right.b), Number(right.alpha)], function (color) {\n    var rgba = color.slice();\n    if (rgba[3]) {\n      for (var i = 0; i < 3; i++) rgba[i] = Math.round(clamp(rgba[i], 0, 255));\n    }\n    rgba[3] = clamp(rgba[3], 0, 1);\n    return \"rgba(\".concat(rgba.join(','), \")\");\n  }];\n}\nfunction parseDimension(unitRegExp, string) {\n  if (isNil(string)) {\n    return getOrCreateUnitValue(0, 'px');\n  }\n  string = \"\".concat(string).trim().toLowerCase();\n  if (isFinite(Number(string))) {\n    if ('px'.search(unitRegExp) >= 0) {\n      return getOrCreateUnitValue(Number(string), 'px');\n    }\n    if ('deg'.search(unitRegExp) >= 0) {\n      return getOrCreateUnitValue(Number(string), 'deg');\n    }\n  }\n  var matchedUnits = [];\n  string = string.replace(unitRegExp, function (match) {\n    matchedUnits.push(match);\n    return \"U\".concat(match);\n  });\n  var taggedUnitRegExp = \"U(\".concat(unitRegExp.source, \")\");\n  return matchedUnits.map(function (unit) {\n    return getOrCreateUnitValue(Number(string.replace(new RegExp(\"U\".concat(unit), 'g'), '').replace(new RegExp(taggedUnitRegExp, 'g'), '*0')), unit);\n  })[0];\n}\n\n/**\n * <length>\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/length\n * length with only absolute unit, eg. 1px\n */\nvar parseLengthUnmemoize = function parseLengthUnmemoize(css) {\n  return parseDimension(new RegExp('px', 'g'), css);\n};\nvar parseLength = memoize(parseLengthUnmemoize);\n\n/**\n * <percentage>\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/percentage\n */\nvar parserPercentageUnmemoize = function parserPercentageUnmemoize(css) {\n  return parseDimension(new RegExp('%', 'g'), css);\n};\nmemoize(parserPercentageUnmemoize);\n\n/**\n * length with absolute or relative unit,\n * eg. 1px, 0.7em, 50%, calc(100% - 200px);\n *\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/length-percentage\n */\nvar parseLengthOrPercentageUnmemoize = function parseLengthOrPercentageUnmemoize(css) {\n  if (isNumber(css) || isFinite(Number(css))) {\n    // Number(css) is NaN\n    return getOrCreateUnitValue(Number(css) || 0, 'px');\n    // return Number(css);\n  }\n  return parseDimension(new RegExp('px|%|em|rem', 'g'), css);\n};\nvar parseLengthOrPercentage = memoize(parseLengthOrPercentageUnmemoize);\nvar parseAngleUnmemoize = function parseAngleUnmemoize(css) {\n  return parseDimension(new RegExp('deg|rad|grad|turn', 'g'), css);\n};\nvar parseAngle = memoize(parseAngleUnmemoize);\n\n/**\n * merge CSSUnitValue\n *\n * @example\n * 10px + 20px = 30px\n * 10deg + 10rad\n * 10% + 20% = 30%\n */\nfunction mergeDimensions(left, right, target, nonNegative) {\n  var index = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n  var unit = '';\n  var leftValue = left.value || 0;\n  var rightValue = right.value || 0;\n  var canonicalUnit = toCanonicalUnit(left.unit);\n  var leftCanonicalUnitValue = left.convertTo(canonicalUnit);\n  var rightCanonicalUnitValue = right.convertTo(canonicalUnit);\n  if (leftCanonicalUnitValue && rightCanonicalUnitValue) {\n    leftValue = leftCanonicalUnitValue.value;\n    rightValue = rightCanonicalUnitValue.value;\n    unit = unitTypeToString(left.unit);\n  }\n  // format '%' to 'px'\n  else if (CSSUnitValue.isLength(left.unit) || CSSUnitValue.isLength(right.unit)) {\n    leftValue = convertPercentUnit(left, index, target);\n    rightValue = convertPercentUnit(right, index, target);\n    unit = 'px';\n  }\n  return [leftValue, rightValue, function (value) {\n    if (nonNegative) {\n      value = Math.max(value, 0);\n    }\n    return value + unit;\n  }];\n}\nfunction convertAngleUnit(value) {\n  var deg = 0;\n  if (value.unit === UnitType.kDegrees) {\n    deg = value.value;\n  } else if (value.unit === UnitType.kRadians) {\n    deg = rad2deg(Number(value.value));\n  } else if (value.unit === UnitType.kTurns) {\n    deg = turn2deg(Number(value.value));\n  } else if (value.value) {\n    deg = value.value;\n  }\n  return deg;\n}\nfunction parseDimensionArrayFormat(string, size) {\n  var parsed;\n  if (Array.isArray(string)) {\n    // [1, '2px', 3]\n    parsed = string.map(function (segment) {\n      return Number(segment);\n    });\n  } else if (isString(string)) {\n    parsed = string.split(' ').map(function (segment) {\n      return Number(segment);\n    });\n  } else if (isNumber(string)) {\n    parsed = [string];\n  }\n  if (size === 2) {\n    if (parsed.length === 1) {\n      return [parsed[0], parsed[0]];\n    }\n    return [parsed[0], parsed[1]];\n  }\n  if (parsed.length === 1) {\n    return [parsed[0], parsed[0], parsed[0], parsed[0]];\n  }\n  if (parsed.length === 2) {\n    return [parsed[0], parsed[1], parsed[0], parsed[1]];\n  }\n  if (parsed.length === 3) {\n    return [parsed[0], parsed[1], parsed[2], parsed[1]];\n  }\n  return [parsed[0], parsed[1], parsed[2], parsed[3]];\n}\n\n// export function mergeDimensionList(\n//   left: CSSUnitValue[],\n//   right: CSSUnitValue[],\n//   target: IElement | null,\n// ): [number[], number[], (list: number[]) => string] | undefined {\n//   if (left.length !== right.length) {\n//     return;\n//   }\n\n//   const unit = left[0].unit;\n\n//   return [\n//     left.map((l) => l.value),\n//     right.map((l) => l.value),\n//     (values: number[]) => {\n//       return values.map((n) => new CSSUnitValue(n, unit)).join(' ');\n//     },\n//   ];\n// }\n\nfunction convertPercentUnit(valueWithUnit, vec3Index, target) {\n  var useMin = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n  if (valueWithUnit.unit === UnitType.kPixels) {\n    return Number(valueWithUnit.value);\n  }\n  if (valueWithUnit.unit === UnitType.kPercentage && target) {\n    var bounds = target.nodeName === Shape.GROUP ? target.getLocalBounds() : target.getGeometryBounds();\n    return (useMin ? bounds.min[vec3Index] : 0) + valueWithUnit.value / 100 * bounds.halfExtents[vec3Index] * 2;\n  }\n  return 0;\n}\nvar parseParam = function parseParam(css) {\n  return parseDimension(/deg|rad|grad|turn|px|%/g, css);\n};\nvar supportedFilters = ['blur', 'brightness', 'drop-shadow', 'contrast', 'grayscale', 'sepia', 'saturate', 'hue-rotate', 'invert'];\nfunction parseFilter() {\n  var filterStr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  filterStr = filterStr.toLowerCase().trim();\n  if (filterStr === 'none') {\n    return [];\n  }\n  var filterRegExp = /\\s*([\\w-]+)\\(([^)]*)\\)/g;\n  var result = [];\n  var match;\n  var prevLastIndex = 0;\n  while (match = filterRegExp.exec(filterStr)) {\n    if (match.index !== prevLastIndex) {\n      return [];\n    }\n    prevLastIndex = match.index + match[0].length;\n    if (supportedFilters.indexOf(match[1]) > -1) {\n      result.push({\n        name: match[1],\n        params: match[2].split(' ').map(function (p) {\n          return parseParam(p) || parseColor(p);\n        })\n      });\n    }\n    if (filterRegExp.lastIndex === filterStr.length) {\n      return result;\n    }\n  }\n  return [];\n}\nfunction numberToString(x) {\n  // scale(0.00000001) -> scale(0)\n  // return x.toFixed(6).replace(/0+$/, '').replace(/\\.$/, '');\n  return x.toString();\n}\n\n/**\n * parse string or number to CSSUnitValue(numeric)\n *\n * eg.\n * * 0 -> CSSUnitValue(0)\n * * '2' -> CSSUnitValue(2)\n */\nvar parseNumberUnmemoize = function parseNumberUnmemoize(string) {\n  if (typeof string === 'number') {\n    return getOrCreateUnitValue(string);\n  }\n  if (/^\\s*[-+]?(\\d*\\.)?\\d+\\s*$/.test(string)) {\n    return getOrCreateUnitValue(Number(string));\n  }\n  return getOrCreateUnitValue(0);\n};\nvar parseNumber = memoize(parseNumberUnmemoize);\nmemoize(function (string) {\n  if (isString(string)) {\n    return string.split(' ').map(parseNumber);\n  }\n  return string.map(parseNumber);\n});\nfunction mergeNumbers(left, right) {\n  return [left, right, numberToString];\n}\nfunction clampedMergeNumbers(min, max) {\n  return function (left, right) {\n    return [left, right, function (x) {\n      return numberToString(clamp(x, min, max));\n    }];\n  };\n}\nfunction mergeNumberLists(left, right) {\n  if (left.length !== right.length) {\n    return;\n  }\n  return [left, right, function (numberList) {\n    return numberList;\n  }];\n}\nfunction getOrCalculatePathTotalLength(path) {\n  if (path.parsedStyle.d.totalLength === 0) {\n    path.parsedStyle.d.totalLength = getTotalLength(path.parsedStyle.d.absolutePath);\n  }\n  return path.parsedStyle.d.totalLength;\n}\nfunction getOrCalculatePolylineTotalLength(polyline) {\n  if (polyline.parsedStyle.points.totalLength === 0) {\n    polyline.parsedStyle.points.totalLength = polylineLength(polyline.parsedStyle.points.points);\n  }\n  return polyline.parsedStyle.points.totalLength;\n}\nfunction removeRedundantMCommand(path) {\n  for (var i = 0; i < path.length; i++) {\n    var prevSegment = path[i - 1];\n    var segment = path[i];\n    var cmd = segment[0];\n    if (cmd === 'M') {\n      if (prevSegment) {\n        var prevCmd = prevSegment[0];\n        var srcPoint = [segment[1], segment[2]];\n        var destPoint = void 0;\n        if (prevCmd === 'L' || prevCmd === 'M') {\n          destPoint = [prevSegment[1], prevSegment[2]];\n        } else if (prevCmd === 'C' || prevCmd === 'A' || prevCmd === 'Q') {\n          destPoint = [prevSegment[prevSegment.length - 2], prevSegment[prevSegment.length - 1]];\n        }\n        if (destPoint && isSamePoint(srcPoint, destPoint)) {\n          path.splice(i, 1);\n          i--;\n        }\n      }\n    }\n  }\n}\nfunction hasArcOrBezier(path) {\n  var hasArc = false;\n  var count = path.length;\n  for (var i = 0; i < count; i++) {\n    var params = path[i];\n    var cmd = params[0];\n    if (cmd === 'C' || cmd === 'A' || cmd === 'Q') {\n      hasArc = true;\n      break;\n    }\n  }\n  return hasArc;\n}\nfunction extractPolygons(pathArray) {\n  var polygons = [];\n  var polylines = [];\n  var points = []; // 防止第一个命令不是 'M'\n  for (var i = 0; i < pathArray.length; i++) {\n    var params = pathArray[i];\n    var cmd = params[0];\n    if (cmd === 'M') {\n      // 遇到 'M' 判定是否是新数组，新数组中没有点\n      if (points.length) {\n        // 如果存在点，则说明没有遇到 'Z'，开始了一个新的多边形\n        polylines.push(points);\n        points = []; // 创建新的点\n      }\n      points.push([params[1], params[2]]);\n    } else if (cmd === 'Z') {\n      if (points.length) {\n        // 存在点\n        polygons.push(points);\n        points = []; // 开始新的点集合\n      }\n      // 如果不存在点，同时 'Z'，则说明是错误，不处理\n    } else {\n      points.push([params[1], params[2]]);\n    }\n  }\n  // 说明 points 未放入 polygons 或者 polyline\n  // 仅当只有一个 M，没有 Z 时会发生这种情况\n  if (points.length > 0) {\n    polylines.push(points);\n  }\n  return {\n    polygons: polygons,\n    polylines: polylines\n  };\n}\nfunction isSamePoint(point1, point2) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n}\nfunction getPathBBox(segments, lineWidth) {\n  var xArr = [];\n  var yArr = [];\n  var segmentsWithAngle = [];\n  for (var i = 0; i < segments.length; i++) {\n    var segment = segments[i];\n    var currentPoint = segment.currentPoint,\n      params = segment.params,\n      prePoint = segment.prePoint;\n    var box = void 0;\n    switch (segment.command) {\n      case 'Q':\n        box = quadBox(prePoint[0], prePoint[1], params[1], params[2], params[3], params[4]);\n        break;\n      case 'C':\n        box = cubicBox(prePoint[0], prePoint[1], params[1], params[2], params[3], params[4], params[5], params[6]);\n        break;\n      case 'A':\n        var arcParams = segment.arcParams;\n        box = arcBox(arcParams.cx, arcParams.cy, arcParams.rx, arcParams.ry, arcParams.xRotation, arcParams.startAngle, arcParams.endAngle);\n        break;\n      default:\n        xArr.push(currentPoint[0]);\n        yArr.push(currentPoint[1]);\n        break;\n    }\n    if (box) {\n      segment.box = box;\n      xArr.push(box.x, box.x + box.width);\n      yArr.push(box.y, box.y + box.height);\n    }\n    if (lineWidth && (segment.command === 'L' || segment.command === 'M') && segment.prePoint && segment.nextPoint) {\n      segmentsWithAngle.push(segment);\n    }\n  }\n  // bbox calculation should ignore NaN for path attribute\n  // ref: https://github.com/antvis/g/issues/210\n  // ref: https://github.com/antvis/G2/issues/3109\n  xArr = xArr.filter(function (item) {\n    return !Number.isNaN(item) && item !== Infinity && item !== -Infinity;\n  });\n  yArr = yArr.filter(function (item) {\n    return !Number.isNaN(item) && item !== Infinity && item !== -Infinity;\n  });\n  var minX = min(xArr);\n  var minY = min(yArr);\n  var maxX = max(xArr);\n  var maxY = max(yArr);\n  if (segmentsWithAngle.length === 0) {\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  }\n  for (var _i = 0; _i < segmentsWithAngle.length; _i++) {\n    var _segment = segmentsWithAngle[_i];\n    var _currentPoint = _segment.currentPoint;\n    var extra = void 0;\n    if (_currentPoint[0] === minX) {\n      extra = getExtraFromSegmentWithAngle(_segment, lineWidth);\n      minX -= extra.xExtra;\n    } else if (_currentPoint[0] === maxX) {\n      extra = getExtraFromSegmentWithAngle(_segment, lineWidth);\n      maxX += extra.xExtra;\n    }\n    if (_currentPoint[1] === minY) {\n      extra = getExtraFromSegmentWithAngle(_segment, lineWidth);\n      minY -= extra.yExtra;\n    } else if (_currentPoint[1] === maxY) {\n      extra = getExtraFromSegmentWithAngle(_segment, lineWidth);\n      maxY += extra.yExtra;\n    }\n  }\n  return {\n    x: minX,\n    y: minY,\n    width: maxX - minX,\n    height: maxY - minY\n  };\n}\nfunction getExtraFromSegmentWithAngle(segment, lineWidth) {\n  var prePoint = segment.prePoint,\n    currentPoint = segment.currentPoint,\n    nextPoint = segment.nextPoint;\n  var currentAndPre = Math.pow(currentPoint[0] - prePoint[0], 2) + Math.pow(currentPoint[1] - prePoint[1], 2);\n  var currentAndNext = Math.pow(currentPoint[0] - nextPoint[0], 2) + Math.pow(currentPoint[1] - nextPoint[1], 2);\n  var preAndNext = Math.pow(prePoint[0] - nextPoint[0], 2) + Math.pow(prePoint[1] - nextPoint[1], 2);\n  // 以 currentPoint 为顶点的夹角\n  var currentAngle = Math.acos((currentAndPre + currentAndNext - preAndNext) / (2 * Math.sqrt(currentAndPre) * Math.sqrt(currentAndNext)));\n  // 夹角为空、 0 或 PI 时，不需要计算夹角处的额外宽度\n  // 注意: 由于计算精度问题，夹角为 0 的情况计算出来的角度可能是一个很小的值，还需要判断其与 0 是否近似相等\n  if (!currentAngle || Math.sin(currentAngle) === 0 || isNumberEqual(currentAngle, 0)) {\n    return {\n      xExtra: 0,\n      yExtra: 0\n    };\n  }\n  var xAngle = Math.abs(Math.atan2(nextPoint[1] - currentPoint[1], nextPoint[0] - currentPoint[0]));\n  var yAngle = Math.abs(Math.atan2(nextPoint[0] - currentPoint[0], nextPoint[1] - currentPoint[1]));\n  // 将夹角转为锐角\n  xAngle = xAngle > Math.PI / 2 ? Math.PI - xAngle : xAngle;\n  yAngle = yAngle > Math.PI / 2 ? Math.PI - yAngle : yAngle;\n  // 这里不考虑在水平和垂直方向的投影，直接使用最大差值\n  // 由于上层统一加减了二分之一线宽，这里需要进行弥补\n  var extra = {\n    // 水平方向投影\n    xExtra: Math.cos(currentAngle / 2 - xAngle) * (lineWidth / 2 * (1 / Math.sin(currentAngle / 2))) - lineWidth / 2 || 0,\n    // 垂直方向投影\n    yExtra: Math.cos(yAngle - currentAngle / 2) * (lineWidth / 2 * (1 / Math.sin(currentAngle / 2))) - lineWidth / 2 || 0\n  };\n  return extra;\n}\n\n// 点对称\nfunction toSymmetry(point, center) {\n  return [center[0] + (center[0] - point[0]), center[1] + (center[1] - point[1])];\n}\nvar angleBetween = function angleBetween(v0, v1) {\n  var p = v0.x * v1.x + v0.y * v1.y;\n  var n = Math.sqrt((Math.pow(v0.x, 2) + Math.pow(v0.y, 2)) * (Math.pow(v1.x, 2) + Math.pow(v1.y, 2)));\n  var sign = v0.x * v1.y - v0.y * v1.x < 0 ? -1 : 1;\n  var angle = sign * Math.acos(p / n);\n  return angle;\n};\n/**\n * @see https://github.com/rveciana/svg-path-properties/blob/b6bd9a322966f6ef7a311872d80c56e3718de861/src/arc.ts#L121\n */\nvar pointOnEllipticalArc = function pointOnEllipticalArc(p0, rx, ry, xAxisRotation, largeArcFlag, sweepFlag, p1, t) {\n  // In accordance to: http://www.w3.org/TR/SVG/implnote.html#ArcOutOfRangeParameters\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n  xAxisRotation = mod(xAxisRotation, 360);\n  var xAxisRotationRadians = deg2rad(xAxisRotation);\n  // If the endpoints are identical, then this is equivalent to omitting the elliptical arc segment entirely.\n  if (p0.x === p1.x && p0.y === p1.y) {\n    return {\n      x: p0.x,\n      y: p0.y,\n      ellipticalArcAngle: 0\n    }; // Check if angle is correct\n  }\n\n  // If rx = 0 or ry = 0 then this arc is treated as a straight line segment joining the endpoints.\n  if (rx === 0 || ry === 0) {\n    // return this.pointOnLine(p0, p1, t);\n    return {\n      x: 0,\n      y: 0,\n      ellipticalArcAngle: 0\n    }; // Check if angle is correct\n  }\n\n  // Following \"Conversion from endpoint to center parameterization\"\n  // http://www.w3.org/TR/SVG/implnote.html#ArcConversionEndpointToCenter\n\n  // Step #1: Compute transformedPoint\n  var dx = (p0.x - p1.x) / 2;\n  var dy = (p0.y - p1.y) / 2;\n  var transformedPoint = {\n    x: Math.cos(xAxisRotationRadians) * dx + Math.sin(xAxisRotationRadians) * dy,\n    y: -Math.sin(xAxisRotationRadians) * dx + Math.cos(xAxisRotationRadians) * dy\n  };\n  // Ensure radii are large enough\n  var radiiCheck = Math.pow(transformedPoint.x, 2) / Math.pow(rx, 2) + Math.pow(transformedPoint.y, 2) / Math.pow(ry, 2);\n  if (radiiCheck > 1) {\n    rx *= Math.sqrt(radiiCheck);\n    ry *= Math.sqrt(radiiCheck);\n  }\n\n  // Step #2: Compute transformedCenter\n  var cSquareNumerator = Math.pow(rx, 2) * Math.pow(ry, 2) - Math.pow(rx, 2) * Math.pow(transformedPoint.y, 2) - Math.pow(ry, 2) * Math.pow(transformedPoint.x, 2);\n  var cSquareRootDenom = Math.pow(rx, 2) * Math.pow(transformedPoint.y, 2) + Math.pow(ry, 2) * Math.pow(transformedPoint.x, 2);\n  var cRadicand = cSquareNumerator / cSquareRootDenom;\n  // Make sure this never drops below zero because of precision\n  cRadicand = cRadicand < 0 ? 0 : cRadicand;\n  var cCoef = (largeArcFlag !== sweepFlag ? 1 : -1) * Math.sqrt(cRadicand);\n  var transformedCenter = {\n    x: cCoef * (rx * transformedPoint.y / ry),\n    y: cCoef * (-(ry * transformedPoint.x) / rx)\n  };\n\n  // Step #3: Compute center\n  var center = {\n    x: Math.cos(xAxisRotationRadians) * transformedCenter.x - Math.sin(xAxisRotationRadians) * transformedCenter.y + (p0.x + p1.x) / 2,\n    y: Math.sin(xAxisRotationRadians) * transformedCenter.x + Math.cos(xAxisRotationRadians) * transformedCenter.y + (p0.y + p1.y) / 2\n  };\n\n  // Step #4: Compute start/sweep angles\n  // Start angle of the elliptical arc prior to the stretch and rotate operations.\n  // Difference between the start and end angles\n  var startVector = {\n    x: (transformedPoint.x - transformedCenter.x) / rx,\n    y: (transformedPoint.y - transformedCenter.y) / ry\n  };\n  var startAngle = angleBetween({\n    x: 1,\n    y: 0\n  }, startVector);\n  var endVector = {\n    x: (-transformedPoint.x - transformedCenter.x) / rx,\n    y: (-transformedPoint.y - transformedCenter.y) / ry\n  };\n  var sweepAngle = angleBetween(startVector, endVector);\n  if (!sweepFlag && sweepAngle > 0) {\n    sweepAngle -= 2 * Math.PI;\n  } else if (sweepFlag && sweepAngle < 0) {\n    sweepAngle += 2 * Math.PI;\n  }\n  // We use % instead of `mod(..)` because we want it to be -360deg to 360deg(but actually in radians)\n  sweepAngle %= 2 * Math.PI;\n\n  // From http://www.w3.org/TR/SVG/implnote.html#ArcParameterizationAlternatives\n  var angle = startAngle + sweepAngle * t;\n  var ellipseComponentX = rx * Math.cos(angle);\n  var ellipseComponentY = ry * Math.sin(angle);\n  var point = {\n    x: Math.cos(xAxisRotationRadians) * ellipseComponentX - Math.sin(xAxisRotationRadians) * ellipseComponentY + center.x,\n    y: Math.sin(xAxisRotationRadians) * ellipseComponentX + Math.cos(xAxisRotationRadians) * ellipseComponentY + center.y,\n    ellipticalArcStartAngle: startAngle,\n    ellipticalArcEndAngle: startAngle + sweepAngle,\n    ellipticalArcAngle: angle,\n    ellipticalArcCenter: center,\n    resultantRx: rx,\n    resultantRy: ry\n  };\n  return point;\n};\nfunction path2Segments(path) {\n  var segments = [];\n  var currentPoint = null; // 当前图形\n  var nextParams = null; // 下一节点的 path 参数\n  var startMovePoint = null; // 开始 M 的点，可能会有多个\n  var lastStartMovePointIndex = 0; // 最近一个开始点 M 的索引\n  var count = path.length;\n  for (var i = 0; i < count; i++) {\n    var params = path[i];\n    nextParams = path[i + 1];\n    var command = params[0];\n    // 数学定义上的参数，便于后面的计算\n    var segment = {\n      command: command,\n      prePoint: currentPoint,\n      params: params,\n      startTangent: null,\n      endTangent: null,\n      currentPoint: null,\n      nextPoint: null,\n      arcParams: null,\n      box: null,\n      cubicParams: null\n    };\n    switch (command) {\n      case 'M':\n        startMovePoint = [params[1], params[2]];\n        lastStartMovePointIndex = i;\n        break;\n      case 'A':\n        var arcParams = getArcParams(currentPoint, params);\n        segment.arcParams = arcParams;\n        break;\n    }\n    if (command === 'Z') {\n      // 有了 Z 后，当前节点从开始 M 的点开始\n      currentPoint = startMovePoint;\n      // 如果当前点的命令为 Z，相当于当前点为最近一个 M 点，则下一个点直接指向最近一个 M 点的下一个点\n      nextParams = path[lastStartMovePointIndex + 1];\n    } else {\n      var len = params.length;\n      currentPoint = [params[len - 2], params[len - 1]];\n    }\n    if (nextParams && nextParams[0] === 'Z') {\n      // 如果下一个点的命令为 Z，则下一个点直接指向最近一个 M 点\n      nextParams = path[lastStartMovePointIndex];\n      if (segments[lastStartMovePointIndex]) {\n        // 如果下一个点的命令为 Z，则最近一个 M 点的前一个点为当前点\n        segments[lastStartMovePointIndex].prePoint = currentPoint;\n      }\n    }\n    segment.currentPoint = currentPoint;\n    // 如果当前点与最近一个 M 点相同，则最近一个 M 点的前一个点为当前点的前一个点\n    if (segments[lastStartMovePointIndex] && isSamePoint(currentPoint, segments[lastStartMovePointIndex].currentPoint)) {\n      segments[lastStartMovePointIndex].prePoint = segment.prePoint;\n    }\n    var nextPoint = nextParams ? [nextParams[nextParams.length - 2], nextParams[nextParams.length - 1]] : null;\n    segment.nextPoint = nextPoint;\n    // Add startTangent and endTangent\n    var prePoint = segment.prePoint;\n    if (['L', 'H', 'V'].includes(command)) {\n      segment.startTangent = [prePoint[0] - currentPoint[0], prePoint[1] - currentPoint[1]];\n      segment.endTangent = [currentPoint[0] - prePoint[0], currentPoint[1] - prePoint[1]];\n    } else if (command === 'Q') {\n      // 二次贝塞尔曲线只有一个控制点\n      var cp = [params[1], params[2]];\n      // 二次贝塞尔曲线的终点为 currentPoint\n      segment.startTangent = [prePoint[0] - cp[0], prePoint[1] - cp[1]];\n      segment.endTangent = [currentPoint[0] - cp[0], currentPoint[1] - cp[1]];\n    } else if (command === 'T') {\n      var preSegment = segments[i - 1];\n      var _cp = toSymmetry(preSegment.currentPoint, prePoint);\n      if (preSegment.command === 'Q') {\n        segment.command = 'Q';\n        segment.startTangent = [prePoint[0] - _cp[0], prePoint[1] - _cp[1]];\n        segment.endTangent = [currentPoint[0] - _cp[0], currentPoint[1] - _cp[1]];\n      } else {\n        // @ts-ignore\n        segment.command = 'TL';\n        segment.startTangent = [prePoint[0] - currentPoint[0], prePoint[1] - currentPoint[1]];\n        segment.endTangent = [currentPoint[0] - prePoint[0], currentPoint[1] - prePoint[1]];\n      }\n    } else if (command === 'C') {\n      // 三次贝塞尔曲线有两个控制点\n      var cp1 = [params[1], params[2]];\n      var cp2 = [params[3], params[4]];\n      segment.startTangent = [prePoint[0] - cp1[0], prePoint[1] - cp1[1]];\n      segment.endTangent = [currentPoint[0] - cp2[0], currentPoint[1] - cp2[1]];\n\n      // horizontal line, eg. ['C', 100, 100, 100, 100, 200, 200]\n      if (segment.startTangent[0] === 0 && segment.startTangent[1] === 0) {\n        segment.startTangent = [cp1[0] - cp2[0], cp1[1] - cp2[1]];\n      }\n      if (segment.endTangent[0] === 0 && segment.endTangent[1] === 0) {\n        segment.endTangent = [cp2[0] - cp1[0], cp2[1] - cp1[1]];\n      }\n    } else if (command === 'S') {\n      var _preSegment = segments[i - 1];\n      var _cp2 = toSymmetry(_preSegment.currentPoint, prePoint);\n      var _cp3 = [params[1], params[2]];\n      if (_preSegment.command === 'C') {\n        segment.command = 'C'; // 将 S 命令变换为 C 命令\n        segment.startTangent = [prePoint[0] - _cp2[0], prePoint[1] - _cp2[1]];\n        segment.endTangent = [currentPoint[0] - _cp3[0], currentPoint[1] - _cp3[1]];\n      } else {\n        // @ts-ignore\n        segment.command = 'SQ'; // 将 S 命令变换为 SQ 命令\n        segment.startTangent = [prePoint[0] - _cp3[0], prePoint[1] - _cp3[1]];\n        segment.endTangent = [currentPoint[0] - _cp3[0], currentPoint[1] - _cp3[1]];\n      }\n    } else if (command === 'A') {\n      var _getTangentAtRatio = getTangentAtRatio(segment, 0),\n        dx1 = _getTangentAtRatio.x,\n        dy1 = _getTangentAtRatio.y;\n      var _getTangentAtRatio2 = getTangentAtRatio(segment, 1, false),\n        dx2 = _getTangentAtRatio2.x,\n        dy2 = _getTangentAtRatio2.y;\n      segment.startTangent = [dx1, dy1];\n      segment.endTangent = [dx2, dy2];\n    }\n    segments.push(segment);\n  }\n  return segments;\n}\n\n/**\n * Use length instead of ratio\n */\nfunction getTangentAtRatio(segment, ratio) {\n  var sign = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  var _segment$arcParams = segment.arcParams,\n    _segment$arcParams$rx = _segment$arcParams.rx,\n    rx = _segment$arcParams$rx === void 0 ? 0 : _segment$arcParams$rx,\n    _segment$arcParams$ry = _segment$arcParams.ry,\n    ry = _segment$arcParams$ry === void 0 ? 0 : _segment$arcParams$ry,\n    xRotation = _segment$arcParams.xRotation,\n    arcFlag = _segment$arcParams.arcFlag,\n    sweepFlag = _segment$arcParams.sweepFlag;\n  var p1 = pointOnEllipticalArc({\n    x: segment.prePoint[0],\n    y: segment.prePoint[1]\n  }, rx, ry, xRotation, !!arcFlag, !!sweepFlag, {\n    x: segment.currentPoint[0],\n    y: segment.currentPoint[1]\n  }, ratio);\n  var p2 = pointOnEllipticalArc({\n    x: segment.prePoint[0],\n    y: segment.prePoint[1]\n  }, rx, ry, xRotation, !!arcFlag, !!sweepFlag, {\n    x: segment.currentPoint[0],\n    y: segment.currentPoint[1]\n  }, sign ? ratio + 0.005 : ratio - 0.005);\n  var xDist = p2.x - p1.x;\n  var yDist = p2.y - p1.y;\n  var dist = Math.sqrt(xDist * xDist + yDist * yDist);\n  return {\n    x: -xDist / dist,\n    y: -yDist / dist\n  };\n}\n\n// 向量长度\nfunction vMag(v) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n}\n\n// u.v/|u||v|，计算夹角的余弦值\nfunction vRatio(u, v) {\n  // 当存在一个向量的长度为 0 时，夹角也为 0，即夹角的余弦值为 1\n  return vMag(u) * vMag(v) ? (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v)) : 1;\n}\n\n// 向量角度\nfunction vAngle(u, v) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n}\nfunction getArcParams(startPoint, params) {\n  var rx = params[1];\n  var ry = params[2];\n  var xRotation = mod(deg2rad(params[3]), Math.PI * 2);\n  var arcFlag = params[4];\n  var sweepFlag = params[5];\n  // 弧形起点坐标\n  var x1 = startPoint[0];\n  var y1 = startPoint[1];\n  // 弧形终点坐标\n  var x2 = params[6];\n  var y2 = params[7];\n  var xp = Math.cos(xRotation) * (x1 - x2) / 2.0 + Math.sin(xRotation) * (y1 - y2) / 2.0;\n  var yp = -1 * Math.sin(xRotation) * (x1 - x2) / 2.0 + Math.cos(xRotation) * (y1 - y2) / 2.0;\n  var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n  var diff = rx * rx * (yp * yp) + ry * ry * (xp * xp);\n  var f = diff ? Math.sqrt((rx * rx * (ry * ry) - diff) / diff) : 1;\n  if (arcFlag === sweepFlag) {\n    f *= -1;\n  }\n  if (isNaN(f)) {\n    f = 0;\n  }\n\n  // 旋转前的起点坐标，且当长半轴和短半轴的长度为 0 时，坐标按 (0, 0) 处理\n  var cxp = ry ? f * rx * yp / ry : 0;\n  var cyp = rx ? f * -ry * xp / rx : 0;\n\n  // 椭圆圆心坐标\n  var cx = (x1 + x2) / 2.0 + Math.cos(xRotation) * cxp - Math.sin(xRotation) * cyp;\n  var cy = (y1 + y2) / 2.0 + Math.sin(xRotation) * cxp + Math.cos(xRotation) * cyp;\n\n  // 起始点的单位向量\n  var u = [(xp - cxp) / rx, (yp - cyp) / ry];\n  // 终止点的单位向量\n  var v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n  // 计算起始点和圆心的连线，与 x 轴正方向的夹角\n  var theta = vAngle([1, 0], u);\n\n  // 计算圆弧起始点和终止点与椭圆圆心连线的夹角\n  var dTheta = vAngle(u, v);\n  if (vRatio(u, v) <= -1) {\n    dTheta = Math.PI;\n  }\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n  if (sweepFlag === 0 && dTheta > 0) {\n    dTheta -= 2 * Math.PI;\n  }\n  if (sweepFlag === 1 && dTheta < 0) {\n    dTheta += 2 * Math.PI;\n  }\n  return {\n    cx: cx,\n    cy: cy,\n    // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n    rx: isSamePoint(startPoint, [x2, y2]) ? 0 : rx,\n    ry: isSamePoint(startPoint, [x2, y2]) ? 0 : ry,\n    startAngle: theta,\n    endAngle: theta + dTheta,\n    xRotation: xRotation,\n    arcFlag: arcFlag,\n    sweepFlag: sweepFlag\n  };\n}\nfunction commandsToPathString(commands, object, transform) {\n  return commands.reduce(function (prev, cur) {\n    var path = '';\n    if (cur[0] === 'M' || cur[0] === 'L') {\n      var p = vec3.fromValues(cur[1], cur[2], 0);\n      if (transform) {\n        vec3.transformMat4(p, p, transform);\n      }\n      path = \"\".concat(cur[0]).concat(p[0], \",\").concat(p[1]);\n    } else if (cur[0] === 'Z') {\n      path = cur[0];\n    } else if (cur[0] === 'C') {\n      var p1 = vec3.fromValues(cur[1], cur[2], 0);\n      var p2 = vec3.fromValues(cur[3], cur[4], 0);\n      var p3 = vec3.fromValues(cur[5], cur[6], 0);\n      if (transform) {\n        vec3.transformMat4(p1, p1, transform);\n        vec3.transformMat4(p2, p2, transform);\n        vec3.transformMat4(p3, p3, transform);\n      }\n      path = \"\".concat(cur[0]).concat(p1[0], \",\").concat(p1[1], \",\").concat(p2[0], \",\").concat(p2[1], \",\").concat(p3[0], \",\").concat(p3[1]);\n    } else if (cur[0] === 'A') {\n      var c = vec3.fromValues(cur[6], cur[7], 0);\n      if (transform) {\n        vec3.transformMat4(c, c, transform);\n      }\n      path = \"\".concat(cur[0]).concat(cur[1], \",\").concat(cur[2], \",\").concat(cur[3], \",\").concat(cur[4], \",\").concat(cur[5], \",\").concat(c[0], \",\").concat(c[1]);\n    } else if (cur[0] === 'Q') {\n      var _p = vec3.fromValues(cur[1], cur[2], 0);\n      var _p2 = vec3.fromValues(cur[3], cur[4], 0);\n      if (transform) {\n        vec3.transformMat4(_p, _p, transform);\n        vec3.transformMat4(_p2, _p2, transform);\n      }\n      path = \"\".concat(cur[0]).concat(cur[1], \",\").concat(cur[2], \",\").concat(cur[3], \",\").concat(cur[4], \"}\");\n    }\n    return prev += path;\n  }, '');\n}\nfunction lineToCommands(x1, y1, x2, y2) {\n  return [['M', x1, y1], ['L', x2, y2]];\n}\nfunction ellipseToCommands(rx, ry, cx, cy) {\n  var factor = (-1 + Math.sqrt(2)) / 3 * 4;\n  var dx = rx * factor;\n  var dy = ry * factor;\n  var left = cx - rx;\n  var right = cx + rx;\n  var top = cy - ry;\n  var bottom = cy + ry;\n  return [['M', left, cy], ['C', left, cy - dy, cx - dx, top, cx, top], ['C', cx + dx, top, right, cy - dy, right, cy], ['C', right, cy + dy, cx + dx, bottom, cx, bottom], ['C', cx - dx, bottom, left, cy + dy, left, cy], ['Z']];\n}\nfunction polygonToCommands(points, closed) {\n  var result = points.map(function (point, i) {\n    return [i === 0 ? 'M' : 'L', point[0], point[1]];\n  });\n  if (closed) {\n    result.push(['Z']);\n  }\n  return result;\n}\nfunction rectToCommands(width, height, x, y, radius) {\n  // @see https://gist.github.com/danielpquinn/dd966af424030d47e476\n  if (radius) {\n    var _radius = _slicedToArray(radius, 4),\n      tlr = _radius[0],\n      trr = _radius[1],\n      brr = _radius[2],\n      blr = _radius[3];\n    var signX = width > 0 ? 1 : -1;\n    var signY = height > 0 ? 1 : -1;\n    // sweep-flag @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths#arcs\n    var sweepFlag = signX + signY !== 0 ? 1 : 0;\n    return [['M', signX * tlr + x, y], ['L', width - signX * trr + x, y], trr ? ['A', trr, trr, 0, 0, sweepFlag, width + x, signY * trr + y] : null, ['L', width + x, height - signY * brr + y], brr ? ['A', brr, brr, 0, 0, sweepFlag, width + x - signX * brr, height + y] : null, ['L', x + signX * blr, height + y], blr ? ['A', blr, blr, 0, 0, sweepFlag, x, height + y - signY * blr] : null, ['L', x, signY * tlr + y], tlr ? ['A', tlr, tlr, 0, 0, sweepFlag, signX * tlr + x, y] : null, ['Z']].filter(function (command) {\n      return command;\n    });\n  }\n  return [['M', x, y], ['L', x + width, y], ['L', x + width, y + height], ['L', x, y + height], ['Z']];\n}\n\n/**\n * convert object to path, should account for:\n * * transform & origin\n * * lineWidth\n */\nfunction convertToPath(object) {\n  var transform = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : object.getLocalTransform();\n  var commands = [];\n  switch (object.nodeName) {\n    case Shape.LINE:\n      var _parsedStyle = object.parsedStyle,\n        _parsedStyle$x = _parsedStyle.x1,\n        x1 = _parsedStyle$x === void 0 ? 0 : _parsedStyle$x,\n        _parsedStyle$y = _parsedStyle.y1,\n        y1 = _parsedStyle$y === void 0 ? 0 : _parsedStyle$y,\n        _parsedStyle$x2 = _parsedStyle.x2,\n        x2 = _parsedStyle$x2 === void 0 ? 0 : _parsedStyle$x2,\n        _parsedStyle$y2 = _parsedStyle.y2,\n        y2 = _parsedStyle$y2 === void 0 ? 0 : _parsedStyle$y2;\n      commands = lineToCommands(x1, y1, x2, y2);\n      break;\n    case Shape.CIRCLE:\n      {\n        var _parsedStyle2 = object.parsedStyle,\n          _parsedStyle2$r = _parsedStyle2.r,\n          r = _parsedStyle2$r === void 0 ? 0 : _parsedStyle2$r,\n          _parsedStyle2$cx = _parsedStyle2.cx,\n          cx = _parsedStyle2$cx === void 0 ? 0 : _parsedStyle2$cx,\n          _parsedStyle2$cy = _parsedStyle2.cy,\n          cy = _parsedStyle2$cy === void 0 ? 0 : _parsedStyle2$cy;\n        commands = ellipseToCommands(r, r, cx, cy);\n        break;\n      }\n    case Shape.ELLIPSE:\n      {\n        var _parsedStyle3 = object.parsedStyle,\n          _parsedStyle3$rx = _parsedStyle3.rx,\n          rx = _parsedStyle3$rx === void 0 ? 0 : _parsedStyle3$rx,\n          _parsedStyle3$ry = _parsedStyle3.ry,\n          ry = _parsedStyle3$ry === void 0 ? 0 : _parsedStyle3$ry,\n          _parsedStyle3$cx = _parsedStyle3.cx,\n          _cx = _parsedStyle3$cx === void 0 ? 0 : _parsedStyle3$cx,\n          _parsedStyle3$cy = _parsedStyle3.cy,\n          _cy = _parsedStyle3$cy === void 0 ? 0 : _parsedStyle3$cy;\n        commands = ellipseToCommands(rx, ry, _cx, _cy);\n        break;\n      }\n    case Shape.POLYLINE:\n    case Shape.POLYGON:\n      var points = object.parsedStyle.points;\n      commands = polygonToCommands(points.points, object.nodeName === Shape.POLYGON);\n      break;\n    case Shape.RECT:\n      var _parsedStyle4 = object.parsedStyle,\n        _parsedStyle4$width = _parsedStyle4.width,\n        width = _parsedStyle4$width === void 0 ? 0 : _parsedStyle4$width,\n        _parsedStyle4$height = _parsedStyle4.height,\n        height = _parsedStyle4$height === void 0 ? 0 : _parsedStyle4$height,\n        _parsedStyle4$x = _parsedStyle4.x,\n        x = _parsedStyle4$x === void 0 ? 0 : _parsedStyle4$x,\n        _parsedStyle4$y = _parsedStyle4.y,\n        y = _parsedStyle4$y === void 0 ? 0 : _parsedStyle4$y,\n        radius = _parsedStyle4.radius;\n      var hasRadius = radius && radius.some(function (r) {\n        return r !== 0;\n      });\n      commands = rectToCommands(width, height, x, y, hasRadius && radius.map(function (r) {\n        return clamp(r, 0, Math.min(Math.abs(width) / 2, Math.abs(height) / 2));\n      }));\n      break;\n    case Shape.PATH:\n      var absolutePath = object.parsedStyle.d.absolutePath;\n      commands = _toConsumableArray(absolutePath);\n      break;\n  }\n  if (commands.length) {\n    return commandsToPathString(commands, object, transform);\n  }\n}\nfunction translatePathToString(absolutePath) {\n  var startOffsetX = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var startOffsetY = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var endOffsetX = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n  var endOffsetY = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0;\n  var newValue = absolutePath.map(function (params, i) {\n    var command = params[0];\n    var nextSegment = absolutePath[i + 1];\n    var useStartOffset = i === 0 && (startOffsetX !== 0 || startOffsetY !== 0);\n    var useEndOffset = (i === absolutePath.length - 1 || nextSegment && (nextSegment[0] === 'M' || nextSegment[0] === 'Z')) && endOffsetX !== 0 && endOffsetY !== 0;\n    switch (command) {\n      case 'M':\n        // Use start marker offset\n        if (useStartOffset) {\n          return \"M \".concat(params[1] + startOffsetX, \",\").concat(params[2] + startOffsetY, \" L \").concat(params[1], \",\").concat(params[2]);\n        }\n        return \"M \".concat(params[1], \",\").concat(params[2]);\n      case 'L':\n        return \"L \".concat(params[1] + (useEndOffset ? endOffsetX : 0), \",\").concat(params[2] + (useEndOffset ? endOffsetY : 0));\n      case 'Q':\n        return \"Q \".concat(params[1], \" \").concat(params[2], \",\").concat(params[3], \" \").concat(params[4]).concat(useEndOffset ? \" L \".concat(params[3] + endOffsetX, \",\").concat(params[4] + endOffsetY) : '');\n      case 'C':\n        return \"C \".concat(params[1], \" \").concat(params[2], \",\").concat(params[3], \" \").concat(params[4], \",\").concat(params[5], \" \").concat(params[6]).concat(useEndOffset ? \" L \".concat(params[5] + endOffsetX, \",\").concat(params[6] + endOffsetY) : '');\n      case 'A':\n        return \"A \".concat(params[1], \" \").concat(params[2], \" \").concat(params[3], \" \").concat(params[4], \" \").concat(params[5], \" \").concat(params[6], \" \").concat(params[7]).concat(useEndOffset ? \" L \".concat(params[6] + endOffsetX, \",\").concat(params[7] + endOffsetY) : '');\n      case 'Z':\n        return 'Z';\n      default:\n        return null;\n    }\n  }).filter(function (item) {\n    return item !== null;\n  }).join(' ');\n  if (~newValue.indexOf('NaN')) {\n    return '';\n  }\n  return newValue;\n}\nvar internalParsePath = function internalParsePath(path) {\n  // empty path\n  if (path === '' || Array.isArray(path) && path.length === 0) {\n    return {\n      absolutePath: [],\n      hasArc: false,\n      segments: [],\n      polygons: [],\n      polylines: [],\n      curve: null,\n      totalLength: 0,\n      rect: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n      }\n    };\n  }\n  var absolutePath;\n  try {\n    absolutePath = normalizePath(path);\n  } catch (_unused) {\n    absolutePath = normalizePath('');\n    console.error(\"[g]: Invalid SVG Path definition: \".concat(path));\n  }\n  removeRedundantMCommand(absolutePath);\n  var hasArc = hasArcOrBezier(absolutePath);\n  var _extractPolygons = extractPolygons(absolutePath),\n    polygons = _extractPolygons.polygons,\n    polylines = _extractPolygons.polylines;\n\n  // for later use\n  var segments = path2Segments(absolutePath);\n\n  // Only calculate bbox here since we don't need length now.\n  var _getPathBBox = getPathBBox(segments, 0),\n    x = _getPathBBox.x,\n    y = _getPathBBox.y,\n    width = _getPathBBox.width,\n    height = _getPathBBox.height;\n  return {\n    absolutePath: absolutePath,\n    hasArc: hasArc,\n    segments: segments,\n    polygons: polygons,\n    polylines: polylines,\n    // curve,\n    // Delay the calculation of length.\n    totalLength: 0,\n    rect: {\n      x: Number.isFinite(x) ? x : 0,\n      y: Number.isFinite(y) ? y : 0,\n      width: Number.isFinite(width) ? width : 0,\n      height: Number.isFinite(height) ? height : 0\n    }\n  };\n};\nvar memoizedParsePath = memoize(internalParsePath);\nfunction parsePath(path) {\n  return isString(path) ? memoizedParsePath(path) : internalParsePath(path);\n}\nfunction mergePaths(left, right, object) {\n  var curve1 = left.curve;\n  var curve2 = right.curve;\n  if (!curve1 || curve1.length === 0) {\n    // convert to curves to do morphing & picking later\n    // @see http://thednp.github.io/kute.js/svgCubicMorph.html\n    curve1 = path2Curve(left.absolutePath, false);\n    left.curve = curve1;\n  }\n  if (!curve2 || curve2.length === 0) {\n    curve2 = path2Curve(right.absolutePath, false);\n    right.curve = curve2;\n  }\n  var curves = [curve1, curve2];\n  if (curve1.length !== curve2.length) {\n    curves = equalizeSegments(curve1, curve2);\n  }\n  var curve0 = getDrawDirection(curves[0]) !== getDrawDirection(curves[1]) ? reverseCurve(curves[0]) : clonePath(curves[0]);\n  return [curve0, getRotatedCurve(curves[1], curve0), function (pathArray) {\n    // need converting to path string?\n    return pathArray;\n  }];\n}\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/points\n *\n * @example\n * points=\"100,10 250,150 200,110\"\n */\nfunction parsePoints(pointsOrStr, object) {\n  var points;\n  if (isString(pointsOrStr)) {\n    points = pointsOrStr.split(' ').map(function (pointStr) {\n      var _pointStr$split = pointStr.split(','),\n        _pointStr$split2 = _slicedToArray(_pointStr$split, 2),\n        x = _pointStr$split2[0],\n        y = _pointStr$split2[1];\n      return [Number(x), Number(y)];\n    });\n  } else {\n    points = pointsOrStr;\n  }\n  return {\n    points: points,\n    totalLength: 0,\n    segments: []\n  };\n}\nfunction mergePoints(left, right) {\n  return [left.points, right.points, function (points) {\n    return points;\n  }];\n}\n\n// eg. { t: 'scale', d: [CSSUnitValue(1), CSSUnitValue(2)] }\n\nvar _ = null;\nvar TRANSFORM_REGEXP = /\\s*(\\w+)\\(([^)]*)\\)/g;\nfunction cast(pattern) {\n  return function (contents) {\n    var i = 0;\n    return pattern.map(function (x) {\n      return x === _ ? contents[i++] : x;\n    });\n  };\n}\nfunction id(x) {\n  return x;\n}\n\n// type: [argTypes, convertTo3D, convertTo2D]\n// In the argument types string, lowercase characters represent optional arguments\nvar transformFunctions = {\n  // @ts-ignore\n  matrix: ['NNNNNN', [_, _, 0, 0, _, _, 0, 0, 0, 0, 1, 0, _, _, 0, 1], id],\n  matrix3d: ['NNNNNNNNNNNNNNNN', id],\n  rotate: ['A'],\n  rotateX: ['A'],\n  rotateY: ['A'],\n  rotateZ: ['A'],\n  rotate3d: ['NNNA'],\n  perspective: ['L'],\n  scale: ['Nn', cast([_, _, new CSSUnitValue(1)]), id],\n  scaleX: ['N', cast([_, new CSSUnitValue(1), new CSSUnitValue(1)]), cast([_, new CSSUnitValue(1)])],\n  scaleY: ['N', cast([new CSSUnitValue(1), _, new CSSUnitValue(1)]), cast([new CSSUnitValue(1), _])],\n  scaleZ: ['N', cast([new CSSUnitValue(1), new CSSUnitValue(1), _])],\n  scale3d: ['NNN', id],\n  skew: ['Aa', null, id],\n  skewX: ['A', null, cast([_, Odeg])],\n  skewY: ['A', null, cast([Odeg, _])],\n  translate: ['Tt', cast([_, _, Opx]), id],\n  translateX: ['T', cast([_, Opx, Opx]), cast([_, Opx])],\n  translateY: ['T', cast([Opx, _, Opx]), cast([Opx, _])],\n  translateZ: ['L', cast([Opx, Opx, _])],\n  translate3d: ['TTL', id]\n};\nfunction parseArrayTransform(transform) {\n  var result = [];\n  var length = transform.length;\n  for (var i = 0; i < length; i++) {\n    var item = transform[i];\n    var name = item[0];\n    var args = item.slice(1);\n    // infer default value\n    if (name === 'translate' || name === 'skew') {\n      if (args.length === 1) args.push(0);\n    } else if (name === 'scale') {\n      if (args.length === 1) args.push(args[0]);\n    }\n    var functionData = transformFunctions[name];\n    if (!functionData) return [];\n    var parsedArgs = args.map(function (value) {\n      return getOrCreateUnitValue(value);\n    });\n    result.push({\n      t: name,\n      d: parsedArgs\n    });\n  }\n  return result;\n}\n\n/**\n * none\n * scale(1) scale(1, 2)\n * scaleX(1)\n */\nfunction parseTransform(transform) {\n  if (Array.isArray(transform)) {\n    return parseArrayTransform(transform);\n  }\n  transform = (transform || 'none').trim();\n  if (transform === 'none') {\n    return [];\n  }\n  var result = [];\n  var match;\n  var prevLastIndex = 0;\n  TRANSFORM_REGEXP.lastIndex = 0;\n  while (match = TRANSFORM_REGEXP.exec(transform)) {\n    if (match.index !== prevLastIndex) {\n      return [];\n    }\n    prevLastIndex = match.index + match[0].length;\n    var functionName = match[1]; // scale\n    var functionData = transformFunctions[functionName]; // scale(1, 2)\n    if (!functionData) {\n      // invalid, eg. scale()\n      return [];\n    }\n    var args = match[2].split(','); // 1,2\n    var argTypes = functionData[0]; // Nn\n    if (argTypes.length < args.length) {\n      // scale(N, n)\n      return [];\n    }\n    var parsedArgs = [];\n    for (var i = 0; i < argTypes.length; i++) {\n      var arg = args[i];\n      var type = argTypes[i];\n      var parsedArg = void 0;\n      if (!arg) {\n        // @ts-ignore\n        parsedArg = {\n          a: Odeg,\n          n: parsedArgs[0],\n          t: Opx\n        }[type];\n      } else {\n        // @ts-ignore\n        parsedArg = {\n          A: function A(s) {\n            return s.trim() === '0' ? Odeg : parseAngle(s);\n          },\n          N: parseNumber,\n          T: parseLengthOrPercentage,\n          L: parseLength\n        }[type.toUpperCase()](arg);\n      }\n      if (parsedArg === undefined) {\n        return [];\n      }\n      parsedArgs.push(parsedArg);\n    }\n    result.push({\n      t: functionName,\n      d: parsedArgs\n    }); // { t: scale, d: [1, 2] }\n\n    if (TRANSFORM_REGEXP.lastIndex === transform.length) {\n      return result;\n    }\n  }\n  return [];\n}\nfunction parseTransformUnmemoize(transform) {\n  if (Array.isArray(transform)) {\n    return parseArrayTransform(transform);\n  }\n  transform = (transform || 'none').trim();\n  if (transform === 'none') {\n    return [];\n  }\n  var result = [];\n  var match;\n  var prevLastIndex = 0;\n  TRANSFORM_REGEXP.lastIndex = 0;\n  while (match = TRANSFORM_REGEXP.exec(transform)) {\n    if (match.index !== prevLastIndex) {\n      return [];\n    }\n    prevLastIndex = match.index + match[0].length;\n    var functionName = match[1]; // scale\n    var functionData = transformFunctions[functionName]; // scale(1, 2)\n    if (!functionData) {\n      // invalid, eg. scale()\n      return [];\n    }\n    var args = match[2].split(','); // 1,2\n    var argTypes = functionData[0]; // Nn\n    if (argTypes.length < args.length) {\n      // scale(N, n)\n      return [];\n    }\n    var parsedArgs = [];\n    for (var i = 0; i < argTypes.length; i++) {\n      var arg = args[i];\n      var type = argTypes[i];\n      var parsedArg = void 0;\n      if (!arg) {\n        // @ts-ignore\n        parsedArg = {\n          a: Odeg,\n          n: parsedArgs[0],\n          t: Opx\n        }[type];\n      } else {\n        // @ts-ignore\n        parsedArg = {\n          A: function A(s) {\n            return s.trim() === '0' ? Odeg : parseAngleUnmemoize(s);\n          },\n          N: parseNumberUnmemoize,\n          T: parseLengthOrPercentageUnmemoize,\n          L: parseLengthUnmemoize\n        }[type.toUpperCase()](arg);\n      }\n      if (parsedArg === undefined) {\n        return [];\n      }\n      parsedArgs.push(parsedArg);\n    }\n    result.push({\n      t: functionName,\n      d: parsedArgs\n    }); // { t: scale, d: [1, 2] }\n\n    if (TRANSFORM_REGEXP.lastIndex === transform.length) {\n      return result;\n    }\n  }\n  return [];\n}\nfunction convertItemToMatrix(item) {\n  var x;\n  var y;\n  var z;\n  var angle;\n  switch (item.t) {\n    case 'rotateX':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [1, 0, 0, 0, 0, Math.cos(angle), Math.sin(angle), 0, 0, -Math.sin(angle), Math.cos(angle), 0, 0, 0, 0, 1];\n    case 'rotateY':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [Math.cos(angle), 0, -Math.sin(angle), 0, 0, 1, 0, 0, Math.sin(angle), 0, Math.cos(angle), 0, 0, 0, 0, 1];\n    case 'rotate':\n    case 'rotateZ':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [Math.cos(angle), Math.sin(angle), 0, 0, -Math.sin(angle), Math.cos(angle), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'rotate3d':\n      x = item.d[0].value;\n      y = item.d[1].value;\n      z = item.d[2].value;\n      angle = deg2rad(convertAngleUnit(item.d[3]));\n      var sqrLength = x * x + y * y + z * z;\n      if (sqrLength === 0) {\n        x = 1;\n        y = 0;\n        z = 0;\n      } else if (sqrLength !== 1) {\n        var length = Math.sqrt(sqrLength);\n        x /= length;\n        y /= length;\n        z /= length;\n      }\n      var s = Math.sin(angle / 2);\n      var sc = s * Math.cos(angle / 2);\n      var sq = s * s;\n      return [1 - 2 * (y * y + z * z) * sq, 2 * (x * y * sq + z * sc), 2 * (x * z * sq - y * sc), 0, 2 * (x * y * sq - z * sc), 1 - 2 * (x * x + z * z) * sq, 2 * (y * z * sq + x * sc), 0, 2 * (x * z * sq + y * sc), 2 * (y * z * sq - x * sc), 1 - 2 * (x * x + y * y) * sq, 0, 0, 0, 0, 1];\n    case 'scale':\n      return [item.d[0].value, 0, 0, 0, 0, item.d[1].value, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'scaleX':\n      return [item.d[0].value, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'scaleY':\n      return [1, 0, 0, 0, 0, item.d[0].value, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'scaleZ':\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, item.d[0].value, 0, 0, 0, 0, 1];\n    case 'scale3d':\n      return [item.d[0].value, 0, 0, 0, 0, item.d[1].value, 0, 0, 0, 0, item.d[2].value, 0, 0, 0, 0, 1];\n    case 'skew':\n      var xAngle = deg2rad(convertAngleUnit(item.d[0]));\n      var yAngle = deg2rad(convertAngleUnit(item.d[1]));\n      return [1, Math.tan(yAngle), 0, 0, Math.tan(xAngle), 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'skewX':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [1, 0, 0, 0, Math.tan(angle), 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'skewY':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [1, Math.tan(angle), 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'translate':\n      // TODO: pass target\n      x = convertPercentUnit(item.d[0], 0, null) || 0;\n      y = convertPercentUnit(item.d[1], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, y, 0, 1];\n    case 'translateX':\n      x = convertPercentUnit(item.d[0], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, 0, 0, 1];\n    case 'translateY':\n      y = convertPercentUnit(item.d[0], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, y, 0, 1];\n    case 'translateZ':\n      z = convertPercentUnit(item.d[0], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, z, 1];\n    case 'translate3d':\n      x = convertPercentUnit(item.d[0], 0, null) || 0;\n      y = convertPercentUnit(item.d[1], 0, null) || 0;\n      z = convertPercentUnit(item.d[2], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, y, z, 1];\n    case 'perspective':\n      var t = convertPercentUnit(item.d[0], 0, null) || 0;\n      var p = t ? -1 / t : 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, p, 0, 0, 0, 1];\n    case 'matrix':\n      return [item.d[0].value, item.d[1].value, 0, 0, item.d[2].value, item.d[3].value, 0, 0, 0, 0, 1, 0, item.d[4].value, item.d[5].value, 0, 1];\n    case 'matrix3d':\n      return item.d.map(function (d) {\n        return d.value;\n      });\n  }\n}\nfunction multiplyMatrices(a, b) {\n  return [a[0] * b[0] + a[4] * b[1] + a[8] * b[2] + a[12] * b[3], a[1] * b[0] + a[5] * b[1] + a[9] * b[2] + a[13] * b[3], a[2] * b[0] + a[6] * b[1] + a[10] * b[2] + a[14] * b[3], a[3] * b[0] + a[7] * b[1] + a[11] * b[2] + a[15] * b[3], a[0] * b[4] + a[4] * b[5] + a[8] * b[6] + a[12] * b[7], a[1] * b[4] + a[5] * b[5] + a[9] * b[6] + a[13] * b[7], a[2] * b[4] + a[6] * b[5] + a[10] * b[6] + a[14] * b[7], a[3] * b[4] + a[7] * b[5] + a[11] * b[6] + a[15] * b[7], a[0] * b[8] + a[4] * b[9] + a[8] * b[10] + a[12] * b[11], a[1] * b[8] + a[5] * b[9] + a[9] * b[10] + a[13] * b[11], a[2] * b[8] + a[6] * b[9] + a[10] * b[10] + a[14] * b[11], a[3] * b[8] + a[7] * b[9] + a[11] * b[10] + a[15] * b[11], a[0] * b[12] + a[4] * b[13] + a[8] * b[14] + a[12] * b[15], a[1] * b[12] + a[5] * b[13] + a[9] * b[14] + a[13] * b[15], a[2] * b[12] + a[6] * b[13] + a[10] * b[14] + a[14] * b[15], a[3] * b[12] + a[7] * b[13] + a[11] * b[14] + a[15] * b[15]];\n}\nfunction convertToMatrix(transformList) {\n  if (transformList.length === 0) {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n  }\n  return transformList.map(convertItemToMatrix).reduce(multiplyMatrices);\n}\nfunction makeMatrixDecomposition(transformList) {\n  var translate = [0, 0, 0];\n  var scale = [1, 1, 1];\n  var skew = [0, 0, 0];\n  var perspective = [0, 0, 0, 1];\n  var quaternion = [0, 0, 0, 1];\n  decomposeMat4(\n  // @ts-ignore\n  convertToMatrix(transformList), translate, scale, skew, perspective, quaternion);\n  return [[translate, scale, skew, quaternion, perspective]];\n}\nvar composeMatrix = function () {\n  function multiply(a, b) {\n    var result = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]];\n    for (var i = 0; i < 4; i++) {\n      for (var j = 0; j < 4; j++) {\n        for (var k = 0; k < 4; k++) {\n          result[i][j] += b[i][k] * a[k][j];\n        }\n      }\n    }\n    return result;\n  }\n  function is2D(m) {\n    return m[0][2] === 0 && m[0][3] === 0 && m[1][2] === 0 && m[1][3] === 0 && m[2][0] === 0 && m[2][1] === 0 && m[2][2] === 1 && m[2][3] === 0 && m[3][2] === 0 && m[3][3] === 1;\n  }\n  function composeMatrix(translate, scale, skew, quat, perspective) {\n    var matrix = [[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1]];\n    for (var i = 0; i < 4; i++) {\n      matrix[i][3] = perspective[i];\n    }\n    for (var _i = 0; _i < 3; _i++) {\n      for (var j = 0; j < 3; j++) {\n        matrix[3][_i] += translate[j] * matrix[j][_i];\n      }\n    }\n    var x = quat[0];\n    var y = quat[1];\n    var z = quat[2];\n    var w = quat[3];\n    var rotMatrix = [[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1]];\n    rotMatrix[0][0] = 1 - 2 * (y * y + z * z);\n    rotMatrix[0][1] = 2 * (x * y - z * w);\n    rotMatrix[0][2] = 2 * (x * z + y * w);\n    rotMatrix[1][0] = 2 * (x * y + z * w);\n    rotMatrix[1][1] = 1 - 2 * (x * x + z * z);\n    rotMatrix[1][2] = 2 * (y * z - x * w);\n    rotMatrix[2][0] = 2 * (x * z - y * w);\n    rotMatrix[2][1] = 2 * (y * z + x * w);\n    rotMatrix[2][2] = 1 - 2 * (x * x + y * y);\n    matrix = multiply(matrix, rotMatrix);\n    var temp = [[1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1]];\n    if (skew[2]) {\n      temp[2][1] = skew[2];\n      matrix = multiply(matrix, temp);\n    }\n    if (skew[1]) {\n      temp[2][1] = 0;\n      temp[2][0] = skew[0];\n      matrix = multiply(matrix, temp);\n    }\n    if (skew[0]) {\n      temp[2][0] = 0;\n      temp[1][0] = skew[0];\n      matrix = multiply(matrix, temp);\n    }\n    for (var _i2 = 0; _i2 < 3; _i2++) {\n      for (var _j = 0; _j < 3; _j++) {\n        matrix[_i2][_j] *= scale[_i2];\n      }\n    }\n    if (is2D(matrix)) {\n      return [matrix[0][0], matrix[0][1], matrix[1][0], matrix[1][1], matrix[3][0], matrix[3][1]];\n    }\n    return matrix[0].concat(matrix[1], matrix[2], matrix[3]);\n  }\n  return composeMatrix;\n}();\nfunction numberToLongString(x) {\n  return x.toFixed(6).replace('.000000', '');\n}\nfunction mergeMatrices(left, right) {\n  var leftArgs;\n  var rightArgs;\n  // @ts-ignore\n  if (left.decompositionPair !== right) {\n    // @ts-ignore\n    left.decompositionPair = right;\n    // @ts-ignore\n    leftArgs = makeMatrixDecomposition(left);\n  }\n  // @ts-ignore\n  if (right.decompositionPair !== left) {\n    // @ts-ignore\n    right.decompositionPair = left;\n    // @ts-ignore\n    rightArgs = makeMatrixDecomposition(right);\n  }\n  if (leftArgs[0] === null || rightArgs[0] === null) return [\n  // @ts-ignore\n  [false],\n  // @ts-ignore\n  [true],\n  // @ts-ignore\n  function (x) {\n    return x ? right[0].d : left[0].d;\n  }];\n  leftArgs[0].push(0);\n  rightArgs[0].push(1);\n  return [leftArgs, rightArgs,\n  // @ts-ignore\n  function (list) {\n    // @ts-ignore\n    var q = quat(leftArgs[0][3], rightArgs[0][3], list[5]);\n    var mat = composeMatrix(list[0], list[1], list[2], q, list[4]);\n    var stringifiedArgs = mat.map(numberToLongString).join(',');\n    return stringifiedArgs;\n  }];\n}\nfunction dot(v1, v2) {\n  var result = 0;\n  for (var i = 0; i < v1.length; i++) {\n    result += v1[i] * v2[i];\n  }\n  return result;\n}\nfunction quat(fromQ, toQ, f) {\n  var product = dot(fromQ, toQ);\n  product = clamp(product, -1.0, 1.0);\n  var quat = [];\n  if (product === 1.0) {\n    quat = fromQ;\n  } else {\n    var theta = Math.acos(product);\n    var w = Math.sin(f * theta) * 1 / Math.sqrt(1 - product * product);\n    for (var i = 0; i < 4; i++) {\n      quat.push(fromQ[i] * (Math.cos(f * theta) - product * w) + toQ[i] * w);\n    }\n  }\n  return quat;\n}\n\n// scaleX/Y/Z -> scale\nfunction typeTo2D(type) {\n  return type.replace(/[XY]/, '');\n}\n\n// scaleX/Y/Z -> scale3d\nfunction typeTo3D(type) {\n  return type.replace(/(X|Y|Z|3d)?$/, '3d');\n}\nvar isMatrixOrPerspective = function isMatrixOrPerspective(lt, rt) {\n  return lt === 'perspective' && rt === 'perspective' || (lt === 'matrix' || lt === 'matrix3d') && (rt === 'matrix' || rt === 'matrix3d');\n};\nfunction mergeTransforms(left, right, target) {\n  var flipResults = false;\n  // padding empty transform, eg. merge 'scale(10)' with 'none' -> scale(1)\n  if (!left.length || !right.length) {\n    if (!left.length) {\n      flipResults = true;\n      left = right;\n      right = [];\n    }\n    var _loop = function _loop() {\n      var _left$i = left[i],\n        type = _left$i.t,\n        args = _left$i.d;\n      // none -> scale(1)/translateX(0)\n      var defaultValue = type.substring(0, 5) === 'scale' ? 1 : 0;\n      right.push({\n        t: type,\n        d: args.map(function (arg) {\n          if (typeof arg === 'number') {\n            return getOrCreateUnitValue(defaultValue);\n          }\n          return getOrCreateUnitValue(defaultValue, arg.unit);\n          //   {\n          //     unit: arg.unit,\n          //     value: defaultValue,\n          //   };\n        })\n      });\n    };\n    for (var i = 0; i < left.length; i++) {\n      _loop();\n    }\n  }\n  var leftResult = [];\n  var rightResult = [];\n  var types = [];\n\n  // merge matrix() with matrix3d()\n  if (left.length !== right.length) {\n    var merged = mergeMatrices(left, right);\n    // @ts-ignore\n    leftResult = [merged[0]];\n    // @ts-ignore\n    rightResult = [merged[1]];\n    types = [['matrix', [merged[2]]]];\n  } else {\n    for (var _i3 = 0; _i3 < left.length; _i3++) {\n      var leftType = left[_i3].t;\n      var rightType = right[_i3].t;\n      var leftArgs = left[_i3].d;\n      var rightArgs = right[_i3].d;\n      var leftFunctionData = transformFunctions[leftType];\n      var rightFunctionData = transformFunctions[rightType];\n      var type = void 0;\n      if (isMatrixOrPerspective(leftType, rightType)) {\n        var _merged = mergeMatrices([left[_i3]], [right[_i3]]);\n        // @ts-ignore\n        leftResult.push(_merged[0]);\n        // @ts-ignore\n        rightResult.push(_merged[1]);\n        types.push(['matrix', [_merged[2]]]);\n        continue;\n      } else if (leftType === rightType) {\n        type = leftType;\n      } else if (leftFunctionData[2] && rightFunctionData[2] && typeTo2D(leftType) === typeTo2D(rightType)) {\n        type = typeTo2D(leftType);\n        // @ts-ignore\n        leftArgs = leftFunctionData[2](leftArgs);\n        // @ts-ignore\n        rightArgs = rightFunctionData[2](rightArgs);\n      } else if (leftFunctionData[1] && rightFunctionData[1] && typeTo3D(leftType) === typeTo3D(rightType)) {\n        type = typeTo3D(leftType);\n        // @ts-ignore\n        leftArgs = leftFunctionData[1](leftArgs);\n        // @ts-ignore\n        rightArgs = rightFunctionData[1](rightArgs);\n      } else {\n        var _merged2 = mergeMatrices(left, right);\n        // @ts-ignore\n        leftResult = [_merged2[0]];\n        // @ts-ignore\n        rightResult = [_merged2[1]];\n        types = [['matrix', [_merged2[2]]]];\n        break;\n      }\n      var leftArgsCopy = [];\n      var rightArgsCopy = [];\n      var stringConversions = [];\n      for (var j = 0; j < leftArgs.length; j++) {\n        // const merge = leftArgs[j].unit === UnitType.kNumber ? mergeDimensions : mergeDimensions;\n        var _merged3 = mergeDimensions(leftArgs[j], rightArgs[j], target, false, j);\n        leftArgsCopy[j] = _merged3[0];\n        rightArgsCopy[j] = _merged3[1];\n        stringConversions.push(_merged3[2]);\n      }\n      leftResult.push(leftArgsCopy);\n      rightResult.push(rightArgsCopy);\n      types.push([type, stringConversions]);\n    }\n  }\n  if (flipResults) {\n    var tmp = leftResult;\n    leftResult = rightResult;\n    rightResult = tmp;\n  }\n  return [leftResult, rightResult, function (list) {\n    return list.map(function (args, i) {\n      var stringifiedArgs = args.map(function (arg, j) {\n        return types[i][1][j](arg);\n      }).join(',');\n      if (types[i][0] === 'matrix' && stringifiedArgs.split(',').length === 16) {\n        types[i][0] = 'matrix3d';\n      }\n      if (types[i][0] === 'matrix3d' && stringifiedArgs.split(',').length === 6) {\n        types[i][0] = 'matrix';\n      }\n      return \"\".concat(types[i][0], \"(\").concat(stringifiedArgs, \")\");\n    }).join(' ');\n  }];\n}\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-origin\n * eg. 'center' 'top left' '50px 50px'\n */\nvar parseTransformOrigin = memoize(function (value) {\n  if (isString(value)) {\n    if (value === 'text-anchor') {\n      return [getOrCreateUnitValue(0, 'px'), getOrCreateUnitValue(0, 'px')];\n    }\n    var values = value.split(' ');\n    if (values.length === 1) {\n      if (values[0] === 'top' || values[0] === 'bottom') {\n        // 'top' -> 'center top'\n        values[1] = values[0];\n        values[0] = 'center';\n      } else {\n        // '50px' -> '50px center'\n        values[1] = 'center';\n      }\n    }\n    if (values.length !== 2) {\n      return null;\n    }\n\n    // eg. center bottom\n    return [parseLengthOrPercentage(convertKeyword2Percent(values[0])), parseLengthOrPercentage(convertKeyword2Percent(values[1]))];\n  }\n  return [getOrCreateUnitValue(value[0] || 0, 'px'), getOrCreateUnitValue(value[1] || 0, 'px')];\n});\nfunction convertKeyword2Percent(keyword) {\n  if (keyword === 'center') {\n    return '50%';\n  }\n  if (keyword === 'left' || keyword === 'top') {\n    return '0%';\n  }\n  if (keyword === 'right' || keyword === 'bottom') {\n    return '100%';\n  }\n  return keyword;\n}\n\n/**\n * Blink used them in code generation(css_properties.json5)\n */\nvar BUILT_IN_PROPERTIES = [{\n  /**\n   * used in CSS Layout API\n   * eg. `display: 'flex'`\n   */\n  n: 'display',\n  k: ['none']\n}, {\n  /**\n   * range [0.0, 1.0]\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/opacity\n   */\n  n: 'opacity',\n  \"int\": true,\n  inh: true,\n  d: '1',\n  syntax: PropertySyntax.OPACITY_VALUE\n}, {\n  /**\n   * inheritable, range [0.0, 1.0]\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/fill-opacity\n   * @see https://svgwg.org/svg2-draft/painting.html#FillOpacity\n   */\n  n: 'fillOpacity',\n  \"int\": true,\n  inh: true,\n  d: '1',\n  syntax: PropertySyntax.OPACITY_VALUE\n}, {\n  /**\n   * inheritable, range [0.0, 1.0]\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-opacity\n   * @see https://svgwg.org/svg2-draft/painting.html#StrokeOpacity\n   */\n  n: 'strokeOpacity',\n  \"int\": true,\n  inh: true,\n  d: '1',\n  syntax: PropertySyntax.OPACITY_VALUE\n}, {\n  /**\n   * background-color is not inheritable\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Fills_and_Strokes\n   */\n  n: 'fill',\n  \"int\": true,\n  k: ['none'],\n  d: 'none',\n  syntax: PropertySyntax.PAINT\n}, {\n  n: 'fillRule',\n  k: ['nonzero', 'evenodd'],\n  d: 'nonzero'\n},\n/**\n * default to none\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke#usage_notes\n */\n{\n  n: 'stroke',\n  \"int\": true,\n  k: ['none'],\n  d: 'none',\n  syntax: PropertySyntax.PAINT,\n  /**\n   * Stroke 'none' won't affect geometry but others will.\n   */\n  l: true\n}, {\n  n: 'shadowType',\n  k: ['inner', 'outer', 'both'],\n  d: 'outer',\n  l: true\n}, {\n  n: 'shadowColor',\n  \"int\": true,\n  syntax: PropertySyntax.COLOR\n}, {\n  n: 'shadowOffsetX',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'shadowOffsetY',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'shadowBlur',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.SHADOW_BLUR\n}, {\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-width\n   */\n  n: 'lineWidth',\n  \"int\": true,\n  inh: true,\n  d: '1',\n  l: true,\n  a: ['strokeWidth'],\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'increasedLineWidthForHitTesting',\n  inh: true,\n  d: '0',\n  l: true,\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'lineJoin',\n  inh: true,\n  l: true,\n  a: ['strokeLinejoin'],\n  k: ['miter', 'bevel', 'round'],\n  d: 'miter'\n}, {\n  n: 'lineCap',\n  inh: true,\n  l: true,\n  a: ['strokeLinecap'],\n  k: ['butt', 'round', 'square'],\n  d: 'butt'\n}, {\n  n: 'lineDash',\n  \"int\": true,\n  inh: true,\n  k: ['none'],\n  a: ['strokeDasharray'],\n  syntax: PropertySyntax.LENGTH_PERCENTAGE_12\n}, {\n  n: 'lineDashOffset',\n  \"int\": true,\n  inh: true,\n  d: '0',\n  a: ['strokeDashoffset'],\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'offsetPath',\n  syntax: PropertySyntax.DEFINED_PATH\n}, {\n  n: 'offsetDistance',\n  \"int\": true,\n  syntax: PropertySyntax.OFFSET_DISTANCE\n}, {\n  n: 'dx',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'dy',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'zIndex',\n  ind: true,\n  \"int\": true,\n  d: '0',\n  k: ['auto'],\n  syntax: PropertySyntax.Z_INDEX\n}, {\n  n: 'visibility',\n  k: ['visible', 'hidden'],\n  ind: true,\n  inh: true,\n  /**\n   * support interpolation\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/visibility#interpolation\n   */\n  \"int\": true,\n  d: 'visible'\n}, {\n  n: 'pointerEvents',\n  inh: true,\n  k: ['none', 'auto', 'stroke', 'fill', 'painted', 'visible', 'visiblestroke', 'visiblefill', 'visiblepainted',\n  // 'bounding-box',\n  'all'],\n  d: 'auto'\n}, {\n  n: 'filter',\n  ind: true,\n  l: true,\n  k: ['none'],\n  d: 'none',\n  syntax: PropertySyntax.FILTER\n}, {\n  n: 'clipPath',\n  syntax: PropertySyntax.DEFINED_PATH\n}, {\n  n: 'textPath',\n  syntax: PropertySyntax.DEFINED_PATH\n}, {\n  n: 'textPathSide',\n  k: ['left', 'right'],\n  d: 'left'\n}, {\n  n: 'textPathStartOffset',\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'transform',\n  p: 100,\n  \"int\": true,\n  k: ['none'],\n  d: 'none',\n  syntax: PropertySyntax.TRANSFORM\n}, {\n  n: 'transformOrigin',\n  p: 100,\n  d: '0 0',\n  // // int: true,\n  // d: (nodeName: string) => {\n  //   if (nodeName === Shape.CIRCLE || nodeName === Shape.ELLIPSE) {\n  //     return 'center';\n  //   }\n  //   if (nodeName === Shape.TEXT) {\n  //     return 'text-anchor';\n  //   }\n  //   return 'left top';\n  // },\n  l: true,\n  syntax: PropertySyntax.TRANSFORM_ORIGIN\n}, {\n  n: 'cx',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'cy',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'cz',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'r',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'rx',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'ry',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n},\n// Rect Image Group\n{\n  // x in local space\n  n: 'x',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.COORDINATE\n}, {\n  // y in local space\n  n: 'y',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.COORDINATE\n}, {\n  // z in local space\n  n: 'z',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'width',\n  \"int\": true,\n  l: true,\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/width\n   */\n  k: ['auto', 'fit-content', 'min-content', 'max-content'],\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'height',\n  \"int\": true,\n  l: true,\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/height\n   */\n  k: ['auto', 'fit-content', 'min-content', 'max-content'],\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'radius',\n  \"int\": true,\n  l: true,\n  d: '0',\n  syntax: PropertySyntax.LENGTH_PERCENTAGE_14\n},\n// Line\n{\n  n: 'x1',\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'y1',\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'z1',\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'x2',\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'y2',\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.COORDINATE\n}, {\n  n: 'z2',\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.COORDINATE\n},\n// Path\n{\n  n: 'd',\n  \"int\": true,\n  l: true,\n  d: '',\n  syntax: PropertySyntax.PATH,\n  p: 50\n},\n// Polyline & Polygon\n{\n  n: 'points',\n  /**\n   * support interpolation\n   */\n  \"int\": true,\n  l: true,\n  syntax: PropertySyntax.LIST_OF_POINTS,\n  p: 50\n},\n// Text\n{\n  n: 'text',\n  l: true,\n  d: '',\n  syntax: PropertySyntax.TEXT,\n  p: 50\n}, {\n  n: 'textTransform',\n  l: true,\n  inh: true,\n  k: ['capitalize', 'uppercase', 'lowercase', 'none'],\n  d: 'none',\n  syntax: PropertySyntax.TEXT_TRANSFORM,\n  p: 51 // it must get parsed after text\n}, {\n  n: 'font',\n  l: true\n}, {\n  n: 'fontSize',\n  \"int\": true,\n  inh: true,\n  /**\n   * @see https://www.w3schools.com/css/css_font_size.asp\n   */\n  d: '16px',\n  l: true,\n  syntax: PropertySyntax.LENGTH_PERCENTAGE\n}, {\n  n: 'fontFamily',\n  l: true,\n  inh: true,\n  d: 'sans-serif'\n}, {\n  n: 'fontStyle',\n  l: true,\n  inh: true,\n  k: ['normal', 'italic', 'oblique'],\n  d: 'normal'\n}, {\n  n: 'fontWeight',\n  l: true,\n  inh: true,\n  k: ['normal', 'bold', 'bolder', 'lighter'],\n  d: 'normal'\n}, {\n  n: 'fontVariant',\n  l: true,\n  inh: true,\n  k: ['normal', 'small-caps'],\n  d: 'normal'\n}, {\n  n: 'lineHeight',\n  l: true,\n  syntax: PropertySyntax.LENGTH,\n  \"int\": true,\n  d: '0'\n}, {\n  n: 'letterSpacing',\n  l: true,\n  syntax: PropertySyntax.LENGTH,\n  \"int\": true,\n  d: '0'\n}, {\n  n: 'miterLimit',\n  l: true,\n  syntax: PropertySyntax.NUMBER,\n  d: function d(nodeName) {\n    if (nodeName === Shape.PATH || nodeName === Shape.POLYGON || nodeName === Shape.POLYLINE) {\n      return '4';\n    }\n    return '10';\n  }\n}, {\n  n: 'wordWrap',\n  l: true\n}, {\n  n: 'wordWrapWidth',\n  l: true\n}, {\n  n: 'maxLines',\n  l: true\n}, {\n  n: 'textOverflow',\n  l: true,\n  d: 'clip'\n}, {\n  n: 'leading',\n  l: true\n}, {\n  n: 'textBaseline',\n  l: true,\n  inh: true,\n  k: ['top', 'hanging', 'middle', 'alphabetic', 'ideographic', 'bottom'],\n  d: 'alphabetic'\n}, {\n  n: 'textAlign',\n  l: true,\n  inh: true,\n  k: ['start', 'center', 'middle', 'end', 'left', 'right'],\n  d: 'start'\n},\n// {\n//   n: 'whiteSpace',\n//   l: true,\n// },\n{\n  n: 'markerStart',\n  syntax: PropertySyntax.MARKER\n}, {\n  n: 'markerEnd',\n  syntax: PropertySyntax.MARKER\n}, {\n  n: 'markerMid',\n  syntax: PropertySyntax.MARKER\n}, {\n  n: 'markerStartOffset',\n  syntax: PropertySyntax.LENGTH,\n  l: true,\n  \"int\": true,\n  d: '0'\n}, {\n  n: 'markerEndOffset',\n  syntax: PropertySyntax.LENGTH,\n  l: true,\n  \"int\": true,\n  d: '0'\n}];\nvar GEOMETRY_ATTRIBUTE_NAMES = BUILT_IN_PROPERTIES.filter(function (n) {\n  return !!n.l;\n}).map(function (n) {\n  return n.n;\n});\nvar propertyMetadataCache = {};\nvar DefaultStyleValueRegistry = /*#__PURE__*/function () {\n  function DefaultStyleValueRegistry(runtime) {\n    var _this = this;\n    _classCallCheck(this, DefaultStyleValueRegistry);\n    this.runtime = runtime;\n    BUILT_IN_PROPERTIES.forEach(function (property) {\n      _this.registerMetadata(property);\n    });\n  }\n  return _createClass(DefaultStyleValueRegistry, [{\n    key: \"registerMetadata\",\n    value: function registerMetadata(metadata) {\n      [metadata.n].concat(_toConsumableArray(metadata.a || [])).forEach(function (name) {\n        propertyMetadataCache[name] = metadata;\n      });\n    }\n  }, {\n    key: \"getPropertySyntax\",\n    value: function getPropertySyntax(syntax) {\n      return this.runtime.CSSPropertySyntaxFactory[syntax];\n    }\n\n    /**\n     * * parse value, eg.\n     * fill: 'red' => CSSRGB\n     * translateX: '10px' => CSSUnitValue { unit: 'px', value: 10 }\n     * fontSize: '2em' => { unit: 'px', value: 32 }\n     *\n     * * calculate used value\n     * * post process\n     */\n  }, {\n    key: \"processProperties\",\n    value: function processProperties(object, attributes) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {\n        skipUpdateAttribute: false,\n        skipParse: false,\n        forceUpdateGeometry: false,\n        usedAttributes: [],\n        memoize: true\n      };\n      Object.assign(object.attributes, attributes);\n\n      // clipPath\n      var oldClipPath = object.parsedStyle.clipPath;\n      var oldOffsetPath = object.parsedStyle.offsetPath;\n      Object.assign(object.parsedStyle, attributes);\n      var needUpdateGeometry = !!options.forceUpdateGeometry;\n      if (!needUpdateGeometry && GEOMETRY_ATTRIBUTE_NAMES.some(function (name) {\n        return name in attributes;\n      })) {\n        needUpdateGeometry = true;\n      }\n      if (attributes.fill) {\n        object.parsedStyle.fill = parseColor(attributes.fill);\n      }\n      if (attributes.stroke) {\n        object.parsedStyle.stroke = parseColor(attributes.stroke);\n      }\n      if (attributes.shadowColor) {\n        object.parsedStyle.shadowColor = parseColor(attributes.shadowColor);\n      }\n      if (attributes.filter) {\n        object.parsedStyle.filter = parseFilter(attributes.filter);\n      }\n      // Rect\n      // @ts-ignore\n      if (!isNil(attributes.radius)) {\n        // @ts-ignore\n        object.parsedStyle.radius = parseDimensionArrayFormat(\n        // @ts-ignore\n        attributes.radius, 4);\n      }\n      // Polyline\n      if (!isNil(attributes.lineDash)) {\n        object.parsedStyle.lineDash = parseDimensionArrayFormat(attributes.lineDash, 2);\n      }\n      // @ts-ignore\n      if (attributes.points) {\n        // @ts-ignore\n        object.parsedStyle.points = parsePoints(attributes.points);\n      }\n      // Path\n      // @ts-ignore\n      if (attributes.d === '') {\n        object.parsedStyle.d = _objectSpread({}, EMPTY_PARSED_PATH);\n      }\n      // @ts-ignore\n      if (attributes.d) {\n        object.parsedStyle.d = parsePath(\n        // @ts-ignore\n        attributes.d);\n      }\n      // Text\n      if (attributes.textTransform) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.TEXT_TRANSFORM].calculator(null, null, {\n          value: attributes.textTransform\n        }, object, null);\n      }\n      if (!isUndefined(attributes.clipPath)) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.DEFINED_PATH].calculator('clipPath', oldClipPath, attributes.clipPath, object, this.runtime);\n      }\n      if (attributes.offsetPath) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.DEFINED_PATH].calculator('offsetPath', oldOffsetPath, attributes.offsetPath, object, this.runtime);\n      }\n      if (attributes.transform) {\n        object.parsedStyle.transform = parseTransform(attributes.transform);\n      }\n      if (attributes.transformOrigin) {\n        object.parsedStyle.transformOrigin = parseTransformOrigin(attributes.transformOrigin);\n      }\n      // Marker\n      // @ts-ignore\n      if (attributes.markerStart) {\n        object.parsedStyle.markerStart = this.runtime.CSSPropertySyntaxFactory[PropertySyntax.MARKER].calculator(null,\n        // @ts-ignore\n        attributes.markerStart,\n        // @ts-ignore\n        attributes.markerStart, null, null);\n      }\n      // @ts-ignore\n      if (attributes.markerEnd) {\n        object.parsedStyle.markerEnd = this.runtime.CSSPropertySyntaxFactory[PropertySyntax.MARKER].calculator(null,\n        // @ts-ignore\n        attributes.markerEnd,\n        // @ts-ignore\n        attributes.markerEnd, null, null);\n      }\n      // @ts-ignore\n      if (attributes.markerMid) {\n        object.parsedStyle.markerMid = this.runtime.CSSPropertySyntaxFactory[PropertySyntax.MARKER].calculator('',\n        // @ts-ignore\n        attributes.markerMid,\n        // @ts-ignore\n        attributes.markerMid, null, null);\n      }\n      if (!isNil(attributes.zIndex)) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.Z_INDEX].postProcessor(object);\n      }\n      if (!isNil(attributes.offsetDistance)) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.OFFSET_DISTANCE].postProcessor(object);\n      }\n      if (attributes.transform) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.TRANSFORM].postProcessor(object);\n      }\n      if (attributes.transformOrigin) {\n        this.runtime.CSSPropertySyntaxFactory[PropertySyntax.TRANSFORM_ORIGIN].postProcessor(object);\n      }\n      if (needUpdateGeometry) {\n        object.geometry.dirty = true;\n        object.renderable.boundsDirty = true;\n        object.renderable.renderBoundsDirty = true;\n        if (!options.forceUpdateGeometry) {\n          this.runtime.sceneGraphService.dirtifyToRoot(object);\n        }\n      }\n    }\n\n    /**\n     * update geometry when relative props changed,\n     * eg. r of Circle, width/height of Rect\n     */\n  }, {\n    key: \"updateGeometry\",\n    value: function updateGeometry(object) {\n      var nodeName = object.nodeName;\n      var geometryUpdater = this.runtime.geometryUpdaterFactory[nodeName];\n      if (geometryUpdater) {\n        var geometry = object.geometry;\n        if (!geometry.contentBounds) {\n          geometry.contentBounds = new AABB();\n        }\n        if (!geometry.renderBounds) {\n          geometry.renderBounds = new AABB();\n        }\n        var parsedStyle = object.parsedStyle;\n        var _geometryUpdater$upda = geometryUpdater.update(parsedStyle, object),\n          _geometryUpdater$upda2 = _geometryUpdater$upda.cx,\n          cx = _geometryUpdater$upda2 === void 0 ? 0 : _geometryUpdater$upda2,\n          _geometryUpdater$upda3 = _geometryUpdater$upda.cy,\n          cy = _geometryUpdater$upda3 === void 0 ? 0 : _geometryUpdater$upda3,\n          _geometryUpdater$upda4 = _geometryUpdater$upda.cz,\n          cz = _geometryUpdater$upda4 === void 0 ? 0 : _geometryUpdater$upda4,\n          _geometryUpdater$upda5 = _geometryUpdater$upda.hwidth,\n          hwidth = _geometryUpdater$upda5 === void 0 ? 0 : _geometryUpdater$upda5,\n          _geometryUpdater$upda6 = _geometryUpdater$upda.hheight,\n          hheight = _geometryUpdater$upda6 === void 0 ? 0 : _geometryUpdater$upda6,\n          _geometryUpdater$upda7 = _geometryUpdater$upda.hdepth,\n          hdepth = _geometryUpdater$upda7 === void 0 ? 0 : _geometryUpdater$upda7;\n        // init with content box\n        var halfExtents = [Math.abs(hwidth), Math.abs(hheight), hdepth];\n        // anchor is center by default, don't account for lineWidth here\n        var stroke = parsedStyle.stroke,\n          _parsedStyle$lineWidt = parsedStyle.lineWidth,\n          lineWidth = _parsedStyle$lineWidt === void 0 ? 1 : _parsedStyle$lineWidt,\n          _parsedStyle$increase = parsedStyle.increasedLineWidthForHitTesting,\n          increasedLineWidthForHitTesting = _parsedStyle$increase === void 0 ? 0 : _parsedStyle$increase,\n          _parsedStyle$shadowTy = parsedStyle.shadowType,\n          shadowType = _parsedStyle$shadowTy === void 0 ? 'outer' : _parsedStyle$shadowTy,\n          shadowColor = parsedStyle.shadowColor,\n          _parsedStyle$filter = parsedStyle.filter,\n          filter = _parsedStyle$filter === void 0 ? [] : _parsedStyle$filter,\n          transformOrigin = parsedStyle.transformOrigin;\n        var center = [cx, cy, cz];\n        // update geometry's AABB\n        geometry.contentBounds.update(center, halfExtents);\n        // @see https://github.molgen.mpg.de/git-mirror/cairo/blob/master/src/cairo-stroke-style.c#L97..L128\n        var expansion = nodeName === Shape.POLYLINE || nodeName === Shape.POLYGON || nodeName === Shape.PATH ? Math.SQRT2 : 0.5;\n        // append border only if stroke existed\n        var hasStroke = stroke && !stroke.isNone;\n        if (hasStroke) {\n          var halfLineWidth = ((lineWidth || 0) + (increasedLineWidthForHitTesting || 0)) * expansion;\n          halfExtents[0] += halfLineWidth;\n          halfExtents[1] += halfLineWidth;\n        }\n        geometry.renderBounds.update(center, halfExtents);\n        // account for shadow, only support constant value now\n        if (shadowColor && shadowType && shadowType !== 'inner') {\n          var _geometry$renderBound = geometry.renderBounds,\n            min = _geometry$renderBound.min,\n            max = _geometry$renderBound.max;\n          var shadowBlur = parsedStyle.shadowBlur,\n            shadowOffsetX = parsedStyle.shadowOffsetX,\n            shadowOffsetY = parsedStyle.shadowOffsetY;\n          var shadowBlurInPixels = shadowBlur || 0;\n          var shadowOffsetXInPixels = shadowOffsetX || 0;\n          var shadowOffsetYInPixels = shadowOffsetY || 0;\n          var shadowLeft = min[0] - shadowBlurInPixels + shadowOffsetXInPixels;\n          var shadowRight = max[0] + shadowBlurInPixels + shadowOffsetXInPixels;\n          var shadowTop = min[1] - shadowBlurInPixels + shadowOffsetYInPixels;\n          var shadowBottom = max[1] + shadowBlurInPixels + shadowOffsetYInPixels;\n          min[0] = Math.min(min[0], shadowLeft);\n          max[0] = Math.max(max[0], shadowRight);\n          min[1] = Math.min(min[1], shadowTop);\n          max[1] = Math.max(max[1], shadowBottom);\n          geometry.renderBounds.setMinMax(min, max);\n        }\n        // account for filter, eg. blur(5px), drop-shadow()\n        filter.forEach(function (_ref) {\n          var name = _ref.name,\n            params = _ref.params;\n          if (name === 'blur') {\n            var blurRadius = params[0].value;\n            geometry.renderBounds.update(geometry.renderBounds.center, vec3.add(geometry.renderBounds.halfExtents, geometry.renderBounds.halfExtents, [blurRadius, blurRadius, 0]));\n          } else if (name === 'drop-shadow') {\n            var _shadowOffsetX = params[0].value;\n            var _shadowOffsetY = params[1].value;\n            var _shadowBlur = params[2].value;\n            var _geometry$renderBound2 = geometry.renderBounds,\n              _min = _geometry$renderBound2.min,\n              _max = _geometry$renderBound2.max;\n            var _shadowLeft = _min[0] - _shadowBlur + _shadowOffsetX;\n            var _shadowRight = _max[0] + _shadowBlur + _shadowOffsetX;\n            var _shadowTop = _min[1] - _shadowBlur + _shadowOffsetY;\n            var _shadowBottom = _max[1] + _shadowBlur + _shadowOffsetY;\n            _min[0] = Math.min(_min[0], _shadowLeft);\n            _max[0] = Math.max(_max[0], _shadowRight);\n            _min[1] = Math.min(_min[1], _shadowTop);\n            _max[1] = Math.max(_max[1], _shadowBottom);\n            geometry.renderBounds.setMinMax(_min, _max);\n          }\n        });\n        object.geometry.dirty = false;\n\n        // @see https://github.com/antvis/g/issues/957\n        var flipY = hwidth < 0;\n        var flipX = hheight < 0;\n        // set transform origin\n        var usedOriginXValue = (flipY ? -1 : 1) * (transformOrigin ? convertPercentUnit(transformOrigin[0], 0, object, true) : 0);\n        var usedOriginYValue = (flipX ? -1 : 1) * (transformOrigin ? convertPercentUnit(transformOrigin[1], 1, object, true) : 0);\n        if (usedOriginXValue || usedOriginYValue) {\n          object.setOrigin(usedOriginXValue, usedOriginYValue);\n        }\n      }\n    }\n  }, {\n    key: \"updateSizeAttenuation\",\n    value: function updateSizeAttenuation(node, zoom) {\n      if (node.style.isSizeAttenuation) {\n        if (!node.style.rawLineWidth) {\n          node.style.rawLineWidth = node.style.lineWidth;\n        }\n        node.style.lineWidth = (node.style.rawLineWidth || 1) / zoom;\n        if (node.nodeName === Shape.CIRCLE) {\n          if (!node.style.rawR) {\n            node.style.rawR = node.style.r;\n          }\n          node.style.r = (node.style.rawR || 1) / zoom;\n        }\n      } else {\n        if (node.style.rawLineWidth) {\n          node.style.lineWidth = node.style.rawLineWidth;\n          delete node.style.rawLineWidth;\n        }\n        if (node.nodeName === Shape.CIRCLE) {\n          if (node.style.rawR) {\n            node.style.r = node.style.rawR;\n            delete node.style.rawR;\n          }\n        }\n      }\n    }\n  }]);\n}();\nvar CSSPropertyAngle = /*#__PURE__*/function () {\n  function CSSPropertyAngle() {\n    _classCallCheck(this, CSSPropertyAngle);\n    this.mixer = mergeNumbers;\n  }\n  return _createClass(CSSPropertyAngle, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed, object) {\n      return convertAngleUnit(parsed);\n    }\n  }]);\n}();\n\n/**\n * clipPath / textPath / offsetPath\n */\nvar CSSPropertyClipPath = /*#__PURE__*/function () {\n  function CSSPropertyClipPath() {\n    _classCallCheck(this, CSSPropertyClipPath);\n  }\n  return _createClass(CSSPropertyClipPath, [{\n    key: \"calculator\",\n    value: function calculator(name, oldPath, newPath, object, runtime) {\n      // unset\n      if (newPath instanceof CSSKeywordValue) {\n        newPath = null;\n      }\n      runtime.sceneGraphService.updateDisplayObjectDependency(name, oldPath, newPath, object);\n      if (name === 'clipPath') {\n        // should affect children\n        object.forEach(function (leaf) {\n          if (leaf.childNodes.length === 0) {\n            runtime.sceneGraphService.dirtifyToRoot(leaf);\n          }\n        });\n      }\n      return newPath;\n    }\n  }]);\n}();\nvar CSSPropertyColor = /*#__PURE__*/function () {\n  function CSSPropertyColor() {\n    _classCallCheck(this, CSSPropertyColor);\n    this.parser = parseColor;\n    this.mixer = mergeColors;\n  }\n  return _createClass(CSSPropertyColor, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed, object) {\n      if (parsed instanceof CSSKeywordValue) {\n        // 'unset' 'none'\n        return parsed.value === 'none' ? noneColor : transparentColor;\n      }\n      return parsed;\n    }\n  }]);\n}();\nvar CSSPropertyFilter = /*#__PURE__*/function () {\n  function CSSPropertyFilter() {\n    _classCallCheck(this, CSSPropertyFilter);\n  }\n  return _createClass(CSSPropertyFilter, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed) {\n      // unset or none\n      if (parsed instanceof CSSKeywordValue) {\n        return [];\n      }\n      return parsed;\n    }\n  }]);\n}();\nfunction getFontSize(object) {\n  var _ref = object.parsedStyle,\n    fontSize = _ref.fontSize;\n  return isNil(fontSize) ? null : fontSize;\n}\n\n/**\n * <length> & <percentage>\n */\nvar CSSPropertyLengthOrPercentage = /*#__PURE__*/function () {\n  function CSSPropertyLengthOrPercentage() {\n    _classCallCheck(this, CSSPropertyLengthOrPercentage);\n    this.mixer = mergeNumbers;\n  }\n  return _createClass(CSSPropertyLengthOrPercentage, [{\n    key: \"calculator\",\n    value:\n    /**\n     * according to parent's bounds\n     *\n     * @example\n     * CSS.percent(50) -> CSS.px(0.5 * parent.width)\n     */\n    function calculator(name, oldParsed, computed, object, runtime) {\n      if (isNumber(computed)) {\n        return computed;\n      }\n      if (CSSUnitValue.isRelativeUnit(computed.unit)) {\n        if (computed.unit === UnitType.kPercentage) {\n          // TODO: merge dimensions\n          return 0;\n        }\n        if (computed.unit === UnitType.kEms) {\n          if (object.parentNode) {\n            var fontSize = getFontSize(object.parentNode);\n            if (fontSize) {\n              fontSize *= computed.value;\n              return fontSize;\n            }\n          }\n          return 0;\n        }\n        if (computed.unit === UnitType.kRems) {\n          var _object$ownerDocument;\n          if (object !== null && object !== void 0 && (_object$ownerDocument = object.ownerDocument) !== null && _object$ownerDocument !== void 0 && _object$ownerDocument.documentElement) {\n            var _fontSize = getFontSize(object.ownerDocument.documentElement);\n            if (_fontSize) {\n              _fontSize *= computed.value;\n              return _fontSize;\n            }\n          }\n          return 0;\n        }\n      } else {\n        // remove listener if exists\n        // registry.unregisterParentGeometryBoundsChangedHandler(object, name);\n\n        // return absolute value\n        return computed.value;\n      }\n    }\n  }]);\n}();\n\n/**\n * format to Tuple2<CSSUnitValue>\n *\n * @example\n * rect.style.lineDash = 10;\n * rect.style.lineDash = [10, 10];\n * rect.style.lineDash = '10 10';\n */\nvar CSSPropertyLengthOrPercentage12 = /*#__PURE__*/function () {\n  function CSSPropertyLengthOrPercentage12() {\n    _classCallCheck(this, CSSPropertyLengthOrPercentage12);\n    this.mixer = mergeNumberLists;\n  }\n  return _createClass(CSSPropertyLengthOrPercentage12, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, computed) {\n      return computed.map(function (c) {\n        return c.value;\n      });\n    }\n  }]);\n}();\n\n/**\n * used in rounded rect\n *\n * @example\n * rect.style.radius = 10;\n * rect.style.radius = '10 10';\n * rect.style.radius = '10 10 10 10';\n */\nvar CSSPropertyLengthOrPercentage14 = /*#__PURE__*/function () {\n  function CSSPropertyLengthOrPercentage14() {\n    _classCallCheck(this, CSSPropertyLengthOrPercentage14);\n    this.mixer = mergeNumberLists;\n  }\n  return _createClass(CSSPropertyLengthOrPercentage14, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, computed) {\n      return computed.map(function (c) {\n        return c.value;\n      });\n    }\n  }]);\n}();\nvar CSSPropertyMarker = /*#__PURE__*/function () {\n  function CSSPropertyMarker() {\n    _classCallCheck(this, CSSPropertyMarker);\n  }\n  return _createClass(CSSPropertyMarker, [{\n    key: \"calculator\",\n    value: function calculator(name, oldMarker, newMarker, object) {\n      var _newMarker;\n      // unset\n      if (newMarker instanceof CSSKeywordValue) {\n        newMarker = null;\n      }\n      var cloned = (_newMarker = newMarker) === null || _newMarker === void 0 ? void 0 : _newMarker.cloneNode(true);\n      if (cloned) {\n        // FIXME: SVG should not inherit parent's style, add a flag here\n        cloned.style.isMarker = true;\n      }\n      return cloned;\n    }\n  }]);\n}();\nvar CSSPropertyNumber = /*#__PURE__*/function () {\n  function CSSPropertyNumber() {\n    _classCallCheck(this, CSSPropertyNumber);\n    this.mixer = mergeNumbers;\n  }\n  return _createClass(CSSPropertyNumber, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, computed) {\n      return computed.value;\n    }\n  }]);\n}();\nvar CSSPropertyOffsetDistance = /*#__PURE__*/function () {\n  function CSSPropertyOffsetDistance() {\n    _classCallCheck(this, CSSPropertyOffsetDistance);\n    this.mixer = clampedMergeNumbers(0, 1);\n  }\n  return _createClass(CSSPropertyOffsetDistance, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, computed) {\n      return computed.value;\n    }\n  }, {\n    key: \"postProcessor\",\n    value: function postProcessor(object) {\n      var _object$parsedStyle = object.parsedStyle,\n        offsetPath = _object$parsedStyle.offsetPath,\n        offsetDistance = _object$parsedStyle.offsetDistance;\n      if (!offsetPath) {\n        return;\n      }\n      var nodeName = offsetPath.nodeName;\n      if (nodeName === Shape.LINE || nodeName === Shape.PATH || nodeName === Shape.POLYLINE) {\n        // set position in world space\n        var point = offsetPath.getPoint(offsetDistance);\n        if (point) {\n          object.setLocalPosition(point.x, point.y);\n        }\n      }\n    }\n  }]);\n}();\n\n/**\n * opacity\n */\nvar CSSPropertyOpacity = /*#__PURE__*/function () {\n  function CSSPropertyOpacity() {\n    _classCallCheck(this, CSSPropertyOpacity);\n    this.mixer = clampedMergeNumbers(0, 1);\n  }\n  return _createClass(CSSPropertyOpacity, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, computed) {\n      return computed.value;\n    }\n  }]);\n}();\nvar CSSPropertyPath = /*#__PURE__*/function () {\n  function CSSPropertyPath() {\n    _classCallCheck(this, CSSPropertyPath);\n    /**\n     * path2Curve\n     */\n    this.parser = parsePath;\n    this.mixer = mergePaths;\n  }\n  return _createClass(CSSPropertyPath, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed) {\n      // unset\n      if (parsed instanceof CSSKeywordValue && parsed.value === 'unset') {\n        return {\n          absolutePath: [],\n          hasArc: false,\n          segments: [],\n          polygons: [],\n          polylines: [],\n          curve: null,\n          totalLength: 0,\n          rect: new Rectangle(0, 0, 0, 0)\n        };\n      }\n      return parsed;\n    }\n  }]);\n}();\nvar CSSPropertyPoints = /*#__PURE__*/_createClass(function CSSPropertyPoints() {\n  _classCallCheck(this, CSSPropertyPoints);\n  this.mixer = mergePoints;\n});\nvar CSSPropertyShadowBlur = /*#__PURE__*/function (_CSSPropertyLengthOrP) {\n  function CSSPropertyShadowBlur() {\n    var _this;\n    _classCallCheck(this, CSSPropertyShadowBlur);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, CSSPropertyShadowBlur, [].concat(args));\n    _this.mixer = clampedMergeNumbers(0, Infinity);\n    return _this;\n  }\n  _inherits(CSSPropertyShadowBlur, _CSSPropertyLengthOrP);\n  return _createClass(CSSPropertyShadowBlur);\n}(CSSPropertyLengthOrPercentage);\nvar CSSPropertyText = /*#__PURE__*/function () {\n  function CSSPropertyText() {\n    _classCallCheck(this, CSSPropertyText);\n  }\n  return _createClass(CSSPropertyText, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed, object) {\n      if (parsed instanceof CSSKeywordValue) {\n        if (parsed.value === 'unset') {\n          return '';\n        }\n        return parsed.value;\n      }\n\n      // allow number as valid text content\n      return \"\".concat(parsed);\n    }\n  }, {\n    key: \"postProcessor\",\n    value: function postProcessor(object) {\n      object.nodeValue = \"\".concat(object.parsedStyle.text) || '';\n    }\n  }]);\n}();\n\n/**\n * it must transform after text get parsed\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-transform\n */\nvar CSSPropertyTextTransform = /*#__PURE__*/function () {\n  function CSSPropertyTextTransform() {\n    _classCallCheck(this, CSSPropertyTextTransform);\n  }\n  return _createClass(CSSPropertyTextTransform, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed, object) {\n      var rawText = object.getAttribute('text');\n      if (rawText) {\n        var transformedText = rawText;\n        if (parsed.value === 'capitalize') {\n          transformedText = rawText.charAt(0).toUpperCase() + rawText.slice(1);\n        } else if (parsed.value === 'lowercase') {\n          transformedText = rawText.toLowerCase();\n        } else if (parsed.value === 'uppercase') {\n          transformedText = rawText.toUpperCase();\n        }\n        object.parsedStyle.text = transformedText;\n      }\n      return parsed.value;\n    }\n  }]);\n}();\nvar definedProps = function definedProps(obj) {\n  return Object.fromEntries(Object.entries(obj).filter(function (_ref) {\n    var _ref2 = _slicedToArray(_ref, 2),\n      v = _ref2[1];\n    return v !== undefined;\n  }));\n};\nvar CANVAS_Map = new WeakMap();\n\n/**\n * destroy existed canvas with the same id\n */\nfunction cleanExistedCanvas(container, canvas, cleanUp) {\n  if (container) {\n    var $dom = typeof container === 'string' ? document.getElementById(container) : container;\n    if (CANVAS_Map.has($dom)) CANVAS_Map.get($dom).destroy(cleanUp);\n    CANVAS_Map.set($dom, canvas);\n  }\n}\nvar isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\nfunction isElement(target) {\n  return !!target.getAttribute;\n}\nfunction sortedIndex(array, value) {\n  var low = 0;\n  var high = array.length;\n  while (low < high) {\n    var mid = low + high >>> 1;\n    if (sortByZIndex(array[mid], value) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\nfunction sortByZIndex(o1, o2) {\n  var zIndex1 = Number(o1.parsedStyle.zIndex || 0);\n  var zIndex2 = Number(o2.parsedStyle.zIndex || 0);\n  if (zIndex1 === zIndex2) {\n    var parent = o1.parentNode;\n    if (parent) {\n      var children = parent.childNodes || [];\n      return children.indexOf(o1) - children.indexOf(o2);\n    }\n  }\n  return zIndex1 - zIndex2;\n}\nfunction findClosestClipPathTarget(object) {\n  var el = object;\n  do {\n    var _el$parsedStyle;\n    var clipPath = (_el$parsedStyle = el.parsedStyle) === null || _el$parsedStyle === void 0 ? void 0 : _el$parsedStyle.clipPath;\n    if (clipPath) return el;\n    el = el.parentElement;\n  } while (el !== null);\n  return null;\n}\nvar PX_SUFFIX = 'px';\nfunction setDOMSize($el, width, height) {\n  if (isBrowser && $el.style) {\n    $el.style.width = width + PX_SUFFIX;\n    $el.style.height = height + PX_SUFFIX;\n  }\n}\nfunction getStyle($el, property) {\n  if (isBrowser) {\n    return document.defaultView.getComputedStyle($el, null).getPropertyValue(property);\n  }\n}\nfunction getWidth($el) {\n  var width = getStyle($el, 'width');\n  if (width === 'auto') {\n    return $el.offsetWidth;\n  }\n  return parseFloat(width);\n}\nfunction getHeight($el) {\n  var height = getStyle($el, 'height');\n  if (height === 'auto') {\n    return $el.offsetHeight;\n  }\n  return parseFloat(height);\n}\n\n// borrow from hammer.js\nvar MOUSE_POINTER_ID = 1;\nvar TOUCH_TO_POINTER = {\n  touchstart: 'pointerdown',\n  touchend: 'pointerup',\n  touchendoutside: 'pointerupoutside',\n  touchmove: 'pointermove',\n  touchcancel: 'pointercancel'\n};\nvar clock = typeof performance === 'object' && performance.now ? performance : Date;\nfunction isInFragment(node) {\n  if (node.nodeName === Shape.FRAGMENT) return true;\n  return node.getRootNode().nodeName === Shape.FRAGMENT;\n}\nfunction isFillOrStrokeAffected() {\n  var pointerEvents = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'auto';\n  var fill = arguments.length > 1 ? arguments[1] : undefined;\n  var stroke = arguments.length > 2 ? arguments[2] : undefined;\n  // account for pointerEvents\n  // @see https://developer.mozilla.org/en-US/docs/Web/CSS/pointer-events\n\n  var hasFill = false;\n  var hasStroke = false;\n  var isFillOtherThanNone = !!fill && !fill.isNone;\n  var isStrokeOtherThanNone = !!stroke && !stroke.isNone;\n  if (pointerEvents === 'visiblepainted' || pointerEvents === 'painted' || pointerEvents === 'auto') {\n    hasFill = isFillOtherThanNone;\n    hasStroke = isStrokeOtherThanNone;\n  } else if (pointerEvents === 'visiblefill' || pointerEvents === 'fill') {\n    hasFill = true;\n  } else if (pointerEvents === 'visiblestroke' || pointerEvents === 'stroke') {\n    hasStroke = true;\n  } else if (pointerEvents === 'visible' || pointerEvents === 'all') {\n    // The values of the fill and stroke do not affect event processing.\n    hasFill = true;\n    hasStroke = true;\n  }\n  return [hasFill, hasStroke];\n}\n\n/**\n * Thanks for following contributor of codes\n * https://gist.github.com/1866474\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n * https://github.com/Financial-Times/polyfill-library/blob/master/polyfills/requestAnimationFrame/polyfill.js\n * */\n\nvar uId = 1;\nvar uniqueId = function uniqueId() {\n  return uId++;\n};\n\n// We use `self` instead of `window` for `WebWorker` support.\nvar root =\n// eslint-disable-next-line no-nested-ternary\ntypeof self === 'object' && self.self === self ? self :\n// @ts-ignore\ntypeof global === 'object' && global.global === global ?\n// @ts-ignore\nglobal : {};\nvar nowOffset = Date.now();\n\n// use performance api if exist, otherwise use Date.now.\n// Date.now polyfill required.\nvar pnow = function pnow() {\n  if (root.performance && typeof root.performance.now === 'function') {\n    return root.performance.now();\n  }\n\n  // fallback\n  return Date.now() - nowOffset;\n};\nvar reservedCBs = {};\nvar lastTime = Date.now();\nvar polyfillRaf = function polyfillRaf(callback) {\n  if (typeof callback !== 'function') {\n    throw new TypeError(\"\".concat(callback, \" is not a function\"));\n  }\n  var currentTime = Date.now();\n  var gap = currentTime - lastTime;\n  var delay = gap > 16 ? 0 : 16 - gap;\n  var id = uniqueId();\n  reservedCBs[id] = callback;\n\n  // keys(reservedCBs).length > 1 의미는 이미 setTimeout 이 걸려있는 경우.\n  // 함께 callback 이 실행될 수 있게 reservedCBs 에만 추가해주고 return\n  if (Object.keys(reservedCBs).length > 1) return id;\n  setTimeout(function () {\n    lastTime = currentTime;\n    var copied = reservedCBs;\n    reservedCBs = {};\n    Object.keys(copied).forEach(function (key) {\n      return copied[key](pnow());\n    });\n  }, delay);\n  return id;\n};\nvar polyfillCaf = function polyfillCaf(id) {\n  delete reservedCBs[id];\n};\nvar vendorPrefixes = ['', 'webkit', 'moz', 'ms', 'o'];\nvar getRequestAnimationFrame = function getRequestAnimationFrame(vp) {\n  if (typeof vp !== 'string') return polyfillRaf;\n  if (vp === '') return root.requestAnimationFrame;\n  return root[\"\".concat(vp, \"RequestAnimationFrame\")];\n};\nvar getCancelAnimationFrame = function getCancelAnimationFrame(vp) {\n  if (typeof vp !== 'string') return polyfillCaf;\n  if (vp === '') return root.cancelAnimationFrame;\n  return root[\"\".concat(vp, \"CancelAnimationFrame\")] || root[\"\".concat(vp, \"CancelRequestAnimationFrame\")];\n};\nvar find = function find(arr, predicate) {\n  var i = 0;\n  while (arr[i] !== undefined) {\n    if (predicate(arr[i])) return arr[i];\n    i += 1;\n  }\n};\nvar vp = find(vendorPrefixes, function (vp) {\n  return !!getRequestAnimationFrame(vp);\n});\nvar raf = getRequestAnimationFrame(vp);\nvar caf = getCancelAnimationFrame(vp);\nroot.requestAnimationFrame = raf;\nroot.cancelAnimationFrame = caf;\nvar AsyncParallelHook = /*#__PURE__*/function () {\n  function AsyncParallelHook() {\n    _classCallCheck(this, AsyncParallelHook);\n    this.callbacks = [];\n  }\n  return _createClass(AsyncParallelHook, [{\n    key: \"getCallbacksNum\",\n    value: function getCallbacksNum() {\n      return this.callbacks.length;\n    }\n  }, {\n    key: \"tapPromise\",\n    value: function tapPromise(options, fn) {\n      this.callbacks.push(fn);\n    }\n  }, {\n    key: \"promise\",\n    value: function promise() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      return Promise.all(this.callbacks.map(function (callback) {\n        return callback.apply(void 0, args);\n      }));\n    }\n  }]);\n}();\nvar AsyncSeriesWaterfallHook = /*#__PURE__*/function () {\n  function AsyncSeriesWaterfallHook() {\n    _classCallCheck(this, AsyncSeriesWaterfallHook);\n    this.callbacks = [];\n  }\n  return _createClass(AsyncSeriesWaterfallHook, [{\n    key: \"tapPromise\",\n    value: function tapPromise(options, fn) {\n      this.callbacks.push(fn);\n    }\n  }, {\n    key: \"promise\",\n    value: function () {\n      var _promise = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _this$callbacks,\n          result,\n          i,\n          callback,\n          _args = arguments;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              if (!this.callbacks.length) {\n                _context.next = 14;\n                break;\n              }\n              _context.next = 3;\n              return (_this$callbacks = this.callbacks)[0].apply(_this$callbacks, _args);\n            case 3:\n              result = _context.sent;\n              i = 0;\n            case 5:\n              if (!(i < this.callbacks.length - 1)) {\n                _context.next = 13;\n                break;\n              }\n              callback = this.callbacks[i]; // @ts-ignore\n              // eslint-disable-next-line no-await-in-loop\n              _context.next = 9;\n              return callback(result);\n            case 9:\n              result = _context.sent;\n            case 10:\n              i++;\n              _context.next = 5;\n              break;\n            case 13:\n              return _context.abrupt(\"return\", result);\n            case 14:\n              return _context.abrupt(\"return\", null);\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function promise() {\n        return _promise.apply(this, arguments);\n      }\n      return promise;\n    }()\n  }]);\n}();\nvar SyncHook = /*#__PURE__*/function () {\n  function SyncHook() {\n    _classCallCheck(this, SyncHook);\n    this.callbacks = [];\n  }\n  return _createClass(SyncHook, [{\n    key: \"tap\",\n    value: function tap(options, fn) {\n      this.callbacks.push(fn);\n    }\n  }, {\n    key: \"call\",\n    value: function call() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      /* eslint-disable-next-line prefer-rest-params */\n      var argsArr = arguments;\n      this.callbacks.forEach(function (callback) {\n        /* eslint-disable-next-line prefer-spread */\n        callback.apply(undefined, argsArr);\n      });\n    }\n  }]);\n}();\nvar SyncWaterfallHook = /*#__PURE__*/function () {\n  function SyncWaterfallHook() {\n    _classCallCheck(this, SyncWaterfallHook);\n    this.callbacks = [];\n  }\n  return _createClass(SyncWaterfallHook, [{\n    key: \"tap\",\n    value: function tap(options, fn) {\n      this.callbacks.push(fn);\n    }\n  }, {\n    key: \"call\",\n    value: function call() {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      if (this.callbacks.length) {\n        /* eslint-disable-next-line prefer-rest-params */\n        var argsArr = arguments;\n        /* eslint-disable-next-line prefer-spread */\n        var result = this.callbacks[0].apply(undefined, argsArr);\n        for (var i = 0; i < this.callbacks.length - 1; i++) {\n          var callback = this.callbacks[i];\n          // @ts-ignore\n          result = callback(result);\n        }\n        return result;\n      }\n      return null;\n    }\n  }]);\n}();\nvar genericFontFamilies = ['serif', 'sans-serif', 'monospace', 'cursive', 'fantasy', 'system-ui'];\nvar stringRegExp = /([\\\"\\'])[^\\'\\\"]+\\1/;\nfunction toFontString(attributes) {\n  var _attributes$fontSize = attributes.fontSize,\n    fontSize = _attributes$fontSize === void 0 ? 16 : _attributes$fontSize,\n    _attributes$fontFamil = attributes.fontFamily,\n    fontFamily = _attributes$fontFamil === void 0 ? 'sans-serif' : _attributes$fontFamil,\n    _attributes$fontStyle = attributes.fontStyle,\n    fontStyle = _attributes$fontStyle === void 0 ? 'normal' : _attributes$fontStyle,\n    _attributes$fontVaria = attributes.fontVariant,\n    fontVariant = _attributes$fontVaria === void 0 ? 'normal' : _attributes$fontVaria,\n    _attributes$fontWeigh = attributes.fontWeight,\n    fontWeight = _attributes$fontWeigh === void 0 ? 'normal' : _attributes$fontWeigh;\n\n  // build canvas api font setting from individual components. Convert a numeric this.fontSize to px\n  // const fontSizeString: string = isNumber(fontSize) ? `${fontSize}px` : fontSize.toString();\n  var fontSizeString = isNumber(fontSize) && \"\".concat(fontSize, \"px\") || '16px';\n  // Clean-up fontFamily property by quoting each font name\n  // this will support font names with spaces\n\n  var fontFamilies = fontFamily.split(',');\n  for (var i = fontFamilies.length - 1; i >= 0; i--) {\n    // Trim any extra white-space\n    var _fontFamily = fontFamilies[i].trim();\n    // Check if font already contains strings\n    if (!stringRegExp.test(_fontFamily) && genericFontFamilies.indexOf(_fontFamily) < 0) {\n      _fontFamily = \"\\\"\".concat(_fontFamily, \"\\\"\");\n    }\n    fontFamilies[i] = _fontFamily;\n  }\n  return \"\".concat(fontStyle, \" \").concat(fontVariant, \" \").concat(fontWeight, \" \").concat(fontSizeString, \" \").concat(fontFamilies.join(','));\n}\nfunction createSkewMatrix(skewMatrix, skewX, skewY) {\n  // Create an identity matrix\n  mat4.identity(skewMatrix);\n  // Apply skew to the matrix\n  skewMatrix[4] = Math.tan(skewX); // Skew Y axis in X direction\n  skewMatrix[1] = Math.tan(skewY); // Skew X axis in Y direction\n\n  return skewMatrix;\n}\nvar $mat4_1 = mat4.create();\nvar $mat4_2 = mat4.create();\nvar parser = {\n  scale: function scale(d) {\n    mat4.fromScaling($mat4_1, [d[0].value, d[1].value, 1]);\n  },\n  scaleX: function scaleX(d) {\n    mat4.fromScaling($mat4_1, [d[0].value, 1, 1]);\n  },\n  scaleY: function scaleY(d) {\n    mat4.fromScaling($mat4_1, [1, d[0].value, 1]);\n  },\n  scaleZ: function scaleZ(d) {\n    mat4.fromScaling($mat4_1, [1, 1, d[0].value]);\n  },\n  scale3d: function scale3d(d) {\n    mat4.fromScaling($mat4_1, [d[0].value, d[1].value, d[2].value]);\n  },\n  translate: function translate(d) {\n    mat4.fromTranslation($mat4_1, [d[0].value, d[1].value, 0]);\n  },\n  translateX: function translateX(d) {\n    mat4.fromTranslation($mat4_1, [d[0].value, 0, 0]);\n  },\n  translateY: function translateY(d) {\n    mat4.fromTranslation($mat4_1, [0, d[0].value, 0]);\n  },\n  translateZ: function translateZ(d) {\n    mat4.fromTranslation($mat4_1, [0, 0, d[0].value]);\n  },\n  translate3d: function translate3d(d) {\n    mat4.fromTranslation($mat4_1, [d[0].value, d[1].value, d[2].value]);\n  },\n  rotate: function rotate(d) {\n    mat4.fromZRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotateX: function rotateX(d) {\n    mat4.fromXRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotateY: function rotateY(d) {\n    mat4.fromYRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotateZ: function rotateZ(d) {\n    mat4.fromZRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotate3d: function rotate3d(d) {\n    mat4.fromRotation($mat4_1, deg2rad(convertAngleUnit(d[3])), [d[0].value, d[1].value, d[2].value]);\n  },\n  skew: function skew(d) {\n    createSkewMatrix($mat4_1, deg2rad(d[0].value), deg2rad(d[1].value));\n  },\n  skewX: function skewX(d) {\n    createSkewMatrix($mat4_1, deg2rad(d[0].value), 0);\n  },\n  skewY: function skewY(d) {\n    createSkewMatrix($mat4_1, 0, deg2rad(d[0].value));\n  },\n  matrix: function matrix(d) {\n    // prettier-ignore\n    mat4.set($mat4_1, d[0].value, d[1].value, 0, 0, d[2].value, d[3].value, 0, 0, 0, 0, 1, 0, d[4].value, d[5].value, 0, 1);\n  },\n  matrix3d: function matrix3d(d) {\n    // @ts-ignore\n    mat4.set.apply(mat4, [$mat4_1].concat(_toConsumableArray(d.map(function (s) {\n      return s.value;\n    }))));\n  }\n};\nvar $vec3One$1 = vec3.fromValues(1, 1, 1);\nvar $vec3Zero$1 = vec3.create();\nvar optimizer = {\n  translate: function translate(object, d) {\n    runtime.sceneGraphService.setLocalScale(object, $vec3One$1, false);\n    runtime.sceneGraphService.setLocalEulerAngles(object, $vec3Zero$1, undefined, undefined, false);\n    runtime.sceneGraphService.setLocalPosition(object, [d[0].value, d[1].value, 0], false);\n    runtime.sceneGraphService.dirtifyLocal(object, object.transformable);\n  }\n};\nfunction parsedTransformToMat4(transform, object) {\n  if (transform.length) {\n    if (transform.length === 1 && optimizer[transform[0].t]) {\n      optimizer[transform[0].t](object, transform[0].d);\n      return;\n    }\n    var m = mat4.identity($mat4_2);\n    for (var i = 0; i < transform.length; i++) {\n      var _transform$i = transform[i],\n        t = _transform$i.t,\n        d = _transform$i.d;\n      var p = parser[t];\n      if (p) {\n        p(d);\n        mat4.mul(m, m, $mat4_1);\n      }\n    }\n    object.setLocalTransform(m);\n  } else {\n    object.resetLocalTransform();\n  }\n  return object.getLocalTransform();\n}\n\n/**\n * @see /zh/docs/api/animation#支持变换的属性\n *\n * support the following formats like CSS Transform:\n *\n * scale\n * * scale(x, y)\n * * scaleX(x)\n * * scaleY(x)\n * * scaleZ(z)\n * * scale3d(x, y, z)\n *\n * translate (unit: none, px, %(relative to its bounds))\n * * translate(x, y) eg. translate(0, 0) translate(0, 30px) translate(100%, 100%)\n * * translateX(0)\n * * translateY(0)\n * * translateZ(0)\n * * translate3d(0, 0, 0)\n *\n * rotate (unit: deg rad turn)\n * * rotate(0.5turn) rotate(30deg) rotate(1rad)\n *\n * none\n *\n * unsupported for now:\n * * calc() eg. translate(calc(100% + 10px))\n * * matrix/matrix3d()\n * * skew/skewX/skewY\n * * perspective\n */\nvar CSSPropertyTransform = /*#__PURE__*/function () {\n  function CSSPropertyTransform() {\n    _classCallCheck(this, CSSPropertyTransform);\n    this.parser = parseTransformUnmemoize;\n    this.mixer = mergeTransforms;\n  }\n  return _createClass(CSSPropertyTransform, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, parsed, object) {\n      // 'none'\n      if (parsed instanceof CSSKeywordValue) {\n        return [];\n      }\n      return parsed;\n    }\n  }, {\n    key: \"postProcessor\",\n    value: function postProcessor(object) {\n      parsedTransformToMat4(object.parsedStyle.transform, object);\n    }\n  }]);\n}();\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-origin\n * @example\n * [10px, 10px] [10%, 10%]\n */\nvar CSSPropertyTransformOrigin = /*#__PURE__*/function () {\n  function CSSPropertyTransformOrigin() {\n    _classCallCheck(this, CSSPropertyTransformOrigin);\n  }\n  return _createClass(CSSPropertyTransformOrigin, [{\n    key: \"postProcessor\",\n    value: function postProcessor(object) {\n      var _ref = object.parsedStyle,\n        transformOrigin = _ref.transformOrigin;\n      if (transformOrigin[0].unit === UnitType.kPixels && transformOrigin[1].unit === UnitType.kPixels) {\n        object.setOrigin(transformOrigin[0].value, transformOrigin[1].value);\n      } else {\n        // Relative to geometry bounds, calculate later.\n        object.getGeometryBounds();\n      }\n    }\n  }]);\n}();\nvar CSSPropertyZIndex = /*#__PURE__*/function () {\n  function CSSPropertyZIndex() {\n    _classCallCheck(this, CSSPropertyZIndex);\n  }\n  return _createClass(CSSPropertyZIndex, [{\n    key: \"calculator\",\n    value: function calculator(name, oldParsed, computed, object) {\n      return computed.value;\n    }\n  }, {\n    key: \"postProcessor\",\n    value: function postProcessor(object) {\n      if (object.parentNode) {\n        var parentEntity = object.parentNode;\n        var parentRenderable = parentEntity.renderable;\n        var parentSortable = parentEntity.sortable;\n        if (parentRenderable) {\n          parentRenderable.dirty = true;\n        }\n        // need re-sort on parent\n        if (parentSortable) {\n          parentSortable.dirty = true;\n          parentSortable.dirtyReason = SortReason.Z_INDEX_CHANGED;\n        }\n      }\n    }\n  }]);\n}();\nvar CircleUpdater = /*#__PURE__*/function () {\n  function CircleUpdater() {\n    _classCallCheck(this, CircleUpdater);\n  }\n  return _createClass(CircleUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle, object) {\n      var _parsedStyle$cx = parsedStyle.cx,\n        cx = _parsedStyle$cx === void 0 ? 0 : _parsedStyle$cx,\n        _parsedStyle$cy = parsedStyle.cy,\n        cy = _parsedStyle$cy === void 0 ? 0 : _parsedStyle$cy,\n        _parsedStyle$r = parsedStyle.r,\n        r = _parsedStyle$r === void 0 ? 0 : _parsedStyle$r;\n      return {\n        cx: cx,\n        cy: cy,\n        hwidth: r,\n        hheight: r\n      };\n    }\n  }]);\n}();\nvar EllipseUpdater = /*#__PURE__*/function () {\n  function EllipseUpdater() {\n    _classCallCheck(this, EllipseUpdater);\n  }\n  return _createClass(EllipseUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle, object) {\n      var _parsedStyle$cx = parsedStyle.cx,\n        cx = _parsedStyle$cx === void 0 ? 0 : _parsedStyle$cx,\n        _parsedStyle$cy = parsedStyle.cy,\n        cy = _parsedStyle$cy === void 0 ? 0 : _parsedStyle$cy,\n        _parsedStyle$rx = parsedStyle.rx,\n        rx = _parsedStyle$rx === void 0 ? 0 : _parsedStyle$rx,\n        _parsedStyle$ry = parsedStyle.ry,\n        ry = _parsedStyle$ry === void 0 ? 0 : _parsedStyle$ry;\n      return {\n        cx: cx,\n        cy: cy,\n        hwidth: rx,\n        hheight: ry\n      };\n    }\n  }]);\n}();\nvar LineUpdater = /*#__PURE__*/function () {\n  function LineUpdater() {\n    _classCallCheck(this, LineUpdater);\n  }\n  return _createClass(LineUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle) {\n      var x1 = parsedStyle.x1,\n        y1 = parsedStyle.y1,\n        x2 = parsedStyle.x2,\n        y2 = parsedStyle.y2;\n      var minX = Math.min(x1, x2);\n      var maxX = Math.max(x1, x2);\n      var minY = Math.min(y1, y2);\n      var maxY = Math.max(y1, y2);\n      var width = maxX - minX;\n      var height = maxY - minY;\n      var hwidth = width / 2;\n      var hheight = height / 2;\n      return {\n        cx: minX + hwidth,\n        cy: minY + hheight,\n        hwidth: hwidth,\n        hheight: hheight\n      };\n    }\n  }]);\n}();\nvar PathUpdater = /*#__PURE__*/function () {\n  function PathUpdater() {\n    _classCallCheck(this, PathUpdater);\n  }\n  return _createClass(PathUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle) {\n      var d = parsedStyle.d;\n      var _d$rect = d.rect,\n        x = _d$rect.x,\n        y = _d$rect.y,\n        width = _d$rect.width,\n        height = _d$rect.height;\n      var hwidth = width / 2;\n      var hheight = height / 2;\n      return {\n        cx: x + hwidth,\n        cy: y + hheight,\n        hwidth: hwidth,\n        hheight: hheight\n      };\n    }\n  }]);\n}();\nvar PolylineUpdater = /*#__PURE__*/function () {\n  function PolylineUpdater() {\n    _classCallCheck(this, PolylineUpdater);\n  }\n  return _createClass(PolylineUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle) {\n      if (parsedStyle.points && isArray(parsedStyle.points.points)) {\n        var points = parsedStyle.points.points;\n\n        // FIXME: account for miter lineJoin\n        var minX = Math.min.apply(Math, _toConsumableArray(points.map(function (point) {\n          return point[0];\n        })));\n        var maxX = Math.max.apply(Math, _toConsumableArray(points.map(function (point) {\n          return point[0];\n        })));\n        var minY = Math.min.apply(Math, _toConsumableArray(points.map(function (point) {\n          return point[1];\n        })));\n        var maxY = Math.max.apply(Math, _toConsumableArray(points.map(function (point) {\n          return point[1];\n        })));\n        var width = maxX - minX;\n        var height = maxY - minY;\n        var hwidth = width / 2;\n        var hheight = height / 2;\n        return {\n          cx: minX + hwidth,\n          cy: minY + hheight,\n          hwidth: hwidth,\n          hheight: hheight\n        };\n      }\n      return {\n        cx: 0,\n        cy: 0,\n        hwidth: 0,\n        hheight: 0\n      };\n    }\n  }]);\n}();\nvar RectUpdater = /*#__PURE__*/function () {\n  function RectUpdater() {\n    _classCallCheck(this, RectUpdater);\n  }\n  return _createClass(RectUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle, object) {\n      var _parsedStyle$x = parsedStyle.x,\n        x = _parsedStyle$x === void 0 ? 0 : _parsedStyle$x,\n        _parsedStyle$y = parsedStyle.y,\n        y = _parsedStyle$y === void 0 ? 0 : _parsedStyle$y,\n        src = parsedStyle.src,\n        _parsedStyle$width = parsedStyle.width,\n        width = _parsedStyle$width === void 0 ? 0 : _parsedStyle$width,\n        _parsedStyle$height = parsedStyle.height,\n        height = _parsedStyle$height === void 0 ? 0 : _parsedStyle$height;\n      var contentWidth = width;\n      var contentHeight = height;\n\n      // resize with HTMLImageElement's size\n      if (src && !isString(src)) {\n        if (!contentWidth) {\n          contentWidth = src.width;\n          parsedStyle.width = contentWidth;\n        }\n        if (!contentHeight) {\n          contentHeight = src.height;\n          parsedStyle.height = contentHeight;\n        }\n      }\n      return {\n        cx: x + contentWidth / 2,\n        cy: y + contentHeight / 2,\n        hwidth: contentWidth / 2,\n        hheight: contentHeight / 2\n      };\n    }\n  }]);\n}();\nvar TextUpdater = /*#__PURE__*/function () {\n  function TextUpdater(globalRuntime) {\n    _classCallCheck(this, TextUpdater);\n    this.globalRuntime = globalRuntime;\n  }\n  return _createClass(TextUpdater, [{\n    key: \"isReadyToMeasure\",\n    value: function isReadyToMeasure(parsedStyle, object) {\n      var text = parsedStyle.text;\n      return text;\n    }\n  }, {\n    key: \"update\",\n    value: function update(parsedStyle, object) {\n      var _object$ownerDocument;\n      var text = parsedStyle.text,\n        _parsedStyle$textAlig = parsedStyle.textAlign,\n        textAlign = _parsedStyle$textAlig === void 0 ? 'start' : _parsedStyle$textAlig,\n        _parsedStyle$lineWidt = parsedStyle.lineWidth,\n        lineWidth = _parsedStyle$lineWidt === void 0 ? 1 : _parsedStyle$lineWidt,\n        _parsedStyle$textBase = parsedStyle.textBaseline,\n        textBaseline = _parsedStyle$textBase === void 0 ? 'alphabetic' : _parsedStyle$textBase,\n        _parsedStyle$dx = parsedStyle.dx,\n        dx = _parsedStyle$dx === void 0 ? 0 : _parsedStyle$dx,\n        _parsedStyle$dy = parsedStyle.dy,\n        dy = _parsedStyle$dy === void 0 ? 0 : _parsedStyle$dy,\n        _parsedStyle$x = parsedStyle.x,\n        x = _parsedStyle$x === void 0 ? 0 : _parsedStyle$x,\n        _parsedStyle$y = parsedStyle.y,\n        y = _parsedStyle$y === void 0 ? 0 : _parsedStyle$y;\n      if (!this.isReadyToMeasure(parsedStyle, object)) {\n        parsedStyle.metrics = {\n          font: '',\n          width: 0,\n          height: 0,\n          lines: [],\n          lineWidths: [],\n          lineHeight: 0,\n          maxLineWidth: 0,\n          fontProperties: {\n            ascent: 0,\n            descent: 0,\n            fontSize: 0\n          },\n          lineMetrics: []\n        };\n        return {\n          hwidth: 0,\n          hheight: 0,\n          cx: 0,\n          cy: 0\n        };\n      }\n      var _ref = (object === null || object === void 0 || (_object$ownerDocument = object.ownerDocument) === null || _object$ownerDocument === void 0 || (_object$ownerDocument = _object$ownerDocument.defaultView) === null || _object$ownerDocument === void 0 ? void 0 : _object$ownerDocument.getConfig()) || {},\n        offscreenCanvas = _ref.offscreenCanvas;\n      var metrics = this.globalRuntime.textService.measureText(text, parsedStyle, offscreenCanvas);\n      parsedStyle.metrics = metrics;\n      var width = metrics.width,\n        height = metrics.height;\n      var hwidth = width / 2;\n      var hheight = height / 2;\n\n      // default 'left'\n      var lineXOffset = x + hwidth;\n      if (textAlign === 'center' || textAlign === 'middle') {\n        lineXOffset += lineWidth / 2 - hwidth;\n      } else if (textAlign === 'right' || textAlign === 'end') {\n        lineXOffset += lineWidth - hwidth * 2;\n      }\n      var lineYOffset = y - hheight;\n      if (textBaseline === 'middle') {\n        lineYOffset += hheight;\n      } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n        lineYOffset += hheight * 2;\n      } else if (textBaseline === 'alphabetic') ;else if (textBaseline === 'bottom' || textBaseline === 'ideographic') {\n        lineYOffset += 0;\n      }\n      // TODO: ideographic & bottom\n\n      if (dx) {\n        lineXOffset += dx;\n      }\n      if (dy) {\n        lineYOffset += dy;\n      }\n      return {\n        cx: lineXOffset,\n        cy: lineYOffset,\n        hwidth: hwidth,\n        hheight: hheight\n      };\n    }\n  }]);\n}();\nvar GroupUpdater = /*#__PURE__*/function () {\n  function GroupUpdater() {\n    _classCallCheck(this, GroupUpdater);\n  }\n  return _createClass(GroupUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle, object) {\n      return {\n        cx: 0,\n        cy: 0,\n        hwidth: 0,\n        hheight: 0\n      };\n    }\n  }]);\n}();\nvar HTMLUpdater = /*#__PURE__*/function () {\n  function HTMLUpdater() {\n    _classCallCheck(this, HTMLUpdater);\n  }\n  return _createClass(HTMLUpdater, [{\n    key: \"update\",\n    value: function update(parsedStyle, object) {\n      var _parsedStyle$x = parsedStyle.x,\n        x = _parsedStyle$x === void 0 ? 0 : _parsedStyle$x,\n        _parsedStyle$y = parsedStyle.y,\n        y = _parsedStyle$y === void 0 ? 0 : _parsedStyle$y,\n        _parsedStyle$width = parsedStyle.width,\n        width = _parsedStyle$width === void 0 ? 0 : _parsedStyle$width,\n        _parsedStyle$height = parsedStyle.height,\n        height = _parsedStyle$height === void 0 ? 0 : _parsedStyle$height;\n      return {\n        cx: x + width / 2,\n        cy: y + height / 2,\n        hwidth: width / 2,\n        hheight: height / 2\n      };\n    }\n  }]);\n}();\nfunction isFederatedEvent(value) {\n  return !!value.type;\n}\n\n/**\n * An DOM-compatible synthetic event implementation that is \"forwarded\" on behalf of an original\n * FederatedEvent or native Event.\n */\nvar FederatedEvent = /*#__PURE__*/function () {\n  /**\n   * The event boundary which manages this event. Propagation can only occur\n   *  within the boundary's jurisdiction.\n   */\n  function FederatedEvent(manager) {\n    _classCallCheck(this, FederatedEvent);\n    /**\n     * The propagation phase.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Event/eventPhase\n     */\n    this.eventPhase = FederatedEvent.prototype.NONE;\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/bubbles\n     */\n    this.bubbles = true;\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/cancelBubble\n     */\n    this.cancelBubble = true;\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Event/cancelable\n     */\n    this.cancelable = false;\n    /** Flags whether the default response of the user agent was prevent through this event. */\n    this.defaultPrevented = false;\n    /** Flags whether propagation was stopped. */\n    this.propagationStopped = false;\n    /** Flags whether propagation was immediately stopped. */\n    this.propagationImmediatelyStopped = false;\n    /**\n     * The coordinates of the evnet relative to the nearest DOM layer.\n     * This is a non-standard property.\n     */\n    this.layer = new Point();\n    /**\n     * The coordinates of the event relative to the DOM document.\n     * This is a non-standard property.\n     * relative to the DOM document.\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent/pageX\n     */\n    this.page = new Point();\n    /**\n     * relative to Canvas, origin is left-top\n     */\n    this.canvas = new Point();\n    /**\n     * relative to Viewport, account for Camera\n     */\n    this.viewport = new Point();\n    this.composed = false;\n    this.NONE = 0;\n    this.CAPTURING_PHASE = 1;\n    this.AT_TARGET = 2;\n    this.BUBBLING_PHASE = 3;\n    this.manager = manager;\n  }\n  return _createClass(FederatedEvent, [{\n    key: \"name\",\n    get:\n    /**\n     * The type of event, supports the following:\n     * * pointerdown\n     * * touchstart\n     * * mousedown\n     * * rightdown\n     * * ...\n     */\n\n    /**\n     * @deprecated\n     */\n    function get() {\n      return this.type;\n    }\n  }, {\n    key: \"layerX\",\n    get: function get() {\n      return this.layer.x;\n    }\n  }, {\n    key: \"layerY\",\n    get: function get() {\n      return this.layer.y;\n    }\n  }, {\n    key: \"pageX\",\n    get: function get() {\n      return this.page.x;\n    }\n  }, {\n    key: \"pageY\",\n    get: function get() {\n      return this.page.y;\n    }\n  }, {\n    key: \"x\",\n    get: function get() {\n      return this.canvas.x;\n    }\n  }, {\n    key: \"y\",\n    get: function get() {\n      return this.canvas.y;\n    }\n  }, {\n    key: \"canvasX\",\n    get: function get() {\n      return this.canvas.x;\n    }\n  }, {\n    key: \"canvasY\",\n    get: function get() {\n      return this.canvas.y;\n    }\n  }, {\n    key: \"viewportX\",\n    get: function get() {\n      return this.viewport.x;\n    }\n  }, {\n    key: \"viewportY\",\n    get: function get() {\n      return this.viewport.y;\n    }\n  }, {\n    key: \"composedPath\",\n    value:\n    /**\n     * The propagation path for this event\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/composedPath\n     *\n     * So composedPath()[0] represents the original target.\n     * @see https://polymer-library.polymer-project.org/3.0/docs/devguide/events#retargeting\n     */\n    function composedPath() {\n      if (this.manager && (!this.path || this.path[0] !== this.target)) {\n        this.path = this.target ? this.manager.propagationPath(this.target) : [];\n      }\n      return this.path;\n    }\n    /**\n     * @deprecated\n     */\n  }, {\n    key: \"propagationPath\",\n    get: function get() {\n      return this.composedPath();\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/preventDefault\n     */\n  }, {\n    key: \"preventDefault\",\n    value: function preventDefault() {\n      if (this.nativeEvent instanceof Event && this.nativeEvent.cancelable) {\n        this.nativeEvent.preventDefault();\n      }\n      this.defaultPrevented = true;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopImmediatePropagation\n     */\n  }, {\n    key: \"stopImmediatePropagation\",\n    value: function stopImmediatePropagation() {\n      this.propagationImmediatelyStopped = true;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopPropagation\n     */\n  }, {\n    key: \"stopPropagation\",\n    value: function stopPropagation() {\n      this.propagationStopped = true;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/UIEvent/view\n     */\n  }, {\n    key: \"initEvent\",\n    value:\n    /**\n     * added for compatibility with DOM Event,\n     * deprecated props and methods\n     */\n    function initEvent() {}\n  }, {\n    key: \"initUIEvent\",\n    value: function initUIEvent() {}\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }]);\n}();\nvar FederatedMouseEvent = /*#__PURE__*/function (_ref) {\n  function FederatedMouseEvent() {\n    var _this;\n    _classCallCheck(this, FederatedMouseEvent);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, FederatedMouseEvent, [].concat(args));\n    /** Whether the \"alt\" key was pressed when this mouse event occurred. */\n    /** The specific button that was pressed in this mouse event. */\n    /** The button depressed when this event occurred. */\n    /** Whether the \"control\" key was pressed when this mouse event occurred. */\n    /** Whether the \"meta\" key was pressed when this mouse event occurred. */\n    /** This is currently not implemented in the Federated Events API. */\n    // @ts-ignore\n    /** Whether the \"shift\" key was pressed when this mouse event occurred. */\n    /**\n     * The coordinates of the mouse event relative to the canvas.\n     */\n    _this.client = new Point();\n    /**\n     * The movement in this pointer relative to the last `mousemove` event.\n     */\n    _this.movement = new Point();\n    /**\n     * The offset of the pointer coordinates w.r.t. target DisplayObject in world space. This is\n     * not supported at the moment.\n     */\n    _this.offset = new Point();\n    /**\n     * The pointer coordinates in world space.\n     */\n    _this.global = new Point();\n    /**\n     * The pointer coordinates in sceen space.\n     */\n    _this.screen = new Point();\n    return _this;\n  }\n  _inherits(FederatedMouseEvent, _ref);\n  return _createClass(FederatedMouseEvent, [{\n    key: \"clientX\",\n    get: function get() {\n      return this.client.x;\n    }\n  }, {\n    key: \"clientY\",\n    get: function get() {\n      return this.client.y;\n    }\n  }, {\n    key: \"movementX\",\n    get: function get() {\n      return this.movement.x;\n    }\n  }, {\n    key: \"movementY\",\n    get: function get() {\n      return this.movement.y;\n    }\n  }, {\n    key: \"offsetX\",\n    get: function get() {\n      return this.offset.x;\n    }\n  }, {\n    key: \"offsetY\",\n    get: function get() {\n      return this.offset.y;\n    }\n  }, {\n    key: \"globalX\",\n    get: function get() {\n      return this.global.x;\n    }\n  }, {\n    key: \"globalY\",\n    get: function get() {\n      return this.global.y;\n    }\n  }, {\n    key: \"screenX\",\n    get: function get() {\n      return this.screen.x;\n    }\n  }, {\n    key: \"screenY\",\n    get: function get() {\n      return this.screen.y;\n    }\n  }, {\n    key: \"getModifierState\",\n    value: function getModifierState(key) {\n      return 'getModifierState' in this.nativeEvent && this.nativeEvent.getModifierState(key);\n    }\n  }, {\n    key: \"initMouseEvent\",\n    value: function initMouseEvent() {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }]);\n}(FederatedEvent);\n\n// @ts-ignore\nvar FederatedPointerEvent = /*#__PURE__*/function (_FederatedMouseEvent) {\n  function FederatedPointerEvent() {\n    var _this;\n    _classCallCheck(this, FederatedPointerEvent);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, FederatedPointerEvent, [].concat(args));\n    /**\n     * The unique identifier of the pointer.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerId\n     */\n    /**\n     * The width of the pointer's contact along the x-axis, measured in CSS pixels.\n     * radiusX of TouchEvents will be represented by this value.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/width\n     */\n    _this.width = 0;\n    /**\n     * The height of the pointer's contact along the y-axis, measured in CSS pixels.\n     * radiusY of TouchEvents will be represented by this value.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/height\n     */\n    _this.height = 0;\n    /**\n     * Indicates whether or not the pointer device that created the event is the primary pointer.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/isPrimary\n     */\n    _this.isPrimary = false;\n    return _this;\n  }\n  _inherits(FederatedPointerEvent, _FederatedMouseEvent);\n  return _createClass(FederatedPointerEvent, [{\n    key: \"getCoalescedEvents\",\n    value:\n    /**\n     * The type of pointer that triggered the event.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerType\n     */\n\n    /**\n     * Pressure applied by the pointing device during the event.\n     *s\n     * A Touch's force property will be represented by this value.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pressure\n     */\n\n    /**\n     * Barrel pressure on a stylus pointer.\n     *\n     * @see https://w3c.github.io/pointerevents/#pointerevent-interface\n     */\n\n    /**\n     * The angle, in degrees, between the pointer device and the screen.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltX\n     */\n\n    /**\n     * The angle, in degrees, between the pointer device and the screen.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltY\n     */\n\n    /**\n     * Twist of a stylus pointer.\n     *\n     * @see https://w3c.github.io/pointerevents/#pointerevent-interface\n     */\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/getCoalescedEvents\n     */\n    function getCoalescedEvents() {\n      if (this.type === 'pointermove' || this.type === 'mousemove' || this.type === 'touchmove') {\n        // @ts-ignore\n        return [this];\n      }\n      return [];\n    }\n\n    /**\n     * @see https://chromestatus.com/feature/5765569655603200\n     */\n  }, {\n    key: \"getPredictedEvents\",\n    value: function getPredictedEvents() {\n      throw new Error('getPredictedEvents is not supported!');\n    }\n\n    /**\n     * @see https://github.com/antvis/G/issues/1115\n     * We currently reuses event objects in the event system,\n     * avoiding the creation of a large number of event objects.\n     * Reused objects are only used to carry different data,\n     * such as coordinate information, native event objects,\n     * and therefore the lifecycle is limited to the event handler,\n     * which can lead to unintended consequences if an attempt is made to cache the entire event object.\n     *\n     * Therefore, while keeping the above performance considerations in mind, it is possible to provide a clone method that creates a new object when the user really wants to cache it, e.g.\n     */\n  }, {\n    key: \"clone\",\n    value: function clone() {\n      return this.manager.clonePointerEvent(this);\n    }\n  }]);\n}(FederatedMouseEvent);\n\n// @ts-ignore\nvar FederatedWheelEvent = /*#__PURE__*/function (_FederatedMouseEvent) {\n  function FederatedWheelEvent() {\n    _classCallCheck(this, FederatedWheelEvent);\n    return _callSuper(this, FederatedWheelEvent, arguments);\n  }\n  _inherits(FederatedWheelEvent, _FederatedMouseEvent);\n  return _createClass(FederatedWheelEvent, [{\n    key: \"clone\",\n    value:\n    /**\n     * The units of `deltaX`, `deltaY`, and `deltaZ`. This is one of `DOM_DELTA_LINE`,\n     * `DOM_DELTA_PAGE`, `DOM_DELTA_PIXEL`.\n     */\n\n    /** Horizontal scroll amount */\n\n    /** Vertical scroll amount */\n\n    /** z-axis scroll amount. */\n\n    function clone() {\n      return this.manager.cloneWheelEvent(this);\n    }\n  }]);\n}(FederatedMouseEvent);\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/Events/Creating_and_triggering_events\n *\n * @example\n  const event = new CustomEvent('build', { detail: { prop1: 'xx' } });\n  circle.addEventListener('build', (e) => {\n    e.target; // circle\n    e.detail; // { prop1: 'xx' }\n  });\n\n  circle.dispatchEvent(event);\n */\nvar CustomEvent = /*#__PURE__*/function (_FederatedEvent) {\n  function CustomEvent(eventName, object) {\n    var _this;\n    _classCallCheck(this, CustomEvent);\n    _this = _callSuper(this, CustomEvent, [null]);\n    _this.type = eventName;\n    _this.detail = object;\n\n    // compatible with G 3.0\n    Object.assign(_this, object);\n    return _this;\n  }\n  _inherits(CustomEvent, _FederatedEvent);\n  return _createClass(CustomEvent);\n}(FederatedEvent);\nvar CANVAS_CACHE = new WeakMap();\n\n/**\n * Objects that can receive events and may have listeners for them.\n * eg. Element, Canvas, DisplayObject\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n */\nvar EventTarget = /*#__PURE__*/function () {\n  function EventTarget() {\n    _classCallCheck(this, EventTarget);\n    /**\n     * event emitter\n     */\n    this.emitter = new EventEmitter();\n  }\n  return _createClass(EventTarget, [{\n    key: \"on\",\n    value:\n    /**\n     * @deprecated\n     * @alias addEventListener\n     */\n    function on(type, listener, options) {\n      this.addEventListener(type, listener, options);\n      return this;\n    }\n    /**\n     * support `capture` & `once` in options\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener\n     */\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(type, listener, options) {\n      var capture = false;\n      var once = false;\n      if (isBoolean(options)) capture = options;else if (options) {\n        var _options$capture = options.capture;\n        capture = _options$capture === void 0 ? false : _options$capture;\n        var _options$once = options.once;\n        once = _options$once === void 0 ? false : _options$once;\n      }\n      if (capture) type += 'capture';\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      listener = isFunction(listener) ? listener : listener.handleEvent;\n      var context = isFunction(listener) ? undefined : listener;\n      if (once) this.emitter.once(type, listener, context);else this.emitter.on(type, listener, context);\n      return this;\n    }\n    /**\n     * @deprecated\n     * @alias removeEventListener\n     */\n  }, {\n    key: \"off\",\n    value: function off(type, listener, options) {\n      if (type) {\n        this.removeEventListener(type, listener, options);\n      } else {\n        // remove all listeners\n        this.removeAllEventListeners();\n      }\n      return this;\n    }\n  }, {\n    key: \"removeAllEventListeners\",\n    value: function removeAllEventListeners() {\n      var _this$emitter;\n      (_this$emitter = this.emitter) === null || _this$emitter === void 0 || _this$emitter.removeAllListeners();\n    }\n  }, {\n    key: \"removeEventListener\",\n    value: function removeEventListener(type, listener, options) {\n      var _listener;\n      if (!this.emitter) return this;\n      var capture = isBoolean(options) ? options : options === null || options === void 0 ? void 0 : options.capture;\n      if (capture) type += 'capture';\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      listener = isFunction(listener) ? listener : (_listener = listener) === null || _listener === void 0 ? void 0 : _listener.handleEvent;\n      var context = isFunction(listener) ? undefined : listener;\n      this.emitter.off(type, listener, context);\n      return this;\n    }\n    /**\n     * @deprecated\n     * @alias dispatchEvent\n     */\n  }, {\n    key: \"emit\",\n    value: function emit(eventName, object) {\n      this.dispatchEvent(new CustomEvent(eventName, object));\n    }\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n     */\n  }, {\n    key: \"dispatchEvent\",\n    value: function dispatchEvent(e) {\n      var skipPropagate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var canvas = CANVAS_CACHE.get(this);\n      if (!canvas) {\n        var _ownerDocument;\n        // @ts-expect-error document may be defined in inherited class\n        if (this.document) canvas = this;\n        // @ts-expect-error defaultView may be defined in inherited class\n        else if (this.defaultView) canvas = this.defaultView;else canvas = (_ownerDocument = this.ownerDocument) === null || _ownerDocument === void 0 ? void 0 : _ownerDocument.defaultView;\n        if (canvas) CANVAS_CACHE.set(this, canvas);\n      }\n      if (canvas) {\n        e.manager = canvas.getEventService();\n        if (!e.manager) return false;\n        e.defaultPrevented = false;\n        if (e.path) e.path.length = 0;\n        // @ts-ignore\n        else e.page = [];\n        if (!skipPropagate) e.target = this;\n        e.manager.dispatchEvent(e, e.type, skipPropagate);\n      }\n      return !e.defaultPrevented;\n    }\n  }]);\n}();\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Node\n */\nvar Node = /*#__PURE__*/function (_EventTarget) {\n  function Node() {\n    var _this;\n    _classCallCheck(this, Node);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, Node, [].concat(args));\n    _this.shadow = false;\n    /**\n     * points to canvas.document\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/ownerDocument\n     */\n    _this.ownerDocument = null;\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/isConnected\n     * @example\n        circle.isConnected; // false\n        canvas.appendChild(circle);\n        circle.isConnected; // true\n     */\n    _this.isConnected = false;\n    /**\n     * Returns node's node document's document base URL.\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node\n     */\n    _this.baseURI = '';\n    /**\n     * Returns the children.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/childNodes\n     */\n    _this.childNodes = [];\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType\n     */\n    _this.nodeType = 0;\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeName\n     */\n    _this.nodeName = '';\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeValue\n     */\n    _this.nodeValue = null;\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/ParentNode\n     */\n    _this.parentNode = null;\n    return _this;\n  }\n  _inherits(Node, _EventTarget);\n  return _createClass(Node, [{\n    key: \"textContent\",\n    get:\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/textContent\n     */\n    function get() {\n      var out = '';\n      if (this.nodeName === Shape.TEXT) {\n        // @ts-ignore\n        out += this.style.text;\n      }\n      var _iterator = _createForOfIteratorHelper(this.childNodes),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var _child = _step.value;\n          if (_child.nodeName === Shape.TEXT) {\n            out += _child.nodeValue;\n          } else {\n            out += _child.textContent;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return out;\n    },\n    set: function set(content) {\n      var _this2 = this;\n      // remove all children\n      this.childNodes.slice().forEach(function (child) {\n        _this2.removeChild(child);\n      });\n      if (this.nodeName === Shape.TEXT) {\n        // @ts-ignore\n        this.style.text = \"\".concat(content);\n      }\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/getRootNode\n     */\n  }, {\n    key: \"getRootNode\",\n    value: function getRootNode() {\n      var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (this.parentNode) {\n        return this.parentNode.getRootNode(opts);\n      }\n      if (opts.composed && this.host) {\n        return this.host.getRootNode(opts);\n      }\n      return this;\n    }\n  }, {\n    key: \"hasChildNodes\",\n    value: function hasChildNodes() {\n      return this.childNodes.length > 0;\n    }\n  }, {\n    key: \"isDefaultNamespace\",\n    value: function isDefaultNamespace(namespace) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"lookupNamespaceURI\",\n    value: function lookupNamespaceURI(prefix) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"lookupPrefix\",\n    value: function lookupPrefix(namespace) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"normalize\",\n    value: function normalize() {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/isEqualNode\n     */\n  }, {\n    key: \"isEqualNode\",\n    value: function isEqualNode(otherNode) {\n      // TODO: compare 2 nodes, not sameness\n      return this === otherNode;\n    }\n  }, {\n    key: \"isSameNode\",\n    value: function isSameNode(otherNode) {\n      return this.isEqualNode(otherNode);\n    }\n  }, {\n    key: \"parent\",\n    get:\n    /**\n     * @deprecated\n     * @alias parentNode\n     */\n    function get() {\n      return this.parentNode;\n    }\n  }, {\n    key: \"parentElement\",\n    get: function get() {\n      return null;\n    }\n  }, {\n    key: \"nextSibling\",\n    get: function get() {\n      return null;\n    }\n  }, {\n    key: \"previousSibling\",\n    get: function get() {\n      return null;\n    }\n  }, {\n    key: \"firstChild\",\n    get: function get() {\n      return this.childNodes.length > 0 ? this.childNodes[0] : null;\n    }\n  }, {\n    key: \"lastChild\",\n    get: function get() {\n      return this.childNodes.length > 0 ? this.childNodes[this.childNodes.length - 1] : null;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/compareDocumentPosition\n     * @see https://github.com/b-fuze/deno-dom/blob/master/src/dom/node.ts#L338\n     */\n  }, {\n    key: \"compareDocumentPosition\",\n    value: function compareDocumentPosition(other) {\n      if (other === this) {\n        // same node\n        return 0;\n      }\n\n      // if (!(other instanceof Node)) {\n      //   throw new TypeError(\n      //     'Node.compareDocumentPosition: Argument 1 does not implement interface Node.',\n      //   );\n      // }\n\n      var node1Root = other;\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var node2Root = this;\n      var node1Hierarchy = [node1Root];\n      var node2Hierarchy = [node2Root];\n      while ((_node1Root$parentNode = node1Root.parentNode) !== null && _node1Root$parentNode !== void 0 ? _node1Root$parentNode : node2Root.parentNode) {\n        var _node1Root$parentNode;\n        node1Root = node1Root.parentNode ? (node1Hierarchy.push(node1Root.parentNode), node1Root.parentNode) : node1Root;\n        node2Root = node2Root.parentNode ? (node2Hierarchy.push(node2Root.parentNode), node2Root.parentNode) : node2Root;\n      }\n\n      // Check if they don't share the same root node\n      if (node1Root !== node2Root) {\n        return Node.DOCUMENT_POSITION_DISCONNECTED | Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC | Node.DOCUMENT_POSITION_PRECEDING;\n      }\n      var longerHierarchy = node1Hierarchy.length > node2Hierarchy.length ? node1Hierarchy : node2Hierarchy;\n      var shorterHierarchy = longerHierarchy === node1Hierarchy ? node2Hierarchy : node1Hierarchy;\n\n      // Check if either is a container of the other\n      if (longerHierarchy[longerHierarchy.length - shorterHierarchy.length] === shorterHierarchy[0]) {\n        return longerHierarchy === node1Hierarchy ?\n        // other is a child of this\n        Node.DOCUMENT_POSITION_CONTAINED_BY | Node.DOCUMENT_POSITION_FOLLOWING :\n        // this is a child of other\n        Node.DOCUMENT_POSITION_CONTAINS | Node.DOCUMENT_POSITION_PRECEDING;\n      }\n\n      // Find their first common ancestor and see whether they\n      // are preceding or following\n      var longerStart = longerHierarchy.length - shorterHierarchy.length;\n      for (var i = shorterHierarchy.length - 1; i >= 0; i--) {\n        var shorterHierarchyNode = shorterHierarchy[i];\n        var longerHierarchyNode = longerHierarchy[longerStart + i];\n\n        // We found the first common ancestor\n        if (longerHierarchyNode !== shorterHierarchyNode) {\n          var siblings = shorterHierarchyNode.parentNode.childNodes;\n          if (siblings.indexOf(shorterHierarchyNode) < siblings.indexOf(longerHierarchyNode)) {\n            // Shorter is before longer\n            if (shorterHierarchy === node1Hierarchy) {\n              // Other is before this\n              return Node.DOCUMENT_POSITION_PRECEDING;\n            }\n            // This is before other\n            return Node.DOCUMENT_POSITION_FOLLOWING;\n          }\n          // Longer is before shorter\n          if (longerHierarchy === node1Hierarchy) {\n            // Other is before this\n            return Node.DOCUMENT_POSITION_PRECEDING;\n          }\n          // Other is after this\n          return Node.DOCUMENT_POSITION_FOLLOWING;\n        }\n      }\n      return Node.DOCUMENT_POSITION_FOLLOWING;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode\n     */\n  }, {\n    key: \"contain\",\n    value:\n    /**\n     * @deprecated\n     * @alias contains\n     */\n    function contain(other) {\n      return this.contains(other);\n    }\n  }, {\n    key: \"contains\",\n    value: function contains(other) {\n      // the node itself, one of its direct children\n      var tmp = other;\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/Node/contains\n      while (tmp && this !== tmp) {\n        tmp = tmp.parentNode;\n      }\n      return !!tmp;\n    }\n  }, {\n    key: \"getAncestor\",\n    value: function getAncestor(n) {\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      var temp = this;\n      while (n > 0 && temp) {\n        temp = temp.parentNode;\n        n--;\n      }\n      return temp;\n    }\n\n    /**\n     * iterate current node and its descendants\n     * @param callback - callback to execute for each node, return false to break\n     * @param assigned - whether to iterate assigned nodes\n     */\n  }, {\n    key: \"forEach\",\n    value: function forEach(callback) {\n      var result = callback(this);\n      if (result !== false) {\n        var nodes = this.childNodes;\n        var length = nodes.length;\n        for (var i = 0; i < length; i++) {\n          nodes[i].forEach(callback);\n        }\n      }\n    }\n  }], [{\n    key: \"isNode\",\n    value: function isNode(target) {\n      return !!target.childNodes;\n    }\n  }]);\n}(EventTarget);\n/**\n * Both nodes are in different documents or different trees in the same document.\n */\nNode.DOCUMENT_POSITION_DISCONNECTED = 1;\n/**\n * otherNode precedes the node in either a pre-order depth-first traversal\n * of a tree containing both (e.g., as an ancestor or previous sibling or a descendant of a previous sibling or previous sibling of an ancestor) or (if they are disconnected) in an arbitrary but consistent ordering.\n */\nNode.DOCUMENT_POSITION_PRECEDING = 2;\n/**\n * otherNode follows the node in either a pre-order depth-first traversal of a tree containing both (e.g., as a descendant or following sibling or a descendant of a following sibling or following sibling of an ancestor) or (if they are disconnected) in an arbitrary but consistent ordering.\n */\nNode.DOCUMENT_POSITION_FOLLOWING = 4;\n/**\n * otherNode is an ancestor of the node.\n */\nNode.DOCUMENT_POSITION_CONTAINS = 8;\n/**\n * otherNode is a descendant of the node.\n */\nNode.DOCUMENT_POSITION_CONTAINED_BY = 16;\n/**\n * The result relies upon arbitrary and/or implementation-specific behavior and is not guaranteed to be portable.\n */\nNode.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 32;\nvar PROPAGATION_LIMIT = 2048;\nvar EventService = /*#__PURE__*/function () {\n  function EventService(globalRuntime, context) {\n    var _this = this;\n    _classCallCheck(this, EventService);\n    this.emitter = new EventEmitter();\n    /**\n     * Store HTML elements in current canvas.\n     */\n    this.nativeHTMLMap = new WeakMap();\n    this.cursor = 'default';\n    this.mappingTable = {};\n    this.mappingState = {\n      trackingData: {}\n    };\n    this.eventPool = new Map();\n    this.tmpMatrix = mat4.create();\n    this.tmpVec3 = vec3.create();\n    this.onPointerDown = function (from) {\n      var e = _this.createPointerEvent(from);\n      _this.dispatchEvent(e, 'pointerdown');\n      if (e.pointerType === 'touch') {\n        _this.dispatchEvent(e, 'touchstart');\n      } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n        var isRightButton = e.button === 2;\n        _this.dispatchEvent(e, isRightButton ? 'rightdown' : 'mousedown');\n      }\n      var trackingData = _this.trackingData(from.pointerId);\n      trackingData.pressTargetsByButton[from.button] = e.composedPath();\n      _this.freeEvent(e);\n    };\n    this.onPointerUp = function (from) {\n      var now = clock.now();\n      var e = _this.createPointerEvent(from, undefined, undefined, _this.context.config.alwaysTriggerPointerEventOnCanvas ? _this.rootTarget : undefined);\n      _this.dispatchEvent(e, 'pointerup');\n      if (e.pointerType === 'touch') {\n        _this.dispatchEvent(e, 'touchend');\n      } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n        var isRightButton = e.button === 2;\n        _this.dispatchEvent(e, isRightButton ? 'rightup' : 'mouseup');\n      }\n      var trackingData = _this.trackingData(from.pointerId);\n      var pressTarget = _this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);\n      var clickTarget = pressTarget;\n\n      // pointerupoutside only bubbles. It only bubbles upto the parent that doesn't contain\n      // the pointerup location.\n      if (pressTarget && !e.composedPath().includes(pressTarget)) {\n        var currentTarget = pressTarget;\n        while (currentTarget && !e.composedPath().includes(currentTarget)) {\n          e.currentTarget = currentTarget;\n          _this.notifyTarget(e, 'pointerupoutside');\n          if (e.pointerType === 'touch') {\n            _this.notifyTarget(e, 'touchendoutside');\n          } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n            var _isRightButton = e.button === 2;\n            _this.notifyTarget(e, _isRightButton ? 'rightupoutside' : 'mouseupoutside');\n          }\n          if (Node.isNode(currentTarget)) {\n            currentTarget = currentTarget.parentNode;\n          }\n        }\n        delete trackingData.pressTargetsByButton[from.button];\n\n        // currentTarget is the most specific ancestor holding both the pointerdown and pointerup\n        // targets. That is - it's our click target!\n        clickTarget = currentTarget;\n      }\n      if (clickTarget) {\n        var _e$detail;\n        var clickEvent = _this.clonePointerEvent(e, 'click');\n        clickEvent.target = clickTarget;\n        clickEvent.path = [];\n        if (!trackingData.clicksByButton[from.button]) {\n          trackingData.clicksByButton[from.button] = {\n            clickCount: 0,\n            target: clickEvent.target,\n            timeStamp: now\n          };\n        }\n        var canvas = _this.context.renderingContext.root.ownerDocument.defaultView;\n        var clickHistory = trackingData.clicksByButton[from.button];\n        if (clickHistory.target === clickEvent.target && now - clickHistory.timeStamp < canvas.dblClickSpeed) {\n          ++clickHistory.clickCount;\n        } else {\n          clickHistory.clickCount = 1;\n        }\n        clickHistory.target = clickEvent.target;\n        clickHistory.timeStamp = now;\n        clickEvent.detail = clickHistory.clickCount;\n\n        // @see https://github.com/antvis/G/issues/1091\n        if (!((_e$detail = e.detail) !== null && _e$detail !== void 0 && _e$detail.preventClick)) {\n          if (!_this.context.config.useNativeClickEvent && (clickEvent.pointerType === 'mouse' || clickEvent.pointerType === 'touch')) {\n            _this.dispatchEvent(clickEvent, 'click');\n          }\n          _this.dispatchEvent(clickEvent, 'pointertap');\n        }\n        _this.freeEvent(clickEvent);\n      }\n      _this.freeEvent(e);\n    };\n    this.onPointerMove = function (from) {\n      var e = _this.createPointerEvent(from, undefined, undefined, _this.context.config.alwaysTriggerPointerEventOnCanvas ? _this.rootTarget : undefined);\n      var isMouse = e.pointerType === 'mouse' || e.pointerType === 'pen';\n      var trackingData = _this.trackingData(from.pointerId);\n      var outTarget = _this.findMountedTarget(trackingData.overTargets);\n\n      // First pointerout/pointerleave\n      if (trackingData.overTargets && outTarget !== e.target) {\n        // pointerout always occurs on the overTarget when the pointer hovers over another element.\n        var outType = from.type === 'mousemove' ? 'mouseout' : 'pointerout';\n        var outEvent = _this.createPointerEvent(from, outType, outTarget || undefined);\n        _this.dispatchEvent(outEvent, 'pointerout');\n        if (isMouse) _this.dispatchEvent(outEvent, 'mouseout');\n\n        // If the pointer exits overTarget and its descendants, then a pointerleave event is also fired. This event\n        // is dispatched to all ancestors that no longer capture the pointer.\n        if (!e.composedPath().includes(outTarget)) {\n          var leaveEvent = _this.createPointerEvent(from, 'pointerleave', outTarget || undefined);\n          leaveEvent.eventPhase = leaveEvent.AT_TARGET;\n          while (leaveEvent.target && !e.composedPath().includes(leaveEvent.target)) {\n            leaveEvent.currentTarget = leaveEvent.target;\n            _this.notifyTarget(leaveEvent);\n            if (isMouse) {\n              _this.notifyTarget(leaveEvent, 'mouseleave');\n            }\n            if (Node.isNode(leaveEvent.target)) {\n              leaveEvent.target = leaveEvent.target.parentNode;\n            }\n          }\n          _this.freeEvent(leaveEvent);\n        }\n        _this.freeEvent(outEvent);\n      }\n\n      // Then pointerover\n      if (outTarget !== e.target) {\n        // pointerover always occurs on the new overTarget\n        var overType = from.type === 'mousemove' ? 'mouseover' : 'pointerover';\n        var overEvent = _this.clonePointerEvent(e, overType); // clone faster\n\n        _this.dispatchEvent(overEvent, 'pointerover');\n        if (isMouse) _this.dispatchEvent(overEvent, 'mouseover');\n\n        // Probe whether the newly hovered Node is an ancestor of the original overTarget.\n        var overTargetAncestor = outTarget && Node.isNode(outTarget) && outTarget.parentNode;\n        while (overTargetAncestor && overTargetAncestor !== (Node.isNode(_this.rootTarget) && _this.rootTarget.parentNode)) {\n          if (overTargetAncestor === e.target) break;\n          overTargetAncestor = overTargetAncestor.parentNode;\n        }\n\n        // The pointer has entered a non-ancestor of the original overTarget. This means we need a pointerentered\n        // event.\n        var didPointerEnter = !overTargetAncestor || overTargetAncestor === (Node.isNode(_this.rootTarget) && _this.rootTarget.parentNode);\n        if (didPointerEnter) {\n          var enterEvent = _this.clonePointerEvent(e, 'pointerenter');\n          enterEvent.eventPhase = enterEvent.AT_TARGET;\n          while (enterEvent.target && enterEvent.target !== outTarget && enterEvent.target !== (Node.isNode(_this.rootTarget) && _this.rootTarget.parentNode)) {\n            enterEvent.currentTarget = enterEvent.target;\n            _this.notifyTarget(enterEvent);\n            if (isMouse) _this.notifyTarget(enterEvent, 'mouseenter');\n            if (Node.isNode(enterEvent.target)) {\n              enterEvent.target = enterEvent.target.parentNode;\n            }\n          }\n          _this.freeEvent(enterEvent);\n        }\n        _this.freeEvent(overEvent);\n      }\n\n      // Then pointermove\n      _this.dispatchEvent(e, 'pointermove');\n      if (e.pointerType === 'touch') _this.dispatchEvent(e, 'touchmove');\n      if (isMouse) {\n        _this.dispatchEvent(e, 'mousemove');\n        _this.cursor = _this.getCursor(e.target);\n      }\n      trackingData.overTargets = e.composedPath();\n      _this.freeEvent(e);\n    };\n    this.onPointerOut = function (from) {\n      var trackingData = _this.trackingData(from.pointerId);\n      if (trackingData.overTargets) {\n        var isMouse = from.pointerType === 'mouse' || from.pointerType === 'pen';\n        var outTarget = _this.findMountedTarget(trackingData.overTargets);\n\n        // pointerout first\n        var outEvent = _this.createPointerEvent(from, 'pointerout', outTarget || undefined);\n        _this.dispatchEvent(outEvent);\n        if (isMouse) _this.dispatchEvent(outEvent, 'mouseout');\n\n        // pointerleave(s) are also dispatched b/c the pointer must've left rootTarget and its descendants to\n        // get an upstream pointerout event (upstream events do not know rootTarget has descendants).\n        var leaveEvent = _this.createPointerEvent(from, 'pointerleave', outTarget || undefined);\n        leaveEvent.eventPhase = leaveEvent.AT_TARGET;\n        while (leaveEvent.target && leaveEvent.target !== (Node.isNode(_this.rootTarget) && _this.rootTarget.parentNode)) {\n          leaveEvent.currentTarget = leaveEvent.target;\n          _this.notifyTarget(leaveEvent);\n          if (isMouse) {\n            _this.notifyTarget(leaveEvent, 'mouseleave');\n          }\n          if (Node.isNode(leaveEvent.target)) {\n            leaveEvent.target = leaveEvent.target.parentNode;\n          }\n        }\n        trackingData.overTargets = null;\n        _this.freeEvent(outEvent);\n        _this.freeEvent(leaveEvent);\n      }\n      _this.cursor = null;\n    };\n    this.onPointerOver = function (from) {\n      var trackingData = _this.trackingData(from.pointerId);\n      var e = _this.createPointerEvent(from);\n      var isMouse = e.pointerType === 'mouse' || e.pointerType === 'pen';\n      _this.dispatchEvent(e, 'pointerover');\n      if (isMouse) _this.dispatchEvent(e, 'mouseover');\n      if (e.pointerType === 'mouse') _this.cursor = _this.getCursor(e.target);\n\n      // pointerenter events must be fired since the pointer entered from upstream.\n      var enterEvent = _this.clonePointerEvent(e, 'pointerenter');\n      enterEvent.eventPhase = enterEvent.AT_TARGET;\n      while (enterEvent.target && enterEvent.target !== (Node.isNode(_this.rootTarget) && _this.rootTarget.parentNode)) {\n        enterEvent.currentTarget = enterEvent.target;\n        _this.notifyTarget(enterEvent);\n        if (isMouse) {\n          // mouseenter should not bubble\n          // @see https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseenter_event#usage_notes\n          _this.notifyTarget(enterEvent, 'mouseenter');\n        }\n        if (Node.isNode(enterEvent.target)) {\n          enterEvent.target = enterEvent.target.parentNode;\n        }\n      }\n      trackingData.overTargets = e.composedPath();\n      _this.freeEvent(e);\n      _this.freeEvent(enterEvent);\n    };\n    this.onPointerUpOutside = function (from) {\n      var trackingData = _this.trackingData(from.pointerId);\n      var pressTarget = _this.findMountedTarget(trackingData.pressTargetsByButton[from.button]);\n      var e = _this.createPointerEvent(from);\n      if (pressTarget) {\n        var currentTarget = pressTarget;\n        while (currentTarget) {\n          e.currentTarget = currentTarget;\n          _this.notifyTarget(e, 'pointerupoutside');\n          if (e.pointerType === 'touch') ;else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n            _this.notifyTarget(e, e.button === 2 ? 'rightupoutside' : 'mouseupoutside');\n          }\n          if (Node.isNode(currentTarget)) {\n            currentTarget = currentTarget.parentNode;\n          }\n        }\n        delete trackingData.pressTargetsByButton[from.button];\n      }\n      _this.freeEvent(e);\n    };\n    this.onWheel = function (from) {\n      var wheelEvent = _this.createWheelEvent(from);\n      _this.dispatchEvent(wheelEvent);\n      _this.freeEvent(wheelEvent);\n    };\n    this.onClick = function (from) {\n      if (_this.context.config.useNativeClickEvent) {\n        var e = _this.createPointerEvent(from);\n        _this.dispatchEvent(e);\n        _this.freeEvent(e);\n      }\n    };\n    this.onPointerCancel = function (from) {\n      var e = _this.createPointerEvent(from, undefined, undefined, _this.context.config.alwaysTriggerPointerEventOnCanvas ? _this.rootTarget : undefined);\n      _this.dispatchEvent(e);\n      _this.freeEvent(e);\n    };\n    this.globalRuntime = globalRuntime;\n    this.context = context;\n  }\n  return _createClass(EventService, [{\n    key: \"init\",\n    value: function init() {\n      this.rootTarget = this.context.renderingContext.root.parentNode; // document\n      this.addEventMapping('pointerdown', this.onPointerDown);\n      this.addEventMapping('pointerup', this.onPointerUp);\n      this.addEventMapping('pointermove', this.onPointerMove);\n      this.addEventMapping('pointerout', this.onPointerOut);\n      this.addEventMapping('pointerleave', this.onPointerOut);\n      this.addEventMapping('pointercancel', this.onPointerCancel);\n      this.addEventMapping('pointerover', this.onPointerOver);\n      this.addEventMapping('pointerupoutside', this.onPointerUpOutside);\n      this.addEventMapping('wheel', this.onWheel);\n      this.addEventMapping('click', this.onClick);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.emitter.removeAllListeners();\n      this.mappingTable = {};\n      this.mappingState = {};\n      this.eventPool.clear();\n    }\n  }, {\n    key: \"getScale\",\n    value: function getScale() {\n      var bbox = this.context.contextService.getBoundingClientRect();\n      var scaleX = 1;\n      var scaleY = 1;\n      var $el = this.context.contextService.getDomElement();\n      if ($el && bbox) {\n        var offsetWidth = $el.offsetWidth,\n          offsetHeight = $el.offsetHeight;\n        if (offsetWidth && offsetHeight) {\n          scaleX = bbox.width / offsetWidth;\n          scaleY = bbox.height / offsetHeight;\n        }\n      }\n      return {\n        scaleX: scaleX,\n        scaleY: scaleY,\n        bbox: bbox\n      };\n    }\n\n    /**\n     * Should account for CSS Transform applied on container.\n     * @see https://github.com/antvis/G/issues/1161\n     * @see https://github.com/antvis/G/issues/1677\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent/offsetX\n     */\n  }, {\n    key: \"client2Viewport\",\n    value: function client2Viewport(client) {\n      var _this$getScale = this.getScale(),\n        scaleX = _this$getScale.scaleX,\n        scaleY = _this$getScale.scaleY,\n        bbox = _this$getScale.bbox;\n      return new Point((client.x - ((bbox === null || bbox === void 0 ? void 0 : bbox.left) || 0)) / scaleX, (client.y - ((bbox === null || bbox === void 0 ? void 0 : bbox.top) || 0)) / scaleY);\n    }\n  }, {\n    key: \"viewport2Client\",\n    value: function viewport2Client(canvas) {\n      var _this$getScale2 = this.getScale(),\n        scaleX = _this$getScale2.scaleX,\n        scaleY = _this$getScale2.scaleY,\n        bbox = _this$getScale2.bbox;\n      return new Point((canvas.x + ((bbox === null || bbox === void 0 ? void 0 : bbox.left) || 0)) * scaleX, (canvas.y + ((bbox === null || bbox === void 0 ? void 0 : bbox.top) || 0)) * scaleY);\n    }\n  }, {\n    key: \"viewport2Canvas\",\n    value: function viewport2Canvas(_ref) {\n      var x = _ref.x,\n        y = _ref.y;\n      var canvas = this.rootTarget.defaultView;\n      var camera = canvas.getCamera();\n      var _this$context$config = this.context.config,\n        width = _this$context$config.width,\n        height = _this$context$config.height;\n      var projectionMatrixInverse = camera.getPerspectiveInverse();\n      var worldMatrix = camera.getWorldTransform();\n      var vpMatrix = mat4.multiply(this.tmpMatrix, worldMatrix, projectionMatrixInverse);\n      var viewport = vec3.set(this.tmpVec3, x / width * 2 - 1, (1 - y / height) * 2 - 1, 0);\n      vec3.transformMat4(viewport, viewport, vpMatrix);\n      return new Point(viewport[0], viewport[1]);\n    }\n  }, {\n    key: \"canvas2Viewport\",\n    value: function canvas2Viewport(canvasP) {\n      var canvas = this.rootTarget.defaultView;\n      var camera = canvas.getCamera();\n\n      // World -> Clip\n      var projectionMatrix = camera.getPerspective();\n      var viewMatrix = camera.getViewTransform();\n      var vpMatrix = mat4.multiply(this.tmpMatrix, projectionMatrix, viewMatrix);\n      var clip = vec3.set(this.tmpVec3, canvasP.x, canvasP.y, 0);\n      vec3.transformMat4(this.tmpVec3, this.tmpVec3, vpMatrix);\n\n      // Clip -> NDC -> Viewport, flip Y\n      var _this$context$config2 = this.context.config,\n        width = _this$context$config2.width,\n        height = _this$context$config2.height;\n      return new Point((clip[0] + 1) / 2 * width, (1 - (clip[1] + 1) / 2) * height);\n    }\n  }, {\n    key: \"setPickHandler\",\n    value: function setPickHandler(pickHandler) {\n      this.pickHandler = pickHandler;\n    }\n  }, {\n    key: \"addEventMapping\",\n    value: function addEventMapping(type, fn) {\n      if (!this.mappingTable[type]) {\n        this.mappingTable[type] = [];\n      }\n      this.mappingTable[type].push({\n        fn: fn,\n        priority: 0\n      });\n      this.mappingTable[type].sort(function (a, b) {\n        return a.priority - b.priority;\n      });\n    }\n  }, {\n    key: \"mapEvent\",\n    value: function mapEvent(e) {\n      if (!this.rootTarget) {\n        return;\n      }\n      var mappers = this.mappingTable[e.type];\n      if (mappers) {\n        for (var i = 0, j = mappers.length; i < j; i++) {\n          mappers[i].fn(e);\n        }\n      } else {\n        console.warn(\"[EventService]: Event mapping not defined for \".concat(e.type));\n      }\n    }\n  }, {\n    key: \"dispatchEvent\",\n    value: function dispatchEvent(e, type, skipPropagate) {\n      // Canvas should skip\n      if (!skipPropagate) {\n        e.propagationStopped = false;\n        e.propagationImmediatelyStopped = false;\n        this.propagate(e, type);\n      } else {\n        // target phase\n        e.eventPhase = e.AT_TARGET;\n        var canvas = this.rootTarget.defaultView || null;\n        e.currentTarget = canvas;\n        this.notifyListeners(e, type);\n      }\n      this.emitter.emit(type || e.type, e);\n    }\n  }, {\n    key: \"propagate\",\n    value: function propagate(e, type) {\n      if (!e.target) {\n        return;\n      }\n\n      // [target, parent, root, Canvas]\n      var composedPath = e.composedPath();\n\n      // event flow: capture -> target -> bubbling\n\n      // capture phase\n      e.eventPhase = e.CAPTURING_PHASE;\n      for (var i = composedPath.length - 1; i >= 1; i--) {\n        e.currentTarget = composedPath[i];\n        this.notifyTarget(e, type);\n        if (e.propagationStopped || e.propagationImmediatelyStopped) return;\n      }\n\n      // target phase\n      e.eventPhase = e.AT_TARGET;\n      e.currentTarget = e.target;\n      this.notifyTarget(e, type);\n      if (e.propagationStopped || e.propagationImmediatelyStopped) return;\n\n      // find current target in composed path\n      var index = composedPath.indexOf(e.currentTarget);\n\n      // bubbling phase\n      e.eventPhase = e.BUBBLING_PHASE;\n      for (var _i = index + 1; _i < composedPath.length; _i++) {\n        e.currentTarget = composedPath[_i];\n        this.notifyTarget(e, type);\n        if (e.propagationStopped || e.propagationImmediatelyStopped) return;\n      }\n    }\n  }, {\n    key: \"propagationPath\",\n    value: function propagationPath(target) {\n      var propagationPath = [target];\n      var canvas = this.rootTarget.defaultView || null;\n      if (canvas && canvas === target) {\n        propagationPath.unshift(canvas.document);\n        return propagationPath;\n      }\n      for (var i = 0; i < PROPAGATION_LIMIT && target !== this.rootTarget; i++) {\n        // if (Node.isNode(target) && !target.parentNode) {\n        //   throw new Error('Cannot find propagation path to disconnected target');\n        // }\n\n        if (Node.isNode(target) && target.parentNode) {\n          // [target, parent, parent, root]\n          propagationPath.push(target.parentNode);\n          target = target.parentNode;\n        }\n      }\n      if (canvas) {\n        // @ts-ignore\n        propagationPath.push(canvas);\n      }\n      return propagationPath;\n    }\n  }, {\n    key: \"hitTest\",\n    value: function hitTest(position) {\n      var viewportX = position.viewportX,\n        viewportY = position.viewportY;\n      var _this$context$config3 = this.context.config,\n        width = _this$context$config3.width,\n        height = _this$context$config3.height,\n        disableHitTesting = _this$context$config3.disableHitTesting;\n      // outside canvas\n      if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n        return null;\n      }\n      return !disableHitTesting && this.pickHandler(position) || this.rootTarget ||\n      // return Document\n      null;\n    }\n\n    /**\n     * whether the native event trigger came from Canvas,\n     * should account for HTML shape\n     */\n  }, {\n    key: \"isNativeEventFromCanvas\",\n    value: function isNativeEventFromCanvas($el, nativeEvent) {\n      var _target;\n      var target = nativeEvent === null || nativeEvent === void 0 ? void 0 : nativeEvent.target;\n      // Get event target inside a web component.\n      // @see https://stackoverflow.com/questions/57963312/get-event-target-inside-a-web-component\n      if ((_target = target) !== null && _target !== void 0 && _target.shadowRoot) {\n        target = nativeEvent.composedPath()[0];\n      }\n      if (target) {\n        // from <canvas>\n        if (target === $el) {\n          return true;\n        }\n\n        // from <svg>\n        if ($el && $el.contains) {\n          return $el.contains(target);\n        }\n      }\n      if (nativeEvent !== null && nativeEvent !== void 0 && nativeEvent.composedPath) {\n        return nativeEvent.composedPath().indexOf($el) > -1;\n      }\n\n      // account for Touch\n      return false;\n    }\n\n    /**\n     * Find HTML from composed path in native UI event.\n     */\n  }, {\n    key: \"getExistedHTML\",\n    value: function getExistedHTML(event) {\n      if (event.nativeEvent.composedPath) {\n        for (var _i2 = 0, _arr = event.nativeEvent.composedPath(); _i2 < _arr.length; _i2++) {\n          var eventTarget = _arr[_i2];\n          var existed = this.nativeHTMLMap.get(eventTarget);\n          if (existed) {\n            return existed;\n          }\n        }\n      }\n      return null;\n    }\n  }, {\n    key: \"pickTarget\",\n    value: function pickTarget(event) {\n      return this.hitTest({\n        clientX: event.clientX,\n        clientY: event.clientY,\n        viewportX: event.viewportX,\n        viewportY: event.viewportY,\n        x: event.canvasX,\n        y: event.canvasY\n      });\n    }\n  }, {\n    key: \"createPointerEvent\",\n    value: function createPointerEvent(from, type, target, fallbackTarget) {\n      var event = this.allocateEvent(FederatedPointerEvent);\n      this.copyPointerData(from, event);\n      this.copyMouseData(from, event);\n      this.copyData(from, event);\n      event.nativeEvent = from.nativeEvent;\n      event.originalEvent = from;\n      var existedHTML = this.getExistedHTML(event);\n      var $el = this.context.contextService.getDomElement();\n      event.target = target !== null && target !== void 0 ? target : existedHTML || this.isNativeEventFromCanvas($el, event.nativeEvent) && this.pickTarget(event) || fallbackTarget;\n      if (typeof type === 'string') {\n        event.type = type;\n      }\n      return event;\n    }\n  }, {\n    key: \"createWheelEvent\",\n    value: function createWheelEvent(from) {\n      var event = this.allocateEvent(FederatedWheelEvent);\n      this.copyWheelData(from, event);\n      this.copyMouseData(from, event);\n      this.copyData(from, event);\n      event.nativeEvent = from.nativeEvent;\n      event.originalEvent = from;\n      var existedHTML = this.getExistedHTML(event);\n      var $el = this.context.contextService.getDomElement();\n      event.target = existedHTML || this.isNativeEventFromCanvas($el, event.nativeEvent) && this.pickTarget(event);\n      return event;\n    }\n  }, {\n    key: \"trackingData\",\n    value: function trackingData(id) {\n      if (!this.mappingState.trackingData[id]) {\n        this.mappingState.trackingData[id] = {\n          pressTargetsByButton: {},\n          clicksByButton: {},\n          overTarget: null\n        };\n      }\n      return this.mappingState.trackingData[id];\n    }\n  }, {\n    key: \"cloneWheelEvent\",\n    value: function cloneWheelEvent(from) {\n      var event = this.allocateEvent(FederatedWheelEvent);\n      event.nativeEvent = from.nativeEvent;\n      event.originalEvent = from.originalEvent;\n      this.copyWheelData(from, event);\n      this.copyMouseData(from, event);\n      this.copyData(from, event);\n      event.target = from.target;\n      event.path = from.composedPath().slice();\n      event.type = from.type;\n      return event;\n    }\n  }, {\n    key: \"clonePointerEvent\",\n    value: function clonePointerEvent(from, type) {\n      var event = this.allocateEvent(FederatedPointerEvent);\n      event.nativeEvent = from.nativeEvent;\n      event.originalEvent = from.originalEvent;\n      this.copyPointerData(from, event);\n      this.copyMouseData(from, event);\n      this.copyData(from, event);\n      event.target = from.target;\n      event.path = from.composedPath().slice();\n      event.type = type !== null && type !== void 0 ? type : event.type;\n      return event;\n    }\n  }, {\n    key: \"copyPointerData\",\n    value: function copyPointerData(from, to) {\n      // if (\n      //   !(\n      //     from instanceof FederatedPointerEvent &&\n      //     to instanceof FederatedPointerEvent\n      //   )\n      // )\n      //   return;\n\n      to.pointerId = from.pointerId;\n      to.width = from.width;\n      to.height = from.height;\n      to.isPrimary = from.isPrimary;\n      to.pointerType = from.pointerType;\n      to.pressure = from.pressure;\n      to.tangentialPressure = from.tangentialPressure;\n      to.tiltX = from.tiltX;\n      to.tiltY = from.tiltY;\n      to.twist = from.twist;\n    }\n  }, {\n    key: \"copyMouseData\",\n    value: function copyMouseData(from, to) {\n      // if (\n      //   !(\n      //     from instanceof FederatedMouseEvent && to instanceof FederatedMouseEvent\n      //   )\n      // )\n      //   return;\n\n      to.altKey = from.altKey;\n      to.button = from.button;\n      to.buttons = from.buttons;\n      to.ctrlKey = from.ctrlKey;\n      to.metaKey = from.metaKey;\n      to.shiftKey = from.shiftKey;\n      to.client.copyFrom(from.client);\n      to.movement.copyFrom(from.movement);\n      to.canvas.copyFrom(from.canvas);\n      to.screen.copyFrom(from.screen);\n      to.global.copyFrom(from.global);\n      to.offset.copyFrom(from.offset);\n    }\n  }, {\n    key: \"copyWheelData\",\n    value: function copyWheelData(from, to) {\n      to.deltaMode = from.deltaMode;\n      to.deltaX = from.deltaX;\n      to.deltaY = from.deltaY;\n      to.deltaZ = from.deltaZ;\n    }\n  }, {\n    key: \"copyData\",\n    value: function copyData(from, to) {\n      to.isTrusted = from.isTrusted;\n      to.timeStamp = clock.now();\n      to.type = from.type;\n      to.detail = from.detail;\n      to.view = from.view;\n      to.page.copyFrom(from.page);\n      to.viewport.copyFrom(from.viewport);\n    }\n  }, {\n    key: \"allocateEvent\",\n    value: function allocateEvent(constructor) {\n      if (!this.eventPool.has(constructor)) {\n        this.eventPool.set(constructor, []);\n      }\n\n      // @ts-ignore\n      var event = this.eventPool.get(constructor).pop() || new constructor(this);\n      event.eventPhase = event.NONE;\n      event.currentTarget = null;\n      event.path = [];\n      event.target = null;\n      return event;\n    }\n  }, {\n    key: \"freeEvent\",\n    value: function freeEvent(event) {\n      if (event.manager !== this) throw new Error('It is illegal to free an event not managed by this EventBoundary!');\n      var constructor = event.constructor;\n      if (!this.eventPool.has(constructor)) {\n        this.eventPool.set(constructor, []);\n      }\n\n      // @ts-ignore\n      this.eventPool.get(constructor).push(event);\n    }\n  }, {\n    key: \"notifyTarget\",\n    value: function notifyTarget(e, type) {\n      var _type;\n      type = (_type = type) !== null && _type !== void 0 ? _type : e.type;\n      var key = e.eventPhase === e.CAPTURING_PHASE || e.eventPhase === e.AT_TARGET ? \"\".concat(type, \"capture\") : type;\n      this.notifyListeners(e, key);\n      if (e.eventPhase === e.AT_TARGET) {\n        this.notifyListeners(e, type);\n      }\n    }\n  }, {\n    key: \"notifyListeners\",\n    value: function notifyListeners(e, type) {\n      // hack EventEmitter, stops if the `propagationImmediatelyStopped` flag is set\n      // @ts-ignore\n      var emitter = e.currentTarget.emitter;\n      // @ts-ignore\n      var listeners = emitter._events[type];\n      if (!listeners) return;\n      if ('fn' in listeners) {\n        if (listeners.once) {\n          emitter.removeListener(type, listeners.fn, undefined, true);\n        }\n        listeners.fn.call(e.currentTarget || listeners.context, e);\n        // listeners.fn.call(listeners.context, e);\n      } else {\n        for (var i = 0; i < listeners.length && !e.propagationImmediatelyStopped; i++) {\n          if (listeners[i].once) {\n            emitter.removeListener(type, listeners[i].fn, undefined, true);\n          }\n          listeners[i].fn.call(e.currentTarget || listeners[i].context, e);\n          // listeners[i].fn.call(listeners[i].context, e);\n        }\n      }\n    }\n\n    /**\n     * some detached nodes may exist in propagation path, need to skip them\n     */\n  }, {\n    key: \"findMountedTarget\",\n    value: function findMountedTarget(propagationPath) {\n      if (!propagationPath) {\n        return null;\n      }\n      var currentTarget = propagationPath[propagationPath.length - 1];\n      for (var i = propagationPath.length - 2; i >= 0; i--) {\n        var target = propagationPath[i];\n        if (target === this.rootTarget || Node.isNode(target) && target.parentNode === currentTarget) {\n          currentTarget = propagationPath[i];\n        } else {\n          break;\n        }\n      }\n      return currentTarget;\n    }\n  }, {\n    key: \"getCursor\",\n    value: function getCursor(target) {\n      var tmp = target;\n      while (tmp) {\n        var cursor = isElement(tmp) && tmp.getAttribute('cursor');\n        if (cursor) {\n          return cursor;\n        }\n        tmp = Node.isNode(tmp) && tmp.parentNode;\n      }\n    }\n  }]);\n}();\n\n/**\n * used in following scenes:\n * - g `ctx.measureText`\n * - g-plugin-canvas-picker `ctx.isPointInPath`\n * - g-plugin-device-renderer `ctx.createLinearGradient` and generate texture\n *\n * @see https://blog.scottlogic.com/2020/03/19/offscreen-canvas.html\n */\nvar OffscreenCanvasCreator = /*#__PURE__*/function () {\n  function OffscreenCanvasCreator() {\n    _classCallCheck(this, OffscreenCanvasCreator);\n  }\n  return _createClass(OffscreenCanvasCreator, [{\n    key: \"getOrCreateCanvas\",\n    value: function getOrCreateCanvas(offscreenCanvas, contextAttributes) {\n      if (this.canvas) {\n        return this.canvas;\n      }\n\n      // user-defined offscreen canvas\n      if (offscreenCanvas || runtime.offscreenCanvas) {\n        this.canvas = offscreenCanvas || runtime.offscreenCanvas;\n        this.context = this.canvas.getContext('2d', _objectSpread({\n          willReadFrequently: true\n        }, contextAttributes));\n      } else {\n        try {\n          // OffscreenCanvas2D measureText can be up to 40% faster.\n          this.canvas = new window.OffscreenCanvas(0, 0);\n          this.context = this.canvas.getContext('2d', _objectSpread({\n            willReadFrequently: true\n          }, contextAttributes));\n          if (!this.context || !this.context.measureText) {\n            this.canvas = document.createElement('canvas');\n            this.context = this.canvas.getContext('2d');\n          }\n        } catch (_unused) {\n          this.canvas = document.createElement('canvas');\n          this.context = this.canvas.getContext('2d', _objectSpread({\n            willReadFrequently: true\n          }, contextAttributes));\n        }\n      }\n      this.canvas.width = 10;\n      this.canvas.height = 10;\n      return this.canvas;\n    }\n  }, {\n    key: \"getOrCreateContext\",\n    value: function getOrCreateContext(offscreenCanvas, contextAttributes) {\n      if (this.context) {\n        return this.context;\n      }\n      this.getOrCreateCanvas(offscreenCanvas, contextAttributes);\n      return this.context;\n    }\n  }], [{\n    key: \"createCanvas\",\n    value:\n    /**\n     * @returns new canvas instance\n     */\n    function createCanvas() {\n      try {\n        return new window.OffscreenCanvas(0, 0);\n      } catch (_unused2) {\n        //\n      }\n      try {\n        return document.createElement('canvas');\n      } catch (_unused3) {\n        //\n      }\n      return null;\n    }\n  }]);\n}();\n\n/**\n * why we need re-render\n */\nvar RenderReason = /*#__PURE__*/function (RenderReason) {\n  RenderReason[RenderReason[\"CAMERA_CHANGED\"] = 0] = \"CAMERA_CHANGED\";\n  RenderReason[RenderReason[\"DISPLAY_OBJECT_CHANGED\"] = 1] = \"DISPLAY_OBJECT_CHANGED\";\n  RenderReason[RenderReason[\"NONE\"] = 2] = \"NONE\";\n  return RenderReason;\n}({});\n\n/**\n * Use frame renderer implemented by `g-canvas/svg/webgl`, in every frame we do followings:\n * * update & merge dirty rectangles\n * * begin frame\n * * filter by visible\n * * sort by z-index in scene graph\n * * culling with strategies registered in `g-canvas/webgl`\n * * end frame\n */\nvar RenderingService = /*#__PURE__*/function () {\n  function RenderingService(globalRuntime, context) {\n    _classCallCheck(this, RenderingService);\n    this.inited = false;\n    this.stats = {\n      /**\n       * total display objects in scenegraph\n       */\n      total: 0,\n      /**\n       * number of display objects need to render in current frame\n       */\n      rendered: 0\n    };\n    this.zIndexCounter = 0;\n    this.hooks = {\n      /**\n       * called before any frame rendered\n       */\n      init: new SyncHook(),\n      initAsync: new AsyncParallelHook(),\n      /**\n       * only dirty object which has sth changed will be rendered\n       */\n      dirtycheck: new SyncWaterfallHook(),\n      /**\n       * do culling\n       */\n      cull: new SyncWaterfallHook(),\n      /**\n       * called at beginning of each frame, won't get called if nothing to re-render\n       */\n      beginFrame: new SyncHook(),\n      /**\n       * called before every dirty object get rendered\n       */\n      beforeRender: new SyncHook(),\n      /**\n       * called when every dirty object rendering even it's culled\n       */\n      render: new SyncHook(),\n      /**\n       * called after every dirty object get rendered\n       */\n      afterRender: new SyncHook(),\n      endFrame: new SyncHook(),\n      destroy: new SyncHook(),\n      /**\n       * use async but faster method such as GPU-based picking in `g-plugin-device-renderer`\n       */\n      pick: new AsyncSeriesWaterfallHook(),\n      /**\n       * Unsafe but sync version of pick.\n       */\n      pickSync: new SyncWaterfallHook(),\n      /**\n       * used in event system\n       */\n      pointerDown: new SyncHook(),\n      pointerUp: new SyncHook(),\n      pointerMove: new SyncHook(),\n      pointerOut: new SyncHook(),\n      pointerOver: new SyncHook(),\n      pointerWheel: new SyncHook(),\n      pointerCancel: new SyncHook(),\n      click: new SyncHook()\n    };\n    this.globalRuntime = globalRuntime;\n    this.context = context;\n  }\n  return _createClass(RenderingService, [{\n    key: \"init\",\n    value: function init(callback) {\n      var _this = this;\n      var context = _objectSpread(_objectSpread({}, this.globalRuntime), this.context);\n\n      // register rendering plugins\n      this.context.renderingPlugins.forEach(function (plugin) {\n        plugin.apply(context, _this.globalRuntime);\n      });\n      this.hooks.init.call();\n      if (this.hooks.initAsync.getCallbacksNum() === 0) {\n        this.inited = true;\n        callback();\n      } else {\n        this.hooks.initAsync.promise().then(function () {\n          _this.inited = true;\n          callback();\n        });\n      }\n    }\n  }, {\n    key: \"getStats\",\n    value: function getStats() {\n      return this.stats;\n    }\n\n    /**\n     * Meet the following conditions:\n     * * disable DirtyRectangleRendering\n     * * camera changed\n     */\n  }, {\n    key: \"disableDirtyRectangleRendering\",\n    value: function disableDirtyRectangleRendering() {\n      var renderer = this.context.config.renderer;\n      var _renderer$getConfig = renderer.getConfig(),\n        enableDirtyRectangleRendering = _renderer$getConfig.enableDirtyRectangleRendering;\n      return !enableDirtyRectangleRendering || this.context.renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED);\n    }\n  }, {\n    key: \"render\",\n    value: function render(canvasConfig, frame, rerenderCallback) {\n      var _this2 = this;\n      this.stats.total = 0;\n      this.stats.rendered = 0;\n      this.zIndexCounter = 0;\n      var renderingContext = this.context.renderingContext;\n      this.globalRuntime.sceneGraphService.syncHierarchy(renderingContext.root);\n      this.globalRuntime.sceneGraphService.triggerPendingEvents();\n      if (renderingContext.renderReasons.size && this.inited) {\n        // @ts-ignore\n        renderingContext.dirtyRectangleRenderingDisabled = this.disableDirtyRectangleRendering();\n        var onlyCameraChanged = renderingContext.renderReasons.size === 1 && renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED);\n        var shouldTriggerRenderHooks = !canvasConfig.disableRenderHooks || !(canvasConfig.disableRenderHooks && onlyCameraChanged);\n        if (shouldTriggerRenderHooks) {\n          this.renderDisplayObject(renderingContext.root, canvasConfig, renderingContext);\n        }\n        this.hooks.beginFrame.call(frame);\n        if (shouldTriggerRenderHooks) {\n          renderingContext.renderListCurrentFrame.forEach(function (object) {\n            _this2.hooks.beforeRender.call(object);\n            _this2.hooks.render.call(object);\n            _this2.hooks.afterRender.call(object);\n          });\n        }\n        this.hooks.endFrame.call(frame);\n        renderingContext.renderListCurrentFrame = [];\n        renderingContext.renderReasons.clear();\n        rerenderCallback();\n      }\n\n      // console.log('stats', this.stats);\n    }\n  }, {\n    key: \"renderDisplayObject\",\n    value: function renderDisplayObject(displayObject, canvasConfig, renderingContext) {\n      var _this3 = this;\n      var _canvasConfig$rendere = canvasConfig.renderer.getConfig(),\n        enableDirtyCheck = _canvasConfig$rendere.enableDirtyCheck,\n        enableCulling = _canvasConfig$rendere.enableCulling;\n\n      // TODO: relayout\n\n      // dirtycheck first\n      var renderable = displayObject.renderable;\n      // eslint-disable-next-line no-nested-ternary\n      var objectChanged = enableDirtyCheck ?\n      // @ts-ignore\n      renderable.dirty || renderingContext.dirtyRectangleRenderingDisabled ? displayObject : null : displayObject;\n      if (objectChanged) {\n        var objectToRender = enableCulling ? this.hooks.cull.call(objectChanged, this.context.camera) : objectChanged;\n        if (objectToRender) {\n          this.stats.rendered++;\n          renderingContext.renderListCurrentFrame.push(objectToRender);\n        }\n      }\n      displayObject.renderable.dirty = false;\n      displayObject.sortable.renderOrder = this.zIndexCounter++;\n      this.stats.total++;\n\n      // sort is very expensive, use cached result if possible\n      var sortable = displayObject.sortable;\n      if (sortable.dirty) {\n        this.sort(displayObject, sortable);\n        sortable.dirty = false;\n        sortable.dirtyChildren = [];\n        sortable.dirtyReason = undefined;\n      }\n\n      // recursive rendering its children\n      (sortable.sorted || displayObject.childNodes).forEach(function (child) {\n        _this3.renderDisplayObject(child, canvasConfig, renderingContext);\n      });\n    }\n  }, {\n    key: \"sort\",\n    value: function sort(displayObject, sortable) {\n      if (sortable.sorted && sortable.dirtyReason !== SortReason.Z_INDEX_CHANGED) {\n        // avoid re-sorting the whole children list\n        sortable.dirtyChildren.forEach(function (child) {\n          var index = displayObject.childNodes.indexOf(child);\n          if (index === -1) {\n            // remove from sorted list\n            var _index = sortable.sorted.indexOf(child);\n            if (_index >= 0) {\n              sortable.sorted.splice(_index, 1);\n            }\n          } else if (sortable.sorted.length === 0) {\n            sortable.sorted.push(child);\n          } else {\n            var _index2 = sortedIndex(sortable.sorted, child);\n            sortable.sorted.splice(_index2, 0, child);\n          }\n        });\n      } else {\n        sortable.sorted = displayObject.childNodes.slice().sort(sortByZIndex);\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this.inited = false;\n      this.hooks.destroy.call();\n      this.globalRuntime.sceneGraphService.clearPendingEvents();\n    }\n  }, {\n    key: \"dirtify\",\n    value: function dirtify() {\n      // need re-render\n      this.context.renderingContext.renderReasons.add(RenderReason.DISPLAY_OBJECT_CHANGED);\n    }\n  }]);\n}();\nvar ATTRIBUTE_REGEXP = /\\[\\s*(.*)=(.*)\\s*\\]/;\n\n/**\n * support the following DOM API:\n * * getElementById\n * * getElementsByClassName\n * * getElementsByName\n * * getElementsByTag\n * * querySelector\n * * querySelectorAll\n */\nvar DefaultSceneGraphSelector = /*#__PURE__*/function () {\n  function DefaultSceneGraphSelector() {\n    _classCallCheck(this, DefaultSceneGraphSelector);\n  }\n  return _createClass(DefaultSceneGraphSelector, [{\n    key: \"selectOne\",\n    value: function selectOne(query, root) {\n      var _this = this;\n      if (query.startsWith('.')) {\n        return root.find(function (node) {\n          // return !node.shadow && node.id === query.substring(1);\n          return ((node === null || node === void 0 ? void 0 : node.classList) || []).indexOf(_this.getIdOrClassname(query)) > -1;\n        });\n      }\n      if (query.startsWith('#')) {\n        // getElementById('id')\n        return root.find(function (node) {\n          // return !node.shadow && node.id === query.substring(1);\n          return node.id === _this.getIdOrClassname(query);\n        });\n      }\n      if (query.startsWith('[')) {\n        var _this$getAttribute = this.getAttribute(query),\n          name = _this$getAttribute.name,\n          value = _this$getAttribute.value;\n        if (name) {\n          // getElementByName();\n          return root.find(function (node) {\n            return root !== node && (name === 'name' ? node.name === value : _this.attributeToString(node, name) === value);\n          });\n        }\n        return null;\n      }\n      // getElementsByTag('circle');\n      return root.find(function (node) {\n        return root !== node && node.nodeName === query;\n      });\n    }\n  }, {\n    key: \"selectAll\",\n    value: function selectAll(query, root) {\n      var _this2 = this;\n      // only support `[name=\"${name}\"]` `.className` `#id`\n      if (query.startsWith('.')) {\n        // getElementsByClassName('className');\n        // should not include itself\n        return root.findAll(function (node) {\n          return root !== node && ((node === null || node === void 0 ? void 0 : node.classList) || []).indexOf(_this2.getIdOrClassname(query)) > -1;\n        });\n      }\n      if (query.startsWith('#')) {\n        return root.findAll(function (node) {\n          return root !== node && node.id === _this2.getIdOrClassname(query);\n        });\n      }\n      if (query.startsWith('[')) {\n        var _this$getAttribute2 = this.getAttribute(query),\n          name = _this$getAttribute2.name,\n          value = _this$getAttribute2.value;\n        if (name) {\n          // getElementsByName();\n          return root.findAll(function (node) {\n            return root !== node && (name === 'name' ? node.name === value : _this2.attributeToString(node, name) === value);\n          });\n        }\n        return [];\n      }\n      // getElementsByTag('circle');\n      return root.findAll(function (node) {\n        return root !== node && node.nodeName === query;\n      });\n    }\n  }, {\n    key: \"is\",\n    value: function is(query, node) {\n      // a simple `matches` implementation\n      if (query.startsWith('.')) {\n        return node.className === this.getIdOrClassname(query);\n      }\n      if (query.startsWith('#')) {\n        return node.id === this.getIdOrClassname(query);\n      }\n      if (query.startsWith('[')) {\n        var _this$getAttribute3 = this.getAttribute(query),\n          name = _this$getAttribute3.name,\n          value = _this$getAttribute3.value;\n        return name === 'name' ? node.name === value : this.attributeToString(node, name) === value;\n      }\n      return node.nodeName === query;\n    }\n  }, {\n    key: \"getIdOrClassname\",\n    value: function getIdOrClassname(query) {\n      return query.substring(1);\n    }\n  }, {\n    key: \"getAttribute\",\n    value: function getAttribute(query) {\n      var matches = query.match(ATTRIBUTE_REGEXP);\n      var name = '';\n      var value = '';\n      if (matches && matches.length > 2) {\n        name = matches[1].replace(/\"/g, '');\n        value = matches[2].replace(/\"/g, '');\n      }\n      return {\n        name: name,\n        value: value\n      };\n    }\n  }, {\n    key: \"attributeToString\",\n    value: function attributeToString(node, name) {\n      if (!node.getAttribute) {\n        return '';\n      }\n      var value = node.getAttribute(name);\n      if (isNil(value)) {\n        return '';\n      }\n      if (value.toString) {\n        return value.toString();\n      }\n      return '';\n    }\n  }]);\n}();\n\n/**\n * built-in events for element\n * @see https://developer.mozilla.org/en-US/docs/Web/API/MutationEvent\n *\n * TODO: use MutationObserver instead\n * @see https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n */\nvar ElementEvent = /*#__PURE__*/function (ElementEvent) {\n  ElementEvent[\"REPARENT\"] = \"reparent\";\n  ElementEvent[\"DESTROY\"] = \"destroy\";\n  ElementEvent[\"ATTR_MODIFIED\"] = \"DOMAttrModified\";\n  ElementEvent[\"INSERTED\"] = \"DOMNodeInserted\";\n  ElementEvent[\"REMOVED\"] = \"removed\";\n  ElementEvent[\"MOUNTED\"] = \"DOMNodeInsertedIntoDocument\";\n  ElementEvent[\"UNMOUNTED\"] = \"DOMNodeRemovedFromDocument\";\n  ElementEvent[\"BOUNDS_CHANGED\"] = \"bounds-changed\";\n  ElementEvent[\"CULLED\"] = \"culled\";\n  return ElementEvent;\n}({});\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/API/CSSStyleDeclaration\n */\n\nvar MutationEvent = /*#__PURE__*/function (_FederatedEvent) {\n  function MutationEvent(typeArg, relatedNode, prevValue, newValue, attrName, attrChange, prevParsedValue, newParsedValue) {\n    var _this;\n    _classCallCheck(this, MutationEvent);\n    _this = _callSuper(this, MutationEvent, [null]);\n    _this.relatedNode = relatedNode;\n    _this.prevValue = prevValue;\n    _this.newValue = newValue;\n    _this.attrName = attrName;\n    _this.attrChange = attrChange;\n    _this.prevParsedValue = prevParsedValue;\n    _this.newParsedValue = newParsedValue;\n    _this.type = typeArg;\n    return _this;\n  }\n  _inherits(MutationEvent, _FederatedEvent);\n  return _createClass(MutationEvent);\n}(FederatedEvent);\nMutationEvent.ADDITION = 2;\nMutationEvent.MODIFICATION = 1;\nMutationEvent.REMOVAL = 3;\nfunction markRenderableDirty(e) {\n  var renderable = e.renderable;\n  if (renderable) {\n    renderable.renderBoundsDirty = true;\n    renderable.boundsDirty = true;\n  }\n}\nvar reparentEvent = new MutationEvent(ElementEvent.REPARENT, null, '', '', '', 0, '', '');\n\n// Object pooling\n/** do not modify this objects */\nvar $vec2Zero = vec2.create();\n/** do not modify this objects */\nvar $vec3Zero = vec3.create();\n/** do not modify this objects */\nvar $vec3One = vec3.fromValues(1, 1, 1);\n/** do not modify this objects */\nvar $mat4Identity = mat4.create();\n\n/** shared objects */\nvar $vec2 = vec2.create();\n/** shared objects */\nvar $vec3$1 = vec3.create();\n/** shared objects */\nvar $mat4 = mat4.create();\n/** shared objects */\nvar $quat$1 = quat$1.create();\nvar $setLocalTransform_1 = vec3.create();\nvar $setLocalTransform_2 = quat$1.create();\nvar $setLocalTransform_3 = vec3.create();\nvar $setLocalPosition = vec3.create();\nvar $setPosition_1 = vec3.create();\nvar $setPosition_ParentInvertMatrix = mat4.create();\nvar $setEulerAngles_InvParentRot = quat$1.create();\nvar $rotateLocal = quat$1.create();\nvar $rotate_ParentInvertRotation = quat$1.create();\nvar $triggerPendingEvents_detail = {\n  affectChildren: true\n};\n\n/**\n * update transform in scene graph\n *\n * @see https://community.khronos.org/t/scene-graphs/50542/7\n */\nvar DefaultSceneGraphService = /*#__PURE__*/function () {\n  function DefaultSceneGraphService(runtime) {\n    _classCallCheck(this, DefaultSceneGraphService);\n    // target -> affectChildren\n    this.pendingEvents = new Map();\n    this.boundsChangedEvent = new CustomEvent(ElementEvent.BOUNDS_CHANGED);\n    this.displayObjectDependencyMap = new WeakMap();\n    this.runtime = runtime;\n  }\n  return _createClass(DefaultSceneGraphService, [{\n    key: \"matches\",\n    value: function matches(query, root) {\n      return this.runtime.sceneGraphSelector.is(query, root);\n    }\n  }, {\n    key: \"querySelector\",\n    value: function querySelector(query, root) {\n      return this.runtime.sceneGraphSelector.selectOne(query, root);\n    }\n  }, {\n    key: \"querySelectorAll\",\n    value: function querySelectorAll(query, root) {\n      return this.runtime.sceneGraphSelector.selectAll(query, root);\n      // .filter((node) => !node.shadow);\n    }\n  }, {\n    key: \"attach\",\n    value: function attach(child, parent, index) {\n      var _sortable$sorted;\n      var detached = false;\n      if (child.parentNode) {\n        detached = child.parentNode !== parent;\n        this.detach(child);\n      }\n      var isChildFragment = child.nodeName === Shape.FRAGMENT;\n      var isAttachToFragment = isInFragment(parent);\n      child.parentNode = parent;\n      var nodes = isChildFragment ? child.childNodes : [child];\n      if (isNumber(index)) {\n        nodes.forEach(function (node) {\n          parent.childNodes.splice(index, 0, node);\n          node.parentNode = parent;\n        });\n      } else {\n        nodes.forEach(function (node) {\n          parent.childNodes.push(node);\n          node.parentNode = parent;\n        });\n      }\n\n      // parent needs re-sort\n      var _ref = parent,\n        sortable = _ref.sortable;\n      if (sortable !== null && sortable !== void 0 && (_sortable$sorted = sortable.sorted) !== null && _sortable$sorted !== void 0 && _sortable$sorted.length || child.parsedStyle.zIndex) {\n        if (sortable.dirtyChildren.indexOf(child) === -1) {\n          sortable.dirtyChildren.push(child);\n        }\n        // if (sortable) {\n        // only child has z-Index\n        sortable.dirty = true;\n        sortable.dirtyReason = SortReason.ADDED;\n      }\n      if (isAttachToFragment) return;\n      if (isChildFragment) this.dirtifyFragment(child);else {\n        var transform = child.transformable;\n        if (transform) {\n          this.dirtifyWorld(child, transform);\n        }\n      }\n      if (detached) {\n        child.dispatchEvent(reparentEvent);\n      }\n    }\n  }, {\n    key: \"detach\",\n    value: function detach(child) {\n      if (child.parentNode) {\n        var _sortable$sorted2, _style;\n        var transform = child.transformable;\n        // if (transform) {\n        //   const worldTransform = this.getWorldTransform(child, transform);\n        //   mat4.getScaling(transform.localScale, worldTransform);\n        //   mat4.getTranslation(transform.localPosition, worldTransform);\n        //   mat4.getRotation(transform.localRotation, worldTransform);\n        //   transform.localDirtyFlag = true;\n        // }\n\n        // parent needs re-sort\n        var _ref2 = child.parentNode,\n          sortable = _ref2.sortable;\n        // if (sortable) {\n        if (sortable !== null && sortable !== void 0 && (_sortable$sorted2 = sortable.sorted) !== null && _sortable$sorted2 !== void 0 && _sortable$sorted2.length || (_style = child.style) !== null && _style !== void 0 && _style.zIndex) {\n          if (sortable.dirtyChildren.indexOf(child) === -1) {\n            sortable.dirtyChildren.push(child);\n          }\n          sortable.dirty = true;\n          sortable.dirtyReason = SortReason.REMOVED;\n        }\n        var index = child.parentNode.childNodes.indexOf(child);\n        if (index > -1) {\n          child.parentNode.childNodes.splice(index, 1);\n        }\n        if (transform) {\n          this.dirtifyWorld(child, transform);\n        }\n        child.parentNode = null;\n      }\n    }\n  }, {\n    key: \"getOrigin\",\n    value: function getOrigin(element) {\n      element.getGeometryBounds();\n      return element.transformable.origin;\n    }\n\n    /**\n     * same as pivot in Pixi.js\n     *\n     * @see https://stackoverflow.com/questions/40748452/how-to-change-css-transform-origin-but-preserve-transformation\n     */\n  }, {\n    key: \"setOrigin\",\n    value: function setOrigin(element, origin) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      if (typeof origin === 'number') {\n        origin = [origin, y, z];\n      }\n      var transform = element.transformable;\n      if (origin[0] === transform.origin[0] && origin[1] === transform.origin[1] && origin[2] === transform.origin[2]) {\n        return;\n      }\n      var originVec = transform.origin;\n\n      // const delta = vec3.subtract(vec3.create(), origin, originVec);\n      // vec3.add(transform.localPosition, transform.localPosition, delta);\n\n      // update origin\n      originVec[0] = origin[0];\n      originVec[1] = origin[1];\n      originVec[2] = origin[2] || 0;\n      this.dirtifyLocal(element, transform);\n    }\n\n    /**\n     * rotate in world space\n     */\n  }, {\n    key: \"rotate\",\n    value: function rotate(element, degrees) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      if (typeof degrees === 'number') {\n        degrees = vec3.fromValues(degrees, y, z);\n      }\n      var transform = element.transformable;\n      if (element.parentNode === null || !element.parentNode.transformable) {\n        this.rotateLocal(element, degrees);\n      } else {\n        var rotation = $quat$1;\n        quat$1.fromEuler(rotation, degrees[0], degrees[1], degrees[2]);\n        var rot = this.getRotation(element);\n        var parentRot = this.getRotation(element.parentNode);\n        quat$1.copy($rotate_ParentInvertRotation, parentRot);\n        quat$1.invert($rotate_ParentInvertRotation, $rotate_ParentInvertRotation);\n        quat$1.multiply(rotation, $rotate_ParentInvertRotation, rotation);\n        quat$1.multiply(transform.localRotation, rotation, rot);\n        quat$1.normalize(transform.localRotation, transform.localRotation);\n        this.dirtifyLocal(element, transform);\n      }\n    }\n\n    /**\n     * rotate in local space\n     * @see @see https://docs.microsoft.com/en-us/windows/win32/api/directxmath/nf-directxmath-xmquaternionrotationrollpitchyaw\n     */\n  }, {\n    key: \"rotateLocal\",\n    value: function rotateLocal(element, degrees) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      if (typeof degrees === 'number') {\n        degrees = vec3.fromValues(degrees, y, z);\n      }\n      var transform = element.transformable;\n      quat$1.fromEuler($rotateLocal, degrees[0], degrees[1], degrees[2]);\n      quat$1.mul(transform.localRotation, transform.localRotation, $rotateLocal);\n      this.dirtifyLocal(element, transform);\n    }\n\n    /**\n     * set euler angles(degrees) in world space\n     */\n  }, {\n    key: \"setEulerAngles\",\n    value: function setEulerAngles(element, degrees) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      if (typeof degrees === 'number') {\n        degrees = vec3.fromValues(degrees, y, z);\n      }\n      var transform = element.transformable;\n      if (element.parentNode === null || !element.parentNode.transformable) {\n        this.setLocalEulerAngles(element, degrees);\n      } else {\n        quat$1.fromEuler(transform.localRotation, degrees[0], degrees[1], degrees[2]);\n        var parentRotation = this.getRotation(element.parentNode);\n        quat$1.copy($setEulerAngles_InvParentRot, quat$1.invert($quat$1, parentRotation));\n        quat$1.mul(transform.localRotation, transform.localRotation, $setEulerAngles_InvParentRot);\n        this.dirtifyLocal(element, transform);\n      }\n    }\n\n    /**\n     * set euler angles(degrees) in local space\n     */\n  }, {\n    key: \"setLocalEulerAngles\",\n    value: function setLocalEulerAngles(element, degrees) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var dirtify = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : true;\n      if (typeof degrees === 'number') {\n        degrees = vec3.fromValues(degrees, y, z);\n      }\n      var transform = element.transformable;\n      quat$1.fromEuler(transform.localRotation, degrees[0], degrees[1], degrees[2]);\n      if (dirtify) {\n        this.dirtifyLocal(element, transform);\n      }\n    }\n\n    /**\n     * translate in local space\n     *\n     * @example\n     * ```\n     * translateLocal(x, y, z)\n     * translateLocal(vec3(x, y, z))\n     * ```\n     */\n  }, {\n    key: \"translateLocal\",\n    value: function translateLocal(element, translation) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      if (typeof translation === 'number') {\n        translation = vec3.fromValues(translation, y, z);\n      }\n      var transform = element.transformable;\n      if (vec3.equals(translation, $vec3Zero)) return;\n      vec3.transformQuat(translation, translation, transform.localRotation);\n      vec3.add(transform.localPosition, transform.localPosition, translation);\n      this.dirtifyLocal(element, transform);\n    }\n\n    /**\n     * move to position in world space\n     *\n     * 对应 g 原版的 move/moveTo\n     * @see https://github.com/antvis/g/blob/master/packages/g-base/src/abstract/element.ts#L684-L689\n     */\n  }, {\n    key: \"setPosition\",\n    value: function setPosition(element, position) {\n      var _position$;\n      var transform = element.transformable;\n      $setPosition_1[0] = position[0];\n      $setPosition_1[1] = position[1];\n      $setPosition_1[2] = (_position$ = position[2]) !== null && _position$ !== void 0 ? _position$ : 0;\n      if (vec3.equals(this.getPosition(element), $setPosition_1)) {\n        return;\n      }\n      vec3.copy(transform.position, $setPosition_1);\n      if (element.parentNode === null || !element.parentNode.transformable) {\n        vec3.copy(transform.localPosition, $setPosition_1);\n      } else {\n        var parentTransform = element.parentNode.transformable;\n        mat4.copy($setPosition_ParentInvertMatrix, parentTransform.worldTransform);\n        mat4.invert($setPosition_ParentInvertMatrix, $setPosition_ParentInvertMatrix);\n        vec3.transformMat4(transform.localPosition, $setPosition_1, $setPosition_ParentInvertMatrix);\n      }\n      this.dirtifyLocal(element, transform);\n    }\n\n    /**\n     * move to position in local space\n     */\n  }, {\n    key: \"setLocalPosition\",\n    value: function setLocalPosition(element, position) {\n      var _position$2;\n      var dirtify = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      var transform = element.transformable;\n      $setLocalPosition[0] = position[0];\n      $setLocalPosition[1] = position[1];\n      $setLocalPosition[2] = (_position$2 = position[2]) !== null && _position$2 !== void 0 ? _position$2 : 0;\n      if (vec3.equals(transform.localPosition, $setLocalPosition)) {\n        return;\n      }\n      vec3.copy(transform.localPosition, $setLocalPosition);\n      if (dirtify) {\n        this.dirtifyLocal(element, transform);\n      }\n    }\n\n    /**\n     * scale in local space\n     */\n  }, {\n    key: \"scaleLocal\",\n    value: function scaleLocal(element, scaling) {\n      var _scaling$;\n      var transform = element.transformable;\n      vec3.multiply(transform.localScale, transform.localScale, vec3.set($vec3$1, scaling[0], scaling[1], (_scaling$ = scaling[2]) !== null && _scaling$ !== void 0 ? _scaling$ : 1));\n      this.dirtifyLocal(element, transform);\n    }\n  }, {\n    key: \"setLocalScale\",\n    value: function setLocalScale(element, scaling) {\n      var _scaling$2;\n      var dirtify = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      var transform = element.transformable;\n      vec3.set($vec3$1, scaling[0], scaling[1], (_scaling$2 = scaling[2]) !== null && _scaling$2 !== void 0 ? _scaling$2 : transform.localScale[2]);\n      if (vec3.equals($vec3$1, transform.localScale)) {\n        return;\n      }\n      vec3.copy(transform.localScale, $vec3$1);\n      if (dirtify) {\n        this.dirtifyLocal(element, transform);\n      }\n    }\n\n    /**\n     * translate in world space\n     *\n     * @example\n     * ```\n     * translate(x, y, z)\n     * translate(vec3(x, y, z))\n     * ```\n     *\n     * 对应 g 原版的 translate 2D\n     * @see https://github.com/antvis/g/blob/master/packages/g-base/src/abstract/element.ts#L665-L676\n     */\n  }, {\n    key: \"translate\",\n    value: function translate(element, translation) {\n      var y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var z = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      if (typeof translation === 'number') {\n        translation = vec3.set($vec3$1, translation, y, z);\n      }\n      if (vec3.equals(translation, $vec3Zero)) return;\n      vec3.add($vec3$1, this.getPosition(element), translation);\n      this.setPosition(element, $vec3$1);\n    }\n  }, {\n    key: \"setRotation\",\n    value: function setRotation(element, rotation, y, z, w) {\n      var transform = element.transformable;\n      if (typeof rotation === 'number') {\n        rotation = quat$1.fromValues(rotation, y, z, w);\n      }\n      if (element.parentNode === null || !element.parentNode.transformable) {\n        this.setLocalRotation(element, rotation);\n      } else {\n        var parentRot = this.getRotation(element.parentNode);\n        quat$1.copy($quat$1, parentRot);\n        quat$1.invert($quat$1, $quat$1);\n        quat$1.multiply(transform.localRotation, $quat$1, rotation);\n        quat$1.normalize(transform.localRotation, transform.localRotation);\n        this.dirtifyLocal(element, transform);\n      }\n    }\n  }, {\n    key: \"setLocalRotation\",\n    value: function setLocalRotation(element, rotation, y, z, w) {\n      var dirtify = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : true;\n      if (typeof rotation === 'number') {\n        rotation = quat$1.set($quat$1, rotation, y, z, w);\n      }\n      var transform = element.transformable;\n      quat$1.copy(transform.localRotation, rotation);\n      if (dirtify) {\n        this.dirtifyLocal(element, transform);\n      }\n    }\n  }, {\n    key: \"setLocalSkew\",\n    value: function setLocalSkew(element, skew, y) {\n      var dirtify = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      if (typeof skew === 'number') {\n        skew = vec2.set($vec2, skew, y);\n      }\n      var transform = element.transformable;\n      vec2.copy(transform.localSkew, skew);\n      if (dirtify) {\n        this.dirtifyLocal(element, transform);\n      }\n    }\n  }, {\n    key: \"dirtifyLocal\",\n    value: function dirtifyLocal(element, transform) {\n      if (isInFragment(element)) return;\n      if (!transform.localDirtyFlag) {\n        transform.localDirtyFlag = true;\n        if (!transform.dirtyFlag) {\n          this.dirtifyWorld(element, transform);\n        }\n      }\n    }\n  }, {\n    key: \"dirtifyWorld\",\n    value: function dirtifyWorld(element, transform) {\n      if (!transform.dirtyFlag) {\n        this.unfreezeParentToRoot(element);\n      }\n      this.dirtifyWorldInternal(element, transform);\n      this.dirtifyToRoot(element, true);\n    }\n  }, {\n    key: \"dirtifyFragment\",\n    value: function dirtifyFragment(element) {\n      var transform = element.transformable;\n      if (transform) {\n        transform.frozen = false;\n        transform.dirtyFlag = true;\n        transform.localDirtyFlag = true;\n      }\n      var renderable = element.renderable;\n      if (renderable) {\n        renderable.renderBoundsDirty = true;\n        renderable.boundsDirty = true;\n        renderable.dirty = true;\n      }\n      var length = element.childNodes.length;\n      for (var i = 0; i < length; i++) {\n        this.dirtifyFragment(element.childNodes[i]);\n      }\n      if (element.nodeName === Shape.FRAGMENT) {\n        this.pendingEvents.set(element, false);\n      }\n    }\n  }, {\n    key: \"triggerPendingEvents\",\n    value: function triggerPendingEvents() {\n      var _this = this;\n      var triggered = new Set();\n      var skipped = new Set();\n      this.pendingEvents.forEach(function (_, element) {\n        if (element.nodeName === Shape.FRAGMENT) {\n          element.forEach(function (e) {\n            if (e !== element) skipped.add(e);\n          });\n        }\n      });\n      var trigger = function trigger(element, detail) {\n        if (element.isConnected && !triggered.has(element) && !skipped.has(element)) {\n          _this.boundsChangedEvent.detail = detail;\n          _this.boundsChangedEvent.target = element;\n          if (element.isMutationObserved) {\n            element.dispatchEvent(_this.boundsChangedEvent);\n          } else {\n            element.ownerDocument.defaultView.dispatchEvent(_this.boundsChangedEvent, true);\n          }\n          triggered.add(element);\n        }\n      };\n      this.pendingEvents.forEach(function (affectChildren, element) {\n        $triggerPendingEvents_detail.affectChildren = affectChildren;\n        if (affectChildren) {\n          element.forEach(function (e) {\n            trigger(e, $triggerPendingEvents_detail);\n          });\n        } else trigger(element, $triggerPendingEvents_detail);\n      });\n      triggered.clear();\n      skipped.clear();\n      this.clearPendingEvents();\n    }\n  }, {\n    key: \"clearPendingEvents\",\n    value: function clearPendingEvents() {\n      this.pendingEvents.clear();\n    }\n  }, {\n    key: \"dirtifyToRoot\",\n    value: function dirtifyToRoot(element) {\n      var affectChildren = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var p = element;\n\n      // only need to re-render itself\n      if (p.renderable) {\n        p.renderable.dirty = true;\n      }\n      while (p) {\n        markRenderableDirty(p);\n        p = p.parentNode;\n      }\n      if (affectChildren) {\n        element.forEach(function (e) {\n          markRenderableDirty(e);\n        });\n      }\n      this.informDependentDisplayObjects(element);\n      this.pendingEvents.set(element, affectChildren);\n    }\n  }, {\n    key: \"updateDisplayObjectDependency\",\n    value: function updateDisplayObjectDependency(name, oldPath, newPath, object) {\n      // clear ref to old clip path\n      if (oldPath && oldPath !== newPath) {\n        var oldDependencyMap = this.displayObjectDependencyMap.get(oldPath);\n        if (oldDependencyMap && oldDependencyMap[name]) {\n          var index = oldDependencyMap[name].indexOf(object);\n          oldDependencyMap[name].splice(index, 1);\n        }\n      }\n      if (newPath) {\n        var newDependencyMap = this.displayObjectDependencyMap.get(newPath);\n        if (!newDependencyMap) {\n          this.displayObjectDependencyMap.set(newPath, {});\n          newDependencyMap = this.displayObjectDependencyMap.get(newPath);\n        }\n        if (!newDependencyMap[name]) {\n          newDependencyMap[name] = [];\n        }\n        newDependencyMap[name].push(object);\n      }\n    }\n  }, {\n    key: \"informDependentDisplayObjects\",\n    value: function informDependentDisplayObjects(object) {\n      var _this2 = this;\n      var dependencyMap = this.displayObjectDependencyMap.get(object);\n      if (dependencyMap) {\n        Object.keys(dependencyMap).forEach(function (name) {\n          dependencyMap[name].forEach(function (target) {\n            _this2.dirtifyToRoot(target, true);\n            target.dispatchEvent(new MutationEvent(ElementEvent.ATTR_MODIFIED, target, _this2, _this2, name, MutationEvent.MODIFICATION, _this2, _this2));\n            if (target.isCustomElement && target.isConnected) {\n              if (target.attributeChangedCallback) {\n                target.attributeChangedCallback(name, _this2, _this2);\n              }\n            }\n          });\n        });\n      }\n    }\n  }, {\n    key: \"getPosition\",\n    value: function getPosition(element) {\n      var transform = element.transformable;\n      return mat4.getTranslation(transform.position, this.getWorldTransform(element, transform));\n    }\n  }, {\n    key: \"getRotation\",\n    value: function getRotation(element) {\n      var transform = element.transformable;\n      return mat4.getRotation(transform.rotation, this.getWorldTransform(element, transform));\n    }\n  }, {\n    key: \"getScale\",\n    value: function getScale(element) {\n      var transform = element.transformable;\n      return mat4.getScaling(transform.scaling, this.getWorldTransform(element, transform));\n    }\n  }, {\n    key: \"getWorldTransform\",\n    value: function getWorldTransform(element) {\n      var transform = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : element.transformable;\n      if (!transform.localDirtyFlag && !transform.dirtyFlag) {\n        return transform.worldTransform;\n      }\n      if (element.parentNode && element.parentNode.transformable) {\n        this.getWorldTransform(element.parentNode);\n      }\n      this.sync(element, transform);\n      return transform.worldTransform;\n    }\n  }, {\n    key: \"getLocalPosition\",\n    value: function getLocalPosition(element) {\n      return element.transformable.localPosition;\n    }\n  }, {\n    key: \"getLocalRotation\",\n    value: function getLocalRotation(element) {\n      return element.transformable.localRotation;\n    }\n  }, {\n    key: \"getLocalScale\",\n    value: function getLocalScale(element) {\n      return element.transformable.localScale;\n    }\n  }, {\n    key: \"getLocalSkew\",\n    value: function getLocalSkew(element) {\n      return element.transformable.localSkew;\n    }\n  }, {\n    key: \"calcLocalTransform\",\n    value: function calcLocalTransform(transform) {\n      var hasSkew = transform.localSkew[0] !== 0 || transform.localSkew[1] !== 0;\n      if (hasSkew) {\n        mat4.fromRotationTranslationScaleOrigin(transform.localTransform, transform.localRotation, transform.localPosition, vec3.fromValues(1, 1, 1), transform.origin);\n\n        // apply skew2D\n        if (transform.localSkew[0] !== 0 || transform.localSkew[1] !== 0) {\n          mat4.identity($mat4);\n          $mat4[4] = Math.tan(transform.localSkew[0]);\n          $mat4[1] = Math.tan(transform.localSkew[1]);\n          mat4.multiply(transform.localTransform, transform.localTransform, $mat4);\n        }\n        var scaling = mat4.fromRotationTranslationScaleOrigin($mat4, quat$1.set($quat$1, 0, 0, 0, 1), vec3.set($vec3$1, 1, 1, 1), transform.localScale, transform.origin);\n        mat4.multiply(transform.localTransform, transform.localTransform, scaling);\n      } else {\n        var localTransform = transform.localTransform,\n          localPosition = transform.localPosition,\n          localRotation = transform.localRotation,\n          localScale = transform.localScale,\n          origin = transform.origin;\n        var hasPosition = localPosition[0] !== 0 || localPosition[1] !== 0 || localPosition[2] !== 0;\n        var hasRotation = localRotation[3] !== 1 || localRotation[0] !== 0 || localRotation[1] !== 0 || localRotation[2] !== 0;\n        var hasScale = localScale[0] !== 1 || localScale[1] !== 1 || localScale[2] !== 1;\n        var hasOrigin = origin[0] !== 0 || origin[1] !== 0 || origin[2] !== 0;\n        if (!hasRotation && !hasScale && !hasOrigin) {\n          if (hasPosition) {\n            mat4.fromTranslation(localTransform, localPosition);\n          } else {\n            mat4.identity(localTransform);\n          }\n        } else {\n          // @see https://github.com/mattdesl/css-mat4/blob/master/index.js\n          mat4.fromRotationTranslationScaleOrigin(localTransform, localRotation, localPosition, localScale, origin);\n        }\n      }\n    }\n  }, {\n    key: \"getLocalTransform\",\n    value: function getLocalTransform(element) {\n      var transform = element.transformable;\n      if (transform.localDirtyFlag) {\n        this.calcLocalTransform(transform);\n        transform.localDirtyFlag = false;\n      }\n      return transform.localTransform;\n    }\n  }, {\n    key: \"setLocalTransform\",\n    value: function setLocalTransform(element, transform) {\n      var t = mat4.getTranslation($setLocalTransform_1, transform);\n      var r = mat4.getRotation($setLocalTransform_2, transform);\n      var s = mat4.getScaling($setLocalTransform_3, transform);\n      this.setLocalScale(element, s, false);\n      this.setLocalPosition(element, t, false);\n      this.setLocalRotation(element, r, undefined, undefined, undefined, false);\n      this.dirtifyLocal(element, element.transformable);\n    }\n  }, {\n    key: \"resetLocalTransform\",\n    value: function resetLocalTransform(element) {\n      this.setLocalScale(element, $vec3One, false);\n      this.setLocalPosition(element, $vec3Zero, false);\n      this.setLocalEulerAngles(element, $vec3Zero, undefined, undefined, false);\n      this.setLocalSkew(element, $vec2Zero, undefined, false);\n      this.dirtifyLocal(element, element.transformable);\n    }\n  }, {\n    key: \"getTransformedGeometryBounds\",\n    value: function getTransformedGeometryBounds(element) {\n      var render = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var existedAABB = arguments.length > 2 ? arguments[2] : undefined;\n      var bounds = this.getGeometryBounds(element, render);\n      if (!AABB.isEmpty(bounds)) {\n        var aabb = existedAABB || new AABB();\n        aabb.setFromTransformedAABB(bounds, this.getWorldTransform(element));\n        return aabb;\n      }\n      return null;\n    }\n\n    /**\n     * won't account for children\n     */\n  }, {\n    key: \"getGeometryBounds\",\n    value: function getGeometryBounds(element) {\n      var render = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var _ref3 = element,\n        geometry = _ref3.geometry;\n      if (geometry.dirty) {\n        runtime.styleValueRegistry.updateGeometry(element);\n      }\n      var bounds = render ? geometry.renderBounds : geometry.contentBounds || null;\n      // return (bounds && new AABB(bounds.center, bounds.halfExtents)) || new AABB();\n      return bounds || new AABB();\n    }\n\n    /**\n     * account for children in world space\n     */\n  }, {\n    key: \"getBounds\",\n    value: function getBounds(element) {\n      var _this3 = this;\n      var render = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var _ref4 = element,\n        renderable = _ref4.renderable;\n      if (!renderable.boundsDirty && !render && renderable.bounds) {\n        return renderable.bounds;\n      }\n      if (!renderable.renderBoundsDirty && render && renderable.renderBounds) {\n        return renderable.renderBounds;\n      }\n\n      // reuse existed if possible\n      var existedAABB = render ? renderable.renderBounds : renderable.bounds;\n\n      // reset with geometry's aabb\n      var aabb = this.getTransformedGeometryBounds(element, render, existedAABB);\n\n      // merge children's aabbs\n      var children = element.childNodes;\n      children.forEach(function (child) {\n        var childBounds = _this3.getBounds(child, render);\n        if (childBounds) {\n          if (!aabb) {\n            aabb = existedAABB || new AABB();\n            aabb.update(childBounds.center, childBounds.halfExtents);\n          } else {\n            aabb.add(childBounds);\n          }\n        }\n      });\n      if (!aabb) {\n        aabb = new AABB();\n      }\n      if (render) {\n        // FIXME: account for clip path\n        var clipped = findClosestClipPathTarget(element);\n        if (clipped) {\n          // use bounds under world space\n          var clipPathBounds = clipped.parsedStyle.clipPath.getBounds(render);\n          if (!aabb) {\n            aabb.update(clipPathBounds.center, clipPathBounds.halfExtents);\n          } else if (clipPathBounds) {\n            aabb = clipPathBounds.intersection(aabb);\n          }\n        }\n      }\n      if (render) {\n        renderable.renderBounds = aabb;\n        renderable.renderBoundsDirty = false;\n      } else {\n        renderable.bounds = aabb;\n        renderable.boundsDirty = false;\n      }\n      return aabb;\n    }\n\n    /**\n     * account for children in local space\n     */\n  }, {\n    key: \"getLocalBounds\",\n    value: function getLocalBounds(element) {\n      if (element.parentNode) {\n        var parentInvert = $mat4Identity;\n        if (element.parentNode.transformable) {\n          parentInvert = mat4.invert($mat4, this.getWorldTransform(element.parentNode));\n        }\n        var bounds = this.getBounds(element);\n        if (!AABB.isEmpty(bounds)) {\n          var localBounds = new AABB();\n          localBounds.setFromTransformedAABB(bounds, parentInvert);\n          return localBounds;\n        }\n      }\n      return this.getBounds(element);\n    }\n  }, {\n    key: \"getBoundingClientRect\",\n    value: function getBoundingClientRect(element) {\n      var _element$ownerDocumen;\n      var aabb;\n      var bounds = this.getGeometryBounds(element);\n      if (!AABB.isEmpty(bounds)) {\n        aabb = new AABB();\n        // apply transformation to aabb\n        aabb.setFromTransformedAABB(bounds, this.getWorldTransform(element));\n      }\n\n      // calc context's offset\n      var bbox = (_element$ownerDocumen = element.ownerDocument) === null || _element$ownerDocumen === void 0 || (_element$ownerDocumen = _element$ownerDocumen.defaultView) === null || _element$ownerDocumen === void 0 ? void 0 : _element$ownerDocumen.getContextService().getBoundingClientRect();\n      if (aabb) {\n        var _aabb$getMin = aabb.getMin(),\n          _aabb$getMin2 = _slicedToArray(_aabb$getMin, 2),\n          left = _aabb$getMin2[0],\n          top = _aabb$getMin2[1];\n        var _aabb$getMax = aabb.getMax(),\n          _aabb$getMax2 = _slicedToArray(_aabb$getMax, 2),\n          right = _aabb$getMax2[0],\n          bottom = _aabb$getMax2[1];\n        return new Rectangle(left + ((bbox === null || bbox === void 0 ? void 0 : bbox.left) || 0), top + ((bbox === null || bbox === void 0 ? void 0 : bbox.top) || 0), right - left, bottom - top);\n      }\n      return new Rectangle((bbox === null || bbox === void 0 ? void 0 : bbox.left) || 0, (bbox === null || bbox === void 0 ? void 0 : bbox.top) || 0, 0, 0);\n    }\n  }, {\n    key: \"dirtifyWorldInternal\",\n    value: function dirtifyWorldInternal(element, transform) {\n      var _this4 = this;\n      if (!transform.dirtyFlag) {\n        transform.dirtyFlag = true;\n        transform.frozen = false;\n        element.childNodes.forEach(function (child) {\n          var childTransform = child.transformable;\n          if (!childTransform.dirtyFlag) {\n            _this4.dirtifyWorldInternal(child, childTransform);\n          }\n        });\n        var _ref5 = element,\n          renderable = _ref5.renderable;\n        if (renderable) {\n          renderable.renderBoundsDirty = true;\n          renderable.boundsDirty = true;\n          renderable.dirty = true;\n        }\n      }\n    }\n  }, {\n    key: \"syncHierarchy\",\n    value: function syncHierarchy(element) {\n      var transform = element.transformable;\n      if (transform.frozen) {\n        return;\n      }\n      transform.frozen = true;\n      if (transform.localDirtyFlag || transform.dirtyFlag) {\n        this.sync(element, transform);\n      }\n      var children = element.childNodes;\n      for (var i = 0; i < children.length; i++) {\n        this.syncHierarchy(children[i]);\n      }\n    }\n  }, {\n    key: \"sync\",\n    value: function sync(element, transform) {\n      if (transform.localDirtyFlag) {\n        this.calcLocalTransform(transform);\n        transform.localDirtyFlag = false;\n      }\n      if (transform.dirtyFlag) {\n        var parent = element.parentNode;\n        var parentTransform = parent && parent.transformable;\n        if (parent === null || !parentTransform) {\n          mat4.copy(transform.worldTransform, transform.localTransform);\n        } else {\n          // TODO: should we support scale compensation?\n          // @see https://github.com/playcanvas/engine/issues/1077#issuecomment-359765557\n          mat4.multiply(transform.worldTransform, parentTransform.worldTransform, transform.localTransform);\n        }\n        transform.dirtyFlag = false;\n      }\n    }\n  }, {\n    key: \"unfreezeParentToRoot\",\n    value: function unfreezeParentToRoot(child) {\n      var p = child.parentNode;\n      while (p) {\n        var transform = p.transformable;\n        if (transform) {\n          transform.frozen = false;\n        }\n        p = p.parentNode;\n      }\n    }\n  }]);\n}();\nvar TEXT_METRICS = {\n  MetricsString: '|ÉqÅ',\n  BaselineSymbol: 'M',\n  BaselineMultiplier: 1.4,\n  HeightMultiplier: 2,\n  Newlines: [0x000a,\n  // line feed\n  0x000d // carriage return\n  ],\n  BreakingSpaces: [0x0009,\n  // character tabulation\n  0x0020,\n  // space\n  0x2000,\n  // en quad\n  0x2001,\n  // em quad\n  0x2002,\n  // en space\n  0x2003,\n  // em space\n  0x2004,\n  // three-per-em space\n  0x2005,\n  // four-per-em space\n  0x2006,\n  // six-per-em space\n  0x2008,\n  // punctuation space\n  0x2009,\n  // thin space\n  0x200a,\n  // hair space\n  0x205f,\n  // medium mathematical space\n  0x3000 // ideographic space\n  ]\n};\nvar LATIN_REGEX = /[a-zA-Z0-9\\u00C0-\\u00D6\\u00D8-\\u00f6\\u00f8-\\u00ff!\"#$%&'()*+,-./:;]/;\n\n// Line breaking rules in CJK (Kinsoku Shori)\n// Refer from https://en.wikipedia.org/wiki/Line_breaking_rules_in_East_Asian_languages\nvar regexCannotStartZhCn = /[!%),.:;?\\]}¢°·'\"\"†‡›℃∶、。〃〆〕〗〞﹚﹜！＂％＇），．：；？！］｝～]/;\nvar regexCannotEndZhCn = /[$(£¥·'\"〈《「『【〔〖〝﹙﹛＄（．［｛￡￥]/;\nvar regexCannotStartZhTw = /[!),.:;?\\]}¢·–—'\"•\"、。〆〞〕〉》」︰︱︲︳﹐﹑﹒﹓﹔﹕﹖﹘﹚﹜！），．：；？︶︸︺︼︾﹀﹂﹗］｜｝､]/;\nvar regexCannotEndZhTw = /[([{£¥'\"‵〈《「『〔〝︴﹙﹛（｛︵︷︹︻︽︿﹁﹃﹏]/;\nvar regexCannotStartJaJp = /[)\\]｝〕〉》」』】〙〗〟'\"｠»ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻‐゠–〜?!‼⁇⁈⁉・、:;,。.]/;\nvar regexCannotEndJaJp = /[([｛〔〈《「『【〘〖〝'\"｟«—...‥〳〴〵]/;\nvar regexCannotStartKoKr = /[!%),.:;?\\]}¢°'\"†‡℃〆〈《「『〕！％），．：；？］｝]/;\nvar regexCannotEndKoKr = /[$([{£¥'\"々〇〉》」〔＄（［｛｠￥￦#]/;\nvar regexCannotStart = new RegExp(\"\".concat(regexCannotStartZhCn.source, \"|\").concat(regexCannotStartZhTw.source, \"|\").concat(regexCannotStartJaJp.source, \"|\").concat(regexCannotStartKoKr.source));\nvar regexCannotEnd = new RegExp(\"\".concat(regexCannotEndZhCn.source, \"|\").concat(regexCannotEndZhTw.source, \"|\").concat(regexCannotEndJaJp.source, \"|\").concat(regexCannotEndKoKr.source));\n\n/**\n * Borrow from pixi/packages/text/src/TextMetrics.ts\n */\nvar TextService = /*#__PURE__*/function () {\n  function TextService(runtime) {\n    var _this = this;\n    _classCallCheck(this, TextService);\n    /**\n     * font metrics cache\n     */\n    this.fontMetricsCache = {};\n    this.shouldBreakByKinsokuShorui = function (_char, nextChar) {\n      if (_this.isBreakingSpace(nextChar)) return false;\n      if (_char) {\n        // Line breaking rules in CJK (Kinsoku Shori)\n        if (regexCannotEnd.exec(nextChar) || regexCannotStart.exec(_char)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    this.trimByKinsokuShorui = function (prev) {\n      var next = _toConsumableArray(prev);\n      var prevLine = next[next.length - 2];\n      if (!prevLine) {\n        return prev;\n      }\n      var lastChar = prevLine[prevLine.length - 1];\n      next[next.length - 2] = prevLine.slice(0, -1);\n      next[next.length - 1] = lastChar + next[next.length - 1];\n      return next;\n    };\n    this.runtime = runtime;\n  }\n  return _createClass(TextService, [{\n    key: \"measureFont\",\n    value:\n    /**\n     * Calculates the ascent, descent and fontSize of a given font-style.\n     */\n    function measureFont(font, offscreenCanvas) {\n      // as this method is used for preparing assets, don't recalculate things if we don't need to\n      if (this.fontMetricsCache[font]) {\n        return this.fontMetricsCache[font];\n      }\n      var properties = {\n        ascent: 0,\n        descent: 0,\n        fontSize: 0\n      };\n      var canvas = this.runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas);\n      var context = this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas, {\n        willReadFrequently: true\n      });\n      context.font = font;\n      var metricsString = TEXT_METRICS.MetricsString + TEXT_METRICS.BaselineSymbol;\n      var width = Math.ceil(context.measureText(metricsString).width);\n      var baseline = Math.ceil(context.measureText(TEXT_METRICS.BaselineSymbol).width);\n      var height = TEXT_METRICS.HeightMultiplier * baseline;\n      baseline = baseline * TEXT_METRICS.BaselineMultiplier | 0;\n      // @ts-ignore\n      canvas.width = width;\n      // @ts-ignore\n      canvas.height = height;\n      context.fillStyle = '#f00';\n      context.fillRect(0, 0, width, height);\n      context.font = font;\n      context.textBaseline = 'alphabetic';\n      context.fillStyle = '#000';\n      context.fillText(metricsString, 0, baseline);\n      var imagedata = context.getImageData(0, 0, width || 1, height || 1).data;\n      var pixels = imagedata.length;\n      var line = width * 4;\n      var i = 0;\n      var idx = 0;\n      var stop = false;\n      // ascent. scan from top to bottom until we find a non red pixel\n      for (i = 0; i < baseline; ++i) {\n        for (var j = 0; j < line; j += 4) {\n          if (imagedata[idx + j] !== 255) {\n            stop = true;\n            break;\n          }\n        }\n        if (!stop) {\n          idx += line;\n        } else {\n          break;\n        }\n      }\n      properties.ascent = baseline - i;\n      idx = pixels - line;\n      stop = false;\n      // descent. scan from bottom to top until we find a non red pixel\n      for (i = height; i > baseline; --i) {\n        for (var _j = 0; _j < line; _j += 4) {\n          if (imagedata[idx + _j] !== 255) {\n            stop = true;\n            break;\n          }\n        }\n        if (!stop) {\n          idx -= line;\n        } else {\n          break;\n        }\n      }\n      properties.descent = i - baseline;\n      properties.fontSize = properties.ascent + properties.descent;\n      this.fontMetricsCache[font] = properties;\n      return properties;\n    }\n  }, {\n    key: \"measureText\",\n    value: function measureText(text, parsedStyle, offscreenCanvas) {\n      var _parsedStyle$fontSize = parsedStyle.fontSize,\n        fontSize = _parsedStyle$fontSize === void 0 ? 16 : _parsedStyle$fontSize,\n        _parsedStyle$wordWrap = parsedStyle.wordWrap,\n        wordWrap = _parsedStyle$wordWrap === void 0 ? false : _parsedStyle$wordWrap,\n        strokeHeight = parsedStyle.lineHeight,\n        _parsedStyle$lineWidt = parsedStyle.lineWidth,\n        lineWidth = _parsedStyle$lineWidt === void 0 ? 1 : _parsedStyle$lineWidt,\n        _parsedStyle$textBase = parsedStyle.textBaseline,\n        textBaseline = _parsedStyle$textBase === void 0 ? 'alphabetic' : _parsedStyle$textBase,\n        _parsedStyle$textAlig = parsedStyle.textAlign,\n        textAlign = _parsedStyle$textAlig === void 0 ? 'start' : _parsedStyle$textAlig,\n        _parsedStyle$letterSp = parsedStyle.letterSpacing,\n        letterSpacing = _parsedStyle$letterSp === void 0 ? 0 : _parsedStyle$letterSp,\n        textPath = parsedStyle.textPath;\n      parsedStyle.textPathSide;\n      parsedStyle.textPathStartOffset;\n      var _parsedStyle$leading = parsedStyle.leading,\n        leading = _parsedStyle$leading === void 0 ? 0 : _parsedStyle$leading;\n      var font = toFontString(parsedStyle);\n      var fontProperties = this.measureFont(font, offscreenCanvas);\n      // fallback in case UA disallow canvas data extraction\n      if (fontProperties.fontSize === 0) {\n        fontProperties.fontSize = fontSize;\n        fontProperties.ascent = fontSize;\n      }\n      var context = this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);\n      context.font = font;\n\n      // no overflowing by default\n      parsedStyle.isOverflowing = false;\n      var outputText = wordWrap ? this.wordWrap(text, parsedStyle, offscreenCanvas) : text;\n      var lines = outputText.split(/(?:\\r\\n|\\r|\\n)/);\n      var lineWidths = new Array(lines.length);\n      var maxLineWidth = 0;\n\n      // account for textPath\n      if (textPath) {\n        textPath.getTotalLength();\n\n        // const startingPoint = textPath.getPoint(0);\n\n        for (var i = 0; i < lines.length; i++) {\n          context.measureText(lines[i]).width + (lines[i].length - 1) * letterSpacing;\n          // for (\n          //   let i = reverse ? lines[0].length - 1 : 0;\n          //   reverse ? i >= 0 : i < lines[0].length;\n          //   reverse ? i-- : i++\n          // ) {\n          //   graphemeInfo = lineBounds[i];\n          //   if (positionInPath > totalPathLength) {\n          //     positionInPath %= totalPathLength;\n          //   } else if (positionInPath < 0) {\n          //     positionInPath += totalPathLength;\n          //   }\n          //   // it would probably much faster to send all the grapheme position for a line\n          //   // and calculate path position/angle at once.\n          //   this.setGraphemeOnPath(\n          //     positionInPath,\n          //     graphemeInfo,\n          //     startingPoint\n          //   );\n          //   positionInPath += graphemeInfo.kernedWidth;\n          // }\n        }\n      } else {\n        for (var _i = 0; _i < lines.length; _i++) {\n          // char width + letterSpacing\n          var _lineWidth = context.measureText(lines[_i]).width + (lines[_i].length - 1) * letterSpacing;\n          lineWidths[_i] = _lineWidth;\n          maxLineWidth = Math.max(maxLineWidth, _lineWidth);\n        }\n        var _width = maxLineWidth + lineWidth;\n\n        // if (dropShadow) {\n        //   width += dropShadowDistance;\n        // }\n        var lineHeight = strokeHeight || fontProperties.fontSize + lineWidth;\n        var height = Math.max(lineHeight, fontProperties.fontSize + lineWidth) + (lines.length - 1) * (lineHeight + leading);\n        // if (dropShadow) {\n        //   height += dropShadowDistance;\n        // }\n        lineHeight += leading;\n\n        // handle vertical text baseline\n        var offsetY = 0;\n        if (textBaseline === 'middle') {\n          offsetY = -height / 2;\n        } else if (textBaseline === 'bottom' || textBaseline === 'alphabetic' || textBaseline === 'ideographic') {\n          offsetY = -height;\n        } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n          offsetY = 0;\n        }\n        return {\n          font: font,\n          width: _width,\n          height: height,\n          lines: lines,\n          lineWidths: lineWidths,\n          lineHeight: lineHeight,\n          maxLineWidth: maxLineWidth,\n          fontProperties: fontProperties,\n          lineMetrics: lineWidths.map(function (width, i) {\n            var offsetX = 0;\n            // handle horizontal text align\n            if (textAlign === 'center' || textAlign === 'middle') {\n              offsetX -= width / 2;\n            } else if (textAlign === 'right' || textAlign === 'end') {\n              offsetX -= width;\n            }\n            return new Rectangle(offsetX - lineWidth / 2, offsetY + i * lineHeight, width + lineWidth, lineHeight);\n          })\n        };\n      }\n    }\n  }, {\n    key: \"setGraphemeOnPath\",\n    value: function setGraphemeOnPath() {}\n  }, {\n    key: \"wordWrap\",\n    value: function wordWrap(text, parsedStyle, offscreenCanvas) {\n      var _this2 = this;\n      var _parsedStyle$wordWrap2 = parsedStyle.wordWrapWidth,\n        wordWrapWidth = _parsedStyle$wordWrap2 === void 0 ? 0 : _parsedStyle$wordWrap2,\n        _parsedStyle$letterSp2 = parsedStyle.letterSpacing,\n        letterSpacing = _parsedStyle$letterSp2 === void 0 ? 0 : _parsedStyle$letterSp2,\n        _parsedStyle$maxLines = parsedStyle.maxLines,\n        maxLines = _parsedStyle$maxLines === void 0 ? Infinity : _parsedStyle$maxLines,\n        textOverflow = parsedStyle.textOverflow;\n      var context = this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);\n      var maxWidth = wordWrapWidth + letterSpacing;\n      var ellipsis = '';\n      if (textOverflow === 'ellipsis') {\n        ellipsis = '...';\n      } else if (textOverflow && textOverflow !== 'clip') {\n        ellipsis = textOverflow;\n      }\n      var lines = [];\n      var currentIndex = 0;\n      var currentWidth = 0;\n      var cache = {};\n      var calcWidth = function calcWidth(_char2) {\n        return _this2.getFromCache(_char2, letterSpacing, cache, context);\n      };\n      var ellipsisWidth = Array.from(ellipsis).reduce(function (prev, cur) {\n        return prev + calcWidth(cur);\n      }, 0);\n      var chars = Array.from(text);\n      for (var i = 0; i < chars.length; i++) {\n        var _char3 = chars[i];\n        var prevChar = text[i - 1];\n        var nextChar = text[i + 1];\n        var charWidth = calcWidth(_char3);\n        if (this.isNewline(_char3)) {\n          currentIndex++;\n\n          // exceed maxLines, break immediately\n          if (currentIndex >= maxLines) {\n            parsedStyle.isOverflowing = true;\n            break;\n          }\n          currentWidth = 0;\n          lines[currentIndex] = '';\n          continue;\n        }\n        if (currentWidth > 0 && currentWidth + charWidth > maxWidth) {\n          if (currentIndex + 1 >= maxLines) {\n            parsedStyle.isOverflowing = true;\n\n            // If there is not enough space to display the string itself, it is clipped.\n            // @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-overflow#values\n            if (ellipsisWidth > 0 && ellipsisWidth <= maxWidth) {\n              // Backspace from line's end.\n              var currentLineLength = lines[currentIndex].length;\n              var lastLineWidth = 0;\n              var lastLineIndex = currentLineLength;\n              for (var _i2 = 0; _i2 < currentLineLength; _i2++) {\n                var width = calcWidth(lines[currentIndex][_i2]);\n                if (lastLineWidth + width + ellipsisWidth > maxWidth) {\n                  lastLineIndex = _i2;\n                  break;\n                }\n                lastLineWidth += width;\n              }\n              lines[currentIndex] = (lines[currentIndex] || '').slice(0, lastLineIndex) + ellipsis;\n            }\n            break;\n          }\n          currentIndex++;\n          currentWidth = 0;\n          lines[currentIndex] = '';\n          if (this.isBreakingSpace(_char3)) {\n            continue;\n          }\n          if (!this.canBreakInLastChar(_char3)) {\n            lines = this.trimToBreakable(lines);\n            currentWidth = this.sumTextWidthByCache(lines[currentIndex] || '', cache);\n          }\n          if (this.shouldBreakByKinsokuShorui(_char3, nextChar)) {\n            lines = this.trimByKinsokuShorui(lines);\n            currentWidth += calcWidth(prevChar || '');\n          }\n        }\n        currentWidth += charWidth;\n        lines[currentIndex] = (lines[currentIndex] || '') + _char3;\n      }\n      return lines.join('\\n');\n    }\n  }, {\n    key: \"isBreakingSpace\",\n    value: function isBreakingSpace(_char4) {\n      if (typeof _char4 !== 'string') {\n        return false;\n      }\n      return TEXT_METRICS.BreakingSpaces.indexOf(_char4.charCodeAt(0)) >= 0;\n    }\n  }, {\n    key: \"isNewline\",\n    value: function isNewline(_char5) {\n      if (typeof _char5 !== 'string') {\n        return false;\n      }\n      return TEXT_METRICS.Newlines.indexOf(_char5.charCodeAt(0)) >= 0;\n    }\n  }, {\n    key: \"trimToBreakable\",\n    value: function trimToBreakable(prev) {\n      var next = _toConsumableArray(prev);\n      var prevLine = next[next.length - 2];\n      var index = this.findBreakableIndex(prevLine);\n      if (index === -1 || !prevLine) return next;\n      var trimmedChar = prevLine.slice(index, index + 1);\n      var isTrimmedWithSpace = this.isBreakingSpace(trimmedChar);\n      var trimFrom = index + 1;\n      var trimTo = index + (isTrimmedWithSpace ? 0 : 1);\n      next[next.length - 1] += prevLine.slice(trimFrom, prevLine.length);\n      next[next.length - 2] = prevLine.slice(0, trimTo);\n      return next;\n    }\n  }, {\n    key: \"canBreakInLastChar\",\n    value: function canBreakInLastChar(_char6) {\n      if (_char6 && LATIN_REGEX.test(_char6)) return false;\n      return true;\n    }\n  }, {\n    key: \"sumTextWidthByCache\",\n    value: function sumTextWidthByCache(text, cache) {\n      return text.split('').reduce(function (sum, c) {\n        if (!cache[c]) throw Error('cannot count the word without cache');\n        return sum + cache[c];\n      }, 0);\n    }\n  }, {\n    key: \"findBreakableIndex\",\n    value: function findBreakableIndex(line) {\n      for (var i = line.length - 1; i >= 0; i--) {\n        if (!LATIN_REGEX.test(line[i])) return i;\n      }\n      return -1;\n    }\n  }, {\n    key: \"getFromCache\",\n    value: function getFromCache(key, letterSpacing, cache, context) {\n      var width = cache[key];\n      if (typeof width !== 'number') {\n        var spacing = key.length * letterSpacing;\n        width = context.measureText(key).width + spacing;\n        cache[key] = width;\n      }\n      return width;\n    }\n  }]);\n}();\nvar runtime = {};\n/**\n * Replace with IoC container\n */\nvar geometryUpdaterFactory = function (_ref) {\n  var rectUpdater = new RectUpdater();\n  var polylineUpdater = new PolylineUpdater();\n  return _ref = {}, _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_ref, Shape.CIRCLE, new CircleUpdater()), Shape.ELLIPSE, new EllipseUpdater()), Shape.RECT, rectUpdater), Shape.IMAGE, rectUpdater), Shape.GROUP, new GroupUpdater()), Shape.LINE, new LineUpdater()), Shape.TEXT, new TextUpdater(runtime)), Shape.POLYLINE, polylineUpdater), Shape.POLYGON, polylineUpdater), Shape.PATH, new PathUpdater()), _defineProperty(_defineProperty(_ref, Shape.HTML, new HTMLUpdater()), Shape.MESH, null);\n}();\nvar CSSPropertySyntaxFactory = function (_ref2) {\n  var color = new CSSPropertyColor();\n  var length = new CSSPropertyLengthOrPercentage();\n  return _ref2 = {}, _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_ref2, PropertySyntax.PERCENTAGE, null), PropertySyntax.NUMBER, new CSSPropertyNumber()), PropertySyntax.ANGLE, new CSSPropertyAngle()), PropertySyntax.DEFINED_PATH, new CSSPropertyClipPath()), PropertySyntax.PAINT, color), PropertySyntax.COLOR, color), PropertySyntax.FILTER, new CSSPropertyFilter()), PropertySyntax.LENGTH, length), PropertySyntax.LENGTH_PERCENTAGE, length), PropertySyntax.LENGTH_PERCENTAGE_12, new CSSPropertyLengthOrPercentage12()), _defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_ref2, PropertySyntax.LENGTH_PERCENTAGE_14, new CSSPropertyLengthOrPercentage14()), PropertySyntax.COORDINATE, new CSSPropertyLengthOrPercentage()), PropertySyntax.OFFSET_DISTANCE, new CSSPropertyOffsetDistance()), PropertySyntax.OPACITY_VALUE, new CSSPropertyOpacity()), PropertySyntax.PATH, new CSSPropertyPath()), PropertySyntax.LIST_OF_POINTS, new CSSPropertyPoints()), PropertySyntax.SHADOW_BLUR, new CSSPropertyShadowBlur()), PropertySyntax.TEXT, new CSSPropertyText()), PropertySyntax.TEXT_TRANSFORM, new CSSPropertyTextTransform()), PropertySyntax.TRANSFORM, new CSSPropertyTransform()), _defineProperty(_defineProperty(_defineProperty(_ref2, PropertySyntax.TRANSFORM_ORIGIN, new CSSPropertyTransformOrigin()), PropertySyntax.Z_INDEX, new CSSPropertyZIndex()), PropertySyntax.MARKER, new CSSPropertyMarker());\n}();\nvar getGlobalThis = function getGlobalThis() {\n  if (typeof globalThis !== 'undefined') return globalThis;\n  if (typeof self !== 'undefined') return self;\n  if (typeof window !== 'undefined') return window;\n  // @ts-ignore\n  if (typeof global !== 'undefined') return global;\n  return {};\n  // [!] Error: The 'this' keyword is equivalent to 'undefined' at the top level of an ES module, and has been rewritten\n  // @see https://rollupjs.org/troubleshooting/#error-this-is-undefined\n  // if (typeof this !== 'undefined') return this;\n};\n\n/**\n * Camera\n * `g-camera-api` will provide an advanced implementation\n */\nruntime.CameraContribution = Camera;\n\n/**\n * `g-web-animations-api` will provide an AnimationTimeline\n */\nruntime.AnimationTimeline = null;\nruntime.EasingFunction = null;\nruntime.offscreenCanvasCreator = new OffscreenCanvasCreator();\nruntime.sceneGraphSelector = new DefaultSceneGraphSelector();\nruntime.sceneGraphService = new DefaultSceneGraphService(runtime);\nruntime.textService = new TextService(runtime);\nruntime.geometryUpdaterFactory = geometryUpdaterFactory;\nruntime.CSSPropertySyntaxFactory = CSSPropertySyntaxFactory;\nruntime.styleValueRegistry = new DefaultStyleValueRegistry(runtime);\nruntime.layoutRegistry = null;\nruntime.globalThis = getGlobalThis();\nruntime.enableStyleSyntax = true;\nruntime.enableSizeAttenuation = false;\nvar entityCounter = 0;\nfunction resetEntityCounter() {\n  entityCounter = 0;\n}\nvar insertedEvent = new MutationEvent(ElementEvent.INSERTED, null, '', '', '', 0, '', '');\nvar removedEvent = new MutationEvent(ElementEvent.REMOVED, null, '', '', '', 0, '', '');\nvar destroyEvent = new CustomEvent(ElementEvent.DESTROY);\n\n/**\n * Has following capabilities:\n * * Node insert/remove, eg. appendChild, removeChild, remove...\n * * Query eg. querySelector getElementById...\n * * Animation\n */\nvar Element = /*#__PURE__*/function (_Node) {\n  function Element() {\n    var _this;\n    _classCallCheck(this, Element);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, Element, [].concat(args));\n    /**\n     * Unique id.\n     */\n    _this.entity = entityCounter++;\n    _this.renderable = {\n      bounds: undefined,\n      boundsDirty: true,\n      renderBounds: undefined,\n      renderBoundsDirty: true,\n      dirtyRenderBounds: undefined,\n      dirty: false\n    };\n    _this.cullable = {\n      strategy: Strategy.Standard,\n      visibilityPlaneMask: -1,\n      visible: true,\n      enable: true\n    };\n    _this.transformable = {\n      dirtyFlag: false,\n      localDirtyFlag: false,\n      frozen: false,\n      localPosition: [0, 0, 0],\n      localRotation: [0, 0, 0, 1],\n      localScale: [1, 1, 1],\n      localTransform: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\n      localSkew: [0, 0],\n      position: [0, 0, 0],\n      rotation: [0, 0, 0, 1],\n      scaling: [1, 1, 1],\n      worldTransform: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\n      origin: [0, 0, 0]\n    };\n    _this.sortable = {\n      dirty: false,\n      sorted: undefined,\n      renderOrder: 0,\n      dirtyChildren: [],\n      dirtyReason: undefined\n    };\n    _this.geometry = {\n      contentBounds: undefined,\n      renderBounds: undefined,\n      dirty: true\n    };\n    _this.rBushNode = {\n      aabb: undefined\n    };\n    /**\n     * https://developer.mozilla.org/zh-CN/docs/Web/API/Element/namespaceURI\n     */\n    _this.namespaceURI = 'g';\n    _this.scrollLeft = 0;\n    _this.scrollTop = 0;\n    /**\n     * We don't support border now\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/clientTop\n     */\n    _this.clientTop = 0;\n    _this.clientLeft = 0;\n    /**\n     * is destroyed or not\n     */\n    _this.destroyed = false;\n    /**\n     * compatible with `style`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style\n     */\n    _this.style = {};\n    _this.computedStyle = {};\n    /**\n     * Renderers will use these used values.\n     */\n    _this.parsedStyle = {\n      // opacity: '',\n      // fillOpacity: '',\n      // strokeOpacity: '',\n      // transformOrigin: '',\n      // visibility: '',\n      // pointerEvents: '',\n      // lineWidth: '',\n      // lineCap: '',\n      // lineJoin: '',\n      // increasedLineWidthForHitTesting: '',\n      // fontSize: '',\n      // fontFamily: '',\n      // fontStyle: '',\n      // fontWeight: '',\n      // fontVariant: '',\n      // textAlign: '',\n      // textBaseline: '',\n      // textTransform: '',\n    };\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/attributes\n     */\n    _this.attributes = {};\n    return _this;\n  }\n  _inherits(Element, _Node);\n  return _createClass(Element, [{\n    key: \"className\",\n    get:\n    /**\n     * used with `getElementById()`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/id\n     */\n\n    /**\n     * used in `getElementsByClassName`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\n     */\n    function get() {\n      // @ts-ignore\n      return this.getAttribute('class') || '';\n    },\n    set: function set(className) {\n      this.setAttribute('class', className);\n    }\n\n    /**\n     * used in `getElementsByName`\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByName\n     */\n  }, {\n    key: \"classList\",\n    get:\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/classList\n     */\n    function get() {\n      return this.className.split(' ').filter(function (c) {\n        return c !== '';\n      });\n    }\n  }, {\n    key: \"tagName\",\n    get: function get() {\n      return this.nodeName;\n    }\n  }, {\n    key: \"children\",\n    get: function get() {\n      return this.childNodes;\n    }\n  }, {\n    key: \"childElementCount\",\n    get: function get() {\n      return this.childNodes.length;\n    }\n  }, {\n    key: \"firstElementChild\",\n    get: function get() {\n      return this.firstChild;\n    }\n  }, {\n    key: \"lastElementChild\",\n    get: function get() {\n      return this.lastChild;\n    }\n  }, {\n    key: \"parentElement\",\n    get: function get() {\n      return this.parentNode;\n    }\n  }, {\n    key: \"nextSibling\",\n    get: function get() {\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        return this.parentNode.childNodes[index + 1] || null;\n      }\n      return null;\n    }\n  }, {\n    key: \"previousSibling\",\n    get: function get() {\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        return this.parentNode.childNodes[index - 1] || null;\n      }\n      return null;\n    }\n  }, {\n    key: \"cloneNode\",\n    value: function cloneNode(deep) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"appendChild\",\n    value: function appendChild(child, index) {\n      var _this$ownerDocument;\n      if (child.destroyed) {\n        throw new Error(ERROR_MSG_APPEND_DESTROYED_ELEMENT);\n      }\n      runtime.sceneGraphService.attach(child, this, index);\n      if ((_this$ownerDocument = this.ownerDocument) !== null && _this$ownerDocument !== void 0 && _this$ownerDocument.defaultView) {\n        if (!isInFragment(this) && child.nodeName === Shape.FRAGMENT) {\n          this.ownerDocument.defaultView.mountFragment(child);\n        } else {\n          this.ownerDocument.defaultView.mountChildren(child);\n        }\n      }\n\n      // @ts-ignore\n      if (this.isMutationObserved) {\n        insertedEvent.relatedNode = this;\n        child.dispatchEvent(insertedEvent);\n      }\n      return child;\n    }\n  }, {\n    key: \"insertBefore\",\n    value: function insertBefore(newChild, refChild) {\n      if (!refChild) {\n        this.appendChild(newChild);\n      } else {\n        if (newChild.parentElement) {\n          newChild.parentElement.removeChild(newChild);\n        }\n        var index = this.childNodes.indexOf(refChild);\n        if (index === -1) {\n          this.appendChild(newChild);\n        } else {\n          this.appendChild(newChild, index);\n        }\n      }\n      return newChild;\n    }\n  }, {\n    key: \"replaceChild\",\n    value: function replaceChild(newChild, oldChild) {\n      var index = this.childNodes.indexOf(oldChild);\n      this.removeChild(oldChild);\n      this.appendChild(newChild, index);\n      return oldChild;\n    }\n  }, {\n    key: \"removeChild\",\n    value: function removeChild(child) {\n      var _child$ownerDocument;\n      // should emit on itself before detach\n      removedEvent.relatedNode = this;\n      child.dispatchEvent(removedEvent);\n      if ((_child$ownerDocument = child.ownerDocument) !== null && _child$ownerDocument !== void 0 && _child$ownerDocument.defaultView) {\n        child.ownerDocument.defaultView.unmountChildren(child);\n      }\n\n      // remove from scene graph\n      runtime.sceneGraphService.detach(child);\n      return child;\n    }\n\n    /**\n     * Remove all children which can be appended to its original parent later again.\n     */\n  }, {\n    key: \"removeChildren\",\n    value: function removeChildren() {\n      for (var i = this.childNodes.length - 1; i >= 0; i--) {\n        var child = this.childNodes[i];\n        this.removeChild(child);\n      }\n    }\n\n    /**\n     * Recursively destroy all children which can not be appended to its original parent later again.\n     */\n  }, {\n    key: \"destroyChildren\",\n    value: function destroyChildren() {\n      for (var i = this.childNodes.length - 1; i >= 0; i--) {\n        var child = this.childNodes[i];\n        if (child.childNodes.length) {\n          child.destroyChildren();\n        }\n        child.destroy();\n      }\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\n     */\n  }, {\n    key: \"matches\",\n    value: function matches(selector) {\n      return runtime.sceneGraphService.matches(selector, this);\n    }\n  }, {\n    key: \"getElementById\",\n    value: function getElementById(id) {\n      return runtime.sceneGraphService.querySelector(\"#\".concat(id), this);\n    }\n  }, {\n    key: \"getElementsByName\",\n    value: function getElementsByName(name) {\n      return runtime.sceneGraphService.querySelectorAll(\"[name=\\\"\".concat(name, \"\\\"]\"), this);\n    }\n  }, {\n    key: \"getElementsByClassName\",\n    value: function getElementsByClassName(className) {\n      return runtime.sceneGraphService.querySelectorAll(\".\".concat(className), this);\n    }\n  }, {\n    key: \"getElementsByTagName\",\n    value: function getElementsByTagName(tagName) {\n      return runtime.sceneGraphService.querySelectorAll(tagName, this);\n    }\n  }, {\n    key: \"querySelector\",\n    value: function querySelector(selectors) {\n      return runtime.sceneGraphService.querySelector(selectors, this);\n    }\n  }, {\n    key: \"querySelectorAll\",\n    value: function querySelectorAll(selectors) {\n      return runtime.sceneGraphService.querySelectorAll(selectors, this);\n    }\n\n    /**\n     * should traverses the element and its parents (heading toward the document root)\n     * until it finds a node that matches the specified CSS selector.\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/closest\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/closest#polyfill\n     */\n  }, {\n    key: \"closest\",\n    value: function closest(selectors) {\n      var el = this;\n      do {\n        if (runtime.sceneGraphService.matches(selectors, el)) return el;\n        el = el.parentElement;\n      } while (el !== null);\n      return null;\n    }\n\n    /**\n     * search in scene group, but should not include itself\n     */\n  }, {\n    key: \"find\",\n    value: function find(filter) {\n      var _this2 = this;\n      var target = null;\n      this.forEach(function (object) {\n        if (object !== _this2 && filter(object)) {\n          target = object;\n          return false;\n        }\n        return true;\n      });\n      return target;\n    }\n  }, {\n    key: \"findAll\",\n    value: function findAll(filter) {\n      var _this3 = this;\n      var objects = [];\n      this.forEach(function (object) {\n        if (object !== _this3 && filter(object)) {\n          objects.push(object);\n        }\n      });\n      return objects;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/after\n     */\n  }, {\n    key: \"after\",\n    value: function after() {\n      var _this4 = this;\n      if (this.parentNode) {\n        var index = this.parentNode.childNodes.indexOf(this);\n        for (var _len2 = arguments.length, nodes = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n          nodes[_key2] = arguments[_key2];\n        }\n        nodes.forEach(function (node, i) {\n          var _this4$parentNode;\n          return (_this4$parentNode = _this4.parentNode) === null || _this4$parentNode === void 0 ? void 0 : _this4$parentNode.appendChild(node, index + i + 1);\n        });\n      }\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/before\n     */\n  }, {\n    key: \"before\",\n    value: function before() {\n      if (this.parentNode) {\n        var _ref;\n        var index = this.parentNode.childNodes.indexOf(this);\n        for (var _len3 = arguments.length, nodes = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n          nodes[_key3] = arguments[_key3];\n        }\n        var first = nodes[0],\n          rest = nodes.slice(1);\n        this.parentNode.appendChild(first, index);\n        (_ref = first).after.apply(_ref, _toConsumableArray(rest));\n      }\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceWith\n     */\n  }, {\n    key: \"replaceWith\",\n    value: function replaceWith() {\n      this.after.apply(this, arguments);\n      this.remove();\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/append\n     */\n  }, {\n    key: \"append\",\n    value: function append() {\n      var _this5 = this;\n      for (var _len4 = arguments.length, nodes = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        nodes[_key4] = arguments[_key4];\n      }\n      nodes.forEach(function (node) {\n        return _this5.appendChild(node);\n      });\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/prepend\n     */\n  }, {\n    key: \"prepend\",\n    value: function prepend() {\n      var _this6 = this;\n      for (var _len5 = arguments.length, nodes = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n        nodes[_key5] = arguments[_key5];\n      }\n      nodes.forEach(function (node, i) {\n        return _this6.appendChild(node, i);\n      });\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceChildren\n     */\n  }, {\n    key: \"replaceChildren\",\n    value: function replaceChildren() {\n      while (this.childNodes.length && this.firstChild) {\n        this.removeChild(this.firstChild);\n      }\n      this.append.apply(this, arguments);\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/remove\n     */\n  }, {\n    key: \"remove\",\n    value: function remove() {\n      if (this.parentNode) {\n        return this.parentNode.removeChild(this);\n      }\n      return this;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      // destroy itself before remove\n      this.dispatchEvent(destroyEvent);\n\n      // remove from scenegraph first\n      this.remove();\n\n      // remove event listeners\n      this.emitter.removeAllListeners();\n      this.destroyed = true;\n    }\n  }, {\n    key: \"getGeometryBounds\",\n    value: function getGeometryBounds() {\n      return runtime.sceneGraphService.getGeometryBounds(this);\n    }\n  }, {\n    key: \"getRenderBounds\",\n    value: function getRenderBounds() {\n      return runtime.sceneGraphService.getBounds(this, true);\n    }\n\n    /**\n     * get bounds in world space, account for children\n     */\n  }, {\n    key: \"getBounds\",\n    value: function getBounds() {\n      return runtime.sceneGraphService.getBounds(this);\n    }\n\n    /**\n     * get bounds in local space, account for children\n     */\n  }, {\n    key: \"getLocalBounds\",\n    value: function getLocalBounds() {\n      return runtime.sceneGraphService.getLocalBounds(this);\n    }\n\n    /**\n     * account for context's bounds in client space,\n     * but not accounting for children\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n     */\n  }, {\n    key: \"getBoundingClientRect\",\n    value: function getBoundingClientRect() {\n      return runtime.sceneGraphService.getBoundingClientRect(this);\n    }\n\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getClientRects\n     */\n  }, {\n    key: \"getClientRects\",\n    value: function getClientRects() {\n      return [this.getBoundingClientRect()];\n    }\n  }, {\n    key: \"computedStyleMap\",\n    value:\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/computedStyleMap\n     * eg. circle.computedStyleMap().get('fill');\n     */\n    function computedStyleMap() {\n      return new Map(Object.entries(this.computedStyle));\n    }\n  }, {\n    key: \"getAttributeNames\",\n    value:\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNames\n     */\n    function getAttributeNames() {\n      return Object.keys(this.attributes);\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute\n     */\n  }, {\n    key: \"getAttribute\",\n    value: function getAttribute(name) {\n      // @see https://github.com/antvis/G/issues/1267\n      if (typeof name === 'symbol') {\n        return undefined;\n      }\n      var value = this.attributes[name];\n      if (value === undefined) {\n        // if the given attribute does not exist, the value returned will either be null or \"\"\n        return value;\n      }\n      return value;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttribute\n     */\n  }, {\n    key: \"hasAttribute\",\n    value: function hasAttribute(qualifiedName) {\n      return this.getAttributeNames().includes(qualifiedName);\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttributes\n     */\n  }, {\n    key: \"hasAttributes\",\n    value: function hasAttributes() {\n      return !!this.getAttributeNames().length;\n    }\n\n    /**\n     * should use removeAttribute() instead of setting the attribute value to null either directly or using setAttribute(). Many attributes will not behave as expected if you set them to null.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/removeAttribute\n     */\n  }, {\n    key: \"removeAttribute\",\n    value: function removeAttribute(attributeName) {\n      this.setAttribute(attributeName, null);\n      delete this.attributes[attributeName];\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute\n     */\n  }, {\n    key: \"setAttribute\",\n    value: function setAttribute(attributeName, value, force, memoize) {\n      this.attributes[attributeName] = value;\n    }\n  }, {\n    key: \"getAttributeNS\",\n    value: function getAttributeNS(namespace, localName) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"getAttributeNode\",\n    value: function getAttributeNode(qualifiedName) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"getAttributeNodeNS\",\n    value: function getAttributeNodeNS(namespace, localName) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"hasAttributeNS\",\n    value: function hasAttributeNS(namespace, localName) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"removeAttributeNS\",\n    value: function removeAttributeNS(namespace, localName) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"removeAttributeNode\",\n    value: function removeAttributeNode(attr) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"setAttributeNS\",\n    value: function setAttributeNS(namespace, qualifiedName, value) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"setAttributeNode\",\n    value: function setAttributeNode(attr) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"setAttributeNodeNS\",\n    value: function setAttributeNodeNS(attr) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"toggleAttribute\",\n    value: function toggleAttribute(qualifiedName, force) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }]);\n}(Node);\nfunction isDisplayObject(value) {\n  return !!(value !== null && value !== void 0 && value.nodeName);\n}\nvar Proxy = runtime.globalThis.Proxy ? runtime.globalThis.Proxy : function () {};\nvar mutationEvent = new MutationEvent(ElementEvent.ATTR_MODIFIED, null, null, null, null, MutationEvent.MODIFICATION, null, null);\nvar $vec3 = vec3.create();\nvar $quat = quat$1.create();\n\n/**\n * prototype chains: DisplayObject -> Element -> Node -> EventTarget\n *\n * mixins: Animatable, Transformable, Visible\n * @see https://github.com/tannerntannern/ts-mixer/blob/master/README.md#mixing-generic-classes\n *\n * Provide abilities in scene graph, such as:\n * * transform `translate/rotate/scale`\n * * add/remove child\n * * visibility and z-index\n *\n * Those abilities are implemented with those components: `Transform/Sortable/Visible`.\n *\n * Emit following events:\n * * init\n * * destroy\n * * attributeChanged\n */\nvar DisplayObject = /*#__PURE__*/function (_Element) {\n  function DisplayObject(config) {\n    var _this;\n    _classCallCheck(this, DisplayObject);\n    _this = _callSuper(this, DisplayObject);\n\n    // assign name, id to config\n    // eg. group.get('name')\n    /**\n     * contains style props in constructor's params, eg. fill, stroke...\n     */\n    _this.isCustomElement = false;\n    _this.isMutationObserved = false;\n    /**\n     * push to active animations after calling `animate()`\n     */\n    _this.activeAnimations = [];\n    _this.config = config;\n\n    // init scene graph node\n    _this.id = config.id || '';\n    _this.name = config.name || '';\n    if (config.className || config[\"class\"]) {\n      _this.className = config.className || config[\"class\"];\n    }\n    _this.nodeName = config.type || Shape.GROUP;\n    if (config.initialParsedStyle) {\n      Object.assign(_this.parsedStyle, config.initialParsedStyle);\n    }\n\n    // start to process attributes\n    _this.initAttributes(config.style);\n    if (runtime.enableStyleSyntax) {\n      _this.style = new Proxy(\n      // @ts-ignore\n      {\n        // ...this.attributes,\n        setProperty: function setProperty(propertyName, value\n        // priority?: string,\n        ) {\n          _this.setAttribute(propertyName, value);\n        },\n        getPropertyValue: function getPropertyValue(propertyName) {\n          return _this.getAttribute(propertyName);\n        },\n        removeProperty: function removeProperty(propertyName) {\n          _this.removeAttribute(propertyName);\n        },\n        item: function item() {\n          return '';\n        }\n      }, {\n        get: function get(target, name) {\n          if (target[name] !== undefined) {\n            // if (name in target) {\n            return target[name];\n          }\n          return _this.getAttribute(name);\n        },\n        set: function set(_, prop, value) {\n          _this.setAttribute(prop, value);\n          return true;\n        }\n      });\n    }\n    return _this;\n  }\n  _inherits(DisplayObject, _Element);\n  return _createClass(DisplayObject, [{\n    key: \"destroy\",\n    value: function destroy() {\n      _superPropGet(DisplayObject, \"destroy\", this, 3)([]);\n\n      // stop all active animations\n      this.getAnimations().forEach(function (animation) {\n        animation.cancel();\n      });\n    }\n  }, {\n    key: \"cloneNode\",\n    value: function cloneNode(deep, customCloneFunc) {\n      var clonedStyle = _objectSpread({}, this.attributes);\n      for (var attributeName in clonedStyle) {\n        var attribute = clonedStyle[attributeName];\n\n        // @see https://github.com/antvis/G/issues/1095\n        if (isDisplayObject(attribute) &&\n        // share the same clipPath if possible\n        attributeName !== 'clipPath' && attributeName !== 'offsetPath' && attributeName !== 'textPath') {\n          clonedStyle[attributeName] = attribute.cloneNode(deep);\n        }\n        // TODO: clone other type\n        if (customCloneFunc) {\n          clonedStyle[attributeName] = customCloneFunc(attributeName, attribute);\n        }\n      }\n      var cloned = new this.constructor({\n        // copy id & name\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode#notes\n        id: this.id,\n        name: this.name,\n        className: this.name,\n        interactive: this.interactive,\n        style: clonedStyle\n      });\n\n      // apply transform\n      cloned.setLocalTransform(this.getLocalTransform());\n      if (deep) {\n        this.children.forEach(function (child) {\n          // skip marker\n          if (!child.style.isMarker) {\n            var clonedChild = child.cloneNode(deep);\n            cloned.appendChild(clonedChild);\n          }\n        });\n      }\n      return cloned;\n    }\n  }, {\n    key: \"initAttributes\",\n    value: function initAttributes() {\n      var attributes = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = {\n        forceUpdateGeometry: true\n      };\n      runtime.styleValueRegistry.processProperties(this, attributes, options);\n\n      // redraw at next frame\n      this.renderable.dirty = true;\n    }\n  }, {\n    key: \"setAttribute\",\n    value: function setAttribute(name, value) {\n      var force = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var memoize = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      // ignore undefined value\n      if (isUndefined(value)) {\n        return;\n      }\n      if (force || value !== this.attributes[name]) {\n        this.internalSetAttribute(name, value, {\n          memoize: memoize\n        });\n        _superPropGet(DisplayObject, \"setAttribute\", this, 3)([name, value]);\n      }\n    }\n\n    /**\n     * called when attributes get changed or initialized\n     */\n  }, {\n    key: \"internalSetAttribute\",\n    value: function internalSetAttribute(name, value) {\n      var parseOptions = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var renderable = this.renderable;\n      var oldValue = this.attributes[name];\n      var oldParsedValue = this.parsedStyle[name];\n      runtime.styleValueRegistry.processProperties(this, _defineProperty({}, name, value), parseOptions);\n\n      // redraw at next frame\n      renderable.dirty = true;\n      var newParsedValue = this.parsedStyle[name];\n      if (this.isConnected) {\n        mutationEvent.relatedNode = this;\n        mutationEvent.prevValue = oldValue;\n        mutationEvent.newValue = value;\n        mutationEvent.attrName = name;\n        mutationEvent.prevParsedValue = oldParsedValue;\n        mutationEvent.newParsedValue = newParsedValue;\n        if (this.isMutationObserved) {\n          this.dispatchEvent(mutationEvent);\n        } else {\n          mutationEvent.target = this;\n          this.ownerDocument.defaultView.dispatchEvent(mutationEvent, true);\n        }\n      }\n      if ((this.isCustomElement && this.isConnected || !this.isCustomElement) && this.attributeChangedCallback) {\n        this.attributeChangedCallback(name, oldValue, value, oldParsedValue, newParsedValue);\n      }\n    }\n\n    // #region transformable\n    /**\n     * returns different values than getBoundingClientRect(), as the latter returns value relative to the viewport\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGGraphicsElement/getBBox\n     *\n     * FIXME: It is worth noting that getBBox responds to original untransformed values of a drawn object.\n     * @see https://www.w3.org/Graphics/SVG/IG/resources/svgprimer.html#getBBox\n     */\n  }, {\n    key: \"getBBox\",\n    value: function getBBox() {\n      var aabb = this.getBounds();\n      var _aabb$getMin = aabb.getMin(),\n        _aabb$getMin2 = _slicedToArray(_aabb$getMin, 2),\n        left = _aabb$getMin2[0],\n        top = _aabb$getMin2[1];\n      var _aabb$getMax = aabb.getMax(),\n        _aabb$getMax2 = _slicedToArray(_aabb$getMax, 2),\n        right = _aabb$getMax2[0],\n        bottom = _aabb$getMax2[1];\n      return new Rectangle(left, top, right - left, bottom - top);\n    }\n  }, {\n    key: \"setOrigin\",\n    value: function setOrigin(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      runtime.sceneGraphService.setOrigin(this, createVec3(position, y, z, false));\n      return this;\n    }\n  }, {\n    key: \"getOrigin\",\n    value: function getOrigin() {\n      return runtime.sceneGraphService.getOrigin(this);\n    }\n\n    /**\n     * set position in world space\n     */\n  }, {\n    key: \"setPosition\",\n    value: function setPosition(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      runtime.sceneGraphService.setPosition(this, createVec3(position, y, z, false));\n      return this;\n    }\n\n    /**\n     * set position in local space\n     */\n  }, {\n    key: \"setLocalPosition\",\n    value: function setLocalPosition(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      runtime.sceneGraphService.setLocalPosition(this, createVec3(position, y, z, false));\n      return this;\n    }\n\n    /**\n     * translate in world space\n     */\n  }, {\n    key: \"translate\",\n    value: function translate(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      runtime.sceneGraphService.translate(this, createVec3(position, y, z, false));\n      return this;\n    }\n\n    /**\n     * translate in local space\n     */\n  }, {\n    key: \"translateLocal\",\n    value: function translateLocal(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      runtime.sceneGraphService.translateLocal(this, createVec3(position, y, z, false));\n      return this;\n    }\n  }, {\n    key: \"getPosition\",\n    value: function getPosition() {\n      return runtime.sceneGraphService.getPosition(this);\n    }\n  }, {\n    key: \"getLocalPosition\",\n    value: function getLocalPosition() {\n      return runtime.sceneGraphService.getLocalPosition(this);\n    }\n\n    /**\n     * compatible with G 3.0\n     *\n     * scaling in local space\n     * scale(10) = scale(10, 10, 10)\n     *\n     * we can't set scale in world space\n     */\n  }, {\n    key: \"scale\",\n    value: function scale(scaling, y, z) {\n      return this.scaleLocal(scaling, y, z);\n    }\n  }, {\n    key: \"scaleLocal\",\n    value: function scaleLocal(scaling, y, z) {\n      if (typeof scaling === 'number') {\n        y = y || scaling;\n        z = z || scaling;\n        scaling = createVec3(scaling, y, z, false);\n      }\n      runtime.sceneGraphService.scaleLocal(this, scaling);\n      return this;\n    }\n\n    /**\n     * set scaling in local space\n     */\n  }, {\n    key: \"setLocalScale\",\n    value: function setLocalScale(scaling, y, z) {\n      if (typeof scaling === 'number') {\n        y = y || scaling;\n        z = z || scaling;\n        scaling = createVec3(scaling, y, z, false);\n      }\n      runtime.sceneGraphService.setLocalScale(this, scaling);\n      return this;\n    }\n\n    /**\n     * get scaling in local space\n     */\n  }, {\n    key: \"getLocalScale\",\n    value: function getLocalScale() {\n      return runtime.sceneGraphService.getLocalScale(this);\n    }\n\n    /**\n     * get scaling in world space\n     */\n  }, {\n    key: \"getScale\",\n    value: function getScale() {\n      return runtime.sceneGraphService.getScale(this);\n    }\n\n    /**\n     * only return degrees of Z axis in world space\n     */\n  }, {\n    key: \"getEulerAngles\",\n    value: function getEulerAngles() {\n      var _getEuler = getEuler($vec3, runtime.sceneGraphService.getWorldTransform(this)),\n        _getEuler2 = _slicedToArray(_getEuler, 3),\n        ez = _getEuler2[2];\n      return rad2deg(ez);\n    }\n\n    /**\n     * only return degrees of Z axis in local space\n     */\n  }, {\n    key: \"getLocalEulerAngles\",\n    value: function getLocalEulerAngles() {\n      var _getEuler3 = getEuler($vec3, runtime.sceneGraphService.getLocalRotation(this)),\n        _getEuler4 = _slicedToArray(_getEuler3, 3),\n        ez = _getEuler4[2];\n      return rad2deg(ez);\n    }\n\n    /**\n     * set euler angles(degrees) in world space\n     */\n  }, {\n    key: \"setEulerAngles\",\n    value: function setEulerAngles(z) {\n      runtime.sceneGraphService.setEulerAngles(this, 0, 0, z);\n      return this;\n    }\n\n    /**\n     * set euler angles(degrees) in local space\n     */\n  }, {\n    key: \"setLocalEulerAngles\",\n    value: function setLocalEulerAngles(z) {\n      runtime.sceneGraphService.setLocalEulerAngles(this, 0, 0, z);\n      return this;\n    }\n  }, {\n    key: \"rotateLocal\",\n    value: function rotateLocal(x, y, z) {\n      if (isNil(y) && isNil(z)) {\n        runtime.sceneGraphService.rotateLocal(this, 0, 0, x);\n      } else {\n        runtime.sceneGraphService.rotateLocal(this, x, y, z);\n      }\n      return this;\n    }\n  }, {\n    key: \"rotate\",\n    value: function rotate(x, y, z) {\n      if (isNil(y) && isNil(z)) {\n        runtime.sceneGraphService.rotate(this, 0, 0, x);\n      } else {\n        runtime.sceneGraphService.rotate(this, x, y, z);\n      }\n      return this;\n    }\n  }, {\n    key: \"setRotation\",\n    value: function setRotation(rotation, y, z, w) {\n      runtime.sceneGraphService.setRotation(this, rotation, y, z, w);\n      return this;\n    }\n  }, {\n    key: \"setLocalRotation\",\n    value: function setLocalRotation(rotation, y, z, w) {\n      runtime.sceneGraphService.setLocalRotation(this, rotation, y, z, w);\n      return this;\n    }\n  }, {\n    key: \"setLocalSkew\",\n    value: function setLocalSkew(skew, y) {\n      runtime.sceneGraphService.setLocalSkew(this, skew, y);\n      return this;\n    }\n  }, {\n    key: \"getRotation\",\n    value: function getRotation() {\n      return runtime.sceneGraphService.getRotation(this);\n    }\n  }, {\n    key: \"getLocalRotation\",\n    value: function getLocalRotation() {\n      return runtime.sceneGraphService.getLocalRotation(this);\n    }\n  }, {\n    key: \"getLocalSkew\",\n    value: function getLocalSkew() {\n      return runtime.sceneGraphService.getLocalSkew(this);\n    }\n  }, {\n    key: \"getLocalTransform\",\n    value: function getLocalTransform() {\n      return runtime.sceneGraphService.getLocalTransform(this);\n    }\n  }, {\n    key: \"getWorldTransform\",\n    value: function getWorldTransform() {\n      return runtime.sceneGraphService.getWorldTransform(this);\n    }\n  }, {\n    key: \"setLocalTransform\",\n    value: function setLocalTransform(transform) {\n      runtime.sceneGraphService.setLocalTransform(this, transform);\n      return this;\n    }\n  }, {\n    key: \"resetLocalTransform\",\n    value: function resetLocalTransform() {\n      runtime.sceneGraphService.resetLocalTransform(this);\n    }\n    // #endregion transformable\n\n    // #region animatable\n    /**\n     * returns an array of all Animation objects affecting this element\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAnimations\n     */\n  }, {\n    key: \"getAnimations\",\n    value: function getAnimations() {\n      return this.activeAnimations;\n    }\n    /**\n     * create an animation with WAAPI\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/animate\n     */\n  }, {\n    key: \"animate\",\n    value: function animate(keyframes, options) {\n      var _this$ownerDocument;\n      var timeline = (_this$ownerDocument = this.ownerDocument) === null || _this$ownerDocument === void 0 ? void 0 : _this$ownerDocument.timeline;\n      if (timeline) {\n        return timeline.play(this, keyframes, options);\n      }\n      return null;\n    }\n    // #endregion animatable\n\n    // #region visible\n    /**\n     * shortcut for Used value of `visibility`\n     */\n  }, {\n    key: \"isVisible\",\n    value: function isVisible() {\n      var _this$parsedStyle;\n      return ((_this$parsedStyle = this.parsedStyle) === null || _this$parsedStyle === void 0 ? void 0 : _this$parsedStyle.visibility) !== 'hidden';\n    }\n  }, {\n    key: \"interactive\",\n    get: function get() {\n      return this.isInteractive();\n    },\n    set: function set(b) {\n      this.style.pointerEvents = b ? 'auto' : 'none';\n    }\n  }, {\n    key: \"isInteractive\",\n    value: function isInteractive() {\n      var _this$parsedStyle2;\n      return ((_this$parsedStyle2 = this.parsedStyle) === null || _this$parsedStyle2 === void 0 ? void 0 : _this$parsedStyle2.pointerEvents) !== 'none';\n    }\n  }, {\n    key: \"isCulled\",\n    value: function isCulled() {\n      return !!(this.cullable && this.cullable.enable && !this.cullable.visible);\n    }\n\n    /**\n     * bring to front in current group\n     */\n  }, {\n    key: \"toFront\",\n    value: function toFront() {\n      if (this.parentNode) {\n        this.style.zIndex = Math.max.apply(Math, _toConsumableArray(this.parentNode.children.map(function (child) {\n          return Number(child.style.zIndex);\n        }))) + 1;\n      }\n      return this;\n    }\n\n    /**\n     * send to back in current group\n     */\n  }, {\n    key: \"toBack\",\n    value: function toBack() {\n      if (this.parentNode) {\n        this.style.zIndex = Math.min.apply(Math, _toConsumableArray(this.parentNode.children.map(function (child) {\n          return Number(child.style.zIndex);\n        }))) - 1;\n      }\n      return this;\n    }\n    // #endregion visible\n\n    // #region deprecated\n\n    /**\n     * compatible with G 3.0\n     * @alias object.config\n     * @deprecated\n     */\n  }, {\n    key: \"getConfig\",\n    value: function getConfig() {\n      return this.config;\n    }\n\n    /**\n     * @alias style\n     * @example\n     * circle.style.r = 10;\n     * const r = circle.style;\n     * @deprecated\n     */\n  }, {\n    key: \"attr\",\n    value: function attr() {\n      var _this2 = this;\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      var name = args[0],\n        value = args[1];\n      if (!name) {\n        return this.attributes;\n      }\n      if (isObject(name)) {\n        Object.keys(name).forEach(function (key) {\n          _this2.setAttribute(key, name[key]);\n        });\n        return this;\n      }\n      if (args.length === 2) {\n        this.setAttribute(name, value);\n        return this;\n      }\n      return this.attributes[name];\n    }\n\n    /**\n     * return 3x3 matrix in world space\n     * @deprecated\n     */\n  }, {\n    key: \"getMatrix\",\n    value: function getMatrix(transformMat4) {\n      var transform = transformMat4 || this.getWorldTransform();\n      var _mat4$getTranslation = mat4.getTranslation($vec3, transform),\n        _mat4$getTranslation2 = _slicedToArray(_mat4$getTranslation, 2),\n        tx = _mat4$getTranslation2[0],\n        ty = _mat4$getTranslation2[1];\n      var _mat4$getScaling = mat4.getScaling($vec3, transform),\n        _mat4$getScaling2 = _slicedToArray(_mat4$getScaling, 2),\n        sx = _mat4$getScaling2[0],\n        sy = _mat4$getScaling2[1];\n      var rotation = mat4.getRotation($quat, transform);\n      var _getEuler5 = getEuler($vec3, rotation),\n        _getEuler6 = _slicedToArray(_getEuler5, 3),\n        eux = _getEuler6[0],\n        euz = _getEuler6[2];\n      // gimbal lock at 90 degrees\n      return fromRotationTranslationScale(eux || euz, tx, ty, sx, sy);\n    }\n\n    /**\n     * return 3x3 matrix in local space\n     * @deprecated\n     */\n  }, {\n    key: \"getLocalMatrix\",\n    value: function getLocalMatrix() {\n      return this.getMatrix(this.getLocalTransform());\n    }\n\n    /**\n     * set 3x3 matrix in world space\n     * @deprecated\n     */\n  }, {\n    key: \"setMatrix\",\n    value: function setMatrix(mat) {\n      var _decompose = decompose(mat),\n        _decompose2 = _slicedToArray(_decompose, 5),\n        tx = _decompose2[0],\n        ty = _decompose2[1],\n        scalingX = _decompose2[2],\n        scalingY = _decompose2[3],\n        angle = _decompose2[4];\n      this.setEulerAngles(angle).setPosition(tx, ty).setLocalScale(scalingX, scalingY);\n    }\n\n    /**\n     * set 3x3 matrix in local space\n     * @deprecated\n     */\n  }, {\n    key: \"setLocalMatrix\",\n    value: function setLocalMatrix(mat) {\n      var _decompose3 = decompose(mat),\n        _decompose4 = _slicedToArray(_decompose3, 5),\n        tx = _decompose4[0],\n        ty = _decompose4[1],\n        scalingX = _decompose4[2],\n        scalingY = _decompose4[3],\n        angle = _decompose4[4];\n      this.setLocalEulerAngles(angle).setLocalPosition(tx, ty).setLocalScale(scalingX, scalingY);\n    }\n\n    /**\n     * Use `visibility: visible` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"show\",\n    value: function show() {\n      this.forEach(function (object) {\n        object.style.visibility = 'visible';\n      });\n    }\n\n    /**\n     * Use `visibility: hidden` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      this.forEach(function (object) {\n        object.style.visibility = 'hidden';\n      });\n    }\n\n    /**\n     * Use `childElementCount` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"getCount\",\n    value: function getCount() {\n      return this.childElementCount;\n    }\n\n    /**\n     * Use `parentElement` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"getParent\",\n    value: function getParent() {\n      return this.parentElement;\n    }\n\n    /**\n     * Use `children` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"getChildren\",\n    value: function getChildren() {\n      return this.children;\n    }\n\n    /**\n     * Use `firstElementChild` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"getFirst\",\n    value: function getFirst() {\n      return this.firstElementChild;\n    }\n\n    /**\n     * Use `lastElementChild` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"getLast\",\n    value: function getLast() {\n      return this.lastElementChild;\n    }\n\n    /**\n     * Use `this.children[index]` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"getChildByIndex\",\n    value: function getChildByIndex(index) {\n      return this.children[index] || null;\n    }\n\n    /**\n     * Use `appendChild` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"add\",\n    value: function add(child, index) {\n      return this.appendChild(child, index);\n    }\n\n    /**\n     * @deprecated\n     */\n  }, {\n    key: \"set\",\n    value: function set(name, value) {\n      // @ts-ignore\n      this.config[name] = value;\n    }\n\n    /**\n     * @deprecated\n     */\n  }, {\n    key: \"get\",\n    value: function get(name) {\n      return this.config[name];\n    }\n\n    /**\n     * Use `setPosition` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"moveTo\",\n    value: function moveTo(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      this.setPosition(position, y, z);\n      return this;\n    }\n\n    /**\n     * Use `setPosition` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"move\",\n    value: function move(position) {\n      var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      this.setPosition(position, y, z);\n      return this;\n    }\n\n    /**\n     * Use `this.style.zIndex` instead.\n     * @deprecated\n     */\n  }, {\n    key: \"setZIndex\",\n    value: function setZIndex(zIndex) {\n      this.style.zIndex = zIndex;\n      return this;\n    }\n\n    // #endregion deprecated\n  }]);\n}(Element);\nvar Circle = /*#__PURE__*/function (_DisplayObject) {\n  function Circle() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, Circle);\n    return _callSuper(this, Circle, [_objectSpread({\n      type: Shape.CIRCLE\n    }, options)]);\n  }\n  _inherits(Circle, _DisplayObject);\n  return _createClass(Circle);\n}(DisplayObject);\nvar _excluded$6 = [\"style\"];\n/**\n * shadow root\n * @see https://yuque.antfin-inc.com/antv/czqvg5/pgqipg\n */\nvar CustomElement = /*#__PURE__*/function (_DisplayObject) {\n  // private shadowNodes: DisplayObject[] = [];\n\n  function CustomElement() {\n    var _this;\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded$6);\n    _classCallCheck(this, CustomElement);\n    _this = _callSuper(this, CustomElement, [_objectSpread({\n      style: style\n    }, rest)]);\n    // static get observedAttributes(): string[] {\n    //   return [];\n    // }\n    _this.isCustomElement = true;\n    return _this;\n  }\n\n  /**\n   * fired after element insert into DOM tree\n   */\n  _inherits(CustomElement, _DisplayObject);\n  return _createClass(CustomElement);\n}(DisplayObject);\nvar Ellipse = /*#__PURE__*/function (_DisplayObject) {\n  function Ellipse() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, Ellipse);\n    return _callSuper(this, Ellipse, [_objectSpread({\n      type: Shape.ELLIPSE\n    }, options)]);\n  }\n  _inherits(Ellipse, _DisplayObject);\n  return _createClass(Ellipse);\n}(DisplayObject);\n\n/**\n * 节点片段，用于包裹多个节点并批量操作\n *\n *  向 Fragment 或者根节点为 Fragment 的节点添加子节点时，不会触发渲染和事件。\n *\n * 当 Fragment 被挂载到 Canvas 中的节点时，其子节点会一次性被渲染，并触发合并事件。\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment\n */\nvar Fragment = /*#__PURE__*/function (_DisplayObject) {\n  function Fragment() {\n    _classCallCheck(this, Fragment);\n    return _callSuper(this, Fragment, [{\n      type: Shape.FRAGMENT\n    }]);\n  }\n  _inherits(Fragment, _DisplayObject);\n  return _createClass(Fragment);\n}(DisplayObject);\n\n/**\n * its attributes are inherited by its children.\n * @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/g\n * \n * @example\n * <g fill=\"white\" stroke=\"green\" stroke-width=\"5\">\n    <circle cx=\"40\" cy=\"40\" r=\"25\" />\n    <circle cx=\"60\" cy=\"60\" r=\"25\" />\n  </g>\n */\nvar Group = /*#__PURE__*/function (_DisplayObject) {\n  function Group() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, Group);\n    return _callSuper(this, Group, [_objectSpread({\n      type: Shape.GROUP\n    }, options)]);\n  }\n  _inherits(Group, _DisplayObject);\n  return _createClass(Group);\n}(DisplayObject);\nvar _excluded$5 = [\"style\"];\n/**\n * HTML container\n * @see https://github.com/pmndrs/drei#html\n */\nvar HTML = /*#__PURE__*/function (_DisplayObject) {\n  function HTML() {\n    var _this;\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded$5);\n    _classCallCheck(this, HTML);\n    _this = _callSuper(this, HTML, [_objectSpread({\n      type: Shape.HTML,\n      style: style\n    }, rest)]);\n    _this.cullable.enable = false;\n    return _this;\n  }\n\n  /**\n   * return wrapper HTMLElement\n   * * <div> in g-webgl/canvas\n   * * <foreignObject> in g-svg\n   */\n  _inherits(HTML, _DisplayObject);\n  return _createClass(HTML, [{\n    key: \"getDomElement\",\n    value: function getDomElement() {\n      return this.parsedStyle.$el;\n    }\n\n    /**\n     * override with $el.getBoundingClientRect\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect\n     *\n     * ! The calculation logic of the html element should be consistent with that of the canvas element\n     */\n    // getBoundingClientRect(): Rectangle {\n    //   if (this.parsedStyle.$el) {\n    //     return this.parsedStyle.$el.getBoundingClientRect();\n    //   } else {\n    //     const { x, y, width, height } = this.parsedStyle;\n    //     return new Rectangle(x, y, width, height);\n    //   }\n    // }\n  }, {\n    key: \"getClientRects\",\n    value: function getClientRects() {\n      return [this.getBoundingClientRect()];\n    }\n\n    // getBounds() {\n    //   const clientRect = this.getBoundingClientRect();\n    //   // calc context's offset\n    //   // @ts-ignore\n    //   const canvasRect = this.ownerDocument?.defaultView\n    //     ?.getContextService()\n    //     .getBoundingClientRect();\n\n    //   const aabb = new AABB();\n    //   const minX = clientRect.left - (canvasRect?.left || 0);\n    //   const minY = clientRect.top - (canvasRect?.top || 0);\n    //   aabb.setMinMax(\n    //     [minX, minY, 0],\n    //     [minX + clientRect.width, minY + clientRect.height, 0],\n    //   );\n    //   return aabb;\n    // }\n  }, {\n    key: \"getLocalBounds\",\n    value: function getLocalBounds() {\n      if (this.parentNode) {\n        var parentInvert = mat4.invert(mat4.create(), this.parentNode.getWorldTransform());\n        var bounds = this.getBounds();\n        if (!AABB.isEmpty(bounds)) {\n          var localBounds = new AABB();\n          localBounds.setFromTransformedAABB(bounds, parentInvert);\n          return localBounds;\n        }\n      }\n      return this.getBounds();\n    }\n  }]);\n}(DisplayObject);\nvar Image = /*#__PURE__*/function (_DisplayObject) {\n  function Image() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, Image);\n    return _callSuper(this, Image, [_objectSpread({\n      type: Shape.IMAGE\n    }, options)]);\n  }\n  _inherits(Image, _DisplayObject);\n  return _createClass(Image);\n}(DisplayObject);\nvar _excluded$4 = [\"style\"];\n/**\n * Create a line connecting two points.\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Element/line\n *\n * Also support for using marker.\n */\nvar Line = /*#__PURE__*/function (_DisplayObject) {\n  function Line() {\n    var _this;\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded$4);\n    _classCallCheck(this, Line);\n    _this = _callSuper(this, Line, [_objectSpread({\n      type: Shape.LINE,\n      style: _objectSpread({\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n        z1: 0,\n        z2: 0\n      }, style)\n    }, rest)]);\n    _this.markerStartAngle = 0;\n    _this.markerEndAngle = 0;\n    var _this$parsedStyle = _this.parsedStyle,\n      markerStart = _this$parsedStyle.markerStart,\n      markerEnd = _this$parsedStyle.markerEnd;\n    if (markerStart && isDisplayObject(markerStart)) {\n      _this.markerStartAngle = markerStart.getLocalEulerAngles();\n      _this.appendChild(markerStart);\n    }\n    if (markerEnd && isDisplayObject(markerEnd)) {\n      _this.markerEndAngle = markerEnd.getLocalEulerAngles();\n      _this.appendChild(markerEnd);\n    }\n    _this.transformMarker(true);\n    _this.transformMarker(false);\n    return _this;\n  }\n  _inherits(Line, _DisplayObject);\n  return _createClass(Line, [{\n    key: \"attributeChangedCallback\",\n    value: function attributeChangedCallback(attrName, oldValue, newValue, prevParsedValue, newParsedValue) {\n      if (attrName === 'x1' || attrName === 'y1' || attrName === 'x2' || attrName === 'y2' || attrName === 'markerStartOffset' || attrName === 'markerEndOffset') {\n        this.transformMarker(true);\n        this.transformMarker(false);\n      } else if (attrName === 'markerStart') {\n        if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n          this.markerStartAngle = 0;\n          prevParsedValue.remove();\n        }\n\n        // CSSKeyword 'unset'\n        if (newParsedValue && isDisplayObject(newParsedValue)) {\n          this.markerStartAngle = newParsedValue.getLocalEulerAngles();\n          this.appendChild(newParsedValue);\n          this.transformMarker(true);\n        }\n      } else if (attrName === 'markerEnd') {\n        if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n          this.markerEndAngle = 0;\n          prevParsedValue.remove();\n        }\n        if (newParsedValue && isDisplayObject(newParsedValue)) {\n          this.markerEndAngle = newParsedValue.getLocalEulerAngles();\n          this.appendChild(newParsedValue);\n          this.transformMarker(false);\n        }\n      }\n    }\n  }, {\n    key: \"transformMarker\",\n    value: function transformMarker(isStart) {\n      var _this$parsedStyle2 = this.parsedStyle,\n        markerStart = _this$parsedStyle2.markerStart,\n        markerEnd = _this$parsedStyle2.markerEnd,\n        markerStartOffset = _this$parsedStyle2.markerStartOffset,\n        markerEndOffset = _this$parsedStyle2.markerEndOffset,\n        x1 = _this$parsedStyle2.x1,\n        x2 = _this$parsedStyle2.x2,\n        y1 = _this$parsedStyle2.y1,\n        y2 = _this$parsedStyle2.y2;\n      var marker = isStart ? markerStart : markerEnd;\n      if (!marker || !isDisplayObject(marker)) {\n        return;\n      }\n      var rad = 0;\n      var x;\n      var y;\n      var ox;\n      var oy;\n      var offset;\n      var originalAngle;\n      if (isStart) {\n        ox = x1;\n        oy = y1;\n        x = x2 - x1;\n        y = y2 - y1;\n        offset = markerStartOffset || 0;\n        originalAngle = this.markerStartAngle;\n      } else {\n        ox = x2;\n        oy = y2;\n        x = x1 - x2;\n        y = y1 - y2;\n        offset = markerEndOffset || 0;\n        originalAngle = this.markerEndAngle;\n      }\n      rad = Math.atan2(y, x);\n\n      // account for markerOffset\n      marker.setLocalEulerAngles(rad * 180 / Math.PI + originalAngle);\n      marker.setLocalPosition(ox + Math.cos(rad) * offset, oy + Math.sin(rad) * offset);\n    }\n  }, {\n    key: \"getPoint\",\n    value: function getPoint(ratio) {\n      var inWorldSpace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      // TODO: account for z1/z2 in 3D line\n      var _this$parsedStyle3 = this.parsedStyle,\n        x1 = _this$parsedStyle3.x1,\n        y1 = _this$parsedStyle3.y1,\n        x2 = _this$parsedStyle3.x2,\n        y2 = _this$parsedStyle3.y2;\n      var _linePointAt = linePointAt(x1, y1, x2, y2, ratio),\n        x = _linePointAt.x,\n        y = _linePointAt.y;\n      var transformed = vec3.transformMat4(vec3.create(), vec3.fromValues(x, y, 0), inWorldSpace ? this.getWorldTransform() : this.getLocalTransform());\n\n      // apply local transformation\n      return new Point(transformed[0], transformed[1]);\n    }\n  }, {\n    key: \"getPointAtLength\",\n    value: function getPointAtLength(distance) {\n      var inWorldSpace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      return this.getPoint(distance / this.getTotalLength(), inWorldSpace);\n    }\n  }, {\n    key: \"getTotalLength\",\n    value: function getTotalLength() {\n      // TODO: account for z1/z2 in 3D line\n      var _this$parsedStyle4 = this.parsedStyle,\n        x1 = _this$parsedStyle4.x1,\n        y1 = _this$parsedStyle4.y1,\n        x2 = _this$parsedStyle4.x2,\n        y2 = _this$parsedStyle4.y2;\n      return lineLength(x1, y1, x2, y2);\n    }\n  }]);\n}(DisplayObject);\nvar _excluded$3 = [\"style\"];\nvar Path = /*#__PURE__*/function (_DisplayObject) {\n  function Path() {\n    var _this;\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded$3);\n    _classCallCheck(this, Path);\n    _this = _callSuper(this, Path, [_objectSpread({\n      type: Shape.PATH,\n      style: style,\n      initialParsedStyle: {\n        miterLimit: 4,\n        d: _objectSpread({}, EMPTY_PARSED_PATH)\n      }\n    }, rest)]);\n    _this.markerStartAngle = 0;\n    _this.markerEndAngle = 0;\n    /**\n     * markers placed at the mid\n     */\n    _this.markerMidList = [];\n    var _this$parsedStyle = _this.parsedStyle,\n      markerStart = _this$parsedStyle.markerStart,\n      markerEnd = _this$parsedStyle.markerEnd,\n      markerMid = _this$parsedStyle.markerMid;\n    if (markerStart && isDisplayObject(markerStart)) {\n      _this.markerStartAngle = markerStart.getLocalEulerAngles();\n      _this.appendChild(markerStart);\n    }\n    if (markerMid && isDisplayObject(markerMid)) {\n      _this.placeMarkerMid(markerMid);\n    }\n    if (markerEnd && isDisplayObject(markerEnd)) {\n      _this.markerEndAngle = markerEnd.getLocalEulerAngles();\n      _this.appendChild(markerEnd);\n    }\n    _this.transformMarker(true);\n    _this.transformMarker(false);\n    return _this;\n  }\n  _inherits(Path, _DisplayObject);\n  return _createClass(Path, [{\n    key: \"attributeChangedCallback\",\n    value: function attributeChangedCallback(attrName, oldValue, newValue, prevParsedValue, newParsedValue) {\n      if (attrName === 'd') {\n        // recalc markers\n        this.transformMarker(true);\n        this.transformMarker(false);\n        this.placeMarkerMid(this.parsedStyle.markerMid);\n      } else if (attrName === 'markerStartOffset' || attrName === 'markerEndOffset') {\n        this.transformMarker(true);\n        this.transformMarker(false);\n      } else if (attrName === 'markerStart') {\n        if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n          this.markerStartAngle = 0;\n          prevParsedValue.remove();\n        }\n\n        // CSSKeyword 'unset'\n        if (newParsedValue && isDisplayObject(newParsedValue)) {\n          this.markerStartAngle = newParsedValue.getLocalEulerAngles();\n          this.appendChild(newParsedValue);\n          this.transformMarker(true);\n        }\n      } else if (attrName === 'markerEnd') {\n        if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n          this.markerEndAngle = 0;\n          prevParsedValue.remove();\n        }\n        if (newParsedValue && isDisplayObject(newParsedValue)) {\n          this.markerEndAngle = newParsedValue.getLocalEulerAngles();\n          this.appendChild(newParsedValue);\n          this.transformMarker(false);\n        }\n      } else if (attrName === 'markerMid') {\n        this.placeMarkerMid(newParsedValue);\n      }\n    }\n  }, {\n    key: \"transformMarker\",\n    value: function transformMarker(isStart) {\n      var _this$parsedStyle2 = this.parsedStyle,\n        markerStart = _this$parsedStyle2.markerStart,\n        markerEnd = _this$parsedStyle2.markerEnd,\n        markerStartOffset = _this$parsedStyle2.markerStartOffset,\n        markerEndOffset = _this$parsedStyle2.markerEndOffset;\n      var marker = isStart ? markerStart : markerEnd;\n      if (!marker || !isDisplayObject(marker)) {\n        return;\n      }\n      var rad = 0;\n      var x;\n      var y;\n      var ox;\n      var oy;\n      var offset;\n      var originalAngle;\n      if (isStart) {\n        var _this$getStartTangent = this.getStartTangent(),\n          _this$getStartTangent2 = _slicedToArray(_this$getStartTangent, 2),\n          p1 = _this$getStartTangent2[0],\n          p2 = _this$getStartTangent2[1];\n        ox = p2[0];\n        oy = p2[1];\n        x = p1[0] - p2[0];\n        y = p1[1] - p2[1];\n        offset = markerStartOffset || 0;\n        originalAngle = this.markerStartAngle;\n      } else {\n        var _this$getEndTangent = this.getEndTangent(),\n          _this$getEndTangent2 = _slicedToArray(_this$getEndTangent, 2),\n          _p = _this$getEndTangent2[0],\n          _p2 = _this$getEndTangent2[1];\n        ox = _p2[0];\n        oy = _p2[1];\n        x = _p[0] - _p2[0];\n        y = _p[1] - _p2[1];\n        offset = markerEndOffset || 0;\n        originalAngle = this.markerEndAngle;\n      }\n      rad = Math.atan2(y, x);\n\n      // account for markerOffset\n      marker.setLocalEulerAngles(rad * 180 / Math.PI + originalAngle);\n      marker.setLocalPosition(ox + Math.cos(rad) * offset, oy + Math.sin(rad) * offset);\n    }\n  }, {\n    key: \"placeMarkerMid\",\n    value: function placeMarkerMid(marker) {\n      var segments = this.parsedStyle.d.segments;\n      // clear all existed markers\n      this.markerMidList.forEach(function (marker) {\n        marker.remove();\n      });\n      if (marker && isDisplayObject(marker)) {\n        for (var i = 1; i < segments.length - 1; i++) {\n          var _segments$i$currentPo = _slicedToArray(segments[i].currentPoint, 2),\n            ox = _segments$i$currentPo[0],\n            oy = _segments$i$currentPo[1];\n          var cloned = i === 1 ? marker : marker.cloneNode(true);\n          this.markerMidList.push(cloned);\n          this.appendChild(cloned);\n          cloned.setLocalPosition(ox, oy);\n          // TODO: orient of marker\n        }\n      }\n    }\n\n    /**\n     * Returns the total length of the path.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGGeometryElement/getTotalLength\n     */\n  }, {\n    key: \"getTotalLength\",\n    value: function getTotalLength() {\n      return getOrCalculatePathTotalLength(this);\n    }\n\n    /**\n     * Returns the point at a given distance along the path.\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGGeometryElement/getPointAtLength\n     */\n  }, {\n    key: \"getPointAtLength\",\n    value: function getPointAtLength$1(distance) {\n      var inWorldSpace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var absolutePath = this.parsedStyle.d.absolutePath;\n      var _getPointAtLength2 = getPointAtLength(absolutePath, distance),\n        x = _getPointAtLength2.x,\n        y = _getPointAtLength2.y;\n      var transformed = vec3.transformMat4(vec3.create(), vec3.fromValues(x, y, 0), inWorldSpace ? this.getWorldTransform() : this.getLocalTransform());\n\n      // apply local transformation\n      return new Point(transformed[0], transformed[1]);\n    }\n\n    /**\n     * Returns the point at a given ratio of the total length in path.\n     */\n  }, {\n    key: \"getPoint\",\n    value: function getPoint(ratio) {\n      var inWorldSpace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      return this.getPointAtLength(ratio * getOrCalculatePathTotalLength(this), inWorldSpace);\n    }\n\n    /**\n     * Get start tangent vector\n     */\n  }, {\n    key: \"getStartTangent\",\n    value: function getStartTangent() {\n      var segments = this.parsedStyle.d.segments;\n      var result = [];\n      if (segments.length > 1) {\n        var startPoint = segments[0].currentPoint;\n        var endPoint = segments[1].currentPoint;\n        var tangent = segments[1].startTangent;\n        result = [];\n        if (tangent) {\n          result.push([startPoint[0] - tangent[0], startPoint[1] - tangent[1]]);\n          result.push([startPoint[0], startPoint[1]]);\n        } else {\n          result.push([endPoint[0], endPoint[1]]);\n          result.push([startPoint[0], startPoint[1]]);\n        }\n      }\n      return result;\n    }\n\n    /**\n     * Get end tangent vector\n     */\n  }, {\n    key: \"getEndTangent\",\n    value: function getEndTangent() {\n      var segments = this.parsedStyle.d.segments;\n      var length = segments.length;\n      var result = [];\n      if (length > 1) {\n        var startPoint = segments[length - 2].currentPoint;\n        var endPoint = segments[length - 1].currentPoint;\n        var tangent = segments[length - 1].endTangent;\n        result = [];\n        if (tangent) {\n          result.push([endPoint[0] - tangent[0], endPoint[1] - tangent[1]]);\n          result.push([endPoint[0], endPoint[1]]);\n        } else {\n          result.push([startPoint[0], startPoint[1]]);\n          result.push([endPoint[0], endPoint[1]]);\n        }\n      }\n      return result;\n    }\n  }]);\n}(DisplayObject);\nvar _excluded$2 = [\"style\"];\nvar Polygon = /*#__PURE__*/function (_DisplayObject) {\n  function Polygon() {\n    var _this;\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded$2);\n    _classCallCheck(this, Polygon);\n    _this = _callSuper(this, Polygon, [_objectSpread({\n      type: Shape.POLYGON,\n      style: style,\n      initialParsedStyle: {\n        points: {\n          points: [],\n          totalLength: 0,\n          segments: []\n        },\n        miterLimit: 4,\n        isClosed: true\n      }\n    }, rest)]);\n    _this.markerStartAngle = 0;\n    _this.markerEndAngle = 0;\n    /**\n     * markers placed at the mid\n     */\n    _this.markerMidList = [];\n    var _this$parsedStyle = _this.parsedStyle,\n      markerStart = _this$parsedStyle.markerStart,\n      markerEnd = _this$parsedStyle.markerEnd,\n      markerMid = _this$parsedStyle.markerMid;\n    if (markerStart && isDisplayObject(markerStart)) {\n      _this.markerStartAngle = markerStart.getLocalEulerAngles();\n      _this.appendChild(markerStart);\n    }\n    if (markerMid && isDisplayObject(markerMid)) {\n      _this.placeMarkerMid(markerMid);\n    }\n    if (markerEnd && isDisplayObject(markerEnd)) {\n      _this.markerEndAngle = markerEnd.getLocalEulerAngles();\n      _this.appendChild(markerEnd);\n    }\n    _this.transformMarker(true);\n    _this.transformMarker(false);\n    return _this;\n  }\n  _inherits(Polygon, _DisplayObject);\n  return _createClass(Polygon, [{\n    key: \"attributeChangedCallback\",\n    value: function attributeChangedCallback(attrName, oldValue, newValue, prevParsedValue, newParsedValue) {\n      if (attrName === 'points') {\n        // recalc markers\n        this.transformMarker(true);\n        this.transformMarker(false);\n        this.placeMarkerMid(this.parsedStyle.markerMid);\n      } else if (attrName === 'markerStartOffset' || attrName === 'markerEndOffset') {\n        this.transformMarker(true);\n        this.transformMarker(false);\n      } else if (attrName === 'markerStart') {\n        if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n          this.markerStartAngle = 0;\n          prevParsedValue.remove();\n        }\n\n        // CSSKeyword 'unset'\n        if (newParsedValue && isDisplayObject(newParsedValue)) {\n          this.markerStartAngle = newParsedValue.getLocalEulerAngles();\n          this.appendChild(newParsedValue);\n          this.transformMarker(true);\n        }\n      } else if (attrName === 'markerEnd') {\n        if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n          this.markerEndAngle = 0;\n          prevParsedValue.remove();\n        }\n        if (newParsedValue && isDisplayObject(newParsedValue)) {\n          this.markerEndAngle = newParsedValue.getLocalEulerAngles();\n          this.appendChild(newParsedValue);\n          this.transformMarker(false);\n        }\n      } else if (attrName === 'markerMid') {\n        this.placeMarkerMid(newParsedValue);\n      }\n    }\n  }, {\n    key: \"transformMarker\",\n    value: function transformMarker(isStart) {\n      var _this$parsedStyle2 = this.parsedStyle,\n        markerStart = _this$parsedStyle2.markerStart,\n        markerEnd = _this$parsedStyle2.markerEnd,\n        markerStartOffset = _this$parsedStyle2.markerStartOffset,\n        markerEndOffset = _this$parsedStyle2.markerEndOffset,\n        P = _this$parsedStyle2.points;\n      var _ref2 = P || {},\n        points = _ref2.points;\n      var marker = isStart ? markerStart : markerEnd;\n      if (!marker || !isDisplayObject(marker) || !points) {\n        return;\n      }\n      var rad = 0;\n      var x;\n      var y;\n      var ox;\n      var oy;\n      var offset;\n      var originalAngle;\n      ox = points[0][0];\n      oy = points[0][1];\n      if (isStart) {\n        x = points[1][0] - points[0][0];\n        y = points[1][1] - points[0][1];\n        offset = markerStartOffset || 0;\n        originalAngle = this.markerStartAngle;\n      } else {\n        var length = points.length;\n        if (!this.parsedStyle.isClosed) {\n          ox = points[length - 1][0];\n          oy = points[length - 1][1];\n          x = points[length - 2][0] - points[length - 1][0];\n          y = points[length - 2][1] - points[length - 1][1];\n        } else {\n          x = points[length - 1][0] - points[0][0];\n          y = points[length - 1][1] - points[0][1];\n        }\n        offset = markerEndOffset || 0;\n        originalAngle = this.markerEndAngle;\n      }\n      rad = Math.atan2(y, x);\n\n      // account for markerOffset\n      marker.setLocalEulerAngles(rad * 180 / Math.PI + originalAngle);\n      marker.setLocalPosition(ox + Math.cos(rad) * offset, oy + Math.sin(rad) * offset);\n    }\n  }, {\n    key: \"placeMarkerMid\",\n    value: function placeMarkerMid(marker) {\n      var P = this.parsedStyle.points;\n      var _ref3 = P || {},\n        points = _ref3.points;\n\n      // clear all existed markers\n      this.markerMidList.forEach(function (marker) {\n        marker.remove();\n      });\n      this.markerMidList = [];\n      if (marker && isDisplayObject(marker) && points) {\n        for (var i = 1; i < (this.parsedStyle.isClosed ? points.length : points.length - 1); i++) {\n          var ox = points[i][0];\n          var oy = points[i][1];\n          var cloned = i === 1 ? marker : marker.cloneNode(true);\n          this.markerMidList.push(cloned);\n          this.appendChild(cloned);\n          cloned.setLocalPosition(ox, oy);\n\n          // TODO: orient of marker\n        }\n      }\n    }\n  }]);\n}(DisplayObject);\nvar _excluded$1 = [\"style\"];\n/**\n * Polyline inherits the marker-related capabilities of Polygon.\n */\nvar Polyline = /*#__PURE__*/function (_Polygon) {\n  function Polyline() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded$1);\n    _classCallCheck(this, Polyline);\n    return _callSuper(this, Polyline, [_objectSpread({\n      type: Shape.POLYLINE,\n      style: style,\n      initialParsedStyle: {\n        points: {\n          points: [],\n          totalLength: 0,\n          segments: []\n        },\n        miterLimit: 4,\n        isClosed: false\n      }\n    }, rest)]);\n  }\n  _inherits(Polyline, _Polygon);\n  return _createClass(Polyline, [{\n    key: \"getTotalLength\",\n    value: function getTotalLength() {\n      return getOrCalculatePolylineTotalLength(this);\n    }\n  }, {\n    key: \"getPointAtLength\",\n    value: function getPointAtLength(distance) {\n      var inWorldSpace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      return this.getPoint(distance / this.getTotalLength(), inWorldSpace);\n    }\n  }, {\n    key: \"getPoint\",\n    value: function getPoint(ratio) {\n      var inWorldSpace = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var points = this.parsedStyle.points.points;\n      if (this.parsedStyle.points.segments.length === 0) {\n        var segments = [];\n        var tempLength = 0;\n        var segmentT;\n        var segmentL;\n        var totalLength = this.getTotalLength();\n        points.forEach(function (p, i) {\n          if (points[i + 1]) {\n            segmentT = [0, 0];\n            segmentT[0] = tempLength / totalLength;\n            segmentL = lineLength(p[0], p[1], points[i + 1][0], points[i + 1][1]);\n            tempLength += segmentL;\n            segmentT[1] = tempLength / totalLength;\n            segments.push(segmentT);\n          }\n        });\n        this.parsedStyle.points.segments = segments;\n      }\n      var subt = 0;\n      var index = 0;\n      this.parsedStyle.points.segments.forEach(function (v, i) {\n        if (ratio >= v[0] && ratio <= v[1]) {\n          subt = (ratio - v[0]) / (v[1] - v[0]);\n          index = i;\n        }\n      });\n      var _linePointAt = linePointAt(points[index][0], points[index][1], points[index + 1][0], points[index + 1][1], subt),\n        x = _linePointAt.x,\n        y = _linePointAt.y;\n      var transformed = vec3.transformMat4(vec3.create(), vec3.fromValues(x, y, 0), inWorldSpace ? this.getWorldTransform() : this.getLocalTransform());\n\n      // apply local transformation\n      return new Point(transformed[0], transformed[1]);\n    }\n  }, {\n    key: \"getStartTangent\",\n    value: function getStartTangent() {\n      var points = this.parsedStyle.points.points;\n      var result = [];\n      result.push([points[1][0], points[1][1]]);\n      result.push([points[0][0], points[0][1]]);\n      return result;\n    }\n  }, {\n    key: \"getEndTangent\",\n    value: function getEndTangent() {\n      var points = this.parsedStyle.points.points;\n      var l = points.length - 1;\n      var result = [];\n      result.push([points[l - 1][0], points[l - 1][1]]);\n      result.push([points[l][0], points[l][1]]);\n      return result;\n    }\n  }]);\n}(Polygon);\nvar Rect = /*#__PURE__*/function (_DisplayObject) {\n  function Rect() {\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    _classCallCheck(this, Rect);\n    return _callSuper(this, Rect, [_objectSpread({\n      type: Shape.RECT\n    }, options)]);\n  }\n  _inherits(Rect, _DisplayObject);\n  return _createClass(Rect);\n}(DisplayObject);\nvar _excluded = [\"style\"];\n/**\n * <text> @see https://developer.mozilla.org/en-US/docs/Web/API/SVGTextElement\n */\nvar Text = /*#__PURE__*/function (_DisplayObject) {\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGTextContentElement#constants\n   */\n  // LENGTHADJUST_SPACING: number = 1;\n  // LENGTHADJUST_SPACINGANDGLYPHS: number = 2;\n  // LENGTHADJUST_UNKNOWN: number = 0;\n\n  function Text() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      style = _ref.style,\n      rest = _objectWithoutProperties(_ref, _excluded);\n    _classCallCheck(this, Text);\n    return _callSuper(this, Text, [_objectSpread({\n      type: Shape.TEXT,\n      style: _objectSpread({\n        fill: 'black'\n      }, style)\n    }, rest)]);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGTextContentElement\n   */\n  _inherits(Text, _DisplayObject);\n  return _createClass(Text, [{\n    key: \"getComputedTextLength\",\n    value: function getComputedTextLength() {\n      var _this$parsedStyle$met;\n      this.getGeometryBounds();\n      return ((_this$parsedStyle$met = this.parsedStyle.metrics) === null || _this$parsedStyle$met === void 0 ? void 0 : _this$parsedStyle$met.maxLineWidth) || 0;\n    }\n  }, {\n    key: \"getLineBoundingRects\",\n    value: function getLineBoundingRects() {\n      var _this$parsedStyle$met2;\n      this.getGeometryBounds();\n      return ((_this$parsedStyle$met2 = this.parsedStyle.metrics) === null || _this$parsedStyle$met2 === void 0 ? void 0 : _this$parsedStyle$met2.lineMetrics) || [];\n    }\n  }, {\n    key: \"isOverflowing\",\n    value: function isOverflowing() {\n      this.getGeometryBounds();\n      return !!this.parsedStyle.isOverflowing;\n    }\n  }]);\n}(DisplayObject);\n\n/**\n * canvas.customElements\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry\n */\nvar CustomElementRegistry = /*#__PURE__*/function () {\n  function CustomElementRegistry() {\n    _classCallCheck(this, CustomElementRegistry);\n    this.registry = {};\n    this.define(Shape.CIRCLE, Circle);\n    this.define(Shape.ELLIPSE, Ellipse);\n    this.define(Shape.RECT, Rect);\n    this.define(Shape.IMAGE, Image);\n    this.define(Shape.LINE, Line);\n    this.define(Shape.GROUP, Group);\n    this.define(Shape.PATH, Path);\n    this.define(Shape.POLYGON, Polygon);\n    this.define(Shape.POLYLINE, Polyline);\n    this.define(Shape.TEXT, Text);\n    this.define(Shape.HTML, HTML);\n  }\n  return _createClass(CustomElementRegistry, [{\n    key: \"define\",\n    value: function define(name, constructor) {\n      this.registry[name] = constructor;\n    }\n\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/get\n     */\n  }, {\n    key: \"get\",\n    value: function get(name) {\n      return this.registry[name];\n    }\n  }]);\n}();\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/RegisterProperty#parameters\n */\n\n/**\n * holds useful CSS-related methods.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS\n *\n * * CSS Typed OM @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/factory_functions\n * * register property @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/RegisterProperty\n * * CSS Layout API\n */\nvar CSS = {\n  /**\n   * <number>\n   * @see https://drafts.csswg.org/css-values-4/#number-value\n   */\n  number: function number(n) {\n    return new CSSUnitValue(n);\n  },\n  /**\n   * <percentage>\n   * @see https://drafts.csswg.org/css-values-4/#percentage-value\n   */\n  percent: function percent(n) {\n    return new CSSUnitValue(n, '%');\n  },\n  /**\n   * <length>\n   */\n  px: function px(n) {\n    return new CSSUnitValue(n, 'px');\n  },\n  /**\n   * <length>\n   */\n  em: function em(n) {\n    return new CSSUnitValue(n, 'em');\n  },\n  rem: function rem(n) {\n    return new CSSUnitValue(n, 'rem');\n  },\n  /**\n   * <angle>\n   */\n  deg: function deg(n) {\n    return new CSSUnitValue(n, 'deg');\n  },\n  /**\n   * <angle>\n   */\n  grad: function grad(n) {\n    return new CSSUnitValue(n, 'grad');\n  },\n  /**\n   * <angle>\n   */\n  rad: function rad(n) {\n    return new CSSUnitValue(n, 'rad');\n  },\n  /**\n   * <angle>\n   */\n  turn: function turn(n) {\n    return new CSSUnitValue(n, 'turn');\n  },\n  /**\n   * <time>\n   */\n  s: function s(n) {\n    return new CSSUnitValue(n, 's');\n  },\n  /**\n   * <time>\n   */\n  ms: function ms(n) {\n    return new CSSUnitValue(n, 'ms');\n  },\n  /**\n   * CSS Properties & Values API\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS_Properties_and_Values_API\n   * @see https://drafts.css-houdini.org/css-properties-values-api/#registering-custom-properties\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/RegisterProperty\n   */\n  registerProperty: function registerProperty(definition) {\n    var name = definition.name,\n      inherits = definition.inherits,\n      interpolable = definition.interpolable,\n      initialValue = definition.initialValue,\n      syntax = definition.syntax;\n    runtime.styleValueRegistry.registerMetadata({\n      n: name,\n      inh: inherits,\n      \"int\": interpolable,\n      d: initialValue,\n      syntax: syntax\n    });\n  },\n  /**\n   * CSS Layout API\n   * register layout\n   *\n   * @see https://github.com/w3c/css-houdini-drafts/blob/main/css-layout-api/EXPLAINER.md\n   * @see https://developer.mozilla.org/en-US/docs/Web/Guide/Houdini#css_layout_api\n   */\n  registerLayout: function registerLayout(name, clazz) {\n    runtime.layoutRegistry.registerLayout(name, clazz);\n  }\n};\n\n/**\n * the entry of DOM tree\n * Document -> Node -> EventTarget\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document\n */\nvar Document = /*#__PURE__*/function (_Node) {\n  function Document() {\n    var _this;\n    _classCallCheck(this, Document);\n    _this = _callSuper(this, Document);\n    /**\n     * only document has defaultView, points to canvas,\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/defaultView\n     */\n    _this.defaultView = null;\n    _this.ownerDocument = null;\n    _this.nodeName = 'document';\n\n    // create timeline\n    try {\n      _this.timeline = new runtime.AnimationTimeline(_this);\n    } catch (_unused) {}\n\n    /**\n     * for inherited properties, the initial value is used on the root element only,\n     * as long as no specified value is supplied.\n     * @see https://developer.mozilla.org/en-US/docs/Web/CSS/initial_value\n     */\n    var initialStyle = {};\n    BUILT_IN_PROPERTIES.forEach(function (_ref) {\n      var n = _ref.n,\n        inh = _ref.inh,\n        d = _ref.d;\n      if (inh && d) {\n        initialStyle[n] = isFunction(d) ? d(Shape.GROUP) : d;\n      }\n    });\n\n    // like <html> in DOM tree\n    _this.documentElement = new Group({\n      id: 'g-root',\n      style: initialStyle\n    });\n    _this.documentElement.ownerDocument = _this;\n    _this.documentElement.parentNode = _this;\n    _this.childNodes = [_this.documentElement];\n    return _this;\n  }\n  _inherits(Document, _Node);\n  return _createClass(Document, [{\n    key: \"children\",\n    get: function get() {\n      return this.childNodes;\n    }\n  }, {\n    key: \"childElementCount\",\n    get: function get() {\n      return this.childNodes.length;\n    }\n  }, {\n    key: \"firstElementChild\",\n    get: function get() {\n      return this.firstChild;\n    }\n  }, {\n    key: \"lastElementChild\",\n    get: function get() {\n      return this.lastChild;\n    }\n  }, {\n    key: \"createElement\",\n    value:\n    /**\n     * @example const circle = document.createElement('circle', { style: { r: 10 } });\n     */\n    function createElement(tagName, options) {\n      // @observablehq/plot will create <svg>\n      if (tagName === 'svg') {\n        return this.documentElement;\n      }\n\n      // d3 will use <tspan>\n      var clazz = this.defaultView.customElements.get(tagName);\n      if (!clazz) {\n        console.warn('Unsupported tagName: ', tagName);\n        clazz = tagName === 'tspan' ? Text : Group;\n      }\n      var shape = new clazz(options);\n      shape.ownerDocument = this;\n      return shape;\n    }\n  }, {\n    key: \"createElementNS\",\n    value: function createElementNS(namespaceURI, tagName, options) {\n      return this.createElement(tagName, options);\n    }\n  }, {\n    key: \"cloneNode\",\n    value: function cloneNode(deep) {\n      throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      try {\n        this.documentElement.destroyChildren();\n        this.timeline.destroy();\n      } catch (_unused2) {}\n    }\n\n    /**\n     * Picking 2D graphics with RBush based on BBox, fast but inaccurate.\n     */\n  }, {\n    key: \"elementsFromBBox\",\n    value: function elementsFromBBox(minX, minY, maxX, maxY) {\n      var rBush = this.defaultView.context.rBushRoot;\n      var rBushNodes = rBush.search({\n        minX: minX,\n        minY: minY,\n        maxX: maxX,\n        maxY: maxY\n      });\n      var hitTestList = [];\n      rBushNodes.forEach(function (_ref2) {\n        var displayObject = _ref2.displayObject;\n        var _ref3 = displayObject.parsedStyle,\n          _ref3$pointerEvents = _ref3.pointerEvents,\n          pointerEvents = _ref3$pointerEvents === void 0 ? 'auto' : _ref3$pointerEvents;\n\n        // account for `visibility`\n        // @see https://developer.mozilla.org/en-US/docs/Web/CSS/pointer-events\n        var isVisibilityAffected = ['auto', 'visiblepainted', 'visiblefill', 'visiblestroke', 'visible'].includes(pointerEvents);\n        if ((!isVisibilityAffected || isVisibilityAffected && displayObject.isVisible()) && !displayObject.isCulled() && displayObject.isInteractive()) {\n          hitTestList.push(displayObject);\n        }\n      });\n      // find group with max z-index\n      hitTestList.sort(function (a, b) {\n        return b.sortable.renderOrder - a.sortable.renderOrder;\n      });\n      return hitTestList;\n    }\n  }, {\n    key: \"elementFromPointSync\",\n    value: function elementFromPointSync(x, y) {\n      var _this$defaultView$can = this.defaultView.canvas2Viewport({\n          x: x,\n          y: y\n        }),\n        viewportX = _this$defaultView$can.x,\n        viewportY = _this$defaultView$can.y;\n      var _this$defaultView$get = this.defaultView.getConfig(),\n        width = _this$defaultView$get.width,\n        height = _this$defaultView$get.height;\n      // outside canvas' viewport\n      if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n        return null;\n      }\n      var _this$defaultView$vie = this.defaultView.viewport2Client({\n          x: viewportX,\n          y: viewportY\n        }),\n        clientX = _this$defaultView$vie.x,\n        clientY = _this$defaultView$vie.y;\n      var _this$defaultView$get2 = this.defaultView.getRenderingService().hooks.pickSync.call({\n          topmost: true,\n          position: {\n            x: x,\n            y: y,\n            viewportX: viewportX,\n            viewportY: viewportY,\n            clientX: clientX,\n            clientY: clientY\n          },\n          picked: []\n        }),\n        picked = _this$defaultView$get2.picked;\n      return picked && picked[0] || this.documentElement;\n    }\n\n    /**\n     * Do picking with API instead of triggering interactive events.\n     *\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementFromPoint\n     */\n  }, {\n    key: \"elementFromPoint\",\n    value: function () {\n      var _elementFromPoint = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(x, y) {\n        var _this$defaultView$can2, viewportX, viewportY, _this$defaultView$get3, width, height, _this$defaultView$vie2, clientX, clientY, _yield$this$defaultVi, picked;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _this$defaultView$can2 = this.defaultView.canvas2Viewport({\n                x: x,\n                y: y\n              }), viewportX = _this$defaultView$can2.x, viewportY = _this$defaultView$can2.y;\n              _this$defaultView$get3 = this.defaultView.getConfig(), width = _this$defaultView$get3.width, height = _this$defaultView$get3.height; // outside canvas' viewport\n              if (!(viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height)) {\n                _context.next = 4;\n                break;\n              }\n              return _context.abrupt(\"return\", null);\n            case 4:\n              _this$defaultView$vie2 = this.defaultView.viewport2Client({\n                x: viewportX,\n                y: viewportY\n              }), clientX = _this$defaultView$vie2.x, clientY = _this$defaultView$vie2.y;\n              _context.next = 7;\n              return this.defaultView.getRenderingService().hooks.pick.promise({\n                topmost: true,\n                position: {\n                  x: x,\n                  y: y,\n                  viewportX: viewportX,\n                  viewportY: viewportY,\n                  clientX: clientX,\n                  clientY: clientY\n                },\n                picked: []\n              });\n            case 7:\n              _yield$this$defaultVi = _context.sent;\n              picked = _yield$this$defaultVi.picked;\n              return _context.abrupt(\"return\", picked && picked[0] || this.documentElement);\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this);\n      }));\n      function elementFromPoint(_x, _x2) {\n        return _elementFromPoint.apply(this, arguments);\n      }\n      return elementFromPoint;\n    }()\n  }, {\n    key: \"elementsFromPointSync\",\n    value: function elementsFromPointSync(x, y) {\n      var _this$defaultView$can3 = this.defaultView.canvas2Viewport({\n          x: x,\n          y: y\n        }),\n        viewportX = _this$defaultView$can3.x,\n        viewportY = _this$defaultView$can3.y;\n      var _this$defaultView$get4 = this.defaultView.getConfig(),\n        width = _this$defaultView$get4.width,\n        height = _this$defaultView$get4.height;\n      // outside canvas' viewport\n      if (viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height) {\n        return [];\n      }\n      var _this$defaultView$vie3 = this.defaultView.viewport2Client({\n          x: viewportX,\n          y: viewportY\n        }),\n        clientX = _this$defaultView$vie3.x,\n        clientY = _this$defaultView$vie3.y;\n      var _this$defaultView$get5 = this.defaultView.getRenderingService().hooks.pickSync.call({\n          topmost: false,\n          position: {\n            x: x,\n            y: y,\n            viewportX: viewportX,\n            viewportY: viewportY,\n            clientX: clientX,\n            clientY: clientY\n          },\n          picked: []\n        }),\n        picked = _this$defaultView$get5.picked;\n      if (picked[picked.length - 1] !== this.documentElement) {\n        picked.push(this.documentElement);\n      }\n      return picked;\n    }\n\n    /**\n     * Do picking with API instead of triggering interactive events.\n     *\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint\n     */\n  }, {\n    key: \"elementsFromPoint\",\n    value: function () {\n      var _elementsFromPoint = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(x, y) {\n        var _this$defaultView$can4, viewportX, viewportY, _this$defaultView$get6, width, height, _this$defaultView$vie4, clientX, clientY, _yield$this$defaultVi2, picked;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _this$defaultView$can4 = this.defaultView.canvas2Viewport({\n                x: x,\n                y: y\n              }), viewportX = _this$defaultView$can4.x, viewportY = _this$defaultView$can4.y;\n              _this$defaultView$get6 = this.defaultView.getConfig(), width = _this$defaultView$get6.width, height = _this$defaultView$get6.height; // outside canvas' viewport\n              if (!(viewportX < 0 || viewportY < 0 || viewportX > width || viewportY > height)) {\n                _context2.next = 4;\n                break;\n              }\n              return _context2.abrupt(\"return\", []);\n            case 4:\n              _this$defaultView$vie4 = this.defaultView.viewport2Client({\n                x: viewportX,\n                y: viewportY\n              }), clientX = _this$defaultView$vie4.x, clientY = _this$defaultView$vie4.y;\n              _context2.next = 7;\n              return this.defaultView.getRenderingService().hooks.pick.promise({\n                topmost: false,\n                position: {\n                  x: x,\n                  y: y,\n                  viewportX: viewportX,\n                  viewportY: viewportY,\n                  clientX: clientX,\n                  clientY: clientY\n                },\n                picked: []\n              });\n            case 7:\n              _yield$this$defaultVi2 = _context2.sent;\n              picked = _yield$this$defaultVi2.picked;\n              if (picked[picked.length - 1] !== this.documentElement) {\n                picked.push(this.documentElement);\n              }\n              return _context2.abrupt(\"return\", picked);\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function elementsFromPoint(_x3, _x4) {\n        return _elementsFromPoint.apply(this, arguments);\n      }\n      return elementsFromPoint;\n    }()\n    /**\n     * eg. Uncaught DOMException: Failed to execute 'appendChild' on 'Node': Only one element on document allowed.\n     */\n  }, {\n    key: \"appendChild\",\n    value: function appendChild(newChild, index) {\n      throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n    }\n  }, {\n    key: \"insertBefore\",\n    value: function insertBefore(newChild, refChild) {\n      throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n    }\n  }, {\n    key: \"removeChild\",\n    value: function removeChild(oldChild, destroy) {\n      throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n    }\n  }, {\n    key: \"replaceChild\",\n    value: function replaceChild(newChild, oldChild, destroy) {\n      throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n    }\n  }, {\n    key: \"append\",\n    value: function append() {\n      throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n    }\n  }, {\n    key: \"prepend\",\n    value: function prepend() {\n      throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n    }\n\n    /**\n     * Execute query on documentElement.\n     */\n  }, {\n    key: \"getElementById\",\n    value: function getElementById(id) {\n      return this.documentElement.getElementById(id);\n    }\n  }, {\n    key: \"getElementsByName\",\n    value: function getElementsByName(name) {\n      return this.documentElement.getElementsByName(name);\n    }\n  }, {\n    key: \"getElementsByTagName\",\n    value: function getElementsByTagName(tagName) {\n      return this.documentElement.getElementsByTagName(tagName);\n    }\n  }, {\n    key: \"getElementsByClassName\",\n    value: function getElementsByClassName(className) {\n      return this.documentElement.getElementsByClassName(className);\n    }\n  }, {\n    key: \"querySelector\",\n    value: function querySelector(selectors) {\n      return this.documentElement.querySelector(selectors);\n    }\n  }, {\n    key: \"querySelectorAll\",\n    value: function querySelectorAll(selectors) {\n      return this.documentElement.querySelectorAll(selectors);\n    }\n  }, {\n    key: \"find\",\n    value: function find(filter) {\n      return this.documentElement.find(filter);\n    }\n  }, {\n    key: \"findAll\",\n    value: function findAll(filter) {\n      return this.documentElement.findAll(filter);\n    }\n  }]);\n}(Node);\n\n/**\n * apply following rules:\n * 1. `visibility` in scenegraph node\n * 2. other custom culling strategies, eg. frustum culling\n */\nvar CullingPlugin = /*#__PURE__*/function () {\n  function CullingPlugin(strategies) {\n    _classCallCheck(this, CullingPlugin);\n    this.strategies = strategies;\n  }\n  return _createClass(CullingPlugin, [{\n    key: \"apply\",\n    value: function apply(context) {\n      var camera = context.camera,\n        renderingService = context.renderingService,\n        renderingContext = context.renderingContext;\n      var strategies = this.strategies;\n      renderingService.hooks.cull.tap(CullingPlugin.tag, function (object) {\n        if (object) {\n          var cullable = object.cullable;\n          // cullable.visible = true;\n          // const renderBounds = object.getRenderBounds();\n          // if (AABB.isEmpty(renderBounds)) {\n          //   cullable.visible = false;\n          // } else {\n          //   const isShape2D = shape2D.indexOf(object.nodeName as Shape) > -1;\n          //   const [p0, p1, p2, p3] = camera.getFrustum().planes;\n          //   tmpAABB.setMinMax([-p1.distance, -p3.distance, 0], [p0.distance, p2.distance, 0]);\n\n          //   cullable.visible = isShape2D ? renderBounds.intersects(tmpAABB) : true;\n          // }\n\n          if (strategies.length === 0) {\n            cullable.visible = renderingContext.unculledEntities.indexOf(object.entity) > -1;\n          } else {\n            // eg. implemented by g-webgl(frustum culling)\n            cullable.visible = strategies.every(function (strategy) {\n              return strategy.isVisible(camera, object);\n            });\n          }\n          if (!object.isCulled() && object.isVisible()) {\n            return object;\n          }\n          // if (this.renderingContext.renderListLastFrame.indexOf(object) > -1) {\n          object.dispatchEvent(new CustomEvent(ElementEvent.CULLED));\n          // }\n\n          return null;\n        }\n        return object;\n      });\n      renderingService.hooks.afterRender.tap(CullingPlugin.tag, function (object) {\n        object.cullable.visibilityPlaneMask = -1;\n      });\n    }\n  }]);\n}();\nCullingPlugin.tag = 'Culling';\n\n/**\n * support mouse & touch events\n * @see https://github.com/pixijs/pixi.js/blob/dev/packages/interaction/README.md\n *\n * also provide some extra events such as `drag`\n */\nvar EventPlugin = /*#__PURE__*/function () {\n  function EventPlugin() {\n    var _this = this;\n    _classCallCheck(this, EventPlugin);\n    this.autoPreventDefault = false;\n    this.rootPointerEvent = new FederatedPointerEvent(null);\n    this.rootWheelEvent = new FederatedWheelEvent(null);\n    this.onPointerMove = function (nativeEvent) {\n      var _this$context$renderi;\n      var canvas = (_this$context$renderi = _this.context.renderingContext.root) === null || _this$context$renderi === void 0 || (_this$context$renderi = _this$context$renderi.ownerDocument) === null || _this$context$renderi === void 0 ? void 0 : _this$context$renderi.defaultView;\n      if (canvas.supportsTouchEvents && nativeEvent.pointerType === 'touch') return;\n      var normalizedEvents = _this.normalizeToPointerEvent(nativeEvent, canvas);\n      var _iterator = _createForOfIteratorHelper(normalizedEvents),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var normalizedEvent = _step.value;\n          var event = _this.bootstrapEvent(_this.rootPointerEvent, normalizedEvent, canvas, nativeEvent);\n          _this.context.eventService.mapEvent(event);\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      _this.setCursor(_this.context.eventService.cursor);\n    };\n    this.onClick = function (nativeEvent) {\n      var _this$context$renderi2;\n      var canvas = (_this$context$renderi2 = _this.context.renderingContext.root) === null || _this$context$renderi2 === void 0 || (_this$context$renderi2 = _this$context$renderi2.ownerDocument) === null || _this$context$renderi2 === void 0 ? void 0 : _this$context$renderi2.defaultView;\n      var normalizedEvents = _this.normalizeToPointerEvent(nativeEvent, canvas);\n      var _iterator2 = _createForOfIteratorHelper(normalizedEvents),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var normalizedEvent = _step2.value;\n          var event = _this.bootstrapEvent(_this.rootPointerEvent, normalizedEvent, canvas, nativeEvent);\n          _this.context.eventService.mapEvent(event);\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n      _this.setCursor(_this.context.eventService.cursor);\n    };\n  }\n  return _createClass(EventPlugin, [{\n    key: \"apply\",\n    value: function apply(context) {\n      var _this2 = this;\n      this.context = context;\n      var renderingService = context.renderingService;\n      var canvas = this.context.renderingContext.root.ownerDocument.defaultView;\n      this.context.eventService.setPickHandler(function (position) {\n        var _this2$context$render = _this2.context.renderingService.hooks.pickSync.call({\n            position: position,\n            picked: [],\n            topmost: true // we only concern the topmost element\n          }),\n          picked = _this2$context$render.picked;\n        return picked[0] || null;\n      });\n      renderingService.hooks.pointerWheel.tap(EventPlugin.tag, function (nativeEvent) {\n        var wheelEvent = _this2.normalizeWheelEvent(nativeEvent);\n        _this2.context.eventService.mapEvent(wheelEvent);\n      });\n      renderingService.hooks.pointerDown.tap(EventPlugin.tag, function (nativeEvent) {\n        if (canvas.supportsTouchEvents && nativeEvent.pointerType === 'touch') return;\n        var events = _this2.normalizeToPointerEvent(nativeEvent, canvas);\n        if (_this2.autoPreventDefault && events[0].isNormalized) {\n          var cancelable = nativeEvent.cancelable || !('cancelable' in nativeEvent);\n          if (cancelable) {\n            nativeEvent.preventDefault();\n          }\n        }\n        var _iterator3 = _createForOfIteratorHelper(events),\n          _step3;\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var event = _step3.value;\n            var federatedEvent = _this2.bootstrapEvent(_this2.rootPointerEvent, event, canvas, nativeEvent);\n            _this2.context.eventService.mapEvent(federatedEvent);\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n        _this2.setCursor(_this2.context.eventService.cursor);\n      });\n      renderingService.hooks.pointerUp.tap(EventPlugin.tag, function (nativeEvent) {\n        if (canvas.supportsTouchEvents && nativeEvent.pointerType === 'touch') return;\n\n        // account for element in SVG\n        var $element = _this2.context.contextService.getDomElement();\n        var isNativeEventFromCanvas = _this2.context.eventService.isNativeEventFromCanvas($element, nativeEvent);\n        var outside = !isNativeEventFromCanvas ? 'outside' : '';\n        var normalizedEvents = _this2.normalizeToPointerEvent(nativeEvent, canvas);\n        var _iterator4 = _createForOfIteratorHelper(normalizedEvents),\n          _step4;\n        try {\n          for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n            var normalizedEvent = _step4.value;\n            var event = _this2.bootstrapEvent(_this2.rootPointerEvent, normalizedEvent, canvas, nativeEvent);\n            event.type += outside;\n            _this2.context.eventService.mapEvent(event);\n          }\n        } catch (err) {\n          _iterator4.e(err);\n        } finally {\n          _iterator4.f();\n        }\n        _this2.setCursor(_this2.context.eventService.cursor);\n      });\n      renderingService.hooks.pointerMove.tap(EventPlugin.tag, this.onPointerMove);\n      renderingService.hooks.pointerOver.tap(EventPlugin.tag, this.onPointerMove);\n      renderingService.hooks.pointerOut.tap(EventPlugin.tag, this.onPointerMove);\n      renderingService.hooks.click.tap(EventPlugin.tag, this.onClick);\n      renderingService.hooks.pointerCancel.tap(EventPlugin.tag, function (nativeEvent) {\n        var normalizedEvents = _this2.normalizeToPointerEvent(nativeEvent, canvas);\n        var _iterator5 = _createForOfIteratorHelper(normalizedEvents),\n          _step5;\n        try {\n          for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n            var normalizedEvent = _step5.value;\n            var event = _this2.bootstrapEvent(_this2.rootPointerEvent, normalizedEvent, canvas, nativeEvent);\n            _this2.context.eventService.mapEvent(event);\n          }\n        } catch (err) {\n          _iterator5.e(err);\n        } finally {\n          _iterator5.f();\n        }\n        _this2.setCursor(_this2.context.eventService.cursor);\n      });\n    }\n  }, {\n    key: \"bootstrapEvent\",\n    value: function bootstrapEvent(event, normalizedEvent, view, nativeEvent) {\n      event.view = view;\n      event.originalEvent = null;\n      event.nativeEvent = nativeEvent;\n      event.pointerId = normalizedEvent.pointerId;\n      event.width = normalizedEvent.width;\n      event.height = normalizedEvent.height;\n      event.isPrimary = normalizedEvent.isPrimary;\n      event.pointerType = normalizedEvent.pointerType;\n      event.pressure = normalizedEvent.pressure;\n      event.tangentialPressure = normalizedEvent.tangentialPressure;\n      event.tiltX = normalizedEvent.tiltX;\n      event.tiltY = normalizedEvent.tiltY;\n      event.twist = normalizedEvent.twist;\n      this.transferMouseData(event, normalizedEvent);\n      var _this$context$eventSe = this.context.eventService.client2Viewport({\n          x: normalizedEvent.clientX,\n          y: normalizedEvent.clientY\n        }),\n        x = _this$context$eventSe.x,\n        y = _this$context$eventSe.y;\n      event.viewport.x = x;\n      event.viewport.y = y;\n      var _this$context$eventSe2 = this.context.eventService.viewport2Canvas(event.viewport),\n        canvasX = _this$context$eventSe2.x,\n        canvasY = _this$context$eventSe2.y;\n      event.canvas.x = canvasX;\n      event.canvas.y = canvasY;\n      event.global.copyFrom(event.canvas);\n      event.offset.copyFrom(event.canvas);\n      event.isTrusted = nativeEvent.isTrusted;\n      if (event.type === 'pointerleave') {\n        event.type = 'pointerout';\n      }\n      if (event.type.startsWith('mouse')) {\n        event.type = event.type.replace('mouse', 'pointer');\n      }\n      if (event.type.startsWith('touch')) {\n        event.type = TOUCH_TO_POINTER[event.type] || event.type;\n      }\n      return event;\n    }\n  }, {\n    key: \"normalizeWheelEvent\",\n    value: function normalizeWheelEvent(nativeEvent) {\n      var event = this.rootWheelEvent;\n      this.transferMouseData(event, nativeEvent);\n      event.deltaMode = nativeEvent.deltaMode;\n      event.deltaX = nativeEvent.deltaX;\n      event.deltaY = nativeEvent.deltaY;\n      event.deltaZ = nativeEvent.deltaZ;\n      var _this$context$eventSe3 = this.context.eventService.client2Viewport({\n          x: nativeEvent.clientX,\n          y: nativeEvent.clientY\n        }),\n        x = _this$context$eventSe3.x,\n        y = _this$context$eventSe3.y;\n      event.viewport.x = x;\n      event.viewport.y = y;\n      var _this$context$eventSe4 = this.context.eventService.viewport2Canvas(event.viewport),\n        canvasX = _this$context$eventSe4.x,\n        canvasY = _this$context$eventSe4.y;\n      event.canvas.x = canvasX;\n      event.canvas.y = canvasY;\n      event.global.copyFrom(event.canvas);\n      event.offset.copyFrom(event.canvas);\n      event.nativeEvent = nativeEvent;\n      event.type = nativeEvent.type;\n      return event;\n    }\n\n    /**\n     * Transfers base & mouse event data from the nativeEvent to the federated event.\n     */\n  }, {\n    key: \"transferMouseData\",\n    value: function transferMouseData(event, nativeEvent) {\n      event.isTrusted = nativeEvent.isTrusted;\n      event.srcElement = nativeEvent.srcElement;\n      event.timeStamp = clock.now();\n      event.type = nativeEvent.type;\n      event.altKey = nativeEvent.altKey;\n      event.metaKey = nativeEvent.metaKey;\n      event.shiftKey = nativeEvent.shiftKey;\n      event.ctrlKey = nativeEvent.ctrlKey;\n      event.button = nativeEvent.button;\n      event.buttons = nativeEvent.buttons;\n      event.client.x = nativeEvent.clientX;\n      event.client.y = nativeEvent.clientY;\n      event.movement.x = nativeEvent.movementX;\n      event.movement.y = nativeEvent.movementY;\n      event.page.x = nativeEvent.pageX;\n      event.page.y = nativeEvent.pageY;\n      event.screen.x = nativeEvent.screenX;\n      event.screen.y = nativeEvent.screenY;\n      event.relatedTarget = null;\n    }\n  }, {\n    key: \"setCursor\",\n    value: function setCursor(cursor) {\n      this.context.contextService.applyCursorStyle(cursor || this.context.config.cursor || 'default');\n    }\n  }, {\n    key: \"normalizeToPointerEvent\",\n    value: function normalizeToPointerEvent(event, canvas) {\n      var normalizedEvents = [];\n      if (canvas.isTouchEvent(event)) {\n        for (var i = 0; i < event.changedTouches.length; i++) {\n          var touch = event.changedTouches[i];\n\n          // use changedTouches instead of touches since touchend has no touches\n          // @see https://stackoverflow.com/a/10079076\n          if (isUndefined(touch.button)) touch.button = 0;\n          if (isUndefined(touch.buttons)) touch.buttons = 1;\n          if (isUndefined(touch.isPrimary)) {\n            touch.isPrimary = event.touches.length === 1 && event.type === 'touchstart';\n          }\n          if (isUndefined(touch.width)) touch.width = touch.radiusX || 1;\n          if (isUndefined(touch.height)) touch.height = touch.radiusY || 1;\n          if (isUndefined(touch.tiltX)) touch.tiltX = 0;\n          if (isUndefined(touch.tiltY)) touch.tiltY = 0;\n          if (isUndefined(touch.pointerType)) touch.pointerType = 'touch';\n          // @see https://developer.mozilla.org/zh-CN/docs/Web/API/Touch/identifier\n          if (isUndefined(touch.pointerId)) touch.pointerId = touch.identifier || 0;\n          if (isUndefined(touch.pressure)) touch.pressure = touch.force || 0.5;\n          if (isUndefined(touch.twist)) touch.twist = 0;\n          if (isUndefined(touch.tangentialPressure)) touch.tangentialPressure = 0;\n          touch.isNormalized = true;\n          touch.type = event.type;\n          normalizedEvents.push(touch);\n        }\n      } else if (canvas.isMouseEvent(event)) {\n        var tempEvent = event;\n        if (isUndefined(tempEvent.isPrimary)) tempEvent.isPrimary = true;\n        if (isUndefined(tempEvent.width)) tempEvent.width = 1;\n        if (isUndefined(tempEvent.height)) tempEvent.height = 1;\n        if (isUndefined(tempEvent.tiltX)) tempEvent.tiltX = 0;\n        if (isUndefined(tempEvent.tiltY)) tempEvent.tiltY = 0;\n        if (isUndefined(tempEvent.pointerType)) tempEvent.pointerType = 'mouse';\n        if (isUndefined(tempEvent.pointerId)) tempEvent.pointerId = MOUSE_POINTER_ID;\n        if (isUndefined(tempEvent.pressure)) tempEvent.pressure = 0.5;\n        if (isUndefined(tempEvent.twist)) tempEvent.twist = 0;\n        if (isUndefined(tempEvent.tangentialPressure)) tempEvent.tangentialPressure = 0;\n        tempEvent.isNormalized = true;\n        normalizedEvents.push(tempEvent);\n      } else {\n        normalizedEvents.push(event);\n      }\n      return normalizedEvents;\n    }\n  }]);\n}();\nEventPlugin.tag = 'Event';\n\n// group is not a 2d shape\nvar shape2D = [Shape.CIRCLE, Shape.ELLIPSE, Shape.IMAGE, Shape.RECT, Shape.LINE, Shape.POLYLINE, Shape.POLYGON, Shape.TEXT, Shape.PATH, Shape.HTML];\nvar FrustumCullingStrategy = /*#__PURE__*/function () {\n  function FrustumCullingStrategy() {\n    _classCallCheck(this, FrustumCullingStrategy);\n  }\n  return _createClass(FrustumCullingStrategy, [{\n    key: \"isVisible\",\n    value: function isVisible(camera, object) {\n      var _object$parentNode;\n      // return true;\n\n      var cullable = object.cullable;\n      if (!cullable.enable) {\n        return true;\n      }\n      var renderBounds = object.getRenderBounds();\n      if (AABB.isEmpty(renderBounds)) {\n        return false;\n      }\n\n      // get VP matrix from camera\n      var frustum = camera.getFrustum();\n      var parentVisibilityPlaneMask = (_object$parentNode = object.parentNode) === null || _object$parentNode === void 0 || (_object$parentNode = _object$parentNode.cullable) === null || _object$parentNode === void 0 ? void 0 : _object$parentNode.visibilityPlaneMask;\n      cullable.visibilityPlaneMask = this.computeVisibilityWithPlaneMask(object, renderBounds, parentVisibilityPlaneMask || Mask.INDETERMINATE, frustum.planes);\n      cullable.visible = cullable.visibilityPlaneMask !== Mask.OUTSIDE;\n      return cullable.visible;\n    }\n\n    /**\n     *\n     * @see「Optimized View Frustum Culling Algorithms for Bounding Boxes」\n     * @see https://github.com/antvis/GWebGPUEngine/issues/3\n     *\n     * * 基础相交测试 the basic intersection test\n     * * 标记 masking @see https://cesium.com/blog/2015/08/04/fast-hierarchical-culling/\n     * * TODO: 平面一致性测试 the plane-coherency test\n     * * TODO: 支持 mesh 指定自身的剔除策略，参考 Babylon.js @see https://doc.babylonjs.com/how_to/optimizing_your_scene#changing-mesh-culling-strategy\n     *\n     * @param aabb aabb\n     * @param parentPlaneMask mask of parent\n     * @param planes planes of frustum\n     */\n  }, {\n    key: \"computeVisibilityWithPlaneMask\",\n    value: function computeVisibilityWithPlaneMask(object, aabb, parentPlaneMask, planes) {\n      if (parentPlaneMask === Mask.OUTSIDE || parentPlaneMask === Mask.INSIDE) {\n        // 父节点完全位于视锥内或者外部，直接返回\n        return parentPlaneMask;\n      }\n\n      // Start with MASK_INSIDE (all zeros) so that after the loop, the return value can be compared with MASK_INSIDE.\n      // (Because if there are fewer than 31 planes, the upper bits wont be changed.)\n      var mask = Mask.INSIDE;\n      var isShape2D = shape2D.indexOf(object.nodeName) > -1;\n\n      // Use viewport culling for 2D shapes\n      // @see https://github.com/antvis/g/issues/914\n      for (var k = 0, len = planes.length; k < len; ++k) {\n        // For k greater than 31 (since 31 is the maximum number of INSIDE/INTERSECTING bits we can store), skip the optimization.\n        var flag = 1 << k;\n        if ((parentPlaneMask & flag) === 0) {\n          // 父节点处于当前面内部，可以跳过\n          continue;\n        }\n\n        // skip near & far planes when testing 2D shapes\n        if (isShape2D && (k === 4 || k === 5)) {\n          continue;\n        }\n\n        // p-vertex n-vertex <-|plane p-vertex n-vertex\n        // 使用 p-vertex 和 n-vertex 加速，避免进行平面和 aabb 全部顶点的相交检测\n        var _planes$k = planes[k],\n          normal = _planes$k.normal,\n          distance = _planes$k.distance;\n        if (vec3.dot(normal, aabb.getPositiveFarPoint(planes[k])) + distance < 0) {\n          return Mask.OUTSIDE;\n        }\n        if (vec3.dot(normal, aabb.getNegativeFarPoint(planes[k])) + distance < 0) {\n          // 和当前面相交，对应位置为1，继续检测下一个面\n          mask |= flag;\n        }\n      }\n      return mask;\n    }\n  }]);\n}();\nvar PrepareRendererPlugin = /*#__PURE__*/function () {\n  function PrepareRendererPlugin() {\n    _classCallCheck(this, PrepareRendererPlugin);\n    this.syncTasks = new Map();\n    this.isFirstTimeRendering = true;\n    this.syncing = false;\n    this.isFirstTimeRenderingFinished = false;\n  }\n  return _createClass(PrepareRendererPlugin, [{\n    key: \"apply\",\n    value: function apply(context) {\n      var _this = this,\n        _runtime$globalThis$r;\n      var renderingService = context.renderingService,\n        renderingContext = context.renderingContext,\n        rBushRoot = context.rBushRoot;\n      var canvas = renderingContext.root.ownerDocument.defaultView;\n      this.rBush = rBushRoot;\n      var handleAttributeChanged = function handleAttributeChanged(e) {\n        var object = e.target;\n        object.renderable.dirty = true;\n        renderingService.dirtify();\n      };\n      var handleBoundsChanged = function handleBoundsChanged(e) {\n        _this.syncTasks.set(e.target, e.detail.affectChildren);\n        renderingService.dirtify();\n      };\n      var handleMounted = function handleMounted(e) {\n        var object = e.target;\n        if (runtime.enableSizeAttenuation) {\n          runtime.styleValueRegistry.updateSizeAttenuation(object, canvas.getCamera().getZoom());\n        }\n      };\n      var handleUnmounted = function handleUnmounted(e) {\n        var object = e.target;\n        var rBushNode = object.rBushNode;\n        if (rBushNode.aabb) {\n          _this.rBush.remove(rBushNode.aabb);\n        }\n        _this.syncTasks[\"delete\"](object);\n        runtime.sceneGraphService.dirtifyToRoot(object);\n        renderingService.dirtify();\n      };\n      renderingService.hooks.init.tap(PrepareRendererPlugin.tag, function () {\n        canvas.addEventListener(ElementEvent.MOUNTED, handleMounted);\n        canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n        canvas.addEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n        canvas.addEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n      });\n      renderingService.hooks.destroy.tap(PrepareRendererPlugin.tag, function () {\n        canvas.removeEventListener(ElementEvent.MOUNTED, handleMounted);\n        canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n        canvas.removeEventListener(ElementEvent.ATTR_MODIFIED, handleAttributeChanged);\n        canvas.removeEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n        _this.syncTasks.clear();\n      });\n      var ric = (_runtime$globalThis$r = runtime.globalThis.requestIdleCallback) !== null && _runtime$globalThis$r !== void 0 ? _runtime$globalThis$r : raf.bind(runtime.globalThis);\n      renderingService.hooks.endFrame.tap(PrepareRendererPlugin.tag, function () {\n        if (_this.isFirstTimeRendering) {\n          _this.isFirstTimeRendering = false;\n          _this.syncing = true;\n          ric(function () {\n            _this.syncRTree(true);\n            _this.isFirstTimeRenderingFinished = true;\n          });\n        } else {\n          _this.syncRTree();\n        }\n      });\n    }\n  }, {\n    key: \"syncNode\",\n    value: function syncNode(node) {\n      var force = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!node.isConnected) return;\n      var rBushNode = node.rBushNode;\n\n      // clear dirty node\n      if (rBushNode.aabb) this.rBush.remove(rBushNode.aabb);\n      var renderBounds = node.getRenderBounds();\n      if (renderBounds) {\n        var renderable = node.renderable;\n        if (force) {\n          if (!renderable.dirtyRenderBounds) {\n            renderable.dirtyRenderBounds = new AABB();\n          }\n          // save last dirty aabb\n          renderable.dirtyRenderBounds.update(renderBounds.center, renderBounds.halfExtents);\n        }\n        var _renderBounds$getMin = renderBounds.getMin(),\n          _renderBounds$getMin2 = _slicedToArray(_renderBounds$getMin, 2),\n          minX = _renderBounds$getMin2[0],\n          minY = _renderBounds$getMin2[1];\n        var _renderBounds$getMax = renderBounds.getMax(),\n          _renderBounds$getMax2 = _slicedToArray(_renderBounds$getMax, 2),\n          maxX = _renderBounds$getMax2[0],\n          maxY = _renderBounds$getMax2[1];\n        if (!rBushNode.aabb) {\n          rBushNode.aabb = {};\n        }\n        rBushNode.aabb.displayObject = node;\n        rBushNode.aabb.minX = minX;\n        rBushNode.aabb.minY = minY;\n        rBushNode.aabb.maxX = maxX;\n        rBushNode.aabb.maxY = maxY;\n      }\n      if (rBushNode.aabb) {\n        // TODO: NaN occurs when width/height of Rect is 0\n        if (!isNaN(rBushNode.aabb.maxX) && !isNaN(rBushNode.aabb.maxX) && !isNaN(rBushNode.aabb.minX) && !isNaN(rBushNode.aabb.minY)) {\n          return rBushNode.aabb;\n        }\n      }\n    }\n  }, {\n    key: \"syncRTree\",\n    value: function syncRTree() {\n      var _this2 = this;\n      var force = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n      if (!force && (this.syncing || this.syncTasks.size === 0)) {\n        return;\n      }\n      this.syncing = true;\n\n      // bounds changed, need re-inserting its children\n      var bulk = [];\n      var synced = new Set();\n      var sync = function sync(node) {\n        if (!synced.has(node) && node.renderable) {\n          var aabb = _this2.syncNode(node, force);\n          if (aabb) {\n            bulk.push(aabb);\n            synced.add(node);\n          }\n        }\n      };\n      this.syncTasks.forEach(function (affectChildren, node) {\n        if (affectChildren) {\n          node.forEach(sync);\n        }\n        var parent = node;\n        while (parent) {\n          sync(parent);\n          parent = parent.parentElement;\n        }\n      });\n\n      // use bulk inserting, which is ~2-3 times faster\n      // @see https://github.com/mourner/rbush#bulk-inserting-data\n      this.rBush.load(bulk);\n      bulk.length = 0;\n      this.syncing = false;\n    }\n  }]);\n}();\nPrepareRendererPlugin.tag = 'Prepare';\nfunction isCanvas(value) {\n  return !!value.document;\n}\nvar CanvasEvent = /*#__PURE__*/function (CanvasEvent) {\n  CanvasEvent[\"READY\"] = \"ready\";\n  CanvasEvent[\"BEFORE_RENDER\"] = \"beforerender\";\n  CanvasEvent[\"RERENDER\"] = \"rerender\";\n  CanvasEvent[\"AFTER_RENDER\"] = \"afterrender\";\n  CanvasEvent[\"BEFORE_DESTROY\"] = \"beforedestroy\";\n  CanvasEvent[\"AFTER_DESTROY\"] = \"afterdestroy\";\n  CanvasEvent[\"RESIZE\"] = \"resize\";\n  CanvasEvent[\"DIRTY_RECTANGLE\"] = \"dirtyrectangle\";\n  CanvasEvent[\"RENDERER_CHANGED\"] = \"rendererchanged\";\n  return CanvasEvent;\n}({});\nvar DEFAULT_CAMERA_Z = 500;\nvar DEFAULT_CAMERA_NEAR = 0.1;\nvar DEFAULT_CAMERA_FAR = 1000;\n\n/**\n * reuse custom event preventing from re-create them in every frame\n */\nvar mountedEvent = new CustomEvent(ElementEvent.MOUNTED);\nvar unmountedEvent = new CustomEvent(ElementEvent.UNMOUNTED);\nvar beforeRenderEvent = new CustomEvent(CanvasEvent.BEFORE_RENDER);\nvar rerenderEvent = new CustomEvent(CanvasEvent.RERENDER);\nvar afterRenderEvent = new CustomEvent(CanvasEvent.AFTER_RENDER);\n\n/**\n * can be treated like Window in DOM\n * provide some extra methods like `window`, such as:\n * * `window.requestAnimationFrame`\n * * `window.devicePixelRatio`\n *\n * prototype chains: Canvas(Window) -> EventTarget\n */\nvar Canvas = /*#__PURE__*/function (_EventTarget) {\n  function Canvas(config) {\n    var _this;\n    _classCallCheck(this, Canvas);\n    _this = _callSuper(this, Canvas);\n\n    // create document\n    /**\n     * window.document\n     */\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry\n     */\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\n     */\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame\n     */\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\n     */\n    /**\n     * whether the runtime supports PointerEvent?\n     * if not, the event system won't trigger pointer events like `pointerdown`\n     */\n    /**\n     * whether the runtime supports TouchEvent?\n     * if not, the event system won't trigger touch events like `touchstart`\n     */\n    /**\n     * is this native event a TouchEvent?\n     */\n    /**\n     * is this native event a MouseEvent?\n     */\n    /**\n     * double click speed (ms), default is 200ms\n     */\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Element\n     */\n    _this.Element = DisplayObject;\n    _this.inited = false;\n    _this.context = {};\n    _this.document = new Document();\n    _this.document.defaultView = _this;\n\n    // create registry of custom elements\n    _this.customElements = new CustomElementRegistry();\n    var container = config.container,\n      canvas = config.canvas,\n      offscreenCanvas = config.offscreenCanvas,\n      width = config.width,\n      height = config.height,\n      devicePixelRatio = config.devicePixelRatio,\n      renderer = config.renderer,\n      background = config.background,\n      cursor = config.cursor,\n      document = config.document,\n      requestAnimationFrame = config.requestAnimationFrame,\n      cancelAnimationFrame = config.cancelAnimationFrame,\n      createImage = config.createImage,\n      enableLargeImageOptimization = config.enableLargeImageOptimization,\n      supportsPointerEvents = config.supportsPointerEvents,\n      supportsTouchEvents = config.supportsTouchEvents,\n      supportsCSSTransform = config.supportsCSSTransform,\n      _config$cleanUpOnDest = config.cleanUpOnDestroy,\n      cleanUpOnDestroy = _config$cleanUpOnDest === void 0 ? true : _config$cleanUpOnDest,\n      supportsMutipleCanvasesInOneContainer = config.supportsMutipleCanvasesInOneContainer,\n      useNativeClickEvent = config.useNativeClickEvent,\n      alwaysTriggerPointerEventOnCanvas = config.alwaysTriggerPointerEventOnCanvas,\n      isTouchEvent = config.isTouchEvent,\n      isMouseEvent = config.isMouseEvent,\n      dblClickSpeed = config.dblClickSpeed;\n    if (!supportsMutipleCanvasesInOneContainer) {\n      cleanExistedCanvas(container, _this, cleanUpOnDestroy);\n    }\n    var canvasWidth = width;\n    var canvasHeight = height;\n    var dpr = devicePixelRatio;\n    // use user-defined <canvas> or OffscreenCanvas\n    if (canvas) {\n      // infer width & height with dpr\n      dpr = devicePixelRatio || isBrowser && window.devicePixelRatio || 1;\n      dpr = dpr >= 1 ? Math.ceil(dpr) : 1;\n      canvasWidth = width || getWidth(canvas) || canvas.width / dpr;\n      canvasHeight = height || getHeight(canvas) || canvas.height / dpr;\n    }\n\n    // override it in runtime\n    if (offscreenCanvas) {\n      runtime.offscreenCanvas = offscreenCanvas;\n    }\n\n    /**\n     * implements `Window` interface\n     */\n    _this.devicePixelRatio = dpr;\n    _this.requestAnimationFrame = requestAnimationFrame !== null && requestAnimationFrame !== void 0 ? requestAnimationFrame : raf.bind(runtime.globalThis);\n    _this.cancelAnimationFrame = cancelAnimationFrame !== null && cancelAnimationFrame !== void 0 ? cancelAnimationFrame : caf.bind(runtime.globalThis);\n\n    /**\n     * limits query\n     */\n    // the following feature-detect from hammer.js\n    // @see https://github.com/hammerjs/hammer.js/blob/master/src/inputjs/input-consts.js#L5\n    _this.supportsTouchEvents = supportsTouchEvents !== null && supportsTouchEvents !== void 0 ? supportsTouchEvents : 'ontouchstart' in runtime.globalThis;\n    _this.supportsPointerEvents = supportsPointerEvents !== null && supportsPointerEvents !== void 0 ? supportsPointerEvents : !!runtime.globalThis.PointerEvent;\n    _this.isTouchEvent = isTouchEvent !== null && isTouchEvent !== void 0 ? isTouchEvent : function (event) {\n      return _this.supportsTouchEvents && event instanceof runtime.globalThis.TouchEvent;\n    };\n    _this.isMouseEvent = isMouseEvent !== null && isMouseEvent !== void 0 ? isMouseEvent : function (event) {\n      return !runtime.globalThis.MouseEvent || event instanceof runtime.globalThis.MouseEvent && (!_this.supportsPointerEvents || !(event instanceof runtime.globalThis.PointerEvent));\n    };\n    _this.dblClickSpeed = dblClickSpeed !== null && dblClickSpeed !== void 0 ? dblClickSpeed : 200;\n    _this.initRenderingContext({\n      container: container,\n      canvas: canvas,\n      width: canvasWidth,\n      height: canvasHeight,\n      renderer: renderer,\n      offscreenCanvas: offscreenCanvas,\n      devicePixelRatio: dpr,\n      cursor: cursor || 'default',\n      background: background || 'transparent',\n      createImage: createImage,\n      enableLargeImageOptimization: enableLargeImageOptimization,\n      document: document,\n      supportsCSSTransform: supportsCSSTransform,\n      useNativeClickEvent: useNativeClickEvent,\n      cleanUpOnDestroy: cleanUpOnDestroy,\n      alwaysTriggerPointerEventOnCanvas: alwaysTriggerPointerEventOnCanvas\n    });\n    _this.initDefaultCamera(canvasWidth, canvasHeight, renderer.clipSpaceNearZ);\n    _this.initRenderer(renderer, true);\n    return _this;\n  }\n  _inherits(Canvas, _EventTarget);\n  return _createClass(Canvas, [{\n    key: \"initRenderingContext\",\n    value: function initRenderingContext(mergedConfig) {\n      this.context.config = mergedConfig;\n\n      // bind rendering context, shared by all renderers\n      this.context.renderingContext = {\n        /**\n         * the root node in scene graph\n         */\n        root: this.document.documentElement,\n        renderListCurrentFrame: [],\n        unculledEntities: [],\n        renderReasons: new Set(),\n        force: false,\n        dirty: false\n      };\n    }\n  }, {\n    key: \"initDefaultCamera\",\n    value: function initDefaultCamera(width, height, clipSpaceNearZ) {\n      var _this2 = this;\n      // set a default ortho camera\n      var camera = new runtime.CameraContribution();\n      camera.clipSpaceNearZ = clipSpaceNearZ;\n      camera.setType(CameraType.EXPLORING, CameraTrackingMode.DEFAULT).setPosition(width / 2, height / 2, DEFAULT_CAMERA_Z).setFocalPoint(width / 2, height / 2, 0).setOrthographic(width / -2, width / 2, height / 2, height / -2, DEFAULT_CAMERA_NEAR, DEFAULT_CAMERA_FAR);\n\n      // keep ref since it will use raf in camera animation\n      camera.canvas = this;\n\n      // redraw when camera changed\n      camera.eventEmitter.on(CameraEvent.UPDATED, function () {\n        _this2.context.renderingContext.renderReasons.add(RenderReason.CAMERA_CHANGED);\n        if (runtime.enableSizeAttenuation && _this2.getConfig().renderer.getConfig().enableSizeAttenuation) {\n          _this2.updateSizeAttenuation();\n        }\n      });\n\n      // bind camera\n      this.context.camera = camera;\n    }\n  }, {\n    key: \"updateSizeAttenuation\",\n    value: function updateSizeAttenuation() {\n      var zoom = this.getCamera().getZoom();\n      this.document.documentElement.forEach(function (node) {\n        runtime.styleValueRegistry.updateSizeAttenuation(node, zoom);\n      });\n    }\n  }, {\n    key: \"getConfig\",\n    value: function getConfig() {\n      return this.context.config;\n    }\n\n    /**\n     * get the root displayObject in scenegraph\n     * @alias this.document.documentElement\n     */\n  }, {\n    key: \"getRoot\",\n    value: function getRoot() {\n      return this.document.documentElement;\n    }\n\n    /**\n     * get the camera of canvas\n     */\n  }, {\n    key: \"getCamera\",\n    value: function getCamera() {\n      return this.context.camera;\n    }\n  }, {\n    key: \"getContextService\",\n    value: function getContextService() {\n      return this.context.contextService;\n    }\n  }, {\n    key: \"getEventService\",\n    value: function getEventService() {\n      return this.context.eventService;\n    }\n  }, {\n    key: \"getRenderingService\",\n    value: function getRenderingService() {\n      return this.context.renderingService;\n    }\n  }, {\n    key: \"getRenderingContext\",\n    value: function getRenderingContext() {\n      return this.context.renderingContext;\n    }\n  }, {\n    key: \"getStats\",\n    value: function getStats() {\n      return this.getRenderingService().getStats();\n    }\n\n    // /**\n    //  * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle\n    //  */\n    // getComputedStyle(node: DisplayObject) {\n    //   return node.computedStyle;\n    // }\n  }, {\n    key: \"ready\",\n    get: function get() {\n      var _this3 = this;\n      if (!this.readyPromise) {\n        this.readyPromise = new Promise(function (resolve) {\n          _this3.resolveReadyPromise = function () {\n            resolve(_this3);\n          };\n        });\n        if (this.inited) {\n          this.resolveReadyPromise();\n        }\n      }\n      return this.readyPromise;\n    }\n\n    /**\n     * `cleanUp` means clean all the internal services of Canvas which happens when calling `canvas.destroy()`.\n     */\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var cleanUp = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n      var skipTriggerEvent = arguments.length > 1 ? arguments[1] : undefined;\n      if (skipTriggerEvent === undefined) skipTriggerEvent = this.getConfig().fastCleanExistingCanvas;\n      if (!skipTriggerEvent) {\n        this.dispatchEvent(new CustomEvent(CanvasEvent.BEFORE_DESTROY));\n      }\n      if (this.frameId) {\n        var cancelRAF = this.getConfig().cancelAnimationFrame || cancelAnimationFrame;\n        cancelRAF(this.frameId);\n      }\n\n      // unmount all children\n      var root = this.getRoot();\n      this.unmountChildren(root);\n      if (cleanUp) {\n        // destroy Document\n        this.document.destroy();\n        this.getEventService().destroy();\n      }\n\n      // destroy services\n      this.getRenderingService().destroy();\n      this.getContextService().destroy();\n\n      // clear root after renderservice destroyed\n      if (cleanUp && this.context.rBushRoot) {\n        // clear rbush\n        this.context.rBushRoot.clear();\n        this.context.rBushRoot = null;\n        this.context.renderingContext.root = null;\n      }\n      if (!skipTriggerEvent) {\n        this.dispatchEvent(new CustomEvent(CanvasEvent.AFTER_DESTROY));\n      }\n      var clearEventRetain = function clearEventRetain(event) {\n        event.currentTarget = null;\n        event.manager = null;\n        event.target = null;\n      };\n      clearEventRetain(mountedEvent);\n      clearEventRetain(unmountedEvent);\n      clearEventRetain(beforeRenderEvent);\n      clearEventRetain(rerenderEvent);\n      clearEventRetain(afterRenderEvent);\n      this.cancelAnimationFrame(this.frameId);\n    }\n\n    /**\n     * compatible with G 3.0\n     * @deprecated\n     * @alias resize\n     */\n  }, {\n    key: \"changeSize\",\n    value: function changeSize(width, height) {\n      this.resize(width, height);\n    }\n  }, {\n    key: \"resize\",\n    value: function resize(width, height) {\n      // update canvas' config\n      var canvasConfig = this.context.config;\n      canvasConfig.width = width;\n      canvasConfig.height = height;\n\n      // resize context\n      this.getContextService().resize(width, height);\n\n      // resize camera\n      var camera = this.context.camera;\n      var projectionMode = camera.getProjectionMode();\n      camera.setPosition(width / 2, height / 2, DEFAULT_CAMERA_Z).setFocalPoint(width / 2, height / 2, 0);\n      if (projectionMode === CameraProjectionMode.ORTHOGRAPHIC) {\n        camera.setOrthographic(width / -2, width / 2, height / 2, height / -2, camera.getNear(), camera.getFar());\n      } else {\n        camera.setAspect(width / height);\n      }\n      this.dispatchEvent(new CustomEvent(CanvasEvent.RESIZE, {\n        width: width,\n        height: height\n      }));\n    }\n\n    // proxy to document.documentElement\n  }, {\n    key: \"appendChild\",\n    value: function appendChild(child, index) {\n      return this.document.documentElement.appendChild(child, index);\n    }\n  }, {\n    key: \"insertBefore\",\n    value: function insertBefore(newChild, refChild) {\n      return this.document.documentElement.insertBefore(newChild, refChild);\n    }\n  }, {\n    key: \"removeChild\",\n    value: function removeChild(child) {\n      return this.document.documentElement.removeChild(child);\n    }\n\n    /**\n     * Remove all children which can be appended to its original parent later again.\n     */\n  }, {\n    key: \"removeChildren\",\n    value: function removeChildren() {\n      this.document.documentElement.removeChildren();\n    }\n\n    /**\n     * Recursively destroy all children which can not be appended to its original parent later again.\n     * But the canvas remains running which means display objects can be appended later.\n     */\n  }, {\n    key: \"destroyChildren\",\n    value: function destroyChildren() {\n      this.document.documentElement.destroyChildren();\n    }\n  }, {\n    key: \"render\",\n    value: function render(frame) {\n      var _this4 = this;\n      if (frame) {\n        beforeRenderEvent.detail = frame;\n        afterRenderEvent.detail = frame;\n      }\n      this.dispatchEvent(beforeRenderEvent);\n      var renderingService = this.getRenderingService();\n      renderingService.render(this.getConfig(), frame, function () {\n        // trigger actual rerender event\n        // @see https://github.com/antvis/G/issues/1268\n        _this4.dispatchEvent(rerenderEvent);\n      });\n      this.dispatchEvent(afterRenderEvent);\n    }\n  }, {\n    key: \"run\",\n    value: function run() {\n      var _this5 = this;\n      var _tick = function tick(time, frame) {\n        _this5.render(frame);\n        _this5.frameId = _this5.requestAnimationFrame(_tick);\n      };\n      _tick();\n    }\n  }, {\n    key: \"initRenderer\",\n    value: function initRenderer(renderer) {\n      var _this6 = this;\n      var firstContentfullPaint = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      if (!renderer) {\n        throw new Error('Renderer is required.');\n      }\n\n      // reset\n      this.inited = false;\n      this.readyPromise = undefined;\n\n      // FIXME: should re-create here?\n      this.context.rBushRoot = new RBush();\n\n      // reset rendering plugins\n      this.context.renderingPlugins = [];\n      this.context.renderingPlugins.push(new EventPlugin(), new PrepareRendererPlugin(),\n      // new DirtyCheckPlugin(),\n      new CullingPlugin([new FrustumCullingStrategy()]));\n\n      //\n      this.loadRendererContainerModule(renderer);\n\n      // init context service\n      this.context.contextService = new this.context.ContextService(_objectSpread(_objectSpread({}, runtime), this.context));\n\n      // init rendering service\n      this.context.renderingService = new RenderingService(runtime, this.context);\n\n      // init event service\n      this.context.eventService = new EventService(runtime, this.context);\n      this.context.eventService.init();\n      if (this.context.contextService.init) {\n        this.context.contextService.init();\n        this.initRenderingService(renderer, firstContentfullPaint, true);\n      } else {\n        this.context.contextService.initAsync().then(function () {\n          _this6.initRenderingService(renderer, firstContentfullPaint);\n        });\n      }\n    }\n  }, {\n    key: \"initRenderingService\",\n    value: function initRenderingService(renderer) {\n      var _this7 = this;\n      var firstContentfullPaint = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var async = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      this.context.renderingService.init(function () {\n        _this7.inited = true;\n        if (firstContentfullPaint) {\n          if (async) {\n            _this7.requestAnimationFrame(function () {\n              _this7.dispatchEvent(new CustomEvent(CanvasEvent.READY));\n            });\n          } else {\n            _this7.dispatchEvent(new CustomEvent(CanvasEvent.READY));\n          }\n        } else {\n          _this7.dispatchEvent(new CustomEvent(CanvasEvent.RENDERER_CHANGED));\n        }\n        if (_this7.readyPromise) {\n          _this7.resolveReadyPromise();\n        }\n        if (!firstContentfullPaint) {\n          _this7.getRoot().forEach(function (node) {\n            var _ref = node,\n              renderable = _ref.renderable;\n            if (renderable) {\n              renderable.renderBoundsDirty = true;\n              renderable.boundsDirty = true;\n              renderable.dirty = true;\n            }\n          });\n        }\n\n        // keep current scenegraph unchanged, just trigger mounted event\n        _this7.mountChildren(_this7.getRoot());\n        if (renderer.getConfig().enableAutoRendering) {\n          _this7.run();\n        }\n      });\n    }\n  }, {\n    key: \"loadRendererContainerModule\",\n    value: function loadRendererContainerModule(renderer) {\n      var _this8 = this;\n      // load other container modules provided by g-canvas/g-svg/g-webgl\n      var plugins = renderer.getPlugins();\n      plugins.forEach(function (plugin) {\n        plugin.context = _this8.context;\n        plugin.init(runtime);\n      });\n    }\n  }, {\n    key: \"setRenderer\",\n    value: function setRenderer(renderer) {\n      // update canvas' config\n      var canvasConfig = this.getConfig();\n      if (canvasConfig.renderer === renderer) {\n        return;\n      }\n      var oldRenderer = canvasConfig.renderer;\n      canvasConfig.renderer = renderer;\n\n      // keep all children undestroyed\n      this.destroy(false, true);\n\n      // destroy all plugins, reverse will mutate origin array\n      _toConsumableArray((oldRenderer === null || oldRenderer === void 0 ? void 0 : oldRenderer.getPlugins()) || []).reverse().forEach(function (plugin) {\n        plugin.destroy(runtime);\n      });\n      this.initRenderer(renderer);\n    }\n  }, {\n    key: \"setCursor\",\n    value: function setCursor(cursor) {\n      var canvasConfig = this.getConfig();\n      canvasConfig.cursor = cursor;\n      this.getContextService().applyCursorStyle(cursor);\n    }\n  }, {\n    key: \"unmountChildren\",\n    value: function unmountChildren(parent) {\n      var _this9 = this;\n      // unmountChildren recursively\n      parent.childNodes.forEach(function (child) {\n        _this9.unmountChildren(child);\n      });\n      if (this.inited) {\n        if (parent.isMutationObserved) {\n          parent.dispatchEvent(unmountedEvent);\n        } else {\n          unmountedEvent.target = parent;\n          this.dispatchEvent(unmountedEvent, true);\n        }\n\n        // skip document.documentElement\n        if (parent !== this.document.documentElement) {\n          parent.ownerDocument = null;\n        }\n        parent.isConnected = false;\n      }\n\n      // trigger after unmounted\n      if (parent.isCustomElement) {\n        if (parent.disconnectedCallback) {\n          parent.disconnectedCallback();\n        }\n      }\n    }\n  }, {\n    key: \"mountChildren\",\n    value: function mountChildren(child) {\n      var _this10 = this;\n      var skipTriggerEvent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : isInFragment(child);\n      if (this.inited) {\n        if (!child.isConnected) {\n          child.ownerDocument = this.document;\n          child.isConnected = true;\n          if (!skipTriggerEvent) {\n            if (child.isMutationObserved) {\n              child.dispatchEvent(mountedEvent);\n            } else {\n              mountedEvent.target = child;\n              this.dispatchEvent(mountedEvent, true);\n            }\n          }\n        }\n      } else {\n        console.warn(\"[g]: You are trying to call `canvas.appendChild` before canvas' initialization finished. You can either await `canvas.ready` or listen to `CanvasEvent.READY` manually.\", 'appended child: ', child.nodeName);\n      }\n\n      // recursively mount children\n      child.childNodes.forEach(function (c) {\n        _this10.mountChildren(c, skipTriggerEvent);\n      });\n\n      // trigger after mounted\n      if (child.isCustomElement) {\n        if (child.connectedCallback) {\n          child.connectedCallback();\n        }\n      }\n    }\n  }, {\n    key: \"mountFragment\",\n    value: function mountFragment(child) {\n      this.mountChildren(child, false);\n    }\n  }, {\n    key: \"client2Viewport\",\n    value: function client2Viewport(client) {\n      return this.getEventService().client2Viewport(client);\n    }\n  }, {\n    key: \"viewport2Client\",\n    value: function viewport2Client(canvas) {\n      return this.getEventService().viewport2Client(canvas);\n    }\n  }, {\n    key: \"viewport2Canvas\",\n    value: function viewport2Canvas(viewport) {\n      return this.getEventService().viewport2Canvas(viewport);\n    }\n  }, {\n    key: \"canvas2Viewport\",\n    value: function canvas2Viewport(canvas) {\n      return this.getEventService().canvas2Viewport(canvas);\n    }\n\n    /**\n     * @deprecated\n     * @alias client2Viewport\n     */\n  }, {\n    key: \"getPointByClient\",\n    value: function getPointByClient(clientX, clientY) {\n      return this.client2Viewport({\n        x: clientX,\n        y: clientY\n      });\n    }\n\n    /**\n     * @deprecated\n     * @alias viewport2Client\n     */\n  }, {\n    key: \"getClientByPoint\",\n    value: function getClientByPoint(x, y) {\n      return this.viewport2Client({\n        x: x,\n        y: y\n      });\n    }\n  }]);\n}(EventTarget);\nexport { AABB, AbstractRenderer, AbstractRendererPlugin, BUILT_IN_PROPERTIES, CSS, CSSGradientValue, CSSKeywordValue, CSSRGB, CSSStyleValue, CSSUnitValue, Camera, CameraEvent, CameraProjectionMode, CameraTrackingMode, CameraType, Canvas, CanvasEvent, Circle, CircleUpdater, ClipSpaceNearZ, CustomElement, CustomElementRegistry, CustomEvent, DefaultSceneGraphSelector, DefaultSceneGraphService, DisplayObject, Document, ERROR_MSG_METHOD_NOT_IMPLEMENTED, Element, ElementEvent, Ellipse, EllipseUpdater, EventService, EventTarget, FederatedEvent, FederatedMouseEvent, FederatedPointerEvent, FederatedWheelEvent, Fragment, Frustum, GradientType, Group, GroupUpdater, HTML, HTMLUpdater, Image, Line, LineUpdater, Mask, MutationEvent, Node, OffscreenCanvasCreator, Path, PathUpdater, Plane, Point, Polygon, Polyline, PolylineUpdater, PropertySyntax, RBush, Rect, RectUpdater, Rectangle, RenderReason, RenderingService, Shape, SortReason, Strategy, Text, TextService, TextUpdater, UnitType, computeLinearGradient, computeRadialGradient, convertToPath, createVec3, decompose, definedProps, deg2rad, deg2turn, findClosestClipPathTarget, fromRotationTranslationScale, getAngle, getEuler, getOrCalculatePathTotalLength, grad2deg, isBrowser, isCSSGradientValue, isCSSRGB, isCanvas, isDisplayObject, isFederatedEvent, isFillOrStrokeAffected, isPattern, mergeColors, parseColor, parseLength, parsePath, parseTransform, parsedTransformToMat4, propertyMetadataCache, rad2deg, resetEntityCounter, runtime, setDOMSize, translatePathToString, turn2deg };","map":{"version":3,"names":["global","factory","module","exports","commonjsGlobal","quickselect","arr","k","left","right","compare","quickselectStep","length","defaultCompare","n","m","z","Math","log","s","exp","sd","sqrt","newLeft","max","floor","newRight","min","t","i","j","swap","tmp","a","b","RBush","maxEntries","_maxEntries","_minEntries","ceil","clear","prototype","all","_all","data","search","bbox","node","result","intersects","toBBox","nodesToSearch","children","child","childBBox","leaf","push","contains","pop","collides","load","insert","_build","slice","height","_splitRoot","tmpNode","_insert","item","createNode","remove","equalsFn","path","indexes","parent","goingUp","index","findItem","splice","_condense","compareMinX","minX","compareMinY","minY","toJSON","fromJSON","apply","items","N","M","calcBBox","pow","N2","N1","multiSelect","right2","right3","_chooseSubtree","level","minArea","Infinity","minEnlargement","targetNode","area","bboxArea","enlargement","enlargedArea","isNode","insertPath","extend","_split","_adjustParentBBoxes","_chooseSplitAxis","splitIndex","_chooseSplitIndex","newNode","minOverlap","bbox1","distBBox","bbox2","overlap","intersectionArea","compareNodeMinX","compareNodeMinY","xMargin","_allDistMargin","yMargin","sort","leftBBox","rightBBox","margin","bboxMargin","i$1","child$1","siblings","indexOf","p","destNode","maxX","maxY","stack","mid","Shape","ClipSpaceNearZ","AbstractRendererPlugin","_classCallCheck","plugins","_createClass","key","value","addRenderingPlugin","plugin","context","renderingPlugins","removeAllRenderingPlugins","_this","forEach","AbstractRenderer","config","clipSpaceNearZ","NEGATIVE_ONE","_objectSpread","enableDirtyCheck","enableCulling","enableAutoRendering","enableDirtyRectangleRendering","enableDirtyRectangleRenderingDebug","enableSizeAttenuation","registerPlugin","findIndex","unregisterPlugin","getPlugins","getPlugin","name","find","getConfig","setConfig","Object","assign","addVec3","vec3","add","copyVec3","copy","maxVec3","minVec3","scaleVec3","scale","subVec3","sub","AABB","center","halfExtents","update","setMinMax","getMin","getMax","aabb","isEmpty","tc","tcx","tcy","tcz","th","thx","thy","thz","tminx","tmaxx","tminy","tmaxy","tminz","tmaxz","oc","ocx","ocy","ocz","oh","ohx","ohy","ohz","ominx","omaxx","ominy","omaxy","ominz","omaxz","setFromTransformedAABB","bc","br","ac","ar","mx0","mx1","mx2","my0","my1","my2","mz0","mz1","mz2","mx0a","abs","mx1a","mx2a","my0a","my1a","my2a","mz0a","mz1a","mz2a","aMax","aMin","bMax","bMin","intersection","getNegativeFarPoint","plane","pnVertexFlag","getPositiveFarPoint","Plane","distance","normal","fromValues","updatePNVertexFlag","Number","distanceToPoint","point","dot","normalize","invLen","len","intersectsLine","start","end","d0","d1","lerp","Mask","Frustum","planes","extractFromVPMatrix","projectionMatrix","_projectionMatrix","_slicedToArray","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","set","Point","x","arguments","undefined","y","clone","copyFrom","Rectangle","width","top","bottom","fromRect","rect","applyTransform","matrix","topLeft","vec4","topRight","bottomLeft","bottomRight","transformedTopLeft","create","transformedTopRight","transformedBottomLeft","transformedBottomRight","transformMat4","ERROR_MSG_METHOD_NOT_IMPLEMENTED","ERROR_MSG_USE_DOCUMENT_ELEMENT","ERROR_MSG_APPEND_DESTROYED_ELEMENT","getAngle","angle","$vec3$2","createVec3","Array","isArray","isNumber","DEG_RAD","PI","deg2rad","deg","RAD_DEG","rad2deg","rad","GRAD_DEG","grad2deg","grads","deg2turn","turn2deg","turn","HALF_PI","getEulerFromQuat","out","quat","w","x2","y2","z2","w2","unit","test","atan2","asin","getEulerFromMat4","_mat4$getScaling","mat4","getScaling","_mat4$getScaling2","sx","sy","sz","getEuler","fromRotationTranslationScale","rotation","scaleX","scaleY","cos","sin","mat3","makePerspective","near","far","zero","twoNear","rightMinusLeft","topMinusBottom","c","d","farMinusNear","farMulNear","decompose","mat","row0x","row0y","row1x","row1y","scalingX","scalingY","determinant","invScalingX","invScalingY","perspectiveMatrix","tmpVec4","row","pdum3","decomposeMat4","translation","skew","perspective","quaternion","a03","a13","a23","a30","a31","a32","a33","ret","invert","transpose","mat3from4","combine","cross","m44","mat4x4","scale1","scale2","CameraType","CameraTrackingMode","CameraProjectionMode","CameraEvent","UPDATED","MIN_DISTANCE","Camera","eventEmitter","EventEmitter","up","forward","position","focalPoint","distanceVector","azimuth","elevation","roll","relAzimuth","relElevation","relRoll","dollyingStep","maxDistance","minDistance","zoom","rotateWorld","fov","aspect","projectionMatrixInverse","jitteredProjectionMatrix","enableUpdate","type","EXPLORING","trackingMode","DEFAULT","projectionMode","PERSPECTIVE","frustum","orthoMatrix","isOrtho","ORTHOGRAPHIC","getProjectionMode","getPerspective","getPerspectiveInverse","getFrustum","getPosition","getFocalPoint","getDollyingStep","getNear","getFar","getZoom","getOrthoMatrix","getView","view","setEnableUpdate","enabled","setType","setWorldRotation","_getAngles","TRACKING","setTrackingMode","setProjectionMode","Error","flag","getViewTransform","getWorldTransform","jitterProjectionMatrix","fromTranslation","multiply","clearJitterProjectionMatrix","setMatrix","_update","setProjectionMatrix","setFov","setPerspective","setAspect","setNear","setOrthographic","rright","setFar","setViewOffset","fullWidth","fullHeight","offsetX","offsetY","clearViewOffset","setZoom","setZoomByViewportPoint","viewportPoint","_this$canvas$viewport","canvas","viewport2Canvas","ox","oy","rotate","setPosition","setFocalPoint","_this$canvas$viewport2","cx","cy","dvec","dx","dy","_this$getPosition","_this$getPosition2","px","py","_this$getFocalPoint","_this$getFocalPoint2","fx","fy","_this$view","tan","ZERO","triggerUpdate","l","r","_this$view2","scaleW","scaleH","ortho","orthoZO","_getOrthoMatrix","_setPosition","CINEMATIC","subtract","el","az","rotateY","rotateX","lookAt","_getAxes","_getDistance","getDistance","getDistanceVector","setDistance","pos","f","setMaxDistance","setMinDistance","setAzimuth","computeMatrix","ORBITING","_getPosition","_getFocalPoint","getAzimuth","setElevation","getElevation","setRoll","getRoll","rotZ","quat$1","setAxisAngle","identity","rotX","rotY","rotQ","rotMatrix","fromQuat","translate","transformMat3","fromMat4","fromRotationTranslationScaleOrigin","viewMatrix","vpMatrix","emit","pan","tx","ty","dolly","createLandmark","params","gotoLandmark","options","cancelLandmarkAnimation","Strategy","SortReason","EMPTY_PARSED_PATH","absolutePath","hasArc","segments","polygons","polylines","curve","totalLength","PropertySyntax","memoize","func","resolver","TypeError","_memoized","memoized","_len","args","_key","cache","has","get","Cache","Map","UnitType","UnitCategory","Nested","ParenLess","unit_type","kEms","kPixels","kDegrees","kRadians","kGradians","kMilliseconds","kSeconds","kRems","kTurns","CSSStyleValueType","stringToUnitType","unitFromName","kUnknown","kNumber","kPercentage","unitTypeToUnitCategory","kInteger","kUNumber","kUPercent","kULength","kUTime","kUAngle","kUOther","canonicalUnitTypeForCategory","category","conversionToCanonicalUnitsScaleFactor","factor","unitTypeToString","CSSStyleValue","toString","buildCSSText","kNo","isNumericValue","getType","kUnitType","kClampType","isAngle","isLength","isRelativeUnit","isTime","CSSColorValue","_CSSStyleValue","colorSpace","_callSuper","_inherits","kColorType","to","GradientType","CSSGradientValue","CSSKeywordValue","kKeywordType","formatInfinityOrNaN","number","suffix","isFinite","toCanonicalUnit","CSSUnitValue","unitOrName","equals","other","other_unit_value","convertTo","target_unit","canonical_unit","scale_factor","text","toFixed","kMinInteger","kMaxInteger","_unit","isNaN","concat","Opx","Odeg","CSSRGB","_CSSColorValue","g","alpha","isNone","unsetKeywordValue","initialKeywordValue","inheritKeywordValue","keywordCache","unset","initial","inherit","getOrCreateKeyword","noneColor","transparentColor","getOrCreateRGBA","getOrCreateUnitValue","colorStopToString","colorStop","join","parseGradient$1","tokens","linearGradient","repeatingLinearGradient","radialGradient","repeatingRadialGradient","conicGradient","sideOrCorner","extentKeywords","positionKeywords","pixelValue","percentageValue","emValue","angleValue","startCall","endCall","comma","hexColor","literalColor","rgbColor","rgbaColor","input","error","msg","getAST","ast","matchListDefinitions","matchListing","matchDefinition","matchGradient","matchLinearOrientation","matchListRadialOrientations","gradientType","pattern","orientationMatcher","matchCall","captures","orientation","scan","colorStops","matchColorStop","callback","matchSideOrCorner","matchAngle","match","radialOrientations","radialOrientation","matchRadialOrientation","lookaheadCache","radialType","matchCircle","matchEllipse","at","matchAtPosition","extent","matchExtentKeyword","positionAt","defaultPosition","matchPositioning","circle","style","matchLength","ellipse","matchDistance","positioning","location","matchCoordinates","matcher","color","matchColor","matchHexColor","matchRGBAColor","matchRGBColor","matchLiteralColor","matchNumber","matchPositionKeyword","captureIndex","regexp","blankCaptures","exec","consume","size","substring","code","computeLinearGradient","rx","ry","rcx","rcy","x1","y1","computeRadialGradient","distanceSquareRoot","regexLG","regexRG","regexPR","regexColorStop","spaceColorStops","_colorStops$length","_colorStops$0$length","previousIndex","previousOffset","_colorStops$i$length","offset","isNil","SideOrCornerToDegMap","angleToDeg","positonToCSSUnitValue","unitX","unitY","_position$value","parseGradient","colorStr","map","_ref","steps","LinearGradient","_positonToCSSUnitValu","_orientation$0$style","_type","RadialGradient","_arr$2$match","stop","split","parseFloat","_ref2","_ref3","parsedRadialGradient","parseRadialGradient","isString","parsePattern","gradientStr","_arr$4$match","_ref4","_ref5","patternStr","repetition","src","image","isCSSGradientValue","object","isPattern","isCSSRGB","parseColor","d3","rgba","opacity","mergeColors","round","clamp","parseDimension","unitRegExp","string","trim","toLowerCase","matchedUnits","replace","taggedUnitRegExp","source","RegExp","parseLengthUnmemoize","css","parseLength","parserPercentageUnmemoize","parseLengthOrPercentageUnmemoize","parseLengthOrPercentage","parseAngleUnmemoize","parseAngle","mergeDimensions","target","nonNegative","leftValue","rightValue","canonicalUnit","leftCanonicalUnitValue","rightCanonicalUnitValue","convertPercentUnit","convertAngleUnit","parseDimensionArrayFormat","parsed","segment","valueWithUnit","vec3Index","useMin","bounds","nodeName","GROUP","getLocalBounds","getGeometryBounds","parseParam","supportedFilters","parseFilter","filterStr","filterRegExp","prevLastIndex","lastIndex","numberToString","parseNumberUnmemoize","parseNumber","mergeNumbers","clampedMergeNumbers","mergeNumberLists","numberList","getOrCalculatePathTotalLength","parsedStyle","getTotalLength","getOrCalculatePolylineTotalLength","polyline","points","polylineLength","removeRedundantMCommand","prevSegment","cmd","prevCmd","srcPoint","destPoint","isSamePoint","hasArcOrBezier","count","extractPolygons","pathArray","point1","point2","getPathBBox","lineWidth","xArr","yArr","segmentsWithAngle","currentPoint","prePoint","box","command","quadBox","cubicBox","arcParams","arcBox","xRotation","startAngle","endAngle","nextPoint","filter","_i","_segment","_currentPoint","extra","getExtraFromSegmentWithAngle","xExtra","yExtra","currentAndPre","currentAndNext","preAndNext","currentAngle","acos","isNumberEqual","xAngle","yAngle","toSymmetry","angleBetween","v0","v1","sign","pointOnEllipticalArc","p0","xAxisRotation","largeArcFlag","sweepFlag","p1","mod","xAxisRotationRadians","ellipticalArcAngle","transformedPoint","radiiCheck","cSquareNumerator","cSquareRootDenom","cRadicand","cCoef","transformedCenter","startVector","endVector","sweepAngle","ellipseComponentX","ellipseComponentY","ellipticalArcStartAngle","ellipticalArcEndAngle","ellipticalArcCenter","resultantRx","resultantRy","path2Segments","nextParams","startMovePoint","lastStartMovePointIndex","startTangent","endTangent","cubicParams","getArcParams","includes","cp","preSegment","_cp","cp1","cp2","_preSegment","_cp2","_cp3","_getTangentAtRatio","getTangentAtRatio","dx1","dy1","_getTangentAtRatio2","dx2","dy2","ratio","_segment$arcParams","_segment$arcParams$rx","_segment$arcParams$ry","arcFlag","p2","xDist","yDist","dist","vMag","v","vRatio","u","vAngle","startPoint","xp","yp","lambda","diff","cxp","cyp","theta","dTheta","commandsToPathString","commands","transform","reduce","prev","cur","p3","_p","_p2","lineToCommands","ellipseToCommands","polygonToCommands","closed","rectToCommands","radius","_radius","tlr","trr","brr","blr","signX","signY","convertToPath","getLocalTransform","LINE","_parsedStyle","_parsedStyle$x","_parsedStyle$y","_parsedStyle$x2","_parsedStyle$y2","CIRCLE","_parsedStyle2","_parsedStyle2$r","_parsedStyle2$cx","_parsedStyle2$cy","ELLIPSE","_parsedStyle3","_parsedStyle3$rx","_parsedStyle3$ry","_parsedStyle3$cx","_cx","_parsedStyle3$cy","_cy","POLYLINE","POLYGON","RECT","_parsedStyle4","_parsedStyle4$width","_parsedStyle4$height","_parsedStyle4$x","_parsedStyle4$y","hasRadius","some","PATH","_toConsumableArray","translatePathToString","startOffsetX","startOffsetY","endOffsetX","endOffsetY","newValue","nextSegment","useStartOffset","useEndOffset","internalParsePath","normalizePath","_unused","console","_extractPolygons","_getPathBBox","memoizedParsePath","parsePath","mergePaths","curve1","curve2","path2Curve","curves","equalizeSegments","curve0","getDrawDirection","reverseCurve","clonePath","getRotatedCurve","parsePoints","pointsOrStr","pointStr","_pointStr$split","_pointStr$split2","mergePoints","_","TRANSFORM_REGEXP","cast","contents","id","transformFunctions","matrix3d","rotateZ","rotate3d","scaleZ","scale3d","skewX","skewY","translateX","translateY","translateZ","translate3d","parseArrayTransform","functionData","parsedArgs","parseTransform","functionName","argTypes","arg","parsedArg","A","T","L","toUpperCase","parseTransformUnmemoize","convertItemToMatrix","sqrLength","sc","sq","multiplyMatrices","convertToMatrix","transformList","makeMatrixDecomposition","composeMatrix","is2D","temp","_i2","_j","numberToLongString","mergeMatrices","leftArgs","rightArgs","decompositionPair","list","q","stringifiedArgs","v2","fromQ","toQ","product","typeTo2D","typeTo3D","isMatrixOrPerspective","lt","rt","mergeTransforms","flipResults","_loop","_left$i","defaultValue","leftResult","rightResult","types","merged","_i3","leftType","rightType","leftFunctionData","rightFunctionData","_merged","_merged2","leftArgsCopy","rightArgsCopy","stringConversions","_merged3","parseTransformOrigin","values","convertKeyword2Percent","keyword","BUILT_IN_PROPERTIES","inh","syntax","OPACITY_VALUE","PAINT","COLOR","LENGTH_PERCENTAGE","SHADOW_BLUR","LENGTH_PERCENTAGE_12","DEFINED_PATH","OFFSET_DISTANCE","ind","Z_INDEX","FILTER","TRANSFORM","TRANSFORM_ORIGIN","COORDINATE","LENGTH_PERCENTAGE_14","LIST_OF_POINTS","TEXT","TEXT_TRANSFORM","LENGTH","NUMBER","MARKER","GEOMETRY_ATTRIBUTE_NAMES","propertyMetadataCache","DefaultStyleValueRegistry","runtime","property","registerMetadata","metadata","getPropertySyntax","CSSPropertySyntaxFactory","processProperties","attributes","skipUpdateAttribute","skipParse","forceUpdateGeometry","usedAttributes","oldClipPath","clipPath","oldOffsetPath","offsetPath","needUpdateGeometry","fill","stroke","shadowColor","lineDash","textTransform","calculator","isUndefined","transformOrigin","markerStart","markerEnd","markerMid","zIndex","postProcessor","offsetDistance","geometry","dirty","renderable","boundsDirty","renderBoundsDirty","sceneGraphService","dirtifyToRoot","updateGeometry","geometryUpdater","geometryUpdaterFactory","contentBounds","renderBounds","_geometryUpdater$upda","_geometryUpdater$upda2","_geometryUpdater$upda3","_geometryUpdater$upda4","cz","_geometryUpdater$upda5","hwidth","_geometryUpdater$upda6","hheight","_geometryUpdater$upda7","hdepth","_parsedStyle$lineWidt","_parsedStyle$increase","increasedLineWidthForHitTesting","_parsedStyle$shadowTy","shadowType","_parsedStyle$filter","expansion","SQRT2","hasStroke","halfLineWidth","_geometry$renderBound","shadowBlur","shadowOffsetX","shadowOffsetY","shadowBlurInPixels","shadowOffsetXInPixels","shadowOffsetYInPixels","shadowLeft","shadowRight","shadowTop","shadowBottom","blurRadius","_shadowOffsetX","_shadowOffsetY","_shadowBlur","_geometry$renderBound2","_min","_max","_shadowLeft","_shadowRight","_shadowTop","_shadowBottom","flipY","flipX","usedOriginXValue","usedOriginYValue","setOrigin","updateSizeAttenuation","isSizeAttenuation","rawLineWidth","rawR","CSSPropertyAngle","mixer","oldParsed","CSSPropertyClipPath","oldPath","newPath","updateDisplayObjectDependency","childNodes","CSSPropertyColor","parser","CSSPropertyFilter","getFontSize","fontSize","CSSPropertyLengthOrPercentage","computed","parentNode","_object$ownerDocument","ownerDocument","documentElement","_fontSize","CSSPropertyLengthOrPercentage12","CSSPropertyLengthOrPercentage14","CSSPropertyMarker","oldMarker","newMarker","_newMarker","cloned","cloneNode","isMarker","CSSPropertyNumber","CSSPropertyOffsetDistance","_object$parsedStyle","getPoint","setLocalPosition","CSSPropertyOpacity","CSSPropertyPath","CSSPropertyPoints","CSSPropertyShadowBlur","_CSSPropertyLengthOrP","CSSPropertyText","nodeValue","CSSPropertyTextTransform","rawText","getAttribute","transformedText","charAt","definedProps","obj","fromEntries","entries","CANVAS_Map","WeakMap","cleanExistedCanvas","container","cleanUp","$dom","document","getElementById","destroy","isBrowser","window","isElement","sortedIndex","array","low","high","sortByZIndex","o1","o2","zIndex1","zIndex2","findClosestClipPathTarget","_el$parsedStyle","parentElement","PX_SUFFIX","setDOMSize","$el","getStyle","defaultView","getComputedStyle","getPropertyValue","getWidth","offsetWidth","getHeight","offsetHeight","MOUSE_POINTER_ID","TOUCH_TO_POINTER","touchstart","touchend","touchendoutside","touchmove","touchcancel","clock","performance","now","Date","isInFragment","FRAGMENT","getRootNode","isFillOrStrokeAffected","pointerEvents","hasFill","isFillOtherThanNone","isStrokeOtherThanNone","uId","uniqueId","root","self","nowOffset","pnow","reservedCBs","lastTime","polyfillRaf","currentTime","gap","delay","keys","setTimeout","copied","polyfillCaf","vendorPrefixes","getRequestAnimationFrame","vp","requestAnimationFrame","getCancelAnimationFrame","cancelAnimationFrame","predicate","raf","caf","AsyncParallelHook","callbacks","getCallbacksNum","tapPromise","fn","promise","Promise","AsyncSeriesWaterfallHook","_promise","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_this$callbacks","_args","wrap","_callee$","_context","next","sent","abrupt","SyncHook","tap","call","argsArr","SyncWaterfallHook","genericFontFamilies","stringRegExp","toFontString","_attributes$fontSize","_attributes$fontFamil","fontFamily","_attributes$fontStyle","fontStyle","_attributes$fontVaria","fontVariant","_attributes$fontWeigh","fontWeight","fontSizeString","fontFamilies","_fontFamily","createSkewMatrix","skewMatrix","$mat4_1","$mat4_2","fromScaling","fromZRotation","fromXRotation","fromYRotation","fromRotation","$vec3One$1","$vec3Zero$1","optimizer","setLocalScale","setLocalEulerAngles","dirtifyLocal","transformable","parsedTransformToMat4","_transform$i","mul","setLocalTransform","resetLocalTransform","CSSPropertyTransform","CSSPropertyTransformOrigin","CSSPropertyZIndex","parentEntity","parentRenderable","parentSortable","sortable","dirtyReason","Z_INDEX_CHANGED","CircleUpdater","_parsedStyle$cx","_parsedStyle$cy","_parsedStyle$r","EllipseUpdater","_parsedStyle$rx","_parsedStyle$ry","LineUpdater","PathUpdater","_d$rect","PolylineUpdater","RectUpdater","_parsedStyle$width","_parsedStyle$height","contentWidth","contentHeight","TextUpdater","globalRuntime","isReadyToMeasure","_parsedStyle$textAlig","textAlign","_parsedStyle$textBase","textBaseline","_parsedStyle$dx","_parsedStyle$dy","metrics","font","lines","lineWidths","lineHeight","maxLineWidth","fontProperties","ascent","descent","lineMetrics","offscreenCanvas","textService","measureText","lineXOffset","lineYOffset","GroupUpdater","HTMLUpdater","isFederatedEvent","FederatedEvent","manager","eventPhase","NONE","bubbles","cancelBubble","cancelable","defaultPrevented","propagationStopped","propagationImmediatelyStopped","layer","page","viewport","composed","CAPTURING_PHASE","AT_TARGET","BUBBLING_PHASE","composedPath","propagationPath","preventDefault","nativeEvent","Event","stopImmediatePropagation","stopPropagation","initEvent","initUIEvent","FederatedMouseEvent","client","movement","screen","getModifierState","initMouseEvent","FederatedPointerEvent","_FederatedMouseEvent","isPrimary","getCoalescedEvents","getPredictedEvents","clonePointerEvent","FederatedWheelEvent","cloneWheelEvent","CustomEvent","_FederatedEvent","eventName","detail","CANVAS_CACHE","EventTarget","emitter","on","listener","addEventListener","capture","once","isBoolean","_options$capture","_options$once","isFunction","handleEvent","off","removeEventListener","removeAllEventListeners","_this$emitter","removeAllListeners","_listener","dispatchEvent","e","skipPropagate","_ownerDocument","getEventService","Node","_EventTarget","shadow","isConnected","baseURI","nodeType","_iterator","_createForOfIteratorHelper","_step","done","_child","textContent","err","content","_this2","removeChild","opts","host","hasChildNodes","isDefaultNamespace","namespace","lookupNamespaceURI","prefix","lookupPrefix","isEqualNode","otherNode","isSameNode","compareDocumentPosition","node1Root","node2Root","node1Hierarchy","node2Hierarchy","_node1Root$parentNode","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC","DOCUMENT_POSITION_PRECEDING","longerHierarchy","shorterHierarchy","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_CONTAINS","longerStart","shorterHierarchyNode","longerHierarchyNode","contain","getAncestor","nodes","PROPAGATION_LIMIT","EventService","nativeHTMLMap","cursor","mappingTable","mappingState","trackingData","eventPool","tmpMatrix","tmpVec3","onPointerDown","from","createPointerEvent","pointerType","isRightButton","button","pointerId","pressTargetsByButton","freeEvent","onPointerUp","alwaysTriggerPointerEventOnCanvas","rootTarget","pressTarget","findMountedTarget","clickTarget","currentTarget","notifyTarget","_isRightButton","_e$detail","clickEvent","clicksByButton","clickCount","timeStamp","renderingContext","clickHistory","dblClickSpeed","preventClick","useNativeClickEvent","onPointerMove","isMouse","outTarget","overTargets","outType","outEvent","leaveEvent","overType","overEvent","overTargetAncestor","didPointerEnter","enterEvent","getCursor","onPointerOut","onPointerOver","onPointerUpOutside","onWheel","wheelEvent","createWheelEvent","onClick","onPointerCancel","init","addEventMapping","getScale","contextService","getBoundingClientRect","getDomElement","client2Viewport","_this$getScale","viewport2Client","_this$getScale2","camera","getCamera","_this$context$config","worldMatrix","canvas2Viewport","canvasP","clip","_this$context$config2","setPickHandler","pickHandler","priority","mapEvent","mappers","warn","propagate","notifyListeners","unshift","hitTest","viewportX","viewportY","_this$context$config3","disableHitTesting","isNativeEventFromCanvas","_target","shadowRoot","getExistedHTML","event","_arr","eventTarget","existed","pickTarget","clientX","clientY","canvasX","canvasY","fallbackTarget","allocateEvent","copyPointerData","copyMouseData","copyData","originalEvent","existedHTML","copyWheelData","overTarget","pressure","tangentialPressure","tiltX","tiltY","twist","altKey","buttons","ctrlKey","metaKey","shiftKey","deltaMode","deltaX","deltaY","deltaZ","isTrusted","constructor","listeners","_events","removeListener","OffscreenCanvasCreator","getOrCreateCanvas","contextAttributes","getContext","willReadFrequently","OffscreenCanvas","createElement","getOrCreateContext","createCanvas","_unused2","_unused3","RenderReason","RenderingService","inited","stats","total","rendered","zIndexCounter","hooks","initAsync","dirtycheck","cull","beginFrame","beforeRender","render","afterRender","endFrame","pick","pickSync","pointerDown","pointerUp","pointerMove","pointerOut","pointerOver","pointerWheel","pointerCancel","click","then","getStats","disableDirtyRectangleRendering","renderer","_renderer$getConfig","renderReasons","CAMERA_CHANGED","canvasConfig","frame","rerenderCallback","syncHierarchy","triggerPendingEvents","dirtyRectangleRenderingDisabled","onlyCameraChanged","shouldTriggerRenderHooks","disableRenderHooks","renderDisplayObject","renderListCurrentFrame","displayObject","_this3","_canvasConfig$rendere","objectChanged","objectToRender","renderOrder","dirtyChildren","sorted","_index","_index2","clearPendingEvents","dirtify","DISPLAY_OBJECT_CHANGED","ATTRIBUTE_REGEXP","DefaultSceneGraphSelector","selectOne","query","startsWith","classList","getIdOrClassname","_this$getAttribute","attributeToString","selectAll","findAll","_this$getAttribute2","is","className","_this$getAttribute3","matches","ElementEvent","MutationEvent","typeArg","relatedNode","prevValue","attrName","attrChange","prevParsedValue","newParsedValue","ADDITION","MODIFICATION","REMOVAL","markRenderableDirty","reparentEvent","REPARENT","$vec2Zero","vec2","$vec3Zero","$vec3One","$mat4Identity","$vec2","$vec3$1","$mat4","$quat$1","$setLocalTransform_1","$setLocalTransform_2","$setLocalTransform_3","$setLocalPosition","$setPosition_1","$setPosition_ParentInvertMatrix","$setEulerAngles_InvParentRot","$rotateLocal","$rotate_ParentInvertRotation","$triggerPendingEvents_detail","affectChildren","DefaultSceneGraphService","pendingEvents","boundsChangedEvent","BOUNDS_CHANGED","displayObjectDependencyMap","sceneGraphSelector","querySelector","querySelectorAll","attach","_sortable$sorted","detached","detach","isChildFragment","isAttachToFragment","ADDED","dirtifyFragment","dirtifyWorld","_sortable$sorted2","_style","REMOVED","getOrigin","element","origin","originVec","degrees","rotateLocal","fromEuler","rot","getRotation","parentRot","localRotation","setEulerAngles","parentRotation","translateLocal","transformQuat","localPosition","_position$","parentTransform","worldTransform","_position$2","scaleLocal","scaling","_scaling$","localScale","_scaling$2","setRotation","setLocalRotation","setLocalSkew","localSkew","localDirtyFlag","dirtyFlag","unfreezeParentToRoot","dirtifyWorldInternal","frozen","triggered","Set","skipped","trigger","isMutationObserved","informDependentDisplayObjects","oldDependencyMap","newDependencyMap","dependencyMap","ATTR_MODIFIED","isCustomElement","attributeChangedCallback","getTranslation","sync","getLocalPosition","getLocalRotation","getLocalScale","getLocalSkew","calcLocalTransform","hasSkew","localTransform","hasPosition","hasRotation","hasScale","hasOrigin","getTransformedGeometryBounds","existedAABB","styleValueRegistry","getBounds","childBounds","clipped","clipPathBounds","parentInvert","localBounds","_element$ownerDocumen","getContextService","_aabb$getMin","_aabb$getMin2","_aabb$getMax","_aabb$getMax2","_this4","childTransform","TEXT_METRICS","MetricsString","BaselineSymbol","BaselineMultiplier","HeightMultiplier","Newlines","BreakingSpaces","LATIN_REGEX","regexCannotStartZhCn","regexCannotEndZhCn","regexCannotStartZhTw","regexCannotEndZhTw","regexCannotStartJaJp","regexCannotEndJaJp","regexCannotStartKoKr","regexCannotEndKoKr","regexCannotStart","regexCannotEnd","TextService","fontMetricsCache","shouldBreakByKinsokuShorui","_char","nextChar","isBreakingSpace","trimByKinsokuShorui","prevLine","lastChar","measureFont","properties","offscreenCanvasCreator","metricsString","baseline","fillStyle","fillRect","fillText","imagedata","getImageData","pixels","line","idx","_parsedStyle$fontSize","_parsedStyle$wordWrap","wordWrap","strokeHeight","_parsedStyle$letterSp","letterSpacing","textPath","textPathSide","textPathStartOffset","_parsedStyle$leading","leading","isOverflowing","outputText","_lineWidth","_width","setGraphemeOnPath","_parsedStyle$wordWrap2","wordWrapWidth","_parsedStyle$letterSp2","_parsedStyle$maxLines","maxLines","textOverflow","maxWidth","ellipsis","currentIndex","currentWidth","calcWidth","_char2","getFromCache","ellipsisWidth","chars","_char3","prevChar","charWidth","isNewline","currentLineLength","lastLineWidth","lastLineIndex","canBreakInLastChar","trimToBreakable","sumTextWidthByCache","_char4","charCodeAt","_char5","findBreakableIndex","trimmedChar","isTrimmedWithSpace","trimFrom","trimTo","_char6","sum","spacing","rectUpdater","polylineUpdater","_defineProperty","IMAGE","HTML","MESH","PERCENTAGE","ANGLE","getGlobalThis","globalThis","CameraContribution","AnimationTimeline","EasingFunction","layoutRegistry","enableStyleSyntax","entityCounter","resetEntityCounter","insertedEvent","INSERTED","removedEvent","destroyEvent","DESTROY","Element","_Node","entity","dirtyRenderBounds","cullable","strategy","Standard","visibilityPlaneMask","visible","enable","rBushNode","namespaceURI","scrollLeft","scrollTop","clientTop","clientLeft","destroyed","computedStyle","setAttribute","firstChild","lastChild","deep","appendChild","_this$ownerDocument","mountFragment","mountChildren","insertBefore","newChild","refChild","replaceChild","oldChild","_child$ownerDocument","unmountChildren","removeChildren","destroyChildren","selector","getElementsByName","getElementsByClassName","getElementsByTagName","tagName","selectors","closest","objects","after","_len2","_key2","_this4$parentNode","before","_len3","_key3","first","rest","replaceWith","append","_this5","_len4","_key4","prepend","_this6","_len5","_key5","replaceChildren","getRenderBounds","getClientRects","computedStyleMap","getAttributeNames","hasAttribute","qualifiedName","hasAttributes","removeAttribute","attributeName","force","getAttributeNS","localName","getAttributeNode","getAttributeNodeNS","hasAttributeNS","removeAttributeNS","removeAttributeNode","attr","setAttributeNS","setAttributeNode","setAttributeNodeNS","toggleAttribute","isDisplayObject","Proxy","mutationEvent","$vec3","$quat","DisplayObject","_Element","activeAnimations","initialParsedStyle","initAttributes","setProperty","propertyName","removeProperty","prop","_superPropGet","getAnimations","animation","cancel","customCloneFunc","clonedStyle","attribute","interactive","clonedChild","internalSetAttribute","parseOptions","oldValue","oldParsedValue","getBBox","getEulerAngles","_getEuler","_getEuler2","ez","getLocalEulerAngles","_getEuler3","_getEuler4","animate","keyframes","timeline","play","isVisible","_this$parsedStyle","visibility","isInteractive","_this$parsedStyle2","isCulled","toFront","toBack","isObject","getMatrix","_mat4$getTranslation","_mat4$getTranslation2","_getEuler5","_getEuler6","eux","euz","getLocalMatrix","_decompose","_decompose2","setLocalMatrix","_decompose3","_decompose4","show","hide","getCount","childElementCount","getParent","getChildren","getFirst","firstElementChild","getLast","lastElementChild","getChildByIndex","moveTo","move","setZIndex","Circle","_DisplayObject","CustomElement","_objectWithoutProperties","_excluded$6","Ellipse","Fragment","Group","_excluded$5","Image","Line","_excluded$4","z1","markerStartAngle","markerEndAngle","transformMarker","isStart","markerStartOffset","markerEndOffset","marker","originalAngle","inWorldSpace","_this$parsedStyle3","_linePointAt","linePointAt","transformed","getPointAtLength","_this$parsedStyle4","lineLength","Path","_excluded$3","miterLimit","markerMidList","placeMarkerMid","_this$getStartTangent","getStartTangent","_this$getStartTangent2","_this$getEndTangent","getEndTangent","_this$getEndTangent2","_segments$i$currentPo","getPointAtLength$1","_getPointAtLength2","endPoint","tangent","Polygon","_excluded$2","isClosed","P","Polyline","_Polygon","_excluded$1","tempLength","segmentT","segmentL","subt","Rect","Text","_excluded","getComputedTextLength","_this$parsedStyle$met","getLineBoundingRects","_this$parsedStyle$met2","CustomElementRegistry","registry","define","CSS","percent","em","rem","grad","ms","registerProperty","definition","inherits","interpolable","initialValue","registerLayout","clazz","Document","initialStyle","customElements","shape","createElementNS","elementsFromBBox","rBush","rBushRoot","rBushNodes","hitTestList","_ref3$pointerEvents","isVisibilityAffected","elementFromPointSync","_this$defaultView$can","_this$defaultView$get","_this$defaultView$vie","_this$defaultView$get2","getRenderingService","topmost","picked","_elementFromPoint","_this$defaultView$can2","_this$defaultView$get3","_this$defaultView$vie2","_yield$this$defaultVi","elementFromPoint","_x","_x2","elementsFromPointSync","_this$defaultView$can3","_this$defaultView$get4","_this$defaultView$vie3","_this$defaultView$get5","_elementsFromPoint","_callee2","_this$defaultView$can4","_this$defaultView$get6","_this$defaultView$vie4","_yield$this$defaultVi2","_callee2$","_context2","elementsFromPoint","_x3","_x4","CullingPlugin","strategies","renderingService","tag","unculledEntities","every","CULLED","EventPlugin","autoPreventDefault","rootPointerEvent","rootWheelEvent","_this$context$renderi","supportsTouchEvents","normalizedEvents","normalizeToPointerEvent","normalizedEvent","bootstrapEvent","eventService","setCursor","_this$context$renderi2","_iterator2","_step2","_this2$context$render","normalizeWheelEvent","events","isNormalized","_iterator3","_step3","federatedEvent","$element","outside","_iterator4","_step4","_iterator5","_step5","transferMouseData","_this$context$eventSe","_this$context$eventSe2","_this$context$eventSe3","_this$context$eventSe4","srcElement","movementX","movementY","pageX","pageY","screenX","screenY","relatedTarget","applyCursorStyle","isTouchEvent","changedTouches","touch","touches","radiusX","radiusY","identifier","isMouseEvent","tempEvent","shape2D","FrustumCullingStrategy","_object$parentNode","parentVisibilityPlaneMask","computeVisibilityWithPlaneMask","INDETERMINATE","OUTSIDE","parentPlaneMask","INSIDE","mask","isShape2D","_planes$k","PrepareRendererPlugin","syncTasks","isFirstTimeRendering","syncing","isFirstTimeRenderingFinished","_runtime$globalThis$r","handleAttributeChanged","handleBoundsChanged","handleMounted","handleUnmounted","MOUNTED","UNMOUNTED","ric","requestIdleCallback","bind","syncRTree","syncNode","_renderBounds$getMin","_renderBounds$getMin2","_renderBounds$getMax","_renderBounds$getMax2","bulk","synced","isCanvas","CanvasEvent","DEFAULT_CAMERA_Z","DEFAULT_CAMERA_NEAR","DEFAULT_CAMERA_FAR","mountedEvent","unmountedEvent","beforeRenderEvent","BEFORE_RENDER","rerenderEvent","RERENDER","afterRenderEvent","AFTER_RENDER","Canvas","devicePixelRatio","background","createImage","enableLargeImageOptimization","supportsPointerEvents","supportsCSSTransform","_config$cleanUpOnDest","cleanUpOnDestroy","supportsMutipleCanvasesInOneContainer","canvasWidth","canvasHeight","dpr","PointerEvent","TouchEvent","MouseEvent","initRenderingContext","initDefaultCamera","initRenderer","mergedConfig","getRoot","getRenderingContext","readyPromise","resolve","resolveReadyPromise","skipTriggerEvent","fastCleanExistingCanvas","BEFORE_DESTROY","frameId","cancelRAF","AFTER_DESTROY","clearEventRetain","changeSize","resize","RESIZE","run","_tick","tick","time","firstContentfullPaint","loadRendererContainerModule","ContextService","initRenderingService","_this7","async","READY","RENDERER_CHANGED","_this8","setRenderer","oldRenderer","reverse","_this9","disconnectedCallback","_this10","connectedCallback","getPointByClient","getClientByPoint"],"sources":["/workspaces/TrackFunds/node_modules/node_modules/.pnpm/rbush@3.0.1/node_modules/rbush/rbush.js","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/types.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/AbstractRenderer.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/shapes/AABB.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/shapes/Plane.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/shapes/Frustum.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/shapes/Point.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/shapes/Rectangle.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/error.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/math.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/camera/interfaces.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/camera/Camera.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/components/Cullable.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/components/Sortable.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/constants.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/interfaces.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/memoize.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/types.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/CSSStyleValue.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/CSSColorValue.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/CSSGradientValue.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/CSSKeywordValue.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/CSSNumericValue.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/cssom/CSSRGB.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/CSSStyleValuePool.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/gradient.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/gradient.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/color.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/dimension.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/filter.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/numeric.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/path.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/path.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/points.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/transform.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/parser/transform-origin.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/StyleValueRegistry.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyAngle.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyClipPath.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyColor.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyFilter.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyLengthOrPercentage.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyLengthOrPercentage12.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyLengthOrPercentage14.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyMarker.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyNumber.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyOffsetDistance.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyOpacity.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyPath.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyPoints.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyShadowBlur.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyText.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyTextTransform.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/assert.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/canvas.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/dom.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/event.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/fragment.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/pointer-events.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/raf.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/tapable/AsyncParallelHook.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/tapable/AsyncSeriesWaterfallHook.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/tapable/SyncHook.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/tapable/SyncWaterfallHook.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/text.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/utils/transform-mat4.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyTransform.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyTransformOrigin.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/properties/CSSPropertyZIndex.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/CircleUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/EllipseUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/LineUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/PathUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/PolylineUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/RectUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/TextUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/GroupUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/aabb/HTMLUpdater.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/FederatedEvent.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/FederatedMouseEvent.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/FederatedPointerEvent.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/FederatedWheelEvent.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/CustomEvent.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/EventTarget.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/Node.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/EventService.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/OffscreenCanvasCreator.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/RenderingContext.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/RenderingService.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/SceneGraphSelector.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/interfaces.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/MutationEvent.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/SceneGraphService.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/services/TextService.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/global-runtime.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/Element.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/DisplayObject.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Circle.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/CustomElement.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Ellipse.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Fragment.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Group.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/HTML.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Image.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Line.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Path.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Polygon.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Polyline.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Rect.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/display-objects/Text.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/CustomElementRegistry.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/css/CSS.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/dom/Document.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/plugins/CullingPlugin.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/plugins/EventPlugin.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/plugins/FrustumCullingStrategy.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/plugins/PrepareRendererPlugin.ts","/workspaces/TrackFunds/node_modules/@antv/g-lite/src/Canvas.ts"],"sourcesContent":["(function (global, factory) {\ntypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\ntypeof define === 'function' && define.amd ? define(factory) :\n(global = global || self, global.RBush = factory());\n}(this, function () { 'use strict';\n\nfunction quickselect(arr, k, left, right, compare) {\n    quickselectStep(arr, k, left || 0, right || (arr.length - 1), compare || defaultCompare);\n}\n\nfunction quickselectStep(arr, k, left, right, compare) {\n\n    while (right > left) {\n        if (right - left > 600) {\n            var n = right - left + 1;\n            var m = k - left + 1;\n            var z = Math.log(n);\n            var s = 0.5 * Math.exp(2 * z / 3);\n            var sd = 0.5 * Math.sqrt(z * s * (n - s) / n) * (m - n / 2 < 0 ? -1 : 1);\n            var newLeft = Math.max(left, Math.floor(k - m * s / n + sd));\n            var newRight = Math.min(right, Math.floor(k + (n - m) * s / n + sd));\n            quickselectStep(arr, k, newLeft, newRight, compare);\n        }\n\n        var t = arr[k];\n        var i = left;\n        var j = right;\n\n        swap(arr, left, k);\n        if (compare(arr[right], t) > 0) { swap(arr, left, right); }\n\n        while (i < j) {\n            swap(arr, i, j);\n            i++;\n            j--;\n            while (compare(arr[i], t) < 0) { i++; }\n            while (compare(arr[j], t) > 0) { j--; }\n        }\n\n        if (compare(arr[left], t) === 0) { swap(arr, left, j); }\n        else {\n            j++;\n            swap(arr, j, right);\n        }\n\n        if (j <= k) { left = j + 1; }\n        if (k <= j) { right = j - 1; }\n    }\n}\n\nfunction swap(arr, i, j) {\n    var tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n\nvar RBush = function RBush(maxEntries) {\n    if ( maxEntries === void 0 ) maxEntries = 9;\n\n    // max entries in a node is 9 by default; min node fill is 40% for best performance\n    this._maxEntries = Math.max(4, maxEntries);\n    this._minEntries = Math.max(2, Math.ceil(this._maxEntries * 0.4));\n    this.clear();\n};\n\nRBush.prototype.all = function all () {\n    return this._all(this.data, []);\n};\n\nRBush.prototype.search = function search (bbox) {\n    var node = this.data;\n    var result = [];\n\n    if (!intersects(bbox, node)) { return result; }\n\n    var toBBox = this.toBBox;\n    var nodesToSearch = [];\n\n    while (node) {\n        for (var i = 0; i < node.children.length; i++) {\n            var child = node.children[i];\n            var childBBox = node.leaf ? toBBox(child) : child;\n\n            if (intersects(bbox, childBBox)) {\n                if (node.leaf) { result.push(child); }\n                else if (contains(bbox, childBBox)) { this._all(child, result); }\n                else { nodesToSearch.push(child); }\n            }\n        }\n        node = nodesToSearch.pop();\n    }\n\n    return result;\n};\n\nRBush.prototype.collides = function collides (bbox) {\n    var node = this.data;\n\n    if (!intersects(bbox, node)) { return false; }\n\n    var nodesToSearch = [];\n    while (node) {\n        for (var i = 0; i < node.children.length; i++) {\n            var child = node.children[i];\n            var childBBox = node.leaf ? this.toBBox(child) : child;\n\n            if (intersects(bbox, childBBox)) {\n                if (node.leaf || contains(bbox, childBBox)) { return true; }\n                nodesToSearch.push(child);\n            }\n        }\n        node = nodesToSearch.pop();\n    }\n\n    return false;\n};\n\nRBush.prototype.load = function load (data) {\n    if (!(data && data.length)) { return this; }\n\n    if (data.length < this._minEntries) {\n        for (var i = 0; i < data.length; i++) {\n            this.insert(data[i]);\n        }\n        return this;\n    }\n\n    // recursively build the tree with the given data from scratch using OMT algorithm\n    var node = this._build(data.slice(), 0, data.length - 1, 0);\n\n    if (!this.data.children.length) {\n        // save as is if tree is empty\n        this.data = node;\n\n    } else if (this.data.height === node.height) {\n        // split root if trees have the same height\n        this._splitRoot(this.data, node);\n\n    } else {\n        if (this.data.height < node.height) {\n            // swap trees if inserted one is bigger\n            var tmpNode = this.data;\n            this.data = node;\n            node = tmpNode;\n        }\n\n        // insert the small tree into the large tree at appropriate level\n        this._insert(node, this.data.height - node.height - 1, true);\n    }\n\n    return this;\n};\n\nRBush.prototype.insert = function insert (item) {\n    if (item) { this._insert(item, this.data.height - 1); }\n    return this;\n};\n\nRBush.prototype.clear = function clear () {\n    this.data = createNode([]);\n    return this;\n};\n\nRBush.prototype.remove = function remove (item, equalsFn) {\n    if (!item) { return this; }\n\n    var node = this.data;\n    var bbox = this.toBBox(item);\n    var path = [];\n    var indexes = [];\n    var i, parent, goingUp;\n\n    // depth-first iterative tree traversal\n    while (node || path.length) {\n\n        if (!node) { // go up\n            node = path.pop();\n            parent = path[path.length - 1];\n            i = indexes.pop();\n            goingUp = true;\n        }\n\n        if (node.leaf) { // check current node\n            var index = findItem(item, node.children, equalsFn);\n\n            if (index !== -1) {\n                // item found, remove the item and condense tree upwards\n                node.children.splice(index, 1);\n                path.push(node);\n                this._condense(path);\n                return this;\n            }\n        }\n\n        if (!goingUp && !node.leaf && contains(node, bbox)) { // go down\n            path.push(node);\n            indexes.push(i);\n            i = 0;\n            parent = node;\n            node = node.children[0];\n\n        } else if (parent) { // go right\n            i++;\n            node = parent.children[i];\n            goingUp = false;\n\n        } else { node = null; } // nothing found\n    }\n\n    return this;\n};\n\nRBush.prototype.toBBox = function toBBox (item) { return item; };\n\nRBush.prototype.compareMinX = function compareMinX (a, b) { return a.minX - b.minX; };\nRBush.prototype.compareMinY = function compareMinY (a, b) { return a.minY - b.minY; };\n\nRBush.prototype.toJSON = function toJSON () { return this.data; };\n\nRBush.prototype.fromJSON = function fromJSON (data) {\n    this.data = data;\n    return this;\n};\n\nRBush.prototype._all = function _all (node, result) {\n    var nodesToSearch = [];\n    while (node) {\n        if (node.leaf) { result.push.apply(result, node.children); }\n        else { nodesToSearch.push.apply(nodesToSearch, node.children); }\n\n        node = nodesToSearch.pop();\n    }\n    return result;\n};\n\nRBush.prototype._build = function _build (items, left, right, height) {\n\n    var N = right - left + 1;\n    var M = this._maxEntries;\n    var node;\n\n    if (N <= M) {\n        // reached leaf level; return leaf\n        node = createNode(items.slice(left, right + 1));\n        calcBBox(node, this.toBBox);\n        return node;\n    }\n\n    if (!height) {\n        // target height of the bulk-loaded tree\n        height = Math.ceil(Math.log(N) / Math.log(M));\n\n        // target number of root entries to maximize storage utilization\n        M = Math.ceil(N / Math.pow(M, height - 1));\n    }\n\n    node = createNode([]);\n    node.leaf = false;\n    node.height = height;\n\n    // split the items into M mostly square tiles\n\n    var N2 = Math.ceil(N / M);\n    var N1 = N2 * Math.ceil(Math.sqrt(M));\n\n    multiSelect(items, left, right, N1, this.compareMinX);\n\n    for (var i = left; i <= right; i += N1) {\n\n        var right2 = Math.min(i + N1 - 1, right);\n\n        multiSelect(items, i, right2, N2, this.compareMinY);\n\n        for (var j = i; j <= right2; j += N2) {\n\n            var right3 = Math.min(j + N2 - 1, right2);\n\n            // pack each entry recursively\n            node.children.push(this._build(items, j, right3, height - 1));\n        }\n    }\n\n    calcBBox(node, this.toBBox);\n\n    return node;\n};\n\nRBush.prototype._chooseSubtree = function _chooseSubtree (bbox, node, level, path) {\n    while (true) {\n        path.push(node);\n\n        if (node.leaf || path.length - 1 === level) { break; }\n\n        var minArea = Infinity;\n        var minEnlargement = Infinity;\n        var targetNode = (void 0);\n\n        for (var i = 0; i < node.children.length; i++) {\n            var child = node.children[i];\n            var area = bboxArea(child);\n            var enlargement = enlargedArea(bbox, child) - area;\n\n            // choose entry with the least area enlargement\n            if (enlargement < minEnlargement) {\n                minEnlargement = enlargement;\n                minArea = area < minArea ? area : minArea;\n                targetNode = child;\n\n            } else if (enlargement === minEnlargement) {\n                // otherwise choose one with the smallest area\n                if (area < minArea) {\n                    minArea = area;\n                    targetNode = child;\n                }\n            }\n        }\n\n        node = targetNode || node.children[0];\n    }\n\n    return node;\n};\n\nRBush.prototype._insert = function _insert (item, level, isNode) {\n    var bbox = isNode ? item : this.toBBox(item);\n    var insertPath = [];\n\n    // find the best node for accommodating the item, saving all nodes along the path too\n    var node = this._chooseSubtree(bbox, this.data, level, insertPath);\n\n    // put the item into the node\n    node.children.push(item);\n    extend(node, bbox);\n\n    // split on node overflow; propagate upwards if necessary\n    while (level >= 0) {\n        if (insertPath[level].children.length > this._maxEntries) {\n            this._split(insertPath, level);\n            level--;\n        } else { break; }\n    }\n\n    // adjust bboxes along the insertion path\n    this._adjustParentBBoxes(bbox, insertPath, level);\n};\n\n// split overflowed node into two\nRBush.prototype._split = function _split (insertPath, level) {\n    var node = insertPath[level];\n    var M = node.children.length;\n    var m = this._minEntries;\n\n    this._chooseSplitAxis(node, m, M);\n\n    var splitIndex = this._chooseSplitIndex(node, m, M);\n\n    var newNode = createNode(node.children.splice(splitIndex, node.children.length - splitIndex));\n    newNode.height = node.height;\n    newNode.leaf = node.leaf;\n\n    calcBBox(node, this.toBBox);\n    calcBBox(newNode, this.toBBox);\n\n    if (level) { insertPath[level - 1].children.push(newNode); }\n    else { this._splitRoot(node, newNode); }\n};\n\nRBush.prototype._splitRoot = function _splitRoot (node, newNode) {\n    // split root node\n    this.data = createNode([node, newNode]);\n    this.data.height = node.height + 1;\n    this.data.leaf = false;\n    calcBBox(this.data, this.toBBox);\n};\n\nRBush.prototype._chooseSplitIndex = function _chooseSplitIndex (node, m, M) {\n    var index;\n    var minOverlap = Infinity;\n    var minArea = Infinity;\n\n    for (var i = m; i <= M - m; i++) {\n        var bbox1 = distBBox(node, 0, i, this.toBBox);\n        var bbox2 = distBBox(node, i, M, this.toBBox);\n\n        var overlap = intersectionArea(bbox1, bbox2);\n        var area = bboxArea(bbox1) + bboxArea(bbox2);\n\n        // choose distribution with minimum overlap\n        if (overlap < minOverlap) {\n            minOverlap = overlap;\n            index = i;\n\n            minArea = area < minArea ? area : minArea;\n\n        } else if (overlap === minOverlap) {\n            // otherwise choose distribution with minimum area\n            if (area < minArea) {\n                minArea = area;\n                index = i;\n            }\n        }\n    }\n\n    return index || M - m;\n};\n\n// sorts node children by the best axis for split\nRBush.prototype._chooseSplitAxis = function _chooseSplitAxis (node, m, M) {\n    var compareMinX = node.leaf ? this.compareMinX : compareNodeMinX;\n    var compareMinY = node.leaf ? this.compareMinY : compareNodeMinY;\n    var xMargin = this._allDistMargin(node, m, M, compareMinX);\n    var yMargin = this._allDistMargin(node, m, M, compareMinY);\n\n    // if total distributions margin value is minimal for x, sort by minX,\n    // otherwise it's already sorted by minY\n    if (xMargin < yMargin) { node.children.sort(compareMinX); }\n};\n\n// total margin of all possible split distributions where each node is at least m full\nRBush.prototype._allDistMargin = function _allDistMargin (node, m, M, compare) {\n    node.children.sort(compare);\n\n    var toBBox = this.toBBox;\n    var leftBBox = distBBox(node, 0, m, toBBox);\n    var rightBBox = distBBox(node, M - m, M, toBBox);\n    var margin = bboxMargin(leftBBox) + bboxMargin(rightBBox);\n\n    for (var i = m; i < M - m; i++) {\n        var child = node.children[i];\n        extend(leftBBox, node.leaf ? toBBox(child) : child);\n        margin += bboxMargin(leftBBox);\n    }\n\n    for (var i$1 = M - m - 1; i$1 >= m; i$1--) {\n        var child$1 = node.children[i$1];\n        extend(rightBBox, node.leaf ? toBBox(child$1) : child$1);\n        margin += bboxMargin(rightBBox);\n    }\n\n    return margin;\n};\n\nRBush.prototype._adjustParentBBoxes = function _adjustParentBBoxes (bbox, path, level) {\n    // adjust bboxes along the given tree path\n    for (var i = level; i >= 0; i--) {\n        extend(path[i], bbox);\n    }\n};\n\nRBush.prototype._condense = function _condense (path) {\n    // go through the path, removing empty nodes and updating bboxes\n    for (var i = path.length - 1, siblings = (void 0); i >= 0; i--) {\n        if (path[i].children.length === 0) {\n            if (i > 0) {\n                siblings = path[i - 1].children;\n                siblings.splice(siblings.indexOf(path[i]), 1);\n\n            } else { this.clear(); }\n\n        } else { calcBBox(path[i], this.toBBox); }\n    }\n};\n\nfunction findItem(item, items, equalsFn) {\n    if (!equalsFn) { return items.indexOf(item); }\n\n    for (var i = 0; i < items.length; i++) {\n        if (equalsFn(item, items[i])) { return i; }\n    }\n    return -1;\n}\n\n// calculate node's bbox from bboxes of its children\nfunction calcBBox(node, toBBox) {\n    distBBox(node, 0, node.children.length, toBBox, node);\n}\n\n// min bounding rectangle of node children from k to p-1\nfunction distBBox(node, k, p, toBBox, destNode) {\n    if (!destNode) { destNode = createNode(null); }\n    destNode.minX = Infinity;\n    destNode.minY = Infinity;\n    destNode.maxX = -Infinity;\n    destNode.maxY = -Infinity;\n\n    for (var i = k; i < p; i++) {\n        var child = node.children[i];\n        extend(destNode, node.leaf ? toBBox(child) : child);\n    }\n\n    return destNode;\n}\n\nfunction extend(a, b) {\n    a.minX = Math.min(a.minX, b.minX);\n    a.minY = Math.min(a.minY, b.minY);\n    a.maxX = Math.max(a.maxX, b.maxX);\n    a.maxY = Math.max(a.maxY, b.maxY);\n    return a;\n}\n\nfunction compareNodeMinX(a, b) { return a.minX - b.minX; }\nfunction compareNodeMinY(a, b) { return a.minY - b.minY; }\n\nfunction bboxArea(a)   { return (a.maxX - a.minX) * (a.maxY - a.minY); }\nfunction bboxMargin(a) { return (a.maxX - a.minX) + (a.maxY - a.minY); }\n\nfunction enlargedArea(a, b) {\n    return (Math.max(b.maxX, a.maxX) - Math.min(b.minX, a.minX)) *\n           (Math.max(b.maxY, a.maxY) - Math.min(b.minY, a.minY));\n}\n\nfunction intersectionArea(a, b) {\n    var minX = Math.max(a.minX, b.minX);\n    var minY = Math.max(a.minY, b.minY);\n    var maxX = Math.min(a.maxX, b.maxX);\n    var maxY = Math.min(a.maxY, b.maxY);\n\n    return Math.max(0, maxX - minX) *\n           Math.max(0, maxY - minY);\n}\n\nfunction contains(a, b) {\n    return a.minX <= b.minX &&\n           a.minY <= b.minY &&\n           b.maxX <= a.maxX &&\n           b.maxY <= a.maxY;\n}\n\nfunction intersects(a, b) {\n    return b.minX <= a.maxX &&\n           b.minY <= a.maxY &&\n           b.maxX >= a.minX &&\n           b.maxY >= a.minY;\n}\n\nfunction createNode(children) {\n    return {\n        children: children,\n        height: 1,\n        leaf: true,\n        minX: Infinity,\n        minY: Infinity,\n        maxX: -Infinity,\n        maxY: -Infinity\n    };\n}\n\n// sort an array so that items come in groups of n unsorted items, with groups sorted between each other;\n// combines selection algorithm with binary divide & conquer approach\n\nfunction multiSelect(arr, left, right, n, compare) {\n    var stack = [left, right];\n\n    while (stack.length) {\n        right = stack.pop();\n        left = stack.pop();\n\n        if (right - left <= n) { continue; }\n\n        var mid = left + Math.ceil((right - left) / n / 2) * n;\n        quickselect(arr, mid, left, right, compare);\n\n        stack.push(left, mid, mid, right);\n    }\n}\n\nreturn RBush;\n\n}));\n","import type { IRenderer } from './AbstractRenderer';\nimport type {\n  CSSGlobalKeywords,\n  CSSGradientValue,\n  CSSRGB,\n  CSSUnitValue,\n} from './css';\nimport type {\n  ParsedFilterStyleProperty,\n  ParsedTransform,\n  Pattern,\n} from './css/parser';\nimport type { DisplayObject } from './display-objects';\n\nexport enum Shape {\n  GROUP = 'g',\n  FRAGMENT = 'fragment',\n  CIRCLE = 'circle',\n  ELLIPSE = 'ellipse',\n  IMAGE = 'image',\n  RECT = 'rect',\n  LINE = 'line',\n  POLYLINE = 'polyline',\n  POLYGON = 'polygon',\n  TEXT = 'text',\n  PATH = 'path',\n  HTML = 'html',\n  MESH = 'mesh',\n}\n\ntype ColorType = string | null;\n\nexport interface EventPosition {\n  clientX: number;\n  clientY: number;\n  viewportX: number;\n  viewportY: number;\n  x: number;\n  y: number;\n}\n\nexport type TransformType =\n  | 'matrix'\n  | 'matrix3d'\n  | 'rotate'\n  | 'rotateX'\n  | 'rotateY'\n  | 'rotateZ'\n  | 'rotate3d'\n  | 'scale'\n  | 'scaleX'\n  | 'scaleY'\n  | 'scaleZ'\n  | 'scale3d'\n  | 'skew'\n  | 'skewX'\n  | 'skewY'\n  | 'translate'\n  | 'translateX'\n  | 'translateY'\n  | 'translateZ'\n  | 'translate3d';\nexport type TransformScale = ['scale', number, number?];\nexport type TransformScaleX = ['scaleX', number];\nexport type TransformScaleY = ['scaleY', number];\nexport type TransformScaleZ = ['scaleZ', number];\nexport type TransformScale3d = ['scale3d', number, number, number];\nexport type TransformTranslate = ['translate', number, number?];\nexport type TransformTranslateX = ['translateX', number];\nexport type TransformTranslateY = ['translateY', number];\nexport type TransformTranslateZ = ['translateZ', number];\nexport type TransformTranslate3d = ['translate3d', number, number, number];\nexport type TransformRotate = ['rotate', number];\nexport type TransformRotateX = ['rotateX', number];\nexport type TransformRotateY = ['rotateY', number];\nexport type TransformRotateZ = ['rotateZ', number];\nexport type TransformRotate3d = ['rotate3d', number, number, number, number?];\nexport type TransformSkew = ['skew', number, number?];\nexport type TransformSkewX = ['skewX', number];\nexport type TransformSkewY = ['skewY', number];\n// prettier-ignore\nexport type TransformMatrix = [\n  'matrix',\n  number, number, // a, b\n  number, number, // c, d\n  number, number, // tx, ty\n];\n// prettier-ignore\nexport type TransformMatrix3d = [\n  'matrix3d',\n  number, number, number, number,\n  number, number, number, number,\n  number, number, number, number,\n  number, number, number, number,\n];\n\nexport type TransformArray = (\n  | TransformScale\n  | TransformScaleX\n  | TransformScaleY\n  | TransformScaleZ\n  | TransformScale3d\n  | TransformTranslate\n  | TransformTranslateX\n  | TransformTranslateY\n  | TransformTranslateZ\n  | TransformTranslate3d\n  | TransformRotate\n  | TransformRotateX\n  | TransformRotateY\n  | TransformRotateZ\n  | TransformRotate3d\n  | TransformSkew\n  | TransformSkewX\n  | TransformSkewY\n  | TransformMatrix\n  | TransformMatrix3d\n)[];\nexport type TextTransform = 'capitalize' | 'uppercase' | 'lowercase' | 'none';\nexport type TextOverflow = 'clip' | 'ellipsis' | string;\nexport type TextDecorationLine = string | 'none';\nexport type TextDecorationStyle =\n  | 'solid'\n  | 'double'\n  | 'dotted'\n  | 'dashed'\n  | 'wavy';\n\nexport interface BaseStyleProps {\n  class?: string;\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/transform\n   */\n  transform?: string | TransformArray;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin\n   */\n  transformOrigin?: string;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/visibility\n   */\n  visibility?: 'visible' | 'hidden' | CSSGlobalKeywords;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/pointer-events\n   */\n  pointerEvents?:\n    | 'none'\n    | 'auto'\n    | 'stroke'\n    | 'fill'\n    | 'painted'\n    | 'visible'\n    | 'visiblestroke'\n    | 'visiblefill'\n    | 'visiblepainted'\n    // | 'bounding-box'\n    | 'all'\n    | 'non-transparent-pixel' // valid only for Image\n    | CSSGlobalKeywords;\n\n  /**\n   * z-index in CSS\n   */\n  zIndex?: number;\n\n  /**\n   * the cursor style when the target is active\n   */\n  cursor?: Cursor;\n\n  /**\n   * clip path\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/clip-path\n   */\n  clipPath?: DisplayObject | null;\n\n  /**\n   * offset path\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Motion_Path\n   */\n  offsetPath?: DisplayObject | null;\n  offsetDistance?: number;\n\n  stroke?: ColorType | Pattern;\n  /** 描边透明度 */\n  strokeOpacity?: number | string;\n  /** 填充颜色 */\n  fill?: ColorType | Pattern;\n  /** 填充透明度 */\n  fillOpacity?: number | string;\n\n  /**\n   * The fill-rule attribute is a presentation attribute defining the algorithm to use to determine the inside part of a shape.\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/fill-rule\n   */\n  fillRule?: 'nonzero' | 'evenodd';\n\n  /** 整体透明度 */\n  opacity?: number | string;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-width\n   */\n  strokeWidth?: string | number;\n\n  /**\n   * alias if strokeWidth\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/lineWidth\n   */\n  lineWidth?: string | number;\n\n  /**\n   * increased line width when hitting test\n   */\n  increasedLineWidthForHitTesting?: string | number;\n  /**\n   * 交互区域\n   */\n  hitArea?: DisplayObject | null;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-linecap\n   */\n  strokeLinecap?: CanvasLineCap;\n\n  /**\n   * alias of strokeLinecap\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/lineCap\n   */\n  lineCap?: CanvasLineCap;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-linejoin\n   */\n  strokeLinejoin?: CanvasLineJoin;\n\n  /**\n   * alias of strokeLinejoin\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/lineJoin\n   */\n  lineJoin?: CanvasLineJoin;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray\n   */\n  strokeDasharray?: string | (string | number)[];\n\n  /**\n   * alias of strokeDasharray\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getLineDash\n   */\n  lineDash?: number | string | (string | number)[];\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dashoffset\n   */\n  strokeDashoffset?: number;\n\n  /**\n   * alias of strokeDashoffset\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/lineDashOffset\n   */\n  lineDashOffset?: number;\n\n  shadowType?: 'inner' | 'outer' | 'both';\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/shadowBlur\n   */\n  shadowBlur?: number;\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/shadowColor\n   */\n  shadowColor?: ColorType;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/shadowOffsetX\n   */\n  shadowOffsetX?: number;\n\n  /**\n   * https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/shadowOffsetY\n   */\n  shadowOffsetY?: number;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/filter\n   */\n  filter?: string;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-transform\n   */\n  textTransform?: TextTransform | '';\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/miterLimit\n   */\n  miterLimit?: number | string;\n\n  display?: string;\n\n  /**\n   * @see https://g-next.antv.vision/zh/docs/plugins/dragndrop#drag\n   */\n  draggable?: boolean;\n\n  /**\n   * @see https://g-next.antv.vision/zh/docs/plugins/dragndrop#drop\n   */\n  droppable?: boolean;\n}\n\nexport interface ParsedBaseStyleProps\n  extends Omit<\n    BaseStyleProps,\n    | 'fill'\n    | 'stroke'\n    | 'lineWidth'\n    | 'increasedLineWidthForHitTesting'\n    | 'lineDash'\n    | 'points'\n    | 'shadowColor'\n    | 'transform'\n    | 'transformOrigin'\n    | 'miterLimit'\n    | 'filter'\n    | 'opacity'\n    | 'fillOpacity'\n    | 'strokeOpacity'\n  > {\n  opacity?: number;\n  fillOpacity?: number;\n  strokeOpacity?: number;\n\n  fill?: CSSRGB | CSSGradientValue[] | Pattern;\n  stroke?: CSSRGB | CSSGradientValue[] | Pattern;\n  lineDash?: [number, number];\n\n  transform: ParsedTransform[];\n  transformOrigin?: [CSSUnitValue, CSSUnitValue, CSSUnitValue];\n\n  lineWidth?: number;\n  increasedLineWidthForHitTesting?: number;\n  /**\n   * offset relative to initial definition\n   */\n  offsetX?: number;\n  offsetY?: number;\n  shadowColor?: CSSRGB;\n  miterLimit?: number;\n  filter?: ParsedFilterStyleProperty[];\n}\n\n// Cursor style\n// See: https://developer.mozilla.org/en-US/docs/Web/CSS/cursor\nexport type Cursor =\n  | 'auto'\n  | 'default'\n  | 'none'\n  | 'context-menu'\n  | 'help'\n  | 'pointer'\n  | 'progress'\n  | 'wait'\n  | 'cell'\n  | 'crosshair'\n  | 'text'\n  | 'vertical-text'\n  | 'alias'\n  | 'copy'\n  | 'move'\n  | 'no-drop'\n  | 'not-allowed'\n  | 'grab'\n  | 'grabbing'\n  | 'all-scroll'\n  | 'col-resize'\n  | 'row-resize'\n  | 'n-resize'\n  | 'e-resize'\n  | 's-resize'\n  | 'w-resize'\n  | 'ne-resize'\n  | 'nw-resize'\n  | 'se-resize'\n  | 'sw-resize'\n  | 'ew-resize'\n  | 'ns-resize'\n  | 'nesw-resize'\n  | 'nwse-resize'\n  | 'zoom-in'\n  | 'zoom-out';\n\nexport enum ClipSpaceNearZ {\n  ZERO,\n  NEGATIVE_ONE,\n}\n\nexport interface RendererConfig {\n  /**\n   * enable dirty check for displayobject\n   */\n  enableDirtyCheck: boolean;\n\n  /**\n   * enable culling\n   */\n  enableCulling: boolean;\n\n  /**\n   * enable dirty rectangle rendering\n   */\n  enableDirtyRectangleRendering: boolean;\n\n  /**\n   * enable debugging dirty rectangle, Canvas will trigger CanvasEvent.DIRTY_RECTANGLE\n   */\n  enableDirtyRectangleRenderingDebug: boolean;\n\n  /**\n   * enable auto rendering\n   */\n  enableAutoRendering: boolean;\n\n  /**\n   * Canvas / SVG / Canvaskit should listen to camera changed events, while WebGL / WebGPU will apply this effect in shader.\n   */\n  enableSizeAttenuation: boolean;\n\n  // plugins:\n}\n\n/**\n * eg. NodeCanvas, OffscreenCanvas, HTMLCanvasElement\n */\nexport interface CanvasLike extends EventTarget {\n  width: number;\n  height: number;\n\n  getContext: ((\n    contextId: '2d',\n    contextAttributes?: CanvasRenderingContext2DSettings,\n  ) => CanvasRenderingContext2D | null) &\n    ((\n      contextId: 'webgl',\n      contextAttributes?: WebGLContextAttributes,\n    ) => WebGLRenderingContext | null) &\n    ((\n      contextId: 'webgl2',\n      contextAttributes?: WebGLContextAttributes,\n    ) => WebGL2RenderingContext | null);\n\n  addEventListener: (<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: (this: HTMLCanvasElement, ev: HTMLElementEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions,\n  ) => void) &\n    ((\n      type: string,\n      listener: EventListenerOrEventListenerObject,\n      options?: boolean | AddEventListenerOptions,\n    ) => void);\n  removeEventListener: (<K extends keyof HTMLElementEventMap>(\n    type: K,\n    listener: (this: HTMLCanvasElement, ev: HTMLElementEventMap[K]) => any,\n    options?: boolean | EventListenerOptions,\n  ) => void) &\n    ((\n      type: string,\n      listener: EventListenerOrEventListenerObject,\n      options?: boolean | EventListenerOptions,\n    ) => void);\n}\n\nexport interface CanvasConfig {\n  /**\n   * Renderer\n   */\n  renderer: IRenderer;\n\n  /**\n   * document.getElementById(container);\n   */\n  container?: string | HTMLElement;\n\n  /**\n   * support OffscreenCanvas\n   */\n  canvas?: CanvasLike;\n\n  /**\n   * used in JSDOM\n   */\n  document?: Document;\n\n  /**\n   * used in text measurement & texture generation\n   */\n  offscreenCanvas?: CanvasLike;\n\n  /**\n   * window.devicePixelRatio\n   */\n  devicePixelRatio?: number;\n\n  /**\n   * rAF\n   */\n  requestAnimationFrame?: (callback: FrameRequestCallback) => number;\n  cancelAnimationFrame?: (id: number) => void;\n\n  /**\n   * replace `new window.Image()`\n   */\n  createImage?: (src: string) => HTMLImageElement;\n  /**\n   * Optimize rendering performance for high-resolution large images\n   */\n  enableLargeImageOptimization?:\n    | boolean\n    | {\n        /**\n         * Downsampling rate threshold, [0.01, 0.5], represents the ratio of reducing the image.\n         * For example, 0.3 means reducing the original image to 0.3 times of the original.\n         *\n         * default 0.5\n         */\n        downSamplingRateThreshold?: number;\n        /**\n         * The maximum size of the downsampled image, with equal width and height.\n         *\n         * default 2048\n         */\n        maxDownSampledImageSize?: number;\n      };\n\n  /**\n   * limits query\n   */\n  supportsPointerEvents?: boolean;\n  // supportMouseEvent?: () => boolean;\n  supportsTouchEvents?: boolean;\n  isTouchEvent?: (event: InteractivePointerEvent) => event is TouchEvent;\n  isMouseEvent?: (event: InteractivePointerEvent) => event is MouseEvent;\n  dblClickSpeed?: number;\n\n  /**\n   * Listen to native click event instead of mocking with pointerup & down events.\n   */\n  useNativeClickEvent?: boolean;\n\n  /**\n   * Pointermove / up / cancel event will get triggered even outside Canvas.\n   */\n  alwaysTriggerPointerEventOnCanvas?: boolean;\n\n  /**\n   * Enable event service\n   */\n  disableHitTesting?: boolean;\n\n  /**\n   * Skip triggering hooks.beforeRender/render/afterRender\n   */\n  disableRenderHooks?: boolean;\n\n  /**\n   * Should we account for CSS Transform applied on container? Enabled by default.\n   * @deprecated\n   */\n  supportsCSSTransform?: boolean;\n\n  /**\n   * One container can have multiple canvases inside.\n   */\n  supportsMutipleCanvasesInOneContainer?: boolean;\n\n  /**\n   * 销毁画布时是否执行清理操作\n   */\n  cleanUpOnDestroy?: boolean;\n\n  /**\n   * 画布宽度\n   */\n  width?: number;\n  /**\n   * 画布高度\n   */\n  height?: number;\n\n  /**\n   * 画布背景色\n   */\n  background?: ColorType;\n\n  /**\n   * 画布的 cursor 样式\n   */\n  cursor?: Cursor;\n\n  [key: string]: any;\n}\n\n/**\n * The format to use when defining custom easing functions\n */\nexport type TypeEasingFunction = (\n  t: number,\n  params?: (string | number)[],\n  duration?: number,\n) => number;\n\nexport type InteractivePointerEvent =\n  | PointerEvent\n  | TouchEvent\n  | MouseEvent\n  | WheelEvent;\n\n// @see https://github.com/zhanba/pailye/blob/master/packages/flex/src/types.ts\nexport type Tuple4<T> = [T, T, T, T];\n\nexport type Tuple4Number = Tuple4<number>;\n\nexport type Tuple3<T> = [T, T, T];\n\nexport type Tuple3Number = Tuple3<number>;\n\nexport type ComninedValue<T> = T | [T] | [T, T] | [T, T, T] | Tuple4<T>;\n\nexport type CombinedNumber = ComninedValue<number>;\n\nexport type Length = number;\n\ntype Digit = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9;\n\nexport type Percentage = `${Digit}%` | `${Digit}${Digit}%`;\n\nexport type LengthOrPercentage = Length | Percentage;\nexport type LengthOrPercentageOrAuto = Length | Percentage | 'auto';\n","/* eslint-disable max-classes-per-file */\nimport type { CanvasContext } from './dom';\nimport { GlobalRuntime } from './global-runtime';\nimport type { RenderingPlugin } from './services';\nimport { ClipSpaceNearZ, RendererConfig } from './types';\n\nexport interface RendererPlugin {\n  name: string;\n  context: CanvasContext;\n  init: (runtime: GlobalRuntime) => void;\n  destroy: (runtime: GlobalRuntime) => void;\n}\n\nexport abstract class AbstractRendererPlugin<T = any>\n  implements RendererPlugin\n{\n  context: CanvasContext & T;\n  protected plugins = [];\n\n  protected addRenderingPlugin(plugin: RenderingPlugin) {\n    this.plugins.push(plugin);\n    this.context.renderingPlugins.push(plugin);\n  }\n\n  protected removeAllRenderingPlugins() {\n    this.plugins.forEach((plugin) => {\n      const index = this.context.renderingPlugins.indexOf(plugin);\n      if (index >= 0) {\n        this.context.renderingPlugins.splice(index, 1);\n      }\n    });\n  }\n\n  abstract name: string;\n  abstract init(runtime: GlobalRuntime): void;\n  abstract destroy(runtime: GlobalRuntime): void;\n}\n\nexport interface IRenderer {\n  /**\n   * The near/far clip planes correspond to a normalized device coordinate Z range of [0, 1],\n   * which matches WebGPU/Vulkan/DirectX/Metal's clip volume, while [-1, 1] matches WebGL/OpenGL's clip volume.\n   */\n  clipSpaceNearZ: ClipSpaceNearZ;\n\n  getConfig: () => RendererConfig;\n\n  /**\n   * register plugin at runtime\n   */\n  registerPlugin: (plugin: RendererPlugin) => void;\n\n  /**\n   * unregister plugin at runtime\n   */\n  unregisterPlugin: (plugin: RendererPlugin) => void;\n\n  /**\n   * get plugin by name\n   */\n  getPlugin: (name: string) => RendererPlugin;\n\n  /**\n   * return all registered plugins\n   */\n  getPlugins: () => RendererPlugin[];\n}\n\nexport class AbstractRenderer implements IRenderer {\n  clipSpaceNearZ = ClipSpaceNearZ.NEGATIVE_ONE;\n  private plugins: RendererPlugin[] = [];\n  private config: RendererConfig;\n\n  constructor(config?: Partial<RendererConfig>) {\n    this.config = {\n      /**\n       * only dirty object will cause re-render\n       */\n      enableDirtyCheck: true,\n      enableCulling: false,\n      /**\n       * enable auto rendering by default\n       */\n      enableAutoRendering: true,\n      /**\n       * enable dirty rectangle rendering by default\n       */\n      enableDirtyRectangleRendering: true,\n      enableDirtyRectangleRenderingDebug: false,\n      enableSizeAttenuation: true,\n      ...config,\n    };\n  }\n\n  registerPlugin(plugin: RendererPlugin) {\n    const index = this.plugins.findIndex((p) => p === plugin);\n    if (index === -1) {\n      this.plugins.push(plugin);\n    }\n  }\n\n  unregisterPlugin(plugin: RendererPlugin) {\n    const index = this.plugins.findIndex((p) => p === plugin);\n    if (index > -1) {\n      this.plugins.splice(index, 1);\n    }\n  }\n\n  getPlugins() {\n    return this.plugins;\n  }\n\n  getPlugin(name: string) {\n    return this.plugins.find((plugin) => plugin.name === name);\n  }\n\n  getConfig() {\n    return this.config;\n  }\n\n  setConfig(config: Partial<RendererConfig>) {\n    Object.assign(this.config, config);\n  }\n}\n","import type { mat4 } from 'gl-matrix';\nimport { vec3 } from 'gl-matrix';\nimport { Tuple3Number } from '../types';\nimport type { Plane } from './Plane';\n\nconst {\n  add: addVec3,\n  copy: copyVec3,\n  max: maxVec3,\n  min: minVec3,\n  scale: scaleVec3,\n  sub: subVec3,\n} = vec3;\n\n/**\n * Axis-Aligned Bounding Box\n * 为了便于后续 Frustum Culling，通过查找表定义 p-vertex 和 n-vertex\n * @see https://github.com/antvis/GWebGPUEngine/issues/3\n */\nexport class AABB {\n  static isEmpty(aabb: AABB) {\n    return (\n      !aabb ||\n      (aabb.halfExtents[0] === 0 &&\n        aabb.halfExtents[1] === 0 &&\n        aabb.halfExtents[2] === 0)\n    );\n  }\n\n  center: Tuple3Number = [0, 0, 0];\n  halfExtents: Tuple3Number = [0, 0, 0];\n  min: Tuple3Number = [0, 0, 0];\n  max: Tuple3Number = [0, 0, 0];\n\n  update(center: Tuple3Number, halfExtents: Tuple3Number) {\n    copyVec3(this.center, center);\n    copyVec3(this.halfExtents, halfExtents);\n    subVec3(this.min, this.center, this.halfExtents);\n    addVec3(this.max, this.center, this.halfExtents);\n  }\n\n  setMinMax(min: Tuple3Number, max: Tuple3Number) {\n    addVec3(this.center, max, min);\n    scaleVec3(this.center, this.center, 0.5);\n    subVec3(this.halfExtents, max, min);\n    scaleVec3(this.halfExtents, this.halfExtents, 0.5);\n    copyVec3(this.min, min);\n    copyVec3(this.max, max);\n  }\n\n  getMin() {\n    return this.min;\n  }\n\n  getMax() {\n    return this.max;\n  }\n\n  add(aabb: AABB) {\n    if (AABB.isEmpty(aabb)) {\n      return;\n    }\n    if (AABB.isEmpty(this)) {\n      this.setMinMax(aabb.getMin(), aabb.getMax());\n      return;\n    }\n\n    const tc = this.center;\n    const tcx = tc[0];\n    const tcy = tc[1];\n    const tcz = tc[2];\n    const th = this.halfExtents;\n    const thx = th[0];\n    const thy = th[1];\n    const thz = th[2];\n    let tminx = tcx - thx;\n    let tmaxx = tcx + thx;\n    let tminy = tcy - thy;\n    let tmaxy = tcy + thy;\n    let tminz = tcz - thz;\n    let tmaxz = tcz + thz;\n\n    const oc = aabb.center;\n    const ocx = oc[0];\n    const ocy = oc[1];\n    const ocz = oc[2];\n    const oh = aabb.halfExtents;\n    const ohx = oh[0];\n    const ohy = oh[1];\n    const ohz = oh[2];\n    const ominx = ocx - ohx;\n    const omaxx = ocx + ohx;\n    const ominy = ocy - ohy;\n    const omaxy = ocy + ohy;\n    const ominz = ocz - ohz;\n    const omaxz = ocz + ohz;\n\n    if (ominx < tminx) {\n      tminx = ominx;\n    }\n    if (omaxx > tmaxx) {\n      tmaxx = omaxx;\n    }\n    if (ominy < tminy) {\n      tminy = ominy;\n    }\n    if (omaxy > tmaxy) {\n      tmaxy = omaxy;\n    }\n    if (ominz < tminz) {\n      tminz = ominz;\n    }\n    if (omaxz > tmaxz) {\n      tmaxz = omaxz;\n    }\n\n    tc[0] = (tminx + tmaxx) * 0.5;\n    tc[1] = (tminy + tmaxy) * 0.5;\n    tc[2] = (tminz + tmaxz) * 0.5;\n    th[0] = (tmaxx - tminx) * 0.5;\n    th[1] = (tmaxy - tminy) * 0.5;\n    th[2] = (tmaxz - tminz) * 0.5;\n\n    this.min[0] = tminx;\n    this.min[1] = tminy;\n    this.min[2] = tminz;\n    this.max[0] = tmaxx;\n    this.max[1] = tmaxy;\n    this.max[2] = tmaxz;\n  }\n\n  setFromTransformedAABB(aabb: AABB, m: mat4) {\n    const bc = this.center;\n    const br = this.halfExtents;\n    const ac = aabb.center;\n    const ar = aabb.halfExtents;\n\n    const mx0 = m[0];\n    const mx1 = m[4];\n    const mx2 = m[8];\n    const my0 = m[1];\n    const my1 = m[5];\n    const my2 = m[9];\n    const mz0 = m[2];\n    const mz1 = m[6];\n    const mz2 = m[10];\n\n    const mx0a = Math.abs(mx0);\n    const mx1a = Math.abs(mx1);\n    const mx2a = Math.abs(mx2);\n    const my0a = Math.abs(my0);\n    const my1a = Math.abs(my1);\n    const my2a = Math.abs(my2);\n    const mz0a = Math.abs(mz0);\n    const mz1a = Math.abs(mz1);\n    const mz2a = Math.abs(mz2);\n\n    bc[0] = m[12] + mx0 * ac[0] + mx1 * ac[1] + mx2 * ac[2];\n    bc[1] = m[13] + my0 * ac[0] + my1 * ac[1] + my2 * ac[2];\n    bc[2] = m[14] + mz0 * ac[0] + mz1 * ac[1] + mz2 * ac[2];\n\n    // vec3.set(\n    //   bc,\n    //   m[12] + mx0 * ac[0] + mx1 * ac[1] + mx2 * ac[2],\n    //   m[13] + my0 * ac[0] + my1 * ac[1] + my2 * ac[2],\n    //   m[14] + mz0 * ac[0] + mz1 * ac[1] + mz2 * ac[2],\n    // );\n\n    br[0] = mx0a * ar[0] + mx1a * ar[1] + mx2a * ar[2];\n    br[1] = my0a * ar[0] + my1a * ar[1] + my2a * ar[2];\n    br[2] = mz0a * ar[0] + mz1a * ar[1] + mz2a * ar[2];\n\n    // vec3.set(\n    //   br,\n    //   mx0a * ar[0] + mx1a * ar[1] + mx2a * ar[2],\n    //   my0a * ar[0] + my1a * ar[1] + my2a * ar[2],\n    //   mz0a * ar[0] + mz1a * ar[1] + mz2a * ar[2],\n    // );\n\n    // this.min = vec3.sub(this.min, bc, br);\n    // this.max = vec3.add(this.max, bc, br);\n\n    subVec3(this.min, bc, br);\n    addVec3(this.max, bc, br);\n  }\n\n  intersects(aabb: AABB) {\n    const aMax = this.getMax();\n    const aMin = this.getMin();\n    const bMax = aabb.getMax();\n    const bMin = aabb.getMin();\n\n    return (\n      aMin[0] <= bMax[0] &&\n      aMax[0] >= bMin[0] &&\n      aMin[1] <= bMax[1] &&\n      aMax[1] >= bMin[1] &&\n      aMin[2] <= bMax[2] &&\n      aMax[2] >= bMin[2]\n    );\n  }\n\n  intersection(aabb: AABB): AABB | null {\n    if (!this.intersects(aabb)) {\n      return null;\n    }\n\n    const intersection = new AABB();\n    const min = maxVec3(\n      [0, 0, 0],\n      this.getMin(),\n      aabb.getMin(),\n    ) as Tuple3Number;\n    const max = minVec3(\n      [0, 0, 0],\n      this.getMax(),\n      aabb.getMax(),\n    ) as Tuple3Number;\n    intersection.setMinMax(min, max);\n\n    return intersection;\n  }\n\n  /**\n   * get n-vertex\n   * @param plane plane of CullingVolume\n   */\n  getNegativeFarPoint(plane: Plane): Tuple3Number {\n    if (plane.pnVertexFlag === 0x111) {\n      return copyVec3([0, 0, 0], this.min) as Tuple3Number;\n      // return vec3.copy(vec3.create(), this.min);\n    }\n    if (plane.pnVertexFlag === 0x110) {\n      return [this.min[0], this.min[1], this.max[2]];\n      // return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    }\n    if (plane.pnVertexFlag === 0x101) {\n      return [this.min[0], this.max[1], this.min[2]];\n      // return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    }\n    if (plane.pnVertexFlag === 0x100) {\n      return [this.min[0], this.max[1], this.max[2]];\n      // return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    }\n    if (plane.pnVertexFlag === 0x011) {\n      return [this.max[0], this.min[1], this.min[2]];\n      // return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    }\n    if (plane.pnVertexFlag === 0x010) {\n      return [this.max[0], this.min[1], this.max[2]];\n      // return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    }\n    if (plane.pnVertexFlag === 0x001) {\n      return [this.max[0], this.max[1], this.min[2]];\n      // return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    }\n    return [this.max[0], this.max[1], this.max[2]];\n    // return vec3.fromValues(this.max[0], this.max[1], this.max[2]);\n  }\n\n  /**\n   * get p-vertex\n   * @param plane plane of CullingVolume\n   */\n  getPositiveFarPoint(plane: Plane): Tuple3Number {\n    if (plane.pnVertexFlag === 0x111) {\n      return copyVec3([0, 0, 0], this.max) as Tuple3Number;\n      // return vec3.copy(vec3.create(), this.max);\n    }\n    if (plane.pnVertexFlag === 0x110) {\n      return [this.max[0], this.max[1], this.min[2]];\n      // return vec3.fromValues(this.max[0], this.max[1], this.min[2]);\n    }\n    if (plane.pnVertexFlag === 0x101) {\n      return [this.max[0], this.min[1], this.max[2]];\n      // return vec3.fromValues(this.max[0], this.min[1], this.max[2]);\n    }\n    if (plane.pnVertexFlag === 0x100) {\n      return [this.max[0], this.min[1], this.min[2]];\n      // return vec3.fromValues(this.max[0], this.min[1], this.min[2]);\n    }\n    if (plane.pnVertexFlag === 0x011) {\n      return [this.min[0], this.max[1], this.max[2]];\n      // return vec3.fromValues(this.min[0], this.max[1], this.max[2]);\n    }\n    if (plane.pnVertexFlag === 0x010) {\n      return [this.min[0], this.max[1], this.min[2]];\n      // return vec3.fromValues(this.min[0], this.max[1], this.min[2]);\n    }\n    if (plane.pnVertexFlag === 0x001) {\n      return [this.min[0], this.min[1], this.max[2]];\n      // return vec3.fromValues(this.min[0], this.min[1], this.max[2]);\n    }\n    return [this.min[0], this.min[1], this.min[2]];\n    // return vec3.fromValues(this.min[0], this.min[1], this.min[2]);\n  }\n}\n","import { vec3 } from 'gl-matrix';\n\nexport class Plane {\n  public distance: number;\n  public normal: vec3;\n\n  /**\n   * lookup table for p-vertex & n-vertex when doing frustum culling\n   */\n  public pnVertexFlag: number;\n\n  constructor(distance?: number, normal?: vec3) {\n    this.distance = distance || 0;\n    this.normal = normal || vec3.fromValues(0, 1, 0);\n    this.updatePNVertexFlag();\n  }\n\n  public updatePNVertexFlag() {\n    this.pnVertexFlag =\n      (Number(this.normal[0] >= 0) << 8) +\n      (Number(this.normal[1] >= 0) << 4) +\n      Number(this.normal[2] >= 0);\n  }\n\n  public distanceToPoint(point: vec3) {\n    return vec3.dot(point, this.normal) - this.distance;\n  }\n\n  public normalize() {\n    const invLen = 1 / vec3.len(this.normal);\n    vec3.scale(this.normal, this.normal, invLen);\n    this.distance *= invLen;\n  }\n\n  public intersectsLine(start: vec3, end: vec3, point?: vec3) {\n    const d0 = this.distanceToPoint(start);\n    const d1 = this.distanceToPoint(end);\n    const t = d0 / (d0 - d1);\n    const intersects = t >= 0 && t <= 1;\n    if (intersects && point) {\n      vec3.lerp(point, start, end, t);\n    }\n    return intersects;\n  }\n}\n","import type { mat4 } from 'gl-matrix';\nimport { vec3 } from 'gl-matrix';\nimport { Plane } from './Plane';\n\nexport enum Mask {\n  OUTSIDE = 0xffffffff,\n  INSIDE = 0x00000000,\n  INDETERMINATE = 0x7fffffff,\n}\n\nexport class Frustum {\n  public planes: Plane[] = [];\n\n  constructor(planes?: Plane[]) {\n    if (planes) {\n      this.planes = planes;\n    } else {\n      for (let i = 0; i < 6; i++) {\n        this.planes.push(new Plane());\n      }\n    }\n  }\n\n  /**\n   * extract 6 planes from projectionMatrix\n   * @see http://www8.cs.umu.se/kurser/5DV051/HT12/lab/plane_extraction.pdf\n   */\n  public extractFromVPMatrix(projectionMatrix: mat4) {\n    // @ts-ignore\n    const [\n      m0,\n      m1,\n      m2,\n      m3,\n      m4,\n      m5,\n      m6,\n      m7,\n      m8,\n      m9,\n      m10,\n      m11,\n      m12,\n      m13,\n      m14,\n      m15,\n    ] = projectionMatrix;\n\n    // right\n    vec3.set(this.planes[0].normal, m3 - m0, m7 - m4, m11 - m8);\n    this.planes[0].distance = m15 - m12;\n\n    // left\n    vec3.set(this.planes[1].normal, m3 + m0, m7 + m4, m11 + m8);\n    this.planes[1].distance = m15 + m12;\n\n    // bottom\n    vec3.set(this.planes[2].normal, m3 + m1, m7 + m5, m11 + m9);\n    this.planes[2].distance = m15 + m13;\n\n    // top\n    vec3.set(this.planes[3].normal, m3 - m1, m7 - m5, m11 - m9);\n    this.planes[3].distance = m15 - m13;\n\n    // far\n    vec3.set(this.planes[4].normal, m3 - m2, m7 - m6, m11 - m10);\n    this.planes[4].distance = m15 - m14;\n\n    // near\n    vec3.set(this.planes[5].normal, m3 + m2, m7 + m6, m11 + m10);\n    this.planes[5].distance = m15 + m14;\n\n    this.planes.forEach((plane) => {\n      plane.normalize();\n      plane.updatePNVertexFlag();\n    });\n  }\n}\n","export interface PointLike {\n  x: number;\n  y: number;\n}\n\nexport class Point {\n  x = 0;\n  y = 0;\n\n  constructor(x = 0, y = 0) {\n    this.x = x;\n    this.y = y;\n  }\n\n  clone(): Point {\n    return new Point(this.x, this.y);\n  }\n\n  copyFrom(p: Point) {\n    this.x = p.x;\n    this.y = p.y;\n  }\n}\n","import { mat4, vec4 } from 'gl-matrix';\n\ntype RectangleLike = {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n};\n\nexport class Rectangle implements DOMRect {\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/DOMRect/fromRect_static\n   */\n  static fromRect(rect: RectangleLike) {\n    return new Rectangle(rect.x, rect.y, rect.width, rect.height);\n  }\n\n  /**\n   * will return a new rect instance\n   */\n  static applyTransform(rect: Rectangle, matrix: mat4) {\n    const topLeft = vec4.fromValues(rect.x, rect.y, 0, 1);\n    const topRight = vec4.fromValues(rect.x + rect.width, rect.y, 0, 1);\n    const bottomLeft = vec4.fromValues(rect.x, rect.y + rect.height, 0, 1);\n    const bottomRight = vec4.fromValues(\n      rect.x + rect.width,\n      rect.y + rect.height,\n      0,\n      1,\n    );\n\n    const transformedTopLeft = vec4.create();\n    const transformedTopRight = vec4.create();\n    const transformedBottomLeft = vec4.create();\n    const transformedBottomRight = vec4.create();\n\n    vec4.transformMat4(transformedTopLeft, topLeft, matrix);\n    vec4.transformMat4(transformedTopRight, topRight, matrix);\n    vec4.transformMat4(transformedBottomLeft, bottomLeft, matrix);\n    vec4.transformMat4(transformedBottomRight, bottomRight, matrix);\n\n    const minX = Math.min(\n      transformedTopLeft[0],\n      transformedTopRight[0],\n      transformedBottomLeft[0],\n      transformedBottomRight[0],\n    );\n    const minY = Math.min(\n      transformedTopLeft[1],\n      transformedTopRight[1],\n      transformedBottomLeft[1],\n      transformedBottomRight[1],\n    );\n    const maxX = Math.max(\n      transformedTopLeft[0],\n      transformedTopRight[0],\n      transformedBottomLeft[0],\n      transformedBottomRight[0],\n    );\n    const maxY = Math.max(\n      transformedTopLeft[1],\n      transformedTopRight[1],\n      transformedBottomLeft[1],\n      transformedBottomRight[1],\n    );\n\n    return Rectangle.fromRect({\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY,\n    });\n  }\n\n  left: number;\n  right: number;\n  top: number;\n  bottom: number;\n  constructor(\n    public x: number,\n    public y: number,\n    public width: number,\n    public height: number,\n  ) {\n    this.left = x;\n    this.right = x + width;\n    this.top = y;\n    this.bottom = y + height;\n  }\n  toJSON() {}\n}\n","export const ERROR_MSG_METHOD_NOT_IMPLEMENTED = 'Method not implemented.';\nexport const ERROR_MSG_USE_DOCUMENT_ELEMENT =\n  'Use document.documentElement instead.';\nexport const ERROR_MSG_APPEND_DESTROYED_ELEMENT =\n  'Cannot append a destroyed element.';\n","import { isNumber } from '@antv/util';\nimport type { quat, vec2 } from 'gl-matrix';\nimport { mat3, mat4, vec3, vec4 } from 'gl-matrix';\n\nexport function getAngle(angle?: number) {\n  if (angle === undefined) {\n    return 0;\n  }\n  if (angle > 360 || angle < -360) {\n    return angle % 360;\n  }\n  return angle;\n}\n\nconst $vec3 = vec3.create();\nexport function createVec3(\n  x: number | vec2 | vec3 | vec4,\n  y = 0,\n  z = 0,\n  clone = true,\n) {\n  if (Array.isArray(x) && x.length === 3) {\n    return clone ? vec3.clone(x) : vec3.copy($vec3, x);\n  }\n\n  if (isNumber(x)) {\n    return clone ? vec3.fromValues(x, y, z) : vec3.set($vec3, x, y, z);\n  }\n\n  return clone\n    ? vec3.fromValues(x[0], x[1] || y, x[2] || z)\n    : vec3.set($vec3, x[0], x[1] || y, x[2] || z);\n}\n\nconst DEG_RAD = Math.PI / 180;\nexport function deg2rad(deg: number) {\n  return deg * DEG_RAD;\n}\n\nconst RAD_DEG = 180 / Math.PI;\nexport function rad2deg(rad: number) {\n  return rad * RAD_DEG;\n}\n\nconst GRAD_DEG = 0.9; // 360 / 400;\nexport function grad2deg(grads: number) {\n  grads %= 400;\n  if (grads < 0) {\n    grads += 400;\n  }\n  return grads * GRAD_DEG;\n}\n\nexport function deg2turn(deg: number) {\n  return deg / 360;\n}\n\nexport function turn2deg(turn: number) {\n  return 360 * turn;\n}\n\n/**\n * decompose mat3\n * extract translation/scaling/rotation(in radians)\n *\n * gl-matrix didn't provide them for mat3, but we can\n * @see https://math.stackexchange.com/a/1463487\n * @see https://math.stackexchange.com/a/417813\n */\nexport function getScaling(out: vec2, mat: mat3): vec2 {\n  const m11 = mat[0];\n  const m12 = mat[1];\n  const m21 = mat[3];\n  const m22 = mat[4];\n\n  out[0] = Math.hypot(m11, m12);\n  out[1] = Math.hypot(m21, m22);\n  return out;\n}\nexport function getTranslation(out: vec2, mat: mat3): vec2 {\n  out[0] = mat[6];\n  out[1] = mat[7];\n  return out;\n}\nexport function getRotationInRadians(mat: mat3): number {\n  return Math.atan2(mat[1], mat[4]);\n}\n\nconst HALF_PI = Math.PI / 2;\nfunction getEulerFromQuat(out: vec3, quat: quat) {\n  const x = quat[0];\n  const y = quat[1];\n  const z = quat[2];\n  const w = quat[3];\n  const x2 = x * x;\n  const y2 = y * y;\n  const z2 = z * z;\n  const w2 = w * w;\n  const unit = x2 + y2 + z2 + w2;\n  const test = x * w - y * z;\n  if (test > 0.499995 * unit) {\n    // TODO: Use glmatrix.EPSILON\n    // singularity at the north pole\n    out[0] = HALF_PI;\n    out[1] = 2 * Math.atan2(y, x);\n    out[2] = 0;\n  } else if (test < -0.499995 * unit) {\n    // TODO: Use glmatrix.EPSILON\n    // singularity at the south pole\n    out[0] = -HALF_PI;\n    out[1] = 2 * Math.atan2(y, x);\n    out[2] = 0;\n  } else {\n    out[0] = Math.asin(2 * (x * z - w * y));\n    out[1] = Math.atan2(2 * (x * w + y * z), 1 - 2 * (z2 + w2));\n    out[2] = Math.atan2(2 * (x * y + z * w), 1 - 2 * (y2 + z2));\n  }\n  // TODO: Return them as degrees and not as radians\n  return out;\n}\n\nfunction getEulerFromMat4(out: vec3, m: mat4) {\n  let x: number;\n  let z: number;\n\n  const [sx, sy, sz] = mat4.getScaling(vec3.create(), m);\n\n  const y = Math.asin(-m[2] / sx);\n\n  if (y < HALF_PI) {\n    if (y > -HALF_PI) {\n      x = Math.atan2(m[6] / sy, m[10] / sz);\n      z = Math.atan2(m[1] / sx, m[0] / sx);\n    } else {\n      // Not a unique solution\n      z = 0;\n      x = -Math.atan2(m[4] / sy, m[5] / sy);\n    }\n  } else {\n    // Not a unique solution\n    z = 0;\n    x = Math.atan2(m[4] / sy, m[5] / sy);\n  }\n\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n\n  return out;\n}\n\n/**\n * @see https://github.com/toji/gl-matrix/issues/329\n * @see https://doc.babylonjs.com/divingDeeper/mesh/transforms/center_origin/rotation_conventions\n */\nexport function getEuler(out: vec3, quat: quat | mat4): vec3 {\n  if (quat.length === 16) {\n    return getEulerFromMat4(out, quat as mat4);\n  }\n  return getEulerFromQuat(out, quat as quat);\n}\n\nexport function fromRotationTranslationScale(\n  rotation: number,\n  x: number,\n  y: number,\n  scaleX: number,\n  scaleY: number,\n): mat3 {\n  const cos = Math.cos(rotation);\n  const sin = Math.sin(rotation);\n  return mat3.fromValues(\n    scaleX * cos,\n    scaleY * sin,\n    0,\n    -scaleX * sin,\n    scaleY * cos,\n    0,\n    x,\n    y,\n    1,\n  );\n}\n\nexport function makePerspective(\n  out: mat4,\n  left: number,\n  right: number,\n  top: number,\n  bottom: number,\n  near: number,\n  far: number,\n  zero = false,\n) {\n  const twoNear = 2 * near;\n  const rightMinusLeft = right - left;\n  const topMinusBottom = top - bottom;\n  const x = twoNear / rightMinusLeft;\n  const y = twoNear / topMinusBottom;\n\n  const a = (right + left) / rightMinusLeft;\n  const b = (top + bottom) / topMinusBottom;\n\n  let c: number;\n  let d: number;\n\n  const farMinusNear = far - near;\n  const farMulNear = far * near;\n  if (zero) {\n    c = -far / farMinusNear;\n    d = -farMulNear / farMinusNear;\n  } else {\n    c = -(far + near) / farMinusNear;\n    d = (-2 * farMulNear) / farMinusNear;\n  }\n\n  out[0] = x;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 0;\n  out[5] = y;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = a;\n  out[9] = b;\n  out[10] = c;\n  out[11] = -1;\n  out[12] = 0;\n  out[13] = 0;\n  out[14] = d;\n  out[15] = 0;\n  return out;\n}\n\nexport function decompose(mat: mat3) {\n  let row0x = mat[0];\n  let row0y = mat[1];\n  let row1x = mat[3];\n  let row1y = mat[4];\n  // decompose 3x3 matrix\n  // @see https://www.w3.org/TR/css-transforms-1/#decomposing-a-2d-matrix\n  let scalingX = Math.sqrt(row0x * row0x + row0y * row0y);\n  let scalingY = Math.sqrt(row1x * row1x + row1y * row1y);\n\n  // If determinant is negative, one axis was flipped.\n  const determinant = row0x * row1y - row0y * row1x;\n  if (determinant < 0) {\n    // Flip axis with minimum unit vector dot product.\n    if (row0x < row1y) {\n      scalingX = -scalingX;\n    } else {\n      scalingY = -scalingY;\n    }\n  }\n\n  // Renormalize matrix to remove scale.\n  if (scalingX) {\n    const invScalingX = 1 / scalingX;\n    row0x *= invScalingX;\n    row0y *= invScalingX;\n  }\n  if (scalingY) {\n    const invScalingY = 1 / scalingY;\n    row1x *= invScalingY;\n    row1y *= invScalingY;\n  }\n\n  // Compute rotation and renormalize matrix.\n  const rotation = Math.atan2(row0y, row0x);\n\n  const angle = rad2deg(rotation);\n\n  return [mat[6], mat[7], scalingX, scalingY, angle];\n}\n\nconst tmp = mat4.create();\nconst perspectiveMatrix = mat4.create();\nconst tmpVec4 = vec4.create();\nconst row = [vec3.create(), vec3.create(), vec3.create()];\nconst pdum3 = vec3.create();\n\n/*\nInput:  matrix      ; a 4x4 matrix\nOutput: translation ; a 3 component vector\n        scale       ; a 3 component vector\n        skew        ; skew factors XY,XZ,YZ represented as a 3 component vector\n        perspective ; a 4 component vector\n        quaternion  ; a 4 component vector\nReturns false if the matrix cannot be decomposed, true if it can\n\n\nReferences:\nhttps://github.com/kamicane/matrix3d/blob/master/lib/Matrix3d.js\nhttps://github.com/ChromiumWebApps/chromium/blob/master/ui/gfx/transform_util.cc\nhttp://www.w3.org/TR/css3-transforms/#decomposing-a-3d-matrix\n*/\nexport function decomposeMat4(\n  matrix: mat4,\n  translation: vec3,\n  scale: vec3,\n  skew: vec3,\n  perspective: vec4,\n  quaternion: vec4,\n) {\n  // normalize, if not possible then bail out early\n  if (!normalize(tmp, matrix)) return false;\n\n  // perspectiveMatrix is used to solve for perspective, but it also provides\n  // an easy way to test for singularity of the upper 3x3 component.\n  mat4.copy(perspectiveMatrix, tmp);\n\n  perspectiveMatrix[3] = 0;\n  perspectiveMatrix[7] = 0;\n  perspectiveMatrix[11] = 0;\n  perspectiveMatrix[15] = 1;\n\n  // If the perspectiveMatrix is not invertible, we are also unable to\n  // decompose, so we'll bail early. Constant taken from SkMatrix44::invert.\n  if (Math.abs(mat4.determinant(perspectiveMatrix)) < 1e-8) return false;\n\n  const a03 = tmp[3];\n  const a13 = tmp[7];\n  const a23 = tmp[11];\n  const a30 = tmp[12];\n  const a31 = tmp[13];\n  const a32 = tmp[14];\n  const a33 = tmp[15];\n\n  // First, isolate perspective.\n  if (a03 !== 0 || a13 !== 0 || a23 !== 0) {\n    tmpVec4[0] = a03;\n    tmpVec4[1] = a13;\n    tmpVec4[2] = a23;\n    tmpVec4[3] = a33;\n\n    // Solve the equation by inverting perspectiveMatrix and multiplying\n    // rightHandSide by the inverse.\n    // resuing the perspectiveMatrix here since it's no longer needed\n    const ret = mat4.invert(perspectiveMatrix, perspectiveMatrix);\n    if (!ret) return false;\n    mat4.transpose(perspectiveMatrix, perspectiveMatrix);\n\n    // multiply by transposed inverse perspective matrix, into perspective vec4\n    vec4.transformMat4(perspective, tmpVec4, perspectiveMatrix);\n  } else {\n    // no perspective\n    perspective[0] = perspective[1] = perspective[2] = 0;\n    perspective[3] = 1;\n  }\n\n  // Next take care of translation\n  translation[0] = a30;\n  translation[1] = a31;\n  translation[2] = a32;\n\n  // Now get scale and shear. 'row' is a 3 element array of 3 component vectors\n  mat3from4(row as unknown as mat3, tmp);\n\n  // Compute X scale factor and normalize first row.\n  scale[0] = vec3.length(row[0]);\n  vec3.normalize(row[0], row[0]);\n\n  // Compute XY shear factor and make 2nd row orthogonal to 1st.\n  skew[0] = vec3.dot(row[0], row[1]);\n  combine(row[1], row[1], row[0], 1.0, -skew[0]);\n\n  // Now, compute Y scale and normalize 2nd row.\n  scale[1] = vec3.length(row[1]);\n  vec3.normalize(row[1], row[1]);\n  skew[0] /= scale[1];\n\n  // Compute XZ and YZ shears, orthogonalize 3rd row\n  skew[1] = vec3.dot(row[0], row[2]);\n  combine(row[2], row[2], row[0], 1.0, -skew[1]);\n  skew[2] = vec3.dot(row[1], row[2]);\n  combine(row[2], row[2], row[1], 1.0, -skew[2]);\n\n  // Next, get Z scale and normalize 3rd row.\n  scale[2] = vec3.length(row[2]);\n  vec3.normalize(row[2], row[2]);\n  skew[1] /= scale[2];\n  skew[2] /= scale[2];\n\n  // At this point, the matrix (in rows) is orthonormal.\n  // Check for a coordinate system flip.  If the determinant\n  // is -1, then negate the matrix and the scaling factors.\n  vec3.cross(pdum3, row[1], row[2]);\n  if (vec3.dot(row[0], pdum3) < 0) {\n    for (let i = 0; i < 3; i++) {\n      scale[i] *= -1;\n      row[i][0] *= -1;\n      row[i][1] *= -1;\n      row[i][2] *= -1;\n    }\n  }\n\n  // Now, get the rotations out\n  quaternion[0] =\n    0.5 * Math.sqrt(Math.max(1 + row[0][0] - row[1][1] - row[2][2], 0));\n  quaternion[1] =\n    0.5 * Math.sqrt(Math.max(1 - row[0][0] + row[1][1] - row[2][2], 0));\n  quaternion[2] =\n    0.5 * Math.sqrt(Math.max(1 - row[0][0] - row[1][1] + row[2][2], 0));\n  quaternion[3] =\n    0.5 * Math.sqrt(Math.max(1 + row[0][0] + row[1][1] + row[2][2], 0));\n\n  if (row[2][1] > row[1][2]) quaternion[0] = -quaternion[0];\n  if (row[0][2] > row[2][0]) quaternion[1] = -quaternion[1];\n  if (row[1][0] > row[0][1]) quaternion[2] = -quaternion[2];\n  return true;\n}\n\nfunction normalize(out: mat4, mat: mat4) {\n  const m44 = mat[15];\n  // Cannot normalize.\n  if (m44 === 0) return false;\n  const scale = 1 / m44;\n  for (let i = 0; i < 16; i++) out[i] = mat[i] * scale;\n  return true;\n}\n\n// gets upper-left of a 4x4 matrix into a 3x3 of vectors\nfunction mat3from4(out: mat3, mat4x4: mat4) {\n  out[0][0] = mat4x4[0];\n  out[0][1] = mat4x4[1];\n  out[0][2] = mat4x4[2];\n\n  out[1][0] = mat4x4[4];\n  out[1][1] = mat4x4[5];\n  out[1][2] = mat4x4[6];\n\n  out[2][0] = mat4x4[8];\n  out[2][1] = mat4x4[9];\n  out[2][2] = mat4x4[10];\n}\n\nfunction combine(out: vec3, a: vec3, b: vec3, scale1: number, scale2: number) {\n  out[0] = a[0] * scale1 + b[0] * scale2;\n  out[1] = a[1] * scale1 + b[1] * scale2;\n  out[2] = a[2] * scale1 + b[2] * scale2;\n}\n","import type { EventEmitter } from 'eventemitter3';\nimport type { mat4, vec2, vec3 } from 'gl-matrix';\nimport type { TypeEasingFunction } from '..';\nimport type { ICanvas } from '../dom';\nimport type { Frustum } from '../shapes';\nimport type { Landmark } from './Landmark';\n\n/**\n * Different type of cameras, eg. simple camera used in 2D scene or\n * advanced camera which can do actions & switch between landmarks.\n */\n\nexport enum CameraType {\n  /**\n   * Performs all the rotational operations with the focal point instead of the camera position.\n   * This type of camera is useful in applications(like CAD) where 3D objects are being designed or explored.\n   * Camera cannot orbits over the north & south poles.\n   * @see http://voxelent.com/tutorial-cameras/\n   *\n   * In Three.js it's used in OrbitControls.\n   * @see https://threejs.org/docs/#examples/zh/controls/OrbitControls\n   */\n  ORBITING,\n  /**\n   * It's similar to the ORBITING camera, but it allows the camera to orbit over the north or south poles.\n   *\n   * In Three.js it's used in OrbitControls.\n   * @see https://threejs.org/docs/#examples/en/controls/TrackballControls\n   */\n  EXPLORING,\n  /**\n   * Performs all the rotational operations with the camera position.\n   * It's useful in first person shooting games.\n   * Camera cannot orbits over the north & south poles.\n   *\n   * In Three.js it's used in FirstPersonControls.\n   * @see https://threejs.org/docs/#examples/en/controls/FirstPersonControls\n   */\n  TRACKING,\n}\n\n/**\n * CameraType must be TRACKING\n */\nexport enum CameraTrackingMode {\n  DEFAULT,\n  ROTATIONAL,\n  TRANSLATIONAL,\n  CINEMATIC,\n}\n\nexport enum CameraProjectionMode {\n  ORTHOGRAPHIC,\n  PERSPECTIVE,\n}\n\nexport const CameraEvent = {\n  UPDATED: 'updated',\n};\n\nexport interface ICamera {\n  canvas: ICanvas;\n  eventEmitter: EventEmitter;\n  isOrtho: () => boolean;\n  getProjectionMode: () => CameraProjectionMode;\n  getPerspective: () => mat4;\n  getPerspectiveInverse: () => mat4;\n  getFrustum: () => Frustum;\n  getPosition: () => vec3;\n  getFocalPoint: () => vec3;\n  getDollyingStep: () => number;\n  getNear: () => number;\n  getFar: () => number;\n  getZoom: () => number;\n  getOrthoMatrix: () => mat4;\n  getView: () => {\n    enabled: boolean;\n    fullWidth: number;\n    fullHeight: number;\n    offsetX: number;\n    offsetY: number;\n    width: number;\n    height: number;\n  };\n  setEnableUpdate: (enabled: boolean) => void;\n  setType: (type: CameraType, trackingMode?: CameraTrackingMode) => this;\n  setProjectionMode: (projectionMode: CameraProjectionMode) => this;\n  setTrackingMode: (trackingMode: CameraTrackingMode) => this;\n  /**\n   * If flag is true, it reverses the azimuth and elevation angles.\n   * Subsequent calls to rotate, setAzimuth, setElevation,\n   * changeAzimuth or changeElevation will cause the inverted effect.\n   * setRoll or changeRoll is not affected by this method.\n   *\n   * This inversion is useful when one wants to simulate that the world\n   * is moving, instead of the camera.\n   *\n   * By default the camera angles are not reversed.\n   * @param {Boolean} flag the boolean flag to reverse the angles.\n   */\n  setWorldRotation: (flag: boolean) => this;\n  /**\n   * 计算 MV 矩阵，为相机矩阵的逆矩阵\n   */\n  getViewTransform: () => mat4;\n  getWorldTransform: () => mat4;\n  jitterProjectionMatrix: (x: number, y: number) => void;\n  clearJitterProjectionMatrix: () => void;\n  /**\n   * 设置相机矩阵\n   */\n  setMatrix: (matrix: mat4) => this;\n  setFov: (fov: number) => this;\n  setAspect: (aspect: number) => this;\n  setNear: (near: number) => this;\n  setFar: (far: number) => this;\n  /**\n   * Sets an offset in a larger frustum, used in PixelPicking\n   */\n  setViewOffset: (\n    fullWidth: number,\n    fullHeight: number,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n  ) => this;\n  clearViewOffset: () => this;\n  setZoom: (zoom: number) => this;\n  setZoomByViewportPoint: (zoom: number, viewportPoint: vec2) => this;\n  setPerspective: (\n    near: number,\n    far: number,\n    fov: number,\n    aspect: number,\n  ) => this;\n  setOrthographic: (\n    l: number,\n    r: number,\n    t: number,\n    b: number,\n    near: number,\n    far: number,\n  ) => this;\n  /**\n   * Move the camera in world coordinates.\n   * It will keep looking at the current focal point.\n   *\n   * support scalars or vectors.\n   * @example\n   * setPosition(1, 2, 3);\n   * setPosition([1, 2, 3]);\n   */\n  setPosition: (x: number | vec2 | vec3, y?: number, z?: number) => this;\n  /**\n   * Sets the focal point of this camera in world coordinates.\n   *\n   * support scalars or vectors.\n   * @example\n   * setFocalPoint(1, 2, 3);\n   * setFocalPoint([1, 2, 3]);\n   */\n  setFocalPoint: (x: number | vec2 | vec3, y?: number, z?: number) => this;\n  getDistance: () => number;\n  getDistanceVector: () => vec3;\n  /**\n   * Moves the camera towards/from the focal point.\n   */\n  setDistance: (d: number) => this;\n  setMaxDistance: (d: number) => this;\n  setMinDistance: (d: number) => this;\n  /**\n   * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n   * the azimuth in degrees\n   */\n  setAzimuth: (az: number) => this;\n  getAzimuth: () => number;\n  /**\n   * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n   */\n  setElevation: (el: number) => this;\n  getElevation: () => number;\n  /**\n   * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n   */\n  setRoll: (angle: number) => this;\n  getRoll: () => number;\n  /**\n   * Changes the azimuth and elevation with respect to the current camera axes\n   * @param {Number} azimuth the relative azimuth\n   * @param {Number} elevation the relative elevation\n   * @param {Number} roll the relative roll\n   */\n  rotate: (azimuth: number, elevation: number, roll: number) => this;\n  /**\n   * 沿水平(right) & 垂直(up)平移相机\n   */\n  pan: (tx: number, ty: number) => this;\n  /**\n   * 沿 n 轴移动，当距离视点远时移动速度较快，离视点越近速度越慢\n   */\n  dolly: (value: number) => this;\n  createLandmark: (\n    name: string,\n    params?: Partial<{\n      position: vec3 | vec2;\n      focalPoint: vec3 | vec2;\n      zoom: number;\n      roll: number;\n    }>,\n  ) => Landmark;\n  gotoLandmark: (\n    name: string | Landmark,\n    options?:\n      | number\n      | Partial<{\n          easing: string;\n          easingFunction: TypeEasingFunction;\n          duration: number;\n          onfinish: () => void;\n        }>,\n  ) => void;\n  /**\n   * Stop camera animation immediately.\n   */\n  cancelLandmarkAnimation: () => void;\n}\n","import EventEmitter from 'eventemitter3';\nimport type { vec2 } from 'gl-matrix';\nimport { mat3, mat4, quat, vec3, vec4 } from 'gl-matrix';\nimport type { Canvas } from '../Canvas';\nimport { Frustum } from '../shapes';\nimport { ClipSpaceNearZ, TypeEasingFunction } from '../types';\nimport { ERROR_MSG_METHOD_NOT_IMPLEMENTED } from '../utils/error';\nimport {\n  createVec3,\n  deg2rad,\n  getAngle,\n  makePerspective,\n  rad2deg,\n} from '../utils/math';\nimport type { Landmark } from './Landmark';\nimport type { ICamera } from './interfaces';\nimport {\n  CameraEvent,\n  CameraProjectionMode,\n  CameraTrackingMode,\n  CameraType,\n} from './interfaces';\n\nconst MIN_DISTANCE = 0.0002;\n\n/**\n * 参考「WebGL Insights - 23.Designing Cameras for WebGL Applications」，基于 Responsible Camera 思路设计\n * @see https://github.com/d13g0/nucleo.js/blob/master/source/camera/Camera.js\n *\n * 保存相机参数，定义相机动作：\n * 1. dolly 沿 n 轴移动\n * 2. pan 沿 u v 轴移动\n * 3. rotate 以方位角旋转\n * 4. 移动到 Landmark，具有平滑的动画效果，其间禁止其他用户交互\n */\n\nexport class Camera implements ICamera {\n  canvas: Canvas;\n\n  /**\n   * Clip space near Z, default to range `[-1, 1]`\n   */\n  clipSpaceNearZ = ClipSpaceNearZ.NEGATIVE_ONE;\n\n  eventEmitter = new EventEmitter();\n\n  /**\n   * Matrix of camera\n   */\n  protected matrix = mat4.create();\n\n  /**\n   * u axis +X is right\n   * @see http://learnwebgl.brown37.net/07_cameras/camera_introduction.html#a-camera-definition\n   */\n  protected right = vec3.fromValues(1, 0, 0);\n\n  /**\n   * v axis +Y is up\n   */\n  protected up = vec3.fromValues(0, 1, 0);\n\n  /**\n   * n axis +Z is inside\n   */\n  protected forward = vec3.fromValues(0, 0, 1);\n\n  /**\n   * Position of camera.\n   */\n  protected position = vec3.fromValues(0, 0, 1);\n\n  /**\n   * Position of focal point.\n   */\n  protected focalPoint = vec3.fromValues(0, 0, 0);\n\n  /**\n   * vector from focalPoint to position\n   */\n  protected distanceVector = vec3.fromValues(0, 0, -1);\n\n  /**\n   * length(focalPoint - position)\n   */\n  protected distance = 1;\n\n  /**\n   * @see https://en.wikipedia.org/wiki/Azimuth\n   */\n  protected azimuth = 0;\n  protected elevation = 0;\n  protected roll = 0;\n  protected relAzimuth = 0;\n  protected relElevation = 0;\n  protected relRoll = 0;\n\n  /**\n   * 沿 n 轴移动时，保证移动速度从快到慢\n   */\n  protected dollyingStep = 0;\n  protected maxDistance = Infinity;\n  protected minDistance = -Infinity;\n\n  /**\n   * zoom factor of the camera, default is 1\n   * eg. https://threejs.org/docs/#api/en/cameras/OrthographicCamera.zoom\n   */\n  protected zoom = 1;\n\n  /**\n   * invert the horizontal coordinate system HCS\n   */\n  protected rotateWorld = false;\n\n  /**\n   * 投影矩阵参数\n   */\n\n  /**\n   * field of view [0-360]\n   * @see http://en.wikipedia.org/wiki/Angle_of_view\n   */\n  protected fov = 30;\n  protected near = 0.1;\n  protected far = 1000;\n  protected aspect = 1;\n  protected left: number;\n  protected rright: number;\n  protected top: number;\n  protected bottom: number;\n  protected projectionMatrix = mat4.create();\n  protected projectionMatrixInverse = mat4.create();\n  protected jitteredProjectionMatrix: mat4 | undefined = undefined;\n\n  protected view:\n    | {\n        enabled: boolean;\n        fullWidth: number;\n        fullHeight: number;\n        offsetX: number;\n        offsetY: number;\n        width: number;\n        height: number;\n      }\n    | undefined;\n  protected enableUpdate = true;\n\n  // protected following = undefined;\n\n  protected type = CameraType.EXPLORING;\n  protected trackingMode = CameraTrackingMode.DEFAULT;\n  protected projectionMode = CameraProjectionMode.PERSPECTIVE;\n\n  /**\n   * for culling use\n   */\n  protected frustum: Frustum = new Frustum();\n\n  /**\n   * ortho matrix for Canvas2D & SVG\n   */\n  protected orthoMatrix: mat4 = mat4.create();\n\n  // constructor(type = CameraType.EXPLORING, trackingMode = CameraTrackingMode.DEFAULT) {\n  //   this.setType(type, trackingMode);\n  // }\n\n  isOrtho() {\n    return this.projectionMode === CameraProjectionMode.ORTHOGRAPHIC;\n  }\n\n  getProjectionMode() {\n    return this.projectionMode;\n  }\n\n  getPerspective() {\n    // account for TAA\n    return this.jitteredProjectionMatrix || this.projectionMatrix;\n  }\n\n  getPerspectiveInverse() {\n    return this.projectionMatrixInverse;\n  }\n\n  getFrustum() {\n    return this.frustum;\n  }\n\n  getPosition() {\n    return this.position;\n  }\n\n  getFocalPoint() {\n    return this.focalPoint;\n  }\n\n  getDollyingStep() {\n    return this.dollyingStep;\n  }\n\n  getNear() {\n    return this.near;\n  }\n\n  getFar() {\n    return this.far;\n  }\n\n  getZoom() {\n    return this.zoom;\n  }\n\n  getOrthoMatrix() {\n    return this.orthoMatrix;\n  }\n\n  getView() {\n    return this.view;\n  }\n\n  setEnableUpdate(enabled: boolean) {\n    this.enableUpdate = enabled;\n  }\n\n  setType(type: CameraType, trackingMode?: CameraTrackingMode) {\n    this.type = type;\n    if (this.type === CameraType.EXPLORING) {\n      this.setWorldRotation(true);\n    } else {\n      this.setWorldRotation(false);\n    }\n    this._getAngles();\n\n    if (this.type === CameraType.TRACKING && trackingMode !== undefined) {\n      this.setTrackingMode(trackingMode);\n    }\n    return this;\n  }\n\n  setProjectionMode(projectionMode: CameraProjectionMode) {\n    this.projectionMode = projectionMode;\n    return this;\n  }\n\n  setTrackingMode(trackingMode: CameraTrackingMode) {\n    if (this.type !== CameraType.TRACKING) {\n      throw new Error(\n        'Impossible to set a tracking mode if the camera is not of tracking type',\n      );\n    }\n    this.trackingMode = trackingMode;\n    return this;\n  }\n\n  /**\n   * If flag is true, it reverses the azimuth and elevation angles.\n   * Subsequent calls to rotate, setAzimuth, setElevation,\n   * changeAzimuth or changeElevation will cause the inverted effect.\n   * setRoll or changeRoll is not affected by this method.\n   *\n   * This inversion is useful when one wants to simulate that the world\n   * is moving, instead of the camera.\n   *\n   * By default the camera angles are not reversed.\n   * @param {Boolean} flag the boolean flag to reverse the angles.\n   */\n  setWorldRotation(flag: boolean) {\n    this.rotateWorld = flag;\n    this._getAngles();\n    return this;\n  }\n\n  /**\n   * 计算 MV 矩阵，为相机矩阵的逆矩阵\n   */\n  getViewTransform(): mat4 {\n    // mat4.scale(this.matrix, this.matrix, vec3.fromValues(1, -1, 1));\n\n    return mat4.invert(mat4.create(), this.matrix);\n  }\n\n  getWorldTransform(): mat4 {\n    return this.matrix;\n  }\n\n  jitterProjectionMatrix(x: number, y: number) {\n    const translation = mat4.fromTranslation(mat4.create(), [x, y, 0]);\n\n    this.jitteredProjectionMatrix = mat4.multiply(\n      mat4.create(),\n      translation,\n      this.projectionMatrix,\n    );\n  }\n\n  clearJitterProjectionMatrix() {\n    this.jitteredProjectionMatrix = undefined;\n  }\n\n  /**\n   * 设置相机矩阵\n   */\n  setMatrix(matrix: mat4) {\n    this.matrix = matrix;\n    this._update();\n    return this;\n  }\n\n  /**\n   * Set projection matrix manually.\n   */\n  setProjectionMatrix(matrix: mat4) {\n    this.projectionMatrix = matrix;\n  }\n\n  setFov(fov: number) {\n    this.setPerspective(this.near, this.far, fov, this.aspect);\n    return this;\n  }\n\n  setAspect(aspect: number) {\n    this.setPerspective(this.near, this.far, this.fov, aspect);\n    return this;\n  }\n\n  setNear(near: number) {\n    if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n      this.setPerspective(near, this.far, this.fov, this.aspect);\n    } else {\n      this.setOrthographic(\n        this.left,\n        this.rright,\n        this.top,\n        this.bottom,\n        near,\n        this.far,\n      );\n    }\n    return this;\n  }\n\n  setFar(far: number) {\n    if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n      this.setPerspective(this.near, far, this.fov, this.aspect);\n    } else {\n      this.setOrthographic(\n        this.left,\n        this.rright,\n        this.top,\n        this.bottom,\n        this.near,\n        far,\n      );\n    }\n    return this;\n  }\n\n  /**\n   * Sets an offset in a larger frustum, used in PixelPicking\n   */\n  setViewOffset(\n    fullWidth: number,\n    fullHeight: number,\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n  ) {\n    this.aspect = fullWidth / fullHeight;\n    if (this.view === undefined) {\n      this.view = {\n        enabled: true,\n        fullWidth: 1,\n        fullHeight: 1,\n        offsetX: 0,\n        offsetY: 0,\n        width: 1,\n        height: 1,\n      };\n    }\n\n    this.view.enabled = true;\n    this.view.fullWidth = fullWidth;\n    this.view.fullHeight = fullHeight;\n    this.view.offsetX = x;\n    this.view.offsetY = y;\n    this.view.width = width;\n    this.view.height = height;\n\n    if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n      this.setPerspective(this.near, this.far, this.fov, this.aspect);\n    } else {\n      this.setOrthographic(\n        this.left,\n        this.rright,\n        this.top,\n        this.bottom,\n        this.near,\n        this.far,\n      );\n    }\n    return this;\n  }\n\n  clearViewOffset() {\n    if (this.view !== undefined) {\n      this.view.enabled = false;\n    }\n\n    if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n      this.setPerspective(this.near, this.far, this.fov, this.aspect);\n    } else {\n      this.setOrthographic(\n        this.left,\n        this.rright,\n        this.top,\n        this.bottom,\n        this.near,\n        this.far,\n      );\n    }\n    return this;\n  }\n\n  setZoom(zoom: number) {\n    this.zoom = zoom;\n    if (this.projectionMode === CameraProjectionMode.ORTHOGRAPHIC) {\n      this.setOrthographic(\n        this.left,\n        this.rright,\n        this.top,\n        this.bottom,\n        this.near,\n        this.far,\n      );\n    } else if (this.projectionMode === CameraProjectionMode.PERSPECTIVE) {\n      this.setPerspective(this.near, this.far, this.fov, this.aspect);\n    }\n    return this;\n  }\n\n  /**\n   * Zoom by specified point in viewport coordinates.\n   */\n  setZoomByViewportPoint(zoom: number, viewportPoint: vec2) {\n    const { x: ox, y: oy } = this.canvas.viewport2Canvas({\n      x: viewportPoint[0],\n      y: viewportPoint[1],\n    });\n\n    const { roll } = this;\n\n    this.rotate(0, 0, -roll);\n    this.setPosition(ox, oy);\n    this.setFocalPoint(ox, oy);\n    this.setZoom(zoom);\n    this.rotate(0, 0, roll);\n\n    const { x: cx, y: cy } = this.canvas.viewport2Canvas({\n      x: viewportPoint[0],\n      y: viewportPoint[1],\n    });\n\n    // project to rotated axis\n    const dvec = vec3.fromValues(cx - ox, cy - oy, 0);\n    const dx = vec3.dot(dvec, this.right) / vec3.length(this.right);\n    const dy = vec3.dot(dvec, this.up) / vec3.length(this.up);\n\n    const [px, py] = this.getPosition();\n    const [fx, fy] = this.getFocalPoint();\n\n    this.setPosition(px - dx, py - dy);\n    this.setFocalPoint(fx - dx, fy - dy);\n\n    return this;\n  }\n\n  setPerspective(near: number, far: number, fov: number, aspect: number) {\n    this.projectionMode = CameraProjectionMode.PERSPECTIVE;\n    this.fov = fov;\n    this.near = near;\n    this.far = far;\n    this.aspect = aspect;\n\n    let top = (this.near * Math.tan(deg2rad(0.5 * this.fov))) / this.zoom;\n    let height = 2 * top;\n    let width = this.aspect * height;\n    let left = -0.5 * width;\n\n    if (this.view?.enabled) {\n      const { fullWidth } = this.view;\n      const { fullHeight } = this.view;\n\n      left += (this.view.offsetX * width) / fullWidth;\n      top -= (this.view.offsetY * height) / fullHeight;\n      width *= this.view.width / fullWidth;\n      height *= this.view.height / fullHeight;\n    }\n\n    makePerspective(\n      this.projectionMatrix,\n      left,\n      left + width,\n      top - height,\n      top,\n      near,\n      this.far,\n      this.clipSpaceNearZ === ClipSpaceNearZ.ZERO,\n    );\n\n    mat4.invert(this.projectionMatrixInverse, this.projectionMatrix);\n\n    this.triggerUpdate();\n    return this;\n  }\n\n  setOrthographic(\n    l: number,\n    r: number,\n    t: number,\n    b: number,\n    near: number,\n    far: number,\n  ) {\n    this.projectionMode = CameraProjectionMode.ORTHOGRAPHIC;\n    this.rright = r;\n    this.left = l;\n    this.top = t;\n    this.bottom = b;\n    this.near = near;\n    this.far = far;\n\n    const dx = (this.rright - this.left) / (2 * this.zoom);\n    const dy = (this.top - this.bottom) / (2 * this.zoom);\n    const cx = (this.rright + this.left) / 2;\n    const cy = (this.top + this.bottom) / 2;\n\n    let left = cx - dx;\n    let right = cx + dx;\n    let top = cy + dy;\n    let bottom = cy - dy;\n\n    if (this.view?.enabled) {\n      const scaleW =\n        (this.rright - this.left) / this.view.fullWidth / this.zoom;\n      const scaleH =\n        (this.top - this.bottom) / this.view.fullHeight / this.zoom;\n\n      left += scaleW * this.view.offsetX;\n      right = left + scaleW * this.view.width;\n      top -= scaleH * this.view.offsetY;\n      bottom = top - scaleH * this.view.height;\n    }\n\n    if (this.clipSpaceNearZ === ClipSpaceNearZ.NEGATIVE_ONE) {\n      // FlipY with switching bottom & top.\n      // @see https://stackoverflow.com/a/4886656\n      mat4.ortho(this.projectionMatrix, left, right, top, bottom, near, far);\n    } else {\n      mat4.orthoZO(this.projectionMatrix, left, right, top, bottom, near, far);\n    }\n\n    mat4.invert(this.projectionMatrixInverse, this.projectionMatrix);\n\n    this._getOrthoMatrix();\n    this.triggerUpdate();\n    return this;\n  }\n\n  /**\n   * Move the camera in world coordinates.\n   * It will keep looking at the current focal point.\n   *\n   * support scalars or vectors.\n   * @example\n   * setPosition(1, 2, 3);\n   * setPosition([1, 2, 3]);\n   */\n  setPosition(\n    x: number | vec2 | vec3,\n    y: number = this.position[1],\n    z: number = this.position[2],\n  ) {\n    const position = createVec3(x, y, z);\n    this._setPosition(position);\n    this.setFocalPoint(this.focalPoint);\n\n    this.triggerUpdate();\n    return this;\n  }\n\n  /**\n   * Sets the focal point of this camera in world coordinates.\n   *\n   * support scalars or vectors.\n   * @example\n   * setFocalPoint(1, 2, 3);\n   * setFocalPoint([1, 2, 3]);\n   */\n  setFocalPoint(\n    x: number | vec2 | vec3,\n    y: number = this.focalPoint[1],\n    z: number = this.focalPoint[2],\n  ) {\n    let up = vec3.fromValues(0, 1, 0);\n    this.focalPoint = createVec3(x, y, z);\n\n    if (this.trackingMode === CameraTrackingMode.CINEMATIC) {\n      const d = vec3.subtract(vec3.create(), this.focalPoint, this.position);\n      x = d[0];\n      y = d[1];\n      z = d[2];\n      const r = vec3.length(d);\n      const el = rad2deg(Math.asin(y / r));\n      const az = 90 + rad2deg(Math.atan2(z, x));\n      const m = mat4.create();\n      mat4.rotateY(m, m, deg2rad(az));\n      mat4.rotateX(m, m, deg2rad(el));\n      up = vec3.transformMat4(vec3.create(), [0, 1, 0], m);\n    }\n\n    mat4.invert(\n      this.matrix,\n      mat4.lookAt(mat4.create(), this.position, this.focalPoint, up),\n    );\n\n    this._getAxes();\n    this._getDistance();\n    this._getAngles();\n    this.triggerUpdate();\n    return this;\n  }\n\n  getDistance() {\n    return this.distance;\n  }\n\n  getDistanceVector() {\n    return this.distanceVector;\n  }\n\n  /**\n   * Moves the camera towards/from the focal point.\n   */\n  setDistance(d: number) {\n    if (this.distance === d || d < 0) {\n      return this;\n    }\n\n    this.distance = d;\n\n    if (this.distance < MIN_DISTANCE) {\n      this.distance = MIN_DISTANCE;\n    }\n    this.dollyingStep = this.distance / 100;\n\n    const pos = vec3.create();\n    d = this.distance;\n    const n = this.forward;\n    const f = this.focalPoint;\n\n    pos[0] = d * n[0] + f[0];\n    pos[1] = d * n[1] + f[1];\n    pos[2] = d * n[2] + f[2];\n\n    this._setPosition(pos);\n    this.triggerUpdate();\n    return this;\n  }\n\n  setMaxDistance(d: number) {\n    this.maxDistance = d;\n    return this;\n  }\n\n  setMinDistance(d: number) {\n    this.minDistance = d;\n    return this;\n  }\n\n  /**\n   * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n   * the azimuth in degrees\n   */\n  setAzimuth(az: number) {\n    this.azimuth = getAngle(az);\n    this.computeMatrix();\n\n    this._getAxes();\n    if (\n      this.type === CameraType.ORBITING ||\n      this.type === CameraType.EXPLORING\n    ) {\n      this._getPosition();\n    } else if (this.type === CameraType.TRACKING) {\n      this._getFocalPoint();\n    }\n\n    this.triggerUpdate();\n    return this;\n  }\n\n  getAzimuth() {\n    return this.azimuth;\n  }\n\n  /**\n   * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n   */\n  setElevation(el: number) {\n    this.elevation = getAngle(el);\n    this.computeMatrix();\n\n    this._getAxes();\n    if (\n      this.type === CameraType.ORBITING ||\n      this.type === CameraType.EXPLORING\n    ) {\n      this._getPosition();\n    } else if (this.type === CameraType.TRACKING) {\n      this._getFocalPoint();\n    }\n\n    this.triggerUpdate();\n    return this;\n  }\n\n  getElevation() {\n    return this.elevation;\n  }\n\n  /**\n   * 设置相机方位角，不同相机模式下需要重新计算相机位置或者是视点位置\n   */\n  setRoll(angle: number) {\n    this.roll = getAngle(angle);\n    this.computeMatrix();\n\n    this._getAxes();\n    if (\n      this.type === CameraType.ORBITING ||\n      this.type === CameraType.EXPLORING\n    ) {\n      this._getPosition();\n    } else if (this.type === CameraType.TRACKING) {\n      this._getFocalPoint();\n    }\n\n    this.triggerUpdate();\n    return this;\n  }\n\n  getRoll() {\n    return this.roll;\n  }\n\n  /**\n   * 根据相机矩阵重新计算各种相机参数\n   */\n  protected _update() {\n    this._getAxes();\n    this._getPosition();\n    this._getDistance();\n    this._getAngles();\n    this._getOrthoMatrix();\n\n    this.triggerUpdate();\n  }\n\n  /**\n   * 计算相机矩阵\n   */\n  protected computeMatrix() {\n    // 使用四元数描述 3D 旋转\n    // @see https://xiaoiver.github.io/coding/2018/12/28/Camera-%E8%AE%BE%E8%AE%A1-%E4%B8%80.html\n    const rotZ = quat.setAxisAngle(\n      quat.create(),\n      [0, 0, 1],\n      deg2rad(this.roll),\n    );\n\n    mat4.identity(this.matrix);\n\n    // only consider HCS for EXPLORING and ORBITING cameras\n    const rotX = quat.setAxisAngle(\n      quat.create(),\n      [1, 0, 0],\n      deg2rad(\n        ((this.rotateWorld && this.type !== CameraType.TRACKING) ||\n        this.type === CameraType.TRACKING\n          ? 1\n          : -1) * this.elevation,\n      ),\n    );\n    const rotY = quat.setAxisAngle(\n      quat.create(),\n      [0, 1, 0],\n      deg2rad(\n        ((this.rotateWorld && this.type !== CameraType.TRACKING) ||\n        this.type === CameraType.TRACKING\n          ? 1\n          : -1) * this.azimuth,\n      ),\n    );\n\n    let rotQ = quat.multiply(quat.create(), rotY, rotX);\n    rotQ = quat.multiply(quat.create(), rotQ, rotZ);\n    const rotMatrix = mat4.fromQuat(mat4.create(), rotQ);\n\n    if (\n      this.type === CameraType.ORBITING ||\n      this.type === CameraType.EXPLORING\n    ) {\n      mat4.translate(this.matrix, this.matrix, this.focalPoint);\n      mat4.multiply(this.matrix, this.matrix, rotMatrix);\n      mat4.translate(this.matrix, this.matrix, [0, 0, this.distance]);\n    } else if (this.type === CameraType.TRACKING) {\n      mat4.translate(this.matrix, this.matrix, this.position);\n      mat4.multiply(this.matrix, this.matrix, rotMatrix);\n    }\n  }\n\n  /**\n   * Sets the camera position in the camera matrix\n   */\n  protected _setPosition(x: number | vec3, y?: number, z?: number) {\n    this.position = createVec3(x, y, z);\n    const m = this.matrix;\n    m[12] = this.position[0];\n    m[13] = this.position[1];\n    m[14] = this.position[2];\n    m[15] = 1;\n\n    this._getOrthoMatrix();\n  }\n\n  /**\n   * Recalculates axes based on the current matrix\n   */\n  protected _getAxes() {\n    vec3.copy(\n      this.right,\n      createVec3(vec4.transformMat4(vec4.create(), [1, 0, 0, 0], this.matrix)),\n    );\n    vec3.copy(\n      this.up,\n      createVec3(vec4.transformMat4(vec4.create(), [0, 1, 0, 0], this.matrix)),\n    );\n    vec3.copy(\n      this.forward,\n      createVec3(vec4.transformMat4(vec4.create(), [0, 0, 1, 0], this.matrix)),\n    );\n    vec3.normalize(this.right, this.right);\n    vec3.normalize(this.up, this.up);\n    vec3.normalize(this.forward, this.forward);\n  }\n\n  /**\n   * Recalculates euler angles based on the current state\n   */\n  protected _getAngles() {\n    // Recalculates angles\n    const x = this.distanceVector[0];\n    const y = this.distanceVector[1];\n    const z = this.distanceVector[2];\n    const r = vec3.length(this.distanceVector);\n\n    // FAST FAIL: If there is no distance we cannot compute angles\n    if (r === 0) {\n      this.elevation = 0;\n      this.azimuth = 0;\n      return;\n    }\n\n    if (this.type === CameraType.TRACKING) {\n      this.elevation = rad2deg(Math.asin(y / r));\n      this.azimuth = rad2deg(Math.atan2(-x, -z));\n    } else if (this.rotateWorld) {\n      this.elevation = rad2deg(Math.asin(y / r));\n      this.azimuth = rad2deg(Math.atan2(-x, -z));\n    } else {\n      this.elevation = -rad2deg(Math.asin(y / r));\n      this.azimuth = -rad2deg(Math.atan2(-x, -z));\n    }\n  }\n\n  /**\n   * 重新计算相机位置，只有 ORBITING 模式相机位置才会发生变化\n   */\n  protected _getPosition() {\n    vec3.copy(\n      this.position,\n      createVec3(vec4.transformMat4(vec4.create(), [0, 0, 0, 1], this.matrix)),\n    );\n\n    // 相机位置变化，需要重新计算视距\n    this._getDistance();\n  }\n\n  /**\n   * 重新计算视点，只有 TRACKING 模式视点才会发生变化\n   */\n  protected _getFocalPoint() {\n    vec3.transformMat3(\n      this.distanceVector,\n      [0, 0, -this.distance],\n      mat3.fromMat4(mat3.create(), this.matrix),\n    );\n    vec3.add(this.focalPoint, this.position, this.distanceVector);\n\n    // 视点变化，需要重新计算视距\n    this._getDistance();\n  }\n\n  /**\n   * 重新计算视距\n   */\n  protected _getDistance() {\n    this.distanceVector = vec3.subtract(\n      vec3.create(),\n      this.focalPoint,\n      this.position,\n    );\n    this.distance = vec3.length(this.distanceVector);\n    this.dollyingStep = this.distance / 100;\n  }\n\n  protected _getOrthoMatrix() {\n    if (this.projectionMode !== CameraProjectionMode.ORTHOGRAPHIC) {\n      return;\n    }\n\n    const { position } = this;\n    const rotZ = quat.setAxisAngle(\n      quat.create(),\n      [0, 0, 1],\n      (-this.roll * Math.PI) / 180,\n    );\n    mat4.fromRotationTranslationScaleOrigin(\n      this.orthoMatrix,\n      rotZ,\n      vec3.fromValues(\n        (this.rright - this.left) / 2 - position[0],\n        (this.top - this.bottom) / 2 - position[1],\n        0,\n      ),\n      vec3.fromValues(this.zoom, this.zoom, 1),\n      position,\n    );\n  }\n\n  protected triggerUpdate() {\n    if (this.enableUpdate) {\n      // update frustum\n      const viewMatrix = this.getViewTransform();\n      const vpMatrix = mat4.multiply(\n        mat4.create(),\n        this.getPerspective(),\n        viewMatrix,\n      );\n      this.getFrustum().extractFromVPMatrix(vpMatrix);\n\n      this.eventEmitter.emit(CameraEvent.UPDATED);\n    }\n  }\n\n  rotate(azimuth: number, elevation: number, roll: number): this {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  pan(tx: number, ty: number): this {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  dolly(value: number): this {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  createLandmark(\n    name: string,\n    params?: Partial<{\n      position: [number, number, number] | Float32Array | [number, number];\n      focalPoint: [number, number, number] | Float32Array | [number, number];\n      zoom: number;\n      roll: number;\n    }>,\n  ): Landmark {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  gotoLandmark(\n    name: string | Landmark,\n    options?:\n      | number\n      | Partial<{\n          easing: string;\n          easingFunction: TypeEasingFunction;\n          duration: number;\n          onfinish: () => void;\n        }>,\n  ): void {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  cancelLandmarkAnimation(): void {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n}\n","/**\n * @see https://doc.babylonjs.com/how_to/optimizing_your_scene#changing-mesh-culling-strategy\n */\nexport enum Strategy {\n  Standard,\n}\n\nexport interface Cullable {\n  strategy: Strategy;\n\n  visibilityPlaneMask: number;\n\n  visible: boolean;\n\n  enable: boolean;\n}\n","import type { INode } from '../dom/interfaces';\n\nexport enum SortReason {\n  ADDED,\n  REMOVED,\n  Z_INDEX_CHANGED,\n}\n\nexport interface Sortable {\n  /**\n   * need to re-sort\n   */\n  dirty: boolean;\n\n  /**\n   * sorted child entities\n   */\n  sorted: INode[];\n\n  /**\n   * render order in whole scenegraph\n   */\n  renderOrder: number;\n\n  /**\n   * dirty children\n   */\n  dirtyChildren: INode[];\n\n  dirtyReason: SortReason;\n}\n","import { AbsoluteArray } from '@antv/util';\nimport { Rectangle } from '../shapes';\n\nexport const EMPTY_PARSED_PATH = {\n  absolutePath: [] as unknown as AbsoluteArray,\n  hasArc: false,\n  segments: [],\n  polygons: [],\n  polylines: [],\n  curve: null,\n  totalLength: 0,\n  rect: new Rectangle(0, 0, 0, 0),\n};\n","import type { BaseStyleProps } from '..';\nimport type { DisplayObject } from '../display-objects';\nimport type { CSSProperty } from './CSSProperty';\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type\n */\nexport enum PropertySyntax {\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#coordinate\n   */\n  COORDINATE = '<coordinate>',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#color\n   */\n  COLOR = '<color>',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#paint\n   */\n  PAINT = '<paint>',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#number\n   */\n  NUMBER = '<number>',\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/angle\n   */\n  ANGLE = '<angle>',\n  /**\n   * <number> with range 0..1\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#opacity_value\n   */\n  OPACITY_VALUE = '<opacity-value>',\n  /**\n   * <number> with range 0..Infinity\n   */\n  SHADOW_BLUR = '<shadow-blur>',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#length\n   */\n  LENGTH = '<length>',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#percentage\n   */\n  PERCENTAGE = '<percentage>',\n  LENGTH_PERCENTAGE = '<length> | <percentage>',\n\n  LENGTH_PERCENTAGE_12 = '[<length> | <percentage>]{1,2}',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/margin#formal_syntax\n   */\n  LENGTH_PERCENTAGE_14 = '[<length> | <percentage>]{1,4}',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Content_type#list-of-ts\n   */\n  LIST_OF_POINTS = '<list-of-points>',\n  PATH = '<path>',\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/filter#formal_syntax\n   */\n  FILTER = '<filter>',\n  Z_INDEX = '<z-index>',\n  OFFSET_DISTANCE = '<offset-distance>',\n  DEFINED_PATH = '<defined-path>',\n  MARKER = '<marker>',\n  TRANSFORM = '<transform>',\n  TRANSFORM_ORIGIN = '<transform-origin>',\n  TEXT = '<text>',\n  TEXT_TRANSFORM = '<text-transform>',\n}\n\nexport interface PropertyMetadata {\n  n: string;\n\n  /**\n   * The interpolable flag indicates whether a property can be animated smoothly.\n   * Default to `false`.\n   */\n  int?: boolean;\n\n  /**\n   * The property will inherit by default if no value is specified.\n   * Default to `false`.\n   */\n  inh?: boolean;\n\n  /**\n   * This property affects only one field on ComputedStyle, and can be set\n   * directly during inheritance instead of forcing a recalc.\n   */\n  ind?: boolean;\n\n  /**\n   * This specifies the default value for this field.\n   * - for keyword fields, this is the initial keyword\n   * - for other fields, this is a string containg the C++ expression that is used to initialise the field.\n   */\n  d?: string | ((nodeName: string) => string);\n\n  /**\n   * The resolved value used for getComputedStyle() depends on layout for this\n   * property, which means we may need to update layout to return the correct\n   * value from getComputedStyle().\n   */\n  l?: boolean;\n\n  /**\n   * This specifies all valid keyword values for the property.\n   */\n  k?: string[];\n\n  /**\n   * eg. strokeWidth is an alias of lineWidth\n   */\n  a?: string[];\n\n  /**\n   * sort before init attributes according to this priority\n   */\n  p?: number;\n\n  /**\n   * eg. <color> <paint> <number>\n   */\n  syntax?: string;\n}\n\nexport interface PropertyParseOptions {\n  skipUpdateAttribute: boolean;\n  skipParse: boolean;\n  forceUpdateGeometry: boolean;\n  usedAttributes: string[];\n  memoize: boolean;\n}\n\nexport interface StyleValueRegistry {\n  updateSizeAttenuation: (displayObject: DisplayObject, zoom: number) => void;\n  registerMetadata: (metadata: PropertyMetadata) => void;\n  getPropertySyntax: (syntax: string) => CSSProperty<any, any>;\n  processProperties: (\n    object: DisplayObject,\n    attributes: BaseStyleProps,\n    options?: Partial<PropertyParseOptions>,\n  ) => void;\n}\n\nexport interface LayoutRegistry {\n  registerLayout: (name: string, ctor: any) => void;\n  hasLayout: (name: string) => boolean;\n  getLayout: (name: string) => any;\n}\n","export function memoize(func: any, resolver?: (...args: any[]) => any) {\n  if (\n    typeof func !== 'function' ||\n    (resolver != null && typeof resolver !== 'function')\n  ) {\n    throw new TypeError('Expected a function');\n  }\n  const memoized = function (...args) {\n    const key = resolver ? resolver.apply(this, args) : args[0];\n    const { cache } = memoized;\n\n    if (cache.has(key)) {\n      return cache.get(key);\n    }\n    const result = func.apply(this, args);\n    memoized.cache = cache.set(key, result) || cache;\n    return result;\n  };\n  memoized.cache = new (memoize.Cache || Map)();\n  return memoized;\n}\n\nmemoize.Cache = Map;\n","// These units are iterated through, so be careful when adding or changing the\n// order.\nexport enum UnitType {\n  kUnknown,\n  kNumber,\n  kPercentage,\n  // Length units\n  kEms,\n  // kExs,\n  kPixels,\n  // kCentimeters,\n  // kMillimeters,\n  // kInches,\n  // kPoints,\n  // kPicas,\n  // kQuarterMillimeters,\n  // https://drafts.csswg.org/css-values-4/#viewport-relative-lengths\n  //\n  // See also IsViewportPercentageLength.\n  // kViewportWidth,\n  // kViewportHeight,\n  // kViewportInlineSize,\n  // kViewportBlockSize,\n  // kViewportMin,\n  // kViewportMax,\n  // kSmallViewportWidth,\n  // kSmallViewportHeight,\n  // kSmallViewportInlineSize,\n  // kSmallViewportBlockSize,\n  // kSmallViewportMin,\n  // kSmallViewportMax,\n  // kLargeViewportWidth,\n  // kLargeViewportHeight,\n  // kLargeViewportInlineSize,\n  // kLargeViewportBlockSize,\n  // kLargeViewportMin,\n  // kLargeViewportMax,\n  // kDynamicViewportWidth,\n  // kDynamicViewportHeight,\n  // kDynamicViewportInlineSize,\n  // kDynamicViewportBlockSize,\n  // kDynamicViewportMin,\n  // kDynamicViewportMax,\n  // https://drafts.csswg.org/css-contain-3/#container-lengths\n  //\n  // See also IsContainerPercentageLength.\n  // kContainerWidth,\n  // kContainerHeight,\n  // kContainerInlineSize,\n  // kContainerBlockSize,\n  // kContainerMin,\n  // kContainerMax,\n  kRems,\n  // kChs,\n  // kUserUnits, // The SVG term for unitless lengths\n  // Angle units\n  kDegrees,\n  kRadians,\n  kGradians,\n  kTurns,\n  // Time units\n  kMilliseconds,\n  kSeconds,\n  // kHertz,\n  // kKilohertz,\n  // Resolution\n  // kDotsPerPixel,\n  // kDotsPerInch,\n  // kDotsPerCentimeter,\n  // Other units\n  // kFraction,\n  kInteger,\n  // This value is used to handle quirky margins in reflow roots (body, td,\n  // and th) like WinIE. The basic idea is that a stylesheet can use the value\n  // __qem (for quirky em) instead of em. When the quirky value is used, if\n  // you're in quirks mode, the margin will collapse away inside a table cell.\n  // This quirk is specified in the HTML spec but our impl is different.\n  // TODO: Remove this. crbug.com/443952\n  // kQuirkyEms,\n}\n\nexport enum UnitCategory {\n  kUNumber,\n  kUPercent,\n  kULength,\n  kUAngle,\n  kUTime,\n  // kUFrequency,\n  // kUResolution,\n  kUOther,\n}\n\nexport enum Nested {\n  kYes,\n  kNo,\n}\nexport enum ParenLess {\n  kYes,\n  kNo,\n}\n","import { Nested, ParenLess, UnitCategory, UnitType } from './types';\n\n// This file specifies the unit strings used in CSSPrimitiveValues.\nconst data = [\n  {\n    name: 'em',\n    unit_type: UnitType.kEms,\n  },\n  // {\n  //   name: 'ex',\n  //   unit_type: UnitType.kExs,\n  // },\n  {\n    name: 'px',\n    unit_type: UnitType.kPixels,\n  },\n  // {\n  //   name: \"cm\",\n  //   unit_type: UnitType.kCentimeters,\n  // },\n  // {\n  //   name: \"mm\",\n  //   unit_type: UnitType.kMillimeters,\n  // },\n  // {\n  //   name: \"q\",\n  //   unit_type: UnitType.kQuarterMillimeters,\n  // },\n  // {\n  //   name: \"in\",\n  //   unit_type: UnitType.kInches,\n  // },\n  // {\n  //   name: \"pt\",\n  //   unit_type: UnitType.kPoints,\n  // },\n  // {\n  //   name: \"pc\",\n  //   unit_type: UnitType.kPicas,\n  // },\n  {\n    name: 'deg',\n    unit_type: UnitType.kDegrees,\n  },\n  {\n    name: 'rad',\n    unit_type: UnitType.kRadians,\n  },\n  {\n    name: 'grad',\n    unit_type: UnitType.kGradians,\n  },\n  {\n    name: 'ms',\n    unit_type: UnitType.kMilliseconds,\n  },\n  {\n    name: 's',\n    unit_type: UnitType.kSeconds,\n  },\n  // {\n  //   name: \"hz\",\n  //   unit_type: UnitType.kHertz,\n  // },\n  // {\n  //   name: \"khz\",\n  //   unit_type: UnitType.kKilohertz,\n  // },\n  // {\n  //   name: \"dpi\",\n  //   unit_type: \"kDotsPerInch\",\n  // },\n  // {\n  //   name: \"dpcm\",\n  //   unit_type: \"kDotsPerCentimeter\",\n  // },\n  // {\n  //   name: \"dppx\",\n  //   unit_type: \"kDotsPerPixel\",\n  // },\n  // {\n  //   name: \"x\",\n  //   unit_type: \"kDotsPerPixel\",\n  // },\n  // {\n  //   name: \"vw\",\n  //   unit_type: \"kViewportWidth\",\n  // },\n  // {\n  //   name: \"vh\",\n  //   unit_type: \"kViewportHeight\",\n  // },\n  // {\n  //   name: \"vi\",\n  //   unit_type: \"kViewportInlineSize\",\n  // },\n  // {\n  //   name: \"vb\",\n  //   unit_type: \"kViewportBlockSize\",\n  // },\n  // {\n  //   name: \"vmin\",\n  //   unit_type: UnitType.kViewportMin,\n  // },\n  // {\n  //   name: \"vmax\",\n  //   unit_type: UnitType.kViewportMax,\n  // },\n  // {\n  //   name: \"svw\",\n  //   unit_type: \"kSmallViewportWidth\",\n  // },\n  // {\n  //   name: \"svh\",\n  //   unit_type: \"kSmallViewportHeight\",\n  // },\n  // {\n  //   name: \"svi\",\n  //   unit_type: \"kSmallViewportInlineSize\",\n  // },\n  // {\n  //   name: \"svb\",\n  //   unit_type: \"kSmallViewportBlockSize\",\n  // },\n  // {\n  //   name: \"svmin\",\n  //   unit_type: \"kSmallViewportMin\",\n  // },\n  // {\n  //   name: \"svmax\",\n  //   unit_type: \"kSmallViewportMax\",\n  // },\n  // {\n  //   name: \"lvw\",\n  //   unit_type: \"kLargeViewportWidth\",\n  // },\n  // {\n  //   name: \"lvh\",\n  //   unit_type: \"kLargeViewportHeight\",\n  // },\n  // {\n  //   name: \"lvi\",\n  //   unit_type: \"kLargeViewportInlineSize\",\n  // },\n  // {\n  //   name: \"lvb\",\n  //   unit_type: \"kLargeViewportBlockSize\",\n  // },\n  // {\n  //   name: \"lvmin\",\n  //   unit_type: UnitType.kLargeViewportMin,\n  // },\n  // {\n  //   name: \"lvmax\",\n  //   unit_type: UnitType.kLargeViewportMax,\n  // },\n  // {\n  //   name: \"dvw\",\n  //   unit_type: UnitType.kDynamicViewportWidth,\n  // },\n  // {\n  //   name: \"dvh\",\n  //   unit_type: UnitType.kDynamicViewportHeight,\n  // },\n  // {\n  //   name: \"dvi\",\n  //   unit_type: UnitType.kDynamicViewportInlineSize,\n  // },\n  // {\n  //   name: \"dvb\",\n  //   unit_type: UnitType.kDynamicViewportBlockSize,\n  // },\n  // {\n  //   name: \"dvmin\",\n  //   unit_type: UnitType.kDynamicViewportMin,\n  // },\n  // {\n  //   name: \"dvmax\",\n  //   unit_type: UnitType.kDynamicViewportMax,\n  // },\n  // {\n  //   name: \"cqw\",\n  //   unit_type: UnitType.kContainerWidth,\n  // },\n  // {\n  //   name: \"cqh\",\n  //   unit_type: UnitType.kContainerHeight,\n  // },\n  // {\n  //   name: \"cqi\",\n  //   unit_type: UnitType.kContainerInlineSize,\n  // },\n  // {\n  //   name: \"cqb\",\n  //   unit_type: UnitType.kContainerBlockSize,\n  // },\n  // {\n  //   name: \"cqmin\",\n  //   unit_type: UnitType.kContainerMin,\n  // },\n  // {\n  //   name: \"cqmax\",\n  //   unit_type: UnitType.kContainerMax,\n  // },\n  {\n    name: 'rem',\n    unit_type: UnitType.kRems,\n  },\n  // {\n  //   name: 'fr',\n  //   unit_type: UnitType.kFraction,\n  // },\n  {\n    name: 'turn',\n    unit_type: UnitType.kTurns,\n  },\n  // {\n  //   name: 'ch',\n  //   unit_type: UnitType.kChs,\n  // },\n  // {\n  //   name: '__qem',\n  //   unit_type: UnitType.kQuirkyEms,\n  // },\n];\n\nexport enum CSSStyleValueType {\n  kUnknownType,\n  kUnparsedType,\n  kKeywordType,\n  // Start of CSSNumericValue subclasses\n  kUnitType,\n  kSumType,\n  kProductType,\n  kNegateType,\n  kInvertType,\n  kMinType,\n  kMaxType,\n  kClampType,\n  // End of CSSNumericValue subclasses\n  kTransformType,\n  kPositionType,\n  kURLImageType,\n  kColorType,\n  kUnsupportedColorType,\n}\n\n// function parseCSSStyleValue(propertyName: string, value: string): CSSStyleValue[] {\n//   // const propertyId = cssPropertyID(propertyName);\n\n//   // if (propertyId === CSSPropertyID.kInvalid) {\n//   //   return [];\n//   // }\n\n//   // const customPropertyName = propertyId === CSSPropertyID.kVariable ? propertyName : null;\n//   // return fromString(propertyId, customPropertyName, value);\n//   return [];\n// }\n\nconst stringToUnitType = (name: string): UnitType => {\n  return data.find((item) => item.name === name).unit_type;\n};\n\nexport const unitFromName = (name: string) => {\n  if (!name) {\n    return UnitType.kUnknown;\n  }\n  if (name === 'number') {\n    return UnitType.kNumber;\n  }\n  if (name === 'percent' || name === '%') {\n    return UnitType.kPercentage;\n  }\n  return stringToUnitType(name);\n};\n\nexport const unitTypeToUnitCategory = (type: UnitType) => {\n  switch (type) {\n    case UnitType.kNumber:\n    case UnitType.kInteger:\n      return UnitCategory.kUNumber;\n    case UnitType.kPercentage:\n      return UnitCategory.kUPercent;\n    case UnitType.kPixels:\n      // case UnitType.kCentimeters:\n      // case UnitType.kMillimeters:\n      // case UnitType.kQuarterMillimeters:\n      // case UnitType.kInches:\n      // case UnitType.kPoints:\n      // case UnitType.kPicas:\n      // case UnitType.kUserUnits:\n      return UnitCategory.kULength;\n    case UnitType.kMilliseconds:\n    case UnitType.kSeconds:\n      return UnitCategory.kUTime;\n    case UnitType.kDegrees:\n    case UnitType.kRadians:\n    case UnitType.kGradians:\n    case UnitType.kTurns:\n      return UnitCategory.kUAngle;\n    // case UnitType.kHertz:\n    // case UnitType.kKilohertz:\n    //   return UnitCategory.kUFrequency;\n    // case UnitType.kDotsPerPixel:\n    // case UnitType.kDotsPerInch:\n    // case UnitType.kDotsPerCentimeter:\n    //   return UnitCategory.kUResolution;\n    default:\n      return UnitCategory.kUOther;\n  }\n};\n\nexport const canonicalUnitTypeForCategory = (category: UnitCategory) => {\n  // The canonical unit type is chosen according to the way\n  // CSSPropertyParser.ValidUnit() chooses the default unit in each category\n  // (based on unitflags).\n  switch (category) {\n    case UnitCategory.kUNumber:\n      return UnitType.kNumber;\n    case UnitCategory.kULength:\n      return UnitType.kPixels;\n    case UnitCategory.kUPercent:\n      return UnitType.kPercentage;\n    // return UnitType.kUnknown; // Cannot convert between numbers and percent.\n    case UnitCategory.kUTime:\n      return UnitType.kSeconds;\n    case UnitCategory.kUAngle:\n      return UnitType.kDegrees;\n    // case UnitCategory.kUFrequency:\n    //   return UnitType.kHertz;\n    // case UnitCategory.kUResolution:\n    //   return UnitType.kDotsPerPixel;\n    default:\n      return UnitType.kUnknown;\n  }\n};\n\n/**\n * @see https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/css/css_primitive_value.cc#353\n */\nexport const conversionToCanonicalUnitsScaleFactor = (unit_type: UnitType) => {\n  let factor = 1.0;\n  // FIXME: the switch can be replaced by an array of scale factors.\n  switch (unit_type) {\n    // These are \"canonical\" units in their respective categories.\n    case UnitType.kPixels:\n    // case UnitType.kUserUnits:\n    case UnitType.kDegrees:\n    case UnitType.kSeconds:\n      // case UnitType.kHertz:\n      break;\n    case UnitType.kMilliseconds:\n      factor = 0.001;\n      break;\n    // case UnitType.kCentimeters:\n    //   // factor = kCssPixelsPerCentimeter;\n    //   break;\n    // case UnitType.kDotsPerCentimeter:\n    //   // factor = 1 / kCssPixelsPerCentimeter;\n    //   break;\n    // case UnitType.kMillimeters:\n    //   // factor = kCssPixelsPerMillimeter;\n    //   break;\n    // case UnitType.kQuarterMillimeters:\n    //   // factor = kCssPixelsPerQuarterMillimeter;\n    //   break;\n    // case UnitType.kInches:\n    //   // factor = kCssPixelsPerInch;\n    //   break;\n    // case UnitType.kDotsPerInch:\n    //   // factor = 1 / kCssPixelsPerInch;\n    //   break;\n    // case UnitType.kPoints:\n    //   // factor = kCssPixelsPerPoint;\n    //   break;\n    // case UnitType.kPicas:\n    //   // factor = kCssPixelsPerPica;\n    //   break;\n    case UnitType.kRadians:\n      factor = 180 / Math.PI;\n      break;\n    case UnitType.kGradians:\n      factor = 0.9;\n      break;\n    case UnitType.kTurns:\n      factor = 360;\n      break;\n    // case UnitType.kKilohertz:\n    //   factor = 1000;\n    //   break;\n    default:\n      break;\n  }\n  return factor;\n};\n\nexport const unitTypeToString = (type: UnitType) => {\n  switch (type) {\n    case UnitType.kNumber:\n    case UnitType.kInteger:\n      // case UnitType.kUserUnits:\n      return '';\n    case UnitType.kPercentage:\n      return '%';\n    case UnitType.kEms:\n      // case UnitType.kQuirkyEms:\n      return 'em';\n    // case UnitType.kExs:\n    //   return 'ex';\n    case UnitType.kRems:\n      return 'rem';\n    // case UnitType.kChs:\n    //   return 'ch';\n    case UnitType.kPixels:\n      return 'px';\n    // case UnitType.kCentimeters:\n    //   return 'cm';\n    // case UnitType.kDotsPerPixel:\n    //   return 'dppx';\n    // case UnitType.kDotsPerInch:\n    //   return 'dpi';\n    // case UnitType.kDotsPerCentimeter:\n    //   return 'dpcm';\n    // case UnitType.kMillimeters:\n    //   return 'mm';\n    // case UnitType.kQuarterMillimeters:\n    //   return 'q';\n    // case UnitType.kInches:\n    //   return 'in';\n    // case UnitType.kPoints:\n    //   return 'pt';\n    // case UnitType.kPicas:\n    //   return 'pc';\n    case UnitType.kDegrees:\n      return 'deg';\n    case UnitType.kRadians:\n      return 'rad';\n    case UnitType.kGradians:\n      return 'grad';\n    case UnitType.kMilliseconds:\n      return 'ms';\n    case UnitType.kSeconds:\n      return 's';\n    // case UnitType.kHertz:\n    //   return 'hz';\n    // case UnitType.kKilohertz:\n    //   return 'khz';\n    case UnitType.kTurns:\n      return 'turn';\n    // case UnitType.kFraction:\n    //   return 'fr';\n    // case UnitType.kViewportWidth:\n    //   return 'vw';\n    // case UnitType.kViewportHeight:\n    //   return 'vh';\n    // case UnitType.kViewportInlineSize:\n    //   return 'vi';\n    // case UnitType.kViewportBlockSize:\n    //   return 'vb';\n    // case UnitType.kViewportMin:\n    //   return 'vmin';\n    // case UnitType.kViewportMax:\n    //   return 'vmax';\n    // case UnitType.kSmallViewportWidth:\n    //   return 'svw';\n    // case UnitType.kSmallViewportHeight:\n    //   return 'svh';\n    // case UnitType.kSmallViewportInlineSize:\n    //   return 'svi';\n    // case UnitType.kSmallViewportBlockSize:\n    //   return 'svb';\n    // case UnitType.kSmallViewportMin:\n    //   return 'svmin';\n    // case UnitType.kSmallViewportMax:\n    //   return 'svmax';\n    // case UnitType.kLargeViewportWidth:\n    //   return 'lvw';\n    // case UnitType.kLargeViewportHeight:\n    //   return 'lvh';\n    // case UnitType.kLargeViewportInlineSize:\n    //   return 'lvi';\n    // case UnitType.kLargeViewportBlockSize:\n    //   return 'lvb';\n    // case UnitType.kLargeViewportMin:\n    //   return 'lvmin';\n    // case UnitType.kLargeViewportMax:\n    //   return 'lvmax';\n    // case UnitType.kDynamicViewportWidth:\n    //   return 'dvw';\n    // case UnitType.kDynamicViewportHeight:\n    //   return 'dvh';\n    // case UnitType.kDynamicViewportInlineSize:\n    //   return 'dvi';\n    // case UnitType.kDynamicViewportBlockSize:\n    //   return 'dvb';\n    // case UnitType.kDynamicViewportMin:\n    //   return 'dvmin';\n    // case UnitType.kDynamicViewportMax:\n    //   return 'dvmax';\n    // case UnitType.kContainerWidth:\n    //   return 'cqw';\n    // case UnitType.kContainerHeight:\n    //   return 'cqh';\n    // case UnitType.kContainerInlineSize:\n    //   return 'cqi';\n    // case UnitType.kContainerBlockSize:\n    //   return 'cqb';\n    // case UnitType.kContainerMin:\n    //   return 'cqmin';\n    // case UnitType.kContainerMax:\n    //   return 'cqmax';\n    default:\n      break;\n  }\n  return '';\n};\n\n/**\n * CSSStyleValue is the base class for all CSS values accessible from Typed OM.\n * Values that are not yet supported as specific types are also returned as base CSSStyleValues.\n *\n * Spec @see https://drafts.css-houdini.org/css-typed-om/#stylevalue-objects\n * Docs @see https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleValue\n */\nexport abstract class CSSStyleValue {\n  // static parse(propertyName: string, value: string): CSSStyleValue {\n  //   return parseCSSStyleValue(propertyName, value)[0];\n  // }\n\n  // static parseAll(propertyName: string, value: string): CSSStyleValue[] {\n  //   return parseCSSStyleValue(propertyName, value);\n  // }\n\n  static isAngle(unit: UnitType) {\n    return (\n      unit === UnitType.kDegrees ||\n      unit === UnitType.kRadians ||\n      unit === UnitType.kGradians ||\n      unit === UnitType.kTurns\n    );\n  }\n\n  // static isViewportPercentageLength(type: UnitType) {\n  //   return type >= UnitType.kViewportWidth && type <= UnitType.kDynamicViewportMax;\n  // }\n\n  // static isContainerPercentageLength(type: UnitType) {\n  //   return type >= UnitType.kContainerWidth && type <= UnitType.kContainerMax;\n  // }\n\n  static isLength(type: UnitType) {\n    // return (type >= UnitType.kEms && type <= UnitType.kUserUnits) || type == UnitType.kQuirkyEms;\n    return type >= UnitType.kEms && type < UnitType.kDegrees;\n  }\n\n  static isRelativeUnit(type: UnitType) {\n    return (\n      type === UnitType.kPercentage ||\n      type === UnitType.kEms ||\n      // type === UnitType.kExs ||\n      type === UnitType.kRems\n      // type === UnitType.kChs ||\n      // this.isViewportPercentageLength(type) ||\n      // this.isContainerPercentageLength(type)\n    );\n  }\n\n  static isTime(unit: UnitType) {\n    return unit === UnitType.kSeconds || unit === UnitType.kMilliseconds;\n  }\n\n  // static isFrequency(unit: UnitType) {\n  //   return unit == UnitType.kHertz || unit == UnitType.kKilohertz;\n  // }\n\n  // static isResolution(type: UnitType) {\n  //   return type >= UnitType.kDotsPerPixel && type <= UnitType.kDotsPerCentimeter;\n  // }\n\n  // static isFlex(unit: UnitType) {\n  //   return unit === UnitType.kFraction;\n  // }\n\n  protected abstract getType(): CSSStyleValueType;\n\n  abstract buildCSSText(n: Nested, p: ParenLess, result: string): string;\n\n  abstract clone(): CSSStyleValue;\n\n  // protected abstract toCSSValue(): CSSValue;\n\n  toString(): string {\n    return this.buildCSSText(Nested.kNo, ParenLess.kNo, '');\n  }\n\n  isNumericValue() {\n    return (\n      this.getType() >= CSSStyleValueType.kUnitType &&\n      this.getType() <= CSSStyleValueType.kClampType\n    );\n  }\n}\n","import { CSSStyleValue, CSSStyleValueType } from './CSSStyleValue';\nimport { CSSNumberish } from './CSSNumericValue';\n\n/**\n * @see https://drafts.css-houdini.org/css-typed-om-1/#dom-csscolorvalue-colorspace\n */\nexport type ColorSpace = 'rgb' | 'hsl' | 'hwb' | 'lch' | 'lab';\nexport type CSSColorRGBComp = CSSNumberish | 'none';\nexport type CSSColorPercent = CSSNumberish | 'none';\nexport type CSSColorNumber = CSSNumberish | 'none';\nexport type CSSColorAngle = CSSNumberish | 'none';\n\n/**\n * CSSColorValue is the base class used for the various CSS color interfaces.\n *\n * @see https://drafts.css-houdini.org/css-typed-om-1/#colorvalue-objects\n */\nexport abstract class CSSColorValue extends CSSStyleValue {\n  constructor(public colorSpace: ColorSpace) {\n    super();\n  }\n\n  getType() {\n    return CSSStyleValueType.kColorType;\n  }\n\n  /**\n   * @see https://drafts.css-houdini.org/css-typed-om-1/#dom-csscolorvalue-to\n   */\n  to(colorSpace: ColorSpace): CSSColorValue {\n    return this;\n  }\n}\n","import type { CSSKeywordValue } from './CSSKeywordValue';\nimport type { CSSUnitValue } from './CSSNumericValue';\nimport { CSSStyleValue, CSSStyleValueType } from './CSSStyleValue';\nimport type { Nested, ParenLess } from './types';\n\nexport interface LinearColorStop {\n  offset: CSSUnitValue;\n  color: string; // use user-defined value instead of parsed CSSRGB\n}\n\nexport interface LinearGradient {\n  angle: CSSUnitValue;\n  steps: LinearColorStop[];\n}\n\nexport interface RadialGradient {\n  cx: CSSUnitValue;\n  cy: CSSUnitValue;\n  size?: CSSUnitValue | CSSKeywordValue;\n  steps: LinearColorStop[];\n}\n\nexport enum GradientType {\n  Constant,\n  LinearGradient,\n  RadialGradient,\n}\n\nexport class CSSGradientValue extends CSSStyleValue {\n  constructor(\n    public type: GradientType,\n    public value: LinearGradient | RadialGradient,\n  ) {\n    super();\n  }\n\n  clone() {\n    return new CSSGradientValue(this.type, this.value);\n  }\n\n  buildCSSText(n: Nested, p: ParenLess, result: string): string {\n    return result;\n  }\n\n  getType() {\n    return CSSStyleValueType.kColorType;\n  }\n}\n","import { CSSStyleValue, CSSStyleValueType } from './CSSStyleValue';\nimport type { Nested, ParenLess } from './types';\n\n/**\n * CSSKeywordValue represents CSS Values that are specified as keywords\n * eg. 'initial'\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSSKeywordValue\n * @see https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/css/cssom/css_keyword_value.idl\n */\nexport class CSSKeywordValue extends CSSStyleValue {\n  constructor(public value: string) {\n    super();\n  }\n\n  clone() {\n    return new CSSKeywordValue(this.value);\n  }\n\n  getType() {\n    return CSSStyleValueType.kKeywordType;\n  }\n\n  buildCSSText(n: Nested, p: ParenLess, result: string) {\n    return result + this.value;\n  }\n}\n","import {\n  canonicalUnitTypeForCategory,\n  conversionToCanonicalUnitsScaleFactor,\n  CSSStyleValue,\n  CSSStyleValueType,\n  unitFromName,\n  unitTypeToString,\n  unitTypeToUnitCategory,\n} from './CSSStyleValue';\nimport { Nested, ParenLess, UnitType } from './types';\n\nexport type CSSNumberish = number;\n\nconst formatInfinityOrNaN = (number: number, suffix = '') => {\n  let result = '';\n  if (!Number.isFinite(number)) {\n    if (number > 0) result = 'infinity';\n    else result = '-infinity';\n  } else {\n    result = 'NaN';\n  }\n  return (result += suffix);\n};\n\nexport const toCanonicalUnit = (unit: UnitType) => {\n  return canonicalUnitTypeForCategory(unitTypeToUnitCategory(unit));\n};\n\n/**\n * CSSNumericValue is the base class for numeric and length typed CSS Values.\n * @see https://drafts.css-houdini.org/css-typed-om/#numeric-objects\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSSNumericValue\n * @see https://chromium.googlesource.com/chromium/src/+/refs/heads/main/third_party/blink/renderer/core/css/cssom/css_numeric_value.idl\n */\n\n/**\n * Represents numeric values that can be expressed as a single number plus a\n * unit (or a naked number or percentage).\n * @see https://drafts.css-houdini.org/css-typed-om/#cssunitvalue\n */\nexport class CSSUnitValue extends CSSStyleValue {\n  unit: UnitType;\n  value: number;\n\n  constructor(value: number, unitOrName: UnitType | string = UnitType.kNumber) {\n    super();\n\n    let unit: UnitType;\n    if (typeof unitOrName === 'string') {\n      unit = unitFromName(unitOrName);\n    } else {\n      unit = unitOrName;\n    }\n    this.unit = unit;\n    this.value = value;\n  }\n\n  clone() {\n    return new CSSUnitValue(this.value, this.unit);\n  }\n\n  equals(other: CSSUnitValue): boolean {\n    const other_unit_value = other as unknown as CSSUnitValue;\n    return (\n      this.value === other_unit_value.value &&\n      this.unit === other_unit_value.unit\n    );\n  }\n\n  getType() {\n    return CSSStyleValueType.kUnitType;\n  }\n\n  convertTo(target_unit: UnitType): CSSUnitValue {\n    if (this.unit === target_unit) {\n      return new CSSUnitValue(this.value, this.unit);\n    }\n\n    // Instead of defining the scale factors for every unit to every other unit,\n    // we simply convert to the canonical unit and back since we already have\n    // the scale factors for canonical units.\n    const canonical_unit = toCanonicalUnit(this.unit);\n    if (\n      canonical_unit !== toCanonicalUnit(target_unit) ||\n      canonical_unit === UnitType.kUnknown\n    ) {\n      return null;\n    }\n\n    const scale_factor =\n      conversionToCanonicalUnitsScaleFactor(this.unit) /\n      conversionToCanonicalUnitsScaleFactor(target_unit);\n\n    return new CSSUnitValue(this.value * scale_factor, target_unit);\n  }\n\n  buildCSSText(n: Nested, p: ParenLess, result: string) {\n    let text: string;\n    switch (this.unit) {\n      case UnitType.kUnknown:\n        // FIXME\n        break;\n      case UnitType.kInteger:\n        text = Number(this.value).toFixed(0);\n        break;\n      case UnitType.kNumber:\n      case UnitType.kPercentage:\n      case UnitType.kEms:\n      // case UnitType.kQuirkyEms:\n      // case UnitType.kExs:\n      case UnitType.kRems:\n      // case UnitType.kChs:\n      case UnitType.kPixels:\n      // case UnitType.kCentimeters:\n      // case UnitType.kDotsPerPixel:\n      // case UnitType.kDotsPerInch:\n      // case UnitType.kDotsPerCentimeter:\n      // case UnitType.kMillimeters:\n      // case UnitType.kQuarterMillimeters:\n      // case UnitType.kInches:\n      // case UnitType.kPoints:\n      // case UnitType.kPicas:\n      // case UnitType.kUserUnits:\n      case UnitType.kDegrees:\n      case UnitType.kRadians:\n      case UnitType.kGradians:\n      case UnitType.kMilliseconds:\n      case UnitType.kSeconds:\n      // case UnitType.kHertz:\n      // case UnitType.kKilohertz:\n      case UnitType.kTurns: {\n        // case UnitType.kContainerMax: { // case UnitType.kContainerMin: // case UnitType.kContainerBlockSize: // case UnitType.kContainerInlineSize: // case UnitType.kContainerHeight: // case UnitType.kContainerWidth: // case UnitType.kDynamicViewportMax: // case UnitType.kDynamicViewportMin: // case UnitType.kDynamicViewportBlockSize: // case UnitType.kDynamicViewportInlineSize: // case UnitType.kDynamicViewportHeight: // case UnitType.kDynamicViewportWidth: // case UnitType.kLargeViewportMax: // case UnitType.kLargeViewportMin: // case UnitType.kLargeViewportBlockSize: // case UnitType.kLargeViewportInlineSize: // case UnitType.kLargeViewportHeight: // case UnitType.kLargeViewportWidth: // case UnitType.kSmallViewportMax: // case UnitType.kSmallViewportMin: // case UnitType.kSmallViewportBlockSize: // case UnitType.kSmallViewportInlineSize: // case UnitType.kSmallViewportHeight: // case UnitType.kSmallViewportWidth: // case UnitType.kViewportMax: // case UnitType.kViewportMin: // case UnitType.kViewportBlockSize: // case UnitType.kViewportInlineSize: // case UnitType.kViewportHeight: // case UnitType.kViewportWidth: // case UnitType.kFraction:\n        const kMinInteger = -999999;\n        const kMaxInteger = 999999;\n\n        const { value } = this;\n        const unit = unitTypeToString(this.unit);\n        if (value < kMinInteger || value > kMaxInteger) {\n          const unit = unitTypeToString(this.unit);\n          if (!Number.isFinite(value) || Number.isNaN(value)) {\n            text = formatInfinityOrNaN(value, unit);\n          } else {\n            text = value + (unit || '');\n          }\n        } else {\n          text = `${value}${unit}`;\n        }\n      }\n    }\n\n    result += text;\n    return result;\n  }\n}\n\nexport const Opx: CSSUnitValue = new CSSUnitValue(0, 'px');\nexport const Lpx: CSSUnitValue = new CSSUnitValue(1, 'px');\nexport const Odeg: CSSUnitValue = new CSSUnitValue(0, 'deg');\n","import type { CSSColorPercent, CSSColorRGBComp } from './CSSColorValue';\nimport { CSSColorValue } from './CSSColorValue';\nimport type { Nested, ParenLess } from './types';\n\n/**\n * The CSSRGB class represents the CSS rgb()/rgba() functions.\n *\n * @see https://drafts.css-houdini.org/css-typed-om-1/#cssrgb\n */\nexport class CSSRGB extends CSSColorValue {\n  constructor(\n    public r: CSSColorRGBComp,\n    public g: CSSColorRGBComp,\n    public b: CSSColorRGBComp,\n    public alpha: CSSColorPercent = 1,\n    /**\n     * 'transparent' & 'none' has the same rgba data\n     */\n    public isNone = false,\n  ) {\n    super('rgb');\n  }\n\n  clone() {\n    return new CSSRGB(this.r, this.g, this.b, this.alpha);\n  }\n\n  buildCSSText(n: Nested, p: ParenLess, result: string): string {\n    return `${result}rgba(${this.r},${this.g},${this.b},${this.alpha})`;\n  }\n}\n","import { memoize } from '../utils/memoize';\nimport { CSSKeywordValue, CSSRGB, CSSUnitValue, UnitType } from './cssom';\n\n/**\n * CSSKeywordValue\n */\nexport const unsetKeywordValue = new CSSKeywordValue('unset');\nexport const initialKeywordValue = new CSSKeywordValue('initial');\nexport const inheritKeywordValue = new CSSKeywordValue('inherit');\nconst keywordCache: Record<string, CSSKeywordValue> = {\n  '': unsetKeywordValue,\n  unset: unsetKeywordValue,\n  initial: initialKeywordValue,\n  inherit: inheritKeywordValue,\n};\nexport const getOrCreateKeyword = (name: string) => {\n  if (!keywordCache[name]) {\n    keywordCache[name] = new CSSKeywordValue(name);\n  }\n\n  return keywordCache[name];\n};\n\n/**\n * CSSColor\n */\nexport const noneColor = new CSSRGB(0, 0, 0, 0, true);\nexport const transparentColor = new CSSRGB(0, 0, 0, 0);\nexport const getOrCreateRGBA = memoize(\n  (r: number, g: number, b: number, a: number) => {\n    return new CSSRGB(r, g, b, a);\n  },\n  (r: number, g: number, b: number, a: number) => {\n    return `rgba(${r},${g},${b},${a})`;\n  },\n);\n\n// export const getOrCreateUnitValue = memoize(\n//   (value: number, unitOrName: UnitType | string = UnitType.kNumber) => {\n//     return new CSSUnitValue(value, unitOrName);\n//   },\n//   (value: number, unitOrName: UnitType | string = UnitType.kNumber) => {\n//     return `${value}${unitOrName}`;\n//   },\n// );\n\nexport const getOrCreateUnitValue = (\n  value: number,\n  unitOrName: UnitType | string = UnitType.kNumber,\n) => {\n  return new CSSUnitValue(value, unitOrName);\n};\nexport const PECENTAGE_50 = new CSSUnitValue(50, '%');\n","/**\n * borrow from gradient-parser, but we delete some browser compatible prefix such as `-webkit-`\n * @see https://github.com/rafaelcaricio/gradient-parser\n */\n\nimport { distanceSquareRoot } from '@antv/util';\nimport { CSSKeywordValue, CSSUnitValue, UnitType } from '../css/cssom';\nimport { deg2rad } from './math';\n\nexport interface LinearGradientNode {\n  type: 'linear-gradient';\n  orientation?: DirectionalNode | AngularNode | undefined;\n  colorStops: ColorStop[];\n}\n\nexport interface RepeatingLinearGradientNode {\n  type: 'repeating-linear-gradient';\n  orientation?: DirectionalNode | AngularNode | undefined;\n  colorStops: ColorStop[];\n}\n\nexport interface RadialGradientNode {\n  type: 'radial-gradient';\n  orientation?:\n    | (ShapeNode | DefaultRadialNode | ExtentKeywordNode)[]\n    | undefined;\n  colorStops: ColorStop[];\n}\n\nexport interface RepeatingRadialGradientNode {\n  type: 'repeating-radial-gradient';\n  orientation?:\n    | (ShapeNode | DefaultRadialNode | ExtentKeywordNode)[]\n    | undefined;\n  colorStops: ColorStop[];\n}\n\nexport interface DirectionalNode {\n  type: 'directional';\n  value:\n    | 'left'\n    | 'top'\n    | 'bottom'\n    | 'right'\n    | 'left top'\n    | 'top left'\n    | 'left bottom'\n    | 'bottom left'\n    | 'right top'\n    | 'top right'\n    | 'right bottom'\n    | 'bottom right';\n}\n\nexport interface AngularNode {\n  type: 'angular';\n  value: string;\n}\n\nexport interface LiteralNode {\n  type: 'literal';\n  value: string;\n  length?: PxNode | EmNode | PercentNode | undefined;\n}\n\nexport interface HexNode {\n  type: 'hex';\n  value: string;\n  length?: PxNode | EmNode | PercentNode | undefined;\n}\n\nexport interface RgbNode {\n  type: 'rgb';\n  value: [string, string, string];\n  length?: PxNode | EmNode | PercentNode | undefined;\n}\n\nexport interface RgbaNode {\n  type: 'rgba';\n  value: [string, string, string, string?];\n  length?: PxNode | EmNode | PercentNode | undefined;\n}\n\nexport interface ShapeNode {\n  type: 'shape';\n  style?:\n    | ExtentKeywordNode\n    | PxNode\n    | EmNode\n    | PercentNode\n    | PositionKeywordNode\n    | undefined;\n  value: 'ellipse' | 'circle';\n  at?: PositionNode | undefined;\n}\n\nexport interface DefaultRadialNode {\n  type: 'default-radial';\n  at: PositionNode;\n}\n\nexport interface PositionKeywordNode {\n  type: 'position-keyword';\n  value: 'center' | 'left' | 'top' | 'bottom' | 'right';\n}\n\nexport interface PositionNode {\n  type: 'position';\n  value: {\n    x: ExtentKeywordNode | PxNode | EmNode | PercentNode | PositionKeywordNode;\n    y: ExtentKeywordNode | PxNode | EmNode | PercentNode | PositionKeywordNode;\n  };\n}\n\nexport interface ExtentKeywordNode {\n  type: 'extent-keyword';\n  value:\n    | 'closest-side'\n    | 'closest-corner'\n    | 'farthest-side'\n    | 'farthest-corner'\n    | 'contain'\n    | 'cover';\n  at?: PositionNode | undefined;\n}\n\nexport interface PxNode {\n  type: 'px';\n  value: string;\n}\n\nexport interface EmNode {\n  type: 'em';\n  value: string;\n}\n\nexport interface PercentNode {\n  type: '%';\n  value: string;\n}\n\nexport type ColorStop = LiteralNode | HexNode | RgbNode | RgbaNode;\n\nexport type GradientNode =\n  | LinearGradientNode\n  | RepeatingLinearGradientNode\n  | RadialGradientNode\n  | RepeatingRadialGradientNode;\n\nexport function colorStopToString(colorStop: ColorStop) {\n  const { type, value } = colorStop;\n  if (type === 'hex') {\n    return `#${value}`;\n  }\n  if (type === 'literal') {\n    return value;\n  }\n  if (type === 'rgb') {\n    return `rgb(${value.join(',')})`;\n  }\n  return `rgba(${value.join(',')})`;\n}\n\nexport const parseGradient = (function () {\n  const tokens = {\n    linearGradient: /^(linear\\-gradient)/i,\n    repeatingLinearGradient: /^(repeating\\-linear\\-gradient)/i,\n    radialGradient: /^(radial\\-gradient)/i,\n    repeatingRadialGradient: /^(repeating\\-radial\\-gradient)/i,\n    /**\n     * @see https://projects.verou.me/conic-gradient/\n     */\n    conicGradient: /^(conic\\-gradient)/i,\n    sideOrCorner:\n      /^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,\n    extentKeywords:\n      /^(closest\\-side|closest\\-corner|farthest\\-side|farthest\\-corner|contain|cover)/,\n    positionKeywords: /^(left|center|right|top|bottom)/i,\n    pixelValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))px/,\n    percentageValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))\\%/,\n    emValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))em/,\n    angleValue: /^(-?(([0-9]*\\.[0-9]+)|([0-9]+\\.?)))deg/,\n    startCall: /^\\(/,\n    endCall: /^\\)/,\n    comma: /^,/,\n    hexColor: /^\\#([0-9a-fA-F]+)/,\n    literalColor: /^([a-zA-Z]+)/,\n    rgbColor: /^rgb/i,\n    rgbaColor: /^rgba/i,\n    number: /^(([0-9]*\\.[0-9]+)|([0-9]+\\.?))/,\n  };\n\n  let input = '';\n\n  function error(msg: string) {\n    throw new Error(`${input}: ${msg}`);\n  }\n\n  function getAST() {\n    const ast = matchListDefinitions();\n\n    if (input.length > 0) {\n      error('Invalid input not EOF');\n    }\n\n    return ast;\n  }\n\n  function matchListDefinitions() {\n    return matchListing(matchDefinition);\n  }\n\n  function matchDefinition() {\n    return (\n      matchGradient(\n        'linear-gradient',\n        tokens.linearGradient,\n        matchLinearOrientation,\n      ) ||\n      matchGradient(\n        'repeating-linear-gradient',\n        tokens.repeatingLinearGradient,\n        matchLinearOrientation,\n      ) ||\n      matchGradient(\n        'radial-gradient',\n        tokens.radialGradient,\n        matchListRadialOrientations,\n      ) ||\n      matchGradient(\n        'repeating-radial-gradient',\n        tokens.repeatingRadialGradient,\n        matchListRadialOrientations,\n      ) ||\n      matchGradient(\n        'conic-gradient',\n        tokens.conicGradient,\n        matchListRadialOrientations,\n      )\n    );\n  }\n\n  function matchGradient(\n    gradientType: string,\n    pattern: RegExp,\n    orientationMatcher,\n  ) {\n    return matchCall(pattern, function (captures) {\n      const orientation = orientationMatcher();\n      if (orientation) {\n        if (!scan(tokens.comma)) {\n          error('Missing comma before color stops');\n        }\n      }\n\n      return {\n        type: gradientType,\n        orientation,\n        colorStops: matchListing(matchColorStop),\n      };\n    });\n  }\n\n  function matchCall(pattern, callback) {\n    const captures = scan(pattern);\n\n    if (captures) {\n      if (!scan(tokens.startCall)) {\n        error('Missing (');\n      }\n\n      const result = callback(captures);\n\n      if (!scan(tokens.endCall)) {\n        error('Missing )');\n      }\n\n      return result;\n    }\n  }\n\n  function matchLinearOrientation() {\n    return matchSideOrCorner() || matchAngle();\n  }\n\n  function matchSideOrCorner() {\n    return match('directional', tokens.sideOrCorner, 1);\n  }\n\n  function matchAngle() {\n    return match('angular', tokens.angleValue, 1);\n  }\n\n  function matchListRadialOrientations() {\n    let radialOrientations;\n    let radialOrientation = matchRadialOrientation();\n    let lookaheadCache;\n\n    if (radialOrientation) {\n      radialOrientations = [];\n      radialOrientations.push(radialOrientation);\n\n      lookaheadCache = input;\n      if (scan(tokens.comma)) {\n        radialOrientation = matchRadialOrientation();\n        if (radialOrientation) {\n          radialOrientations.push(radialOrientation);\n        } else {\n          input = lookaheadCache;\n        }\n      }\n    }\n\n    return radialOrientations;\n  }\n\n  function matchRadialOrientation() {\n    let radialType = matchCircle() || matchEllipse();\n\n    if (radialType) {\n      // @ts-ignore\n      radialType.at = matchAtPosition();\n    } else {\n      const extent = matchExtentKeyword();\n      if (extent) {\n        radialType = extent;\n        const positionAt = matchAtPosition();\n        if (positionAt) {\n          // @ts-ignore\n          radialType.at = positionAt;\n        }\n      } else {\n        const defaultPosition = matchPositioning();\n        if (defaultPosition) {\n          radialType = {\n            type: 'default-radial',\n            // @ts-ignore\n            at: defaultPosition,\n          };\n        }\n      }\n    }\n\n    return radialType;\n  }\n\n  function matchCircle() {\n    const circle = match('shape', /^(circle)/i, 0);\n\n    if (circle) {\n      // @ts-ignore\n      circle.style = matchLength() || matchExtentKeyword();\n    }\n\n    return circle;\n  }\n\n  function matchEllipse() {\n    const ellipse = match('shape', /^(ellipse)/i, 0);\n\n    if (ellipse) {\n      // @ts-ignore\n      ellipse.style = matchDistance() || matchExtentKeyword();\n    }\n\n    return ellipse;\n  }\n\n  function matchExtentKeyword() {\n    return match('extent-keyword', tokens.extentKeywords, 1);\n  }\n\n  function matchAtPosition() {\n    if (match('position', /^at/, 0)) {\n      const positioning = matchPositioning();\n\n      if (!positioning) {\n        error('Missing positioning value');\n      }\n\n      return positioning;\n    }\n  }\n\n  function matchPositioning() {\n    const location = matchCoordinates();\n\n    if (location.x || location.y) {\n      return {\n        type: 'position',\n        value: location,\n      };\n    }\n  }\n\n  function matchCoordinates() {\n    return {\n      x: matchDistance(),\n      y: matchDistance(),\n    };\n  }\n\n  function matchListing(matcher: () => any) {\n    let captures = matcher();\n    const result = [];\n\n    if (captures) {\n      result.push(captures);\n      while (scan(tokens.comma)) {\n        captures = matcher();\n        if (captures) {\n          result.push(captures);\n        } else {\n          error('One extra comma');\n        }\n      }\n    }\n\n    return result;\n  }\n\n  function matchColorStop() {\n    const color = matchColor();\n\n    if (!color) {\n      error('Expected color definition');\n    }\n\n    color.length = matchDistance();\n    return color;\n  }\n\n  function matchColor() {\n    return (\n      matchHexColor() ||\n      matchRGBAColor() ||\n      matchRGBColor() ||\n      matchLiteralColor()\n    );\n  }\n\n  function matchLiteralColor() {\n    return match('literal', tokens.literalColor, 0);\n  }\n\n  function matchHexColor() {\n    return match('hex', tokens.hexColor, 1);\n  }\n\n  function matchRGBColor() {\n    return matchCall(tokens.rgbColor, function () {\n      return {\n        type: 'rgb',\n        value: matchListing(matchNumber),\n      };\n    });\n  }\n\n  function matchRGBAColor() {\n    return matchCall(tokens.rgbaColor, function () {\n      return {\n        type: 'rgba',\n        value: matchListing(matchNumber),\n      };\n    });\n  }\n\n  function matchNumber() {\n    return scan(tokens.number)[1];\n  }\n\n  function matchDistance() {\n    return (\n      match('%', tokens.percentageValue, 1) ||\n      matchPositionKeyword() ||\n      matchLength()\n    );\n  }\n\n  function matchPositionKeyword() {\n    return match('position-keyword', tokens.positionKeywords, 1);\n  }\n\n  function matchLength() {\n    return match('px', tokens.pixelValue, 1) || match('em', tokens.emValue, 1);\n  }\n\n  function match(type: string, pattern, captureIndex: number) {\n    const captures = scan(pattern);\n    if (captures) {\n      return {\n        type,\n        value: captures[captureIndex],\n      };\n    }\n  }\n\n  function scan(regexp) {\n    const blankCaptures = /^[\\n\\r\\t\\s]+/.exec(input);\n    if (blankCaptures) {\n      consume(blankCaptures[0].length);\n    }\n\n    const captures = regexp.exec(input);\n    if (captures) {\n      consume(captures[0].length);\n    }\n\n    return captures;\n  }\n\n  function consume(size: number) {\n    input = input.substring(size);\n  }\n\n  return function (code: string): GradientNode[] {\n    input = code;\n    return getAST();\n  };\n})();\n\nexport function computeLinearGradient(\n  min: [number, number],\n  width: number,\n  height: number,\n  angle: CSSUnitValue,\n) {\n  const rad = deg2rad(angle.value);\n  const rx = 0;\n  const ry = 0;\n  const rcx = rx + width / 2;\n  const rcy = ry + height / 2;\n  // get the length of gradient line\n  // @see https://observablehq.com/@danburzo/css-gradient-line\n  const length =\n    Math.abs(width * Math.cos(rad)) + Math.abs(height * Math.sin(rad));\n  const x1 = min[0] + rcx - (Math.cos(rad) * length) / 2;\n  const y1 = min[1] + rcy - (Math.sin(rad) * length) / 2;\n  const x2 = min[0] + rcx + (Math.cos(rad) * length) / 2;\n  const y2 = min[1] + rcy + (Math.sin(rad) * length) / 2;\n\n  return { x1, y1, x2, y2 };\n}\n\nexport function computeRadialGradient(\n  min: [number, number],\n  width: number,\n  height: number,\n  cx: CSSUnitValue,\n  cy: CSSUnitValue,\n  size?: CSSUnitValue | CSSKeywordValue,\n) {\n  // 'px'\n  let x = cx.value;\n  let y = cy.value;\n\n  // TODO: 'em'\n\n  // '%'\n  if (cx.unit === UnitType.kPercentage) {\n    x = (cx.value / 100) * width;\n  }\n  if (cy.unit === UnitType.kPercentage) {\n    y = (cy.value / 100) * height;\n  }\n\n  // default to farthest-side\n  let r = Math.max(\n    distanceSquareRoot([0, 0], [x, y]),\n    distanceSquareRoot([0, height], [x, y]),\n    distanceSquareRoot([width, height], [x, y]),\n    distanceSquareRoot([width, 0], [x, y]),\n  );\n  if (size) {\n    if (size instanceof CSSUnitValue) {\n      r = size.value;\n    } else if (size instanceof CSSKeywordValue) {\n      // @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Images/Using_CSS_gradients#example_closest-side_for_circles\n      if (size.value === 'closest-side') {\n        r = Math.min(x, width - x, y, height - y);\n      } else if (size.value === 'farthest-side') {\n        r = Math.max(x, width - x, y, height - y);\n      } else if (size.value === 'closest-corner') {\n        r = Math.min(\n          distanceSquareRoot([0, 0], [x, y]),\n          distanceSquareRoot([0, height], [x, y]),\n          distanceSquareRoot([width, height], [x, y]),\n          distanceSquareRoot([width, 0], [x, y]),\n        );\n      }\n    }\n  }\n\n  return { x: x + min[0], y: y + min[1], r };\n}\n","import { isNil, isString } from '@antv/util';\nimport type {\n  AngularNode,\n  ColorStop,\n  DirectionalNode,\n  PositionNode,\n} from '../../utils';\nimport {\n  colorStopToString,\n  parseGradient as parse,\n} from '../../utils/gradient';\nimport { memoize } from '../../utils/memoize';\nimport { getOrCreateKeyword, getOrCreateUnitValue } from '../CSSStyleValuePool';\nimport type {\n  CSSKeywordValue,\n  CSSUnitValue,\n  LinearColorStop,\n  RadialGradient,\n} from '../cssom';\nimport { CSSGradientValue, GradientType, Odeg } from '../cssom';\nimport type { Pattern } from './color';\n\nconst regexLG = /^l\\s*\\(\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nconst regexRG = /^r\\s*\\(\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*,\\s*([\\d.]+)\\s*\\)\\s*(.*)/i;\nconst regexPR = /^p\\s*\\(\\s*([axyn])\\s*\\)\\s*(.*)/i;\nconst regexColorStop = /[\\d.]+:(#[^\\s]+|[^\\)]+\\))/gi;\n\nfunction spaceColorStops(colorStops: ColorStop[]) {\n  const { length } = colorStops;\n  colorStops[length - 1].length = colorStops[length - 1].length ?? {\n    type: '%',\n    value: '100',\n  };\n  if (length > 1) {\n    colorStops[0].length = colorStops[0].length ?? {\n      type: '%',\n      value: '0',\n    };\n  }\n\n  let previousIndex = 0;\n  let previousOffset = Number(colorStops[0].length.value);\n  for (let i = 1; i < length; i++) {\n    // support '%' & 'px'\n    const offset = colorStops[i].length?.value;\n    if (!isNil(offset) && !isNil(previousOffset)) {\n      for (let j = 1; j < i - previousIndex; j++)\n        colorStops[previousIndex + j].length = {\n          type: '%',\n          value: `${\n            previousOffset +\n            ((Number(offset) - previousOffset) * j) / (i - previousIndex)\n          }`,\n        };\n      previousIndex = i;\n      previousOffset = Number(offset);\n    }\n  }\n}\n\n// The position of the gradient line's starting point.\n// different from CSS side(to top) @see https://developer.mozilla.org/en-US/docs/Web/CSS/gradient/linear-gradient#values\nconst SideOrCornerToDegMap: Record<DirectionalNode['value'], number> = {\n  left: 270 - 90,\n  top: 0 - 90,\n  bottom: 180 - 90,\n  right: 90 - 90,\n  'left top': 315 - 90,\n  'top left': 315 - 90,\n  'left bottom': 225 - 90,\n  'bottom left': 225 - 90,\n  'right top': 45 - 90,\n  'top right': 45 - 90,\n  'right bottom': 135 - 90,\n  'bottom right': 135 - 90,\n};\n\nconst angleToDeg: (orientation: DirectionalNode | AngularNode) => CSSUnitValue =\n  memoize((orientation: DirectionalNode | AngularNode) => {\n    let angle: number;\n    if (orientation.type === 'angular') {\n      angle = Number(orientation.value);\n    } else {\n      angle = SideOrCornerToDegMap[orientation.value] || 0;\n    }\n    return getOrCreateUnitValue(angle, 'deg');\n  });\n\nconst positonToCSSUnitValue: (position: PositionNode) => {\n  cx: CSSUnitValue;\n  cy: CSSUnitValue;\n} = memoize((position: PositionNode) => {\n  let cx = 50;\n  let cy = 50;\n  let unitX = '%';\n  let unitY = '%';\n  if (position?.type === 'position') {\n    const { x, y } = position.value;\n    if (x?.type === 'position-keyword') {\n      if (x.value === 'left') {\n        cx = 0;\n      } else if (x.value === 'center') {\n        cx = 50;\n      } else if (x.value === 'right') {\n        cx = 100;\n      } else if (x.value === 'top') {\n        cy = 0;\n      } else if (x.value === 'bottom') {\n        cy = 100;\n      }\n    }\n\n    if (y?.type === 'position-keyword') {\n      if (y.value === 'left') {\n        cx = 0;\n      } else if (y.value === 'center') {\n        cy = 50;\n      } else if (y.value === 'right') {\n        cx = 100;\n      } else if (y.value === 'top') {\n        cy = 0;\n      } else if (y.value === 'bottom') {\n        cy = 100;\n      }\n    }\n\n    if (x?.type === 'px' || x?.type === '%' || x?.type === 'em') {\n      unitX = x?.type;\n      cx = Number(x.value);\n    }\n    if (y?.type === 'px' || y?.type === '%' || y?.type === 'em') {\n      unitY = y?.type;\n      cy = Number(y.value);\n    }\n  }\n\n  return {\n    cx: getOrCreateUnitValue(cx, unitX),\n    cy: getOrCreateUnitValue(cy, unitY),\n  };\n});\n\nexport const parseGradient = memoize((colorStr: string) => {\n  if (colorStr.indexOf('linear') > -1 || colorStr.indexOf('radial') > -1) {\n    const ast = parse(colorStr);\n    return ast.map(({ type, orientation, colorStops }) => {\n      spaceColorStops(colorStops);\n      const steps = colorStops.map<LinearColorStop>((colorStop) => {\n        // TODO: only support % for now, should calc percentage of axis length when using px/em\n        return {\n          offset: getOrCreateUnitValue(Number(colorStop.length.value), '%'),\n          color: colorStopToString(colorStop),\n        };\n      });\n      if (type === 'linear-gradient') {\n        return new CSSGradientValue(GradientType.LinearGradient, {\n          angle: orientation\n            ? angleToDeg(orientation as DirectionalNode | AngularNode)\n            : Odeg,\n          steps,\n        });\n      }\n      if (type === 'radial-gradient') {\n        if (!orientation) {\n          orientation = [\n            {\n              type: 'shape',\n              value: 'circle',\n            },\n          ];\n        }\n        if (\n          orientation[0].type === 'shape' &&\n          orientation[0].value === 'circle'\n        ) {\n          const { cx, cy } = positonToCSSUnitValue(orientation[0].at);\n          let size: CSSUnitValue | CSSKeywordValue;\n          if (orientation[0].style) {\n            const { type, value } = orientation[0].style;\n\n            if (type === 'extent-keyword') {\n              size = getOrCreateKeyword(value);\n            } else {\n              size = getOrCreateUnitValue(value, type);\n            }\n          }\n          return new CSSGradientValue(GradientType.RadialGradient, {\n            cx,\n            cy,\n            size,\n            steps,\n          });\n        }\n        // TODO: support ellipse shape\n        // TODO: repeating-linear-gradient & repeating-radial-gradient\n        // } else if (type === 'repeating-linear-gradient') {\n        // } else if (type === 'repeating-radial-gradient') {\n      }\n\n      return undefined;\n    });\n  }\n\n  // legacy format, should be deprecated later\n  const type = colorStr[0];\n  if (colorStr[1] === '(' || colorStr[2] === '(') {\n    if (type === 'l') {\n      const arr = regexLG.exec(colorStr);\n      if (arr) {\n        const steps =\n          arr[2].match(regexColorStop)?.map((stop) => stop.split(':')) || [];\n        return [\n          new CSSGradientValue(GradientType.LinearGradient, {\n            angle: getOrCreateUnitValue(parseFloat(arr[1]), 'deg'),\n            steps: steps.map(([offset, color]) => ({\n              offset: getOrCreateUnitValue(Number(offset) * 100, '%'),\n              color,\n            })),\n          }),\n        ];\n      }\n    } else if (type === 'r') {\n      const parsedRadialGradient = parseRadialGradient(colorStr);\n      if (parsedRadialGradient) {\n        if (isString(parsedRadialGradient)) {\n          colorStr = parsedRadialGradient;\n        } else {\n          return [\n            new CSSGradientValue(\n              GradientType.RadialGradient,\n              parsedRadialGradient,\n            ),\n          ];\n        }\n      }\n    } else if (type === 'p') {\n      return parsePattern(colorStr);\n    }\n  }\n});\n\nfunction parseRadialGradient(\n  gradientStr: string,\n): RadialGradient | string | null {\n  const arr = regexRG.exec(gradientStr);\n  if (arr) {\n    const steps =\n      arr[4].match(regexColorStop)?.map((stop) => stop.split(':')) || [];\n    return {\n      cx: getOrCreateUnitValue(50, '%'),\n      cy: getOrCreateUnitValue(50, '%'),\n      steps: steps.map(([offset, color]) => ({\n        offset: getOrCreateUnitValue(Number(offset) * 100, '%'),\n        color,\n      })),\n    };\n  }\n  return null;\n}\n\nfunction parsePattern(patternStr: string): Pattern | null {\n  const arr = regexPR.exec(patternStr);\n  if (arr) {\n    let repetition = arr[1];\n    const src = arr[2];\n    switch (repetition) {\n      case 'a':\n        repetition = 'repeat';\n        break;\n      case 'x':\n        repetition = 'repeat-x';\n        break;\n      case 'y':\n        repetition = 'repeat-y';\n        break;\n      case 'n':\n        repetition = 'no-repeat';\n        break;\n      default:\n        repetition = 'no-repeat';\n    }\n    return {\n      image: src,\n      // @ts-ignore\n      repetition,\n    };\n  }\n  return null;\n}\n","import { clamp, isNil } from '@antv/util';\nimport * as d3 from 'd3-color';\nimport { Rect } from '../..';\nimport { memoize } from '../../utils/memoize';\nimport type { Tuple4Number } from '../../types';\nimport type { CSSGradientValue } from '../cssom';\nimport { CSSRGB } from '../cssom';\nimport {\n  getOrCreateRGBA,\n  noneColor,\n  transparentColor,\n} from '../CSSStyleValuePool';\nimport { parseGradient } from './gradient';\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/createPattern\n */\nexport interface Pattern {\n  image: string | CanvasImageSource | Rect;\n  repetition?: 'repeat' | 'repeat-x' | 'repeat-y' | 'no-repeat';\n  transform?: string;\n}\n\nexport function isCSSGradientValue(object: any): object is CSSGradientValue {\n  return (\n    !!(object as CSSGradientValue).type && !!(object as CSSGradientValue).value\n  );\n}\n\nexport function isPattern(object: any): object is Pattern {\n  return object && !!(object as Pattern).image;\n}\n\nexport function isCSSRGB(object: any): object is CSSRGB {\n  return (\n    object &&\n    !isNil((object as CSSRGB).r) &&\n    !isNil((object as CSSRGB).g) &&\n    !isNil((object as CSSRGB).b)\n  );\n}\n\n/**\n * @see https://github.com/WebKit/WebKit/blob/main/Source/WebCore/css/parser/CSSParser.cpp#L97\n */\nexport const parseColor = memoize(\n  (colorStr: string): CSSRGB | CSSGradientValue[] | Pattern => {\n    if (isPattern(colorStr)) {\n      return {\n        repetition: 'repeat',\n        ...(colorStr as Pattern),\n      };\n    }\n\n    if (isNil(colorStr)) {\n      colorStr = '';\n    }\n\n    if (colorStr === 'transparent') {\n      // transparent black\n      return transparentColor;\n    }\n    if (colorStr === 'currentColor') {\n      // @see https://github.com/adobe-webplatform/Snap.svg/issues/526\n      colorStr = 'black';\n    } else if (colorStr === 'none') {\n      return noneColor;\n    }\n\n    // support CSS gradient syntax\n    const g = parseGradient(colorStr);\n    if (g) {\n      return g;\n    }\n\n    // constants\n    const color = d3.color(colorStr) as d3.RGBColor;\n    const rgba: Tuple4Number = [0, 0, 0, 0];\n    if (color !== null) {\n      rgba[0] = color.r || 0;\n      rgba[1] = color.g || 0;\n      rgba[2] = color.b || 0;\n      rgba[3] = color.opacity;\n    }\n\n    // return new CSSRGB(...rgba);\n    return getOrCreateRGBA(...rgba);\n  },\n);\n\nexport function mergeColors(\n  left: CSSRGB | CSSGradientValue[] | Pattern,\n  right: CSSRGB | CSSGradientValue[] | Pattern,\n): [number[], number[], (color: number[]) => string] | undefined {\n  // only support constant value, exclude gradient & pattern\n  if (!isCSSRGB(left) || !isCSSRGB(right)) {\n    return;\n  }\n\n  return [\n    [Number(left.r), Number(left.g), Number(left.b), Number(left.alpha)],\n    [Number(right.r), Number(right.g), Number(right.b), Number(right.alpha)],\n    (color: number[]) => {\n      const rgba = color.slice();\n      if (rgba[3]) {\n        for (let i = 0; i < 3; i++)\n          rgba[i] = Math.round(clamp(rgba[i], 0, 255));\n      }\n      rgba[3] = clamp(rgba[3], 0, 1);\n      return `rgba(${rgba.join(',')})`;\n    },\n  ];\n}\n","import { isNil, isNumber, isString } from '@antv/util';\nimport type { DisplayObject } from '../../display-objects';\nimport type { IElement } from '../../dom';\nimport { Shape } from '../../types';\nimport { rad2deg, turn2deg } from '../../utils/math';\nimport { memoize } from '../../utils/memoize';\nimport { getOrCreateUnitValue } from '../CSSStyleValuePool';\nimport type { CSSStyleValue } from '../cssom';\nimport {\n  CSSUnitValue,\n  UnitType,\n  toCanonicalUnit,\n  unitTypeToString,\n} from '../cssom';\n\ntype LengthUnit = 'px' | '%' | 'em' | 'rem';\ntype AngleUnit = 'deg' | 'rad' | 'turn';\ntype Unit = LengthUnit | AngleUnit | '';\n\nexport function parseDimension(\n  unitRegExp: RegExp,\n  string: string,\n): CSSStyleValue | undefined {\n  if (isNil(string)) {\n    return getOrCreateUnitValue(0, 'px');\n  }\n\n  string = `${string}`.trim().toLowerCase();\n\n  if (isFinite(Number(string))) {\n    if ('px'.search(unitRegExp) >= 0) {\n      return getOrCreateUnitValue(Number(string), 'px');\n    }\n    if ('deg'.search(unitRegExp) >= 0) {\n      return getOrCreateUnitValue(Number(string), 'deg');\n    }\n  }\n\n  const matchedUnits: Unit[] = [];\n  string = string.replace(unitRegExp, (match: string) => {\n    matchedUnits.push(match as Unit);\n    return `U${match}`;\n  });\n  const taggedUnitRegExp = `U(${unitRegExp.source})`;\n\n  return matchedUnits.map((unit) =>\n    getOrCreateUnitValue(\n      Number(\n        string\n          .replace(new RegExp(`U${unit}`, 'g'), '')\n          .replace(new RegExp(taggedUnitRegExp, 'g'), '*0'),\n      ),\n      unit,\n    ),\n  )[0];\n}\n\n/**\n * <length>\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/length\n * length with only absolute unit, eg. 1px\n */\nexport const parseLengthUnmemoize = (css: string) => {\n  return parseDimension(new RegExp('px', 'g'), css);\n};\nexport const parseLength = memoize(parseLengthUnmemoize);\n\n/**\n * <percentage>\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/percentage\n */\nexport const parserPercentageUnmemoize = (css: string) => {\n  return parseDimension(new RegExp('%', 'g'), css);\n};\nexport const parserPercentage = memoize(parserPercentageUnmemoize);\n\n/**\n * length with absolute or relative unit,\n * eg. 1px, 0.7em, 50%, calc(100% - 200px);\n *\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/length-percentage\n */\nexport const parseLengthOrPercentageUnmemoize = (css: string): CSSUnitValue => {\n  if (isNumber(css) || isFinite(Number(css))) {\n    // Number(css) is NaN\n    return getOrCreateUnitValue(Number(css) || 0, 'px');\n    // return Number(css);\n  }\n  return parseDimension(new RegExp('px|%|em|rem', 'g'), css) as CSSUnitValue;\n};\nexport const parseLengthOrPercentage = memoize(\n  parseLengthOrPercentageUnmemoize,\n);\n\nexport const parseAngleUnmemoize = (css: string): CSSUnitValue => {\n  return parseDimension(\n    new RegExp('deg|rad|grad|turn', 'g'),\n    css,\n  ) as CSSUnitValue;\n};\nexport const parseAngle = memoize(parseAngleUnmemoize);\n\n/**\n * merge CSSUnitValue\n *\n * @example\n * 10px + 20px = 30px\n * 10deg + 10rad\n * 10% + 20% = 30%\n */\nexport function mergeDimensions(\n  left: CSSUnitValue,\n  right: CSSUnitValue,\n  target: IElement,\n  nonNegative?: boolean,\n  index = 0,\n): [number, number, (value: number) => string] {\n  let unit = '';\n  let leftValue = left.value || 0;\n  let rightValue = right.value || 0;\n\n  const canonicalUnit = toCanonicalUnit(left.unit);\n  const leftCanonicalUnitValue = left.convertTo(canonicalUnit);\n  const rightCanonicalUnitValue = right.convertTo(canonicalUnit);\n\n  if (leftCanonicalUnitValue && rightCanonicalUnitValue) {\n    leftValue = leftCanonicalUnitValue.value;\n    rightValue = rightCanonicalUnitValue.value;\n    unit = unitTypeToString(left.unit);\n  }\n  // format '%' to 'px'\n  else if (\n    CSSUnitValue.isLength(left.unit) ||\n    CSSUnitValue.isLength(right.unit)\n  ) {\n    leftValue = convertPercentUnit(left, index, target as DisplayObject);\n    rightValue = convertPercentUnit(right, index, target as DisplayObject);\n    unit = 'px';\n  }\n\n  return [\n    leftValue,\n    rightValue,\n    (value: number) => {\n      if (nonNegative) {\n        value = Math.max(value, 0);\n      }\n      return value + unit;\n    },\n  ];\n}\n\nexport function convertAngleUnit(value: CSSUnitValue) {\n  let deg = 0;\n  if (value.unit === UnitType.kDegrees) {\n    deg = value.value;\n  } else if (value.unit === UnitType.kRadians) {\n    deg = rad2deg(Number(value.value));\n  } else if (value.unit === UnitType.kTurns) {\n    deg = turn2deg(Number(value.value));\n  } else if (value.value) {\n    deg = value.value;\n  }\n  return deg;\n}\n\nexport function parseDimensionArrayFormat(\n  string: string | number | (string | number)[],\n  size: number,\n): number[] {\n  let parsed: number[];\n\n  if (Array.isArray(string)) {\n    // [1, '2px', 3]\n    parsed = string.map((segment) => Number(segment));\n  } else if (isString(string)) {\n    parsed = string.split(' ').map((segment) => Number(segment));\n  } else if (isNumber(string)) {\n    parsed = [string];\n  }\n\n  if (size === 2) {\n    if (parsed.length === 1) {\n      return [parsed[0], parsed[0]];\n    }\n    return [parsed[0], parsed[1]];\n  }\n  if (parsed.length === 1) {\n    return [parsed[0], parsed[0], parsed[0], parsed[0]];\n  }\n  if (parsed.length === 2) {\n    return [parsed[0], parsed[1], parsed[0], parsed[1]];\n  }\n  if (parsed.length === 3) {\n    return [parsed[0], parsed[1], parsed[2], parsed[1]];\n  }\n  return [parsed[0], parsed[1], parsed[2], parsed[3]];\n}\n\nexport function parseDimensionArray(\n  string: string | (string | number)[],\n): CSSUnitValue[] {\n  if (isString(string)) {\n    // \"1px 2px 3px\"\n    return string.split(' ').map((segment) => parseLengthOrPercentage(segment));\n  }\n  // [1, '2px', 3]\n  return string.map((segment) => parseLengthOrPercentage(segment.toString()));\n}\nexport function parseDimensionArrayUnmemoize(\n  string: string | (string | number)[],\n): CSSUnitValue[] {\n  if (isString(string)) {\n    // \"1px 2px 3px\"\n    return string\n      .split(' ')\n      .map((segment) => parseLengthOrPercentageUnmemoize(segment));\n  }\n  // [1, '2px', 3]\n  return string.map((segment) =>\n    parseLengthOrPercentageUnmemoize(segment.toString()),\n  );\n}\n\n// export function mergeDimensionList(\n//   left: CSSUnitValue[],\n//   right: CSSUnitValue[],\n//   target: IElement | null,\n// ): [number[], number[], (list: number[]) => string] | undefined {\n//   if (left.length !== right.length) {\n//     return;\n//   }\n\n//   const unit = left[0].unit;\n\n//   return [\n//     left.map((l) => l.value),\n//     right.map((l) => l.value),\n//     (values: number[]) => {\n//       return values.map((n) => new CSSUnitValue(n, unit)).join(' ');\n//     },\n//   ];\n// }\n\nexport function convertPercentUnit(\n  valueWithUnit: CSSUnitValue,\n  vec3Index: number,\n  target: DisplayObject,\n  useMin = false,\n): number {\n  if (valueWithUnit.unit === UnitType.kPixels) {\n    return Number(valueWithUnit.value);\n  }\n  if (valueWithUnit.unit === UnitType.kPercentage && target) {\n    const bounds =\n      target.nodeName === Shape.GROUP\n        ? target.getLocalBounds()\n        : target.getGeometryBounds();\n    return (\n      (useMin ? bounds.min[vec3Index] : 0) +\n      (valueWithUnit.value / 100) * bounds.halfExtents[vec3Index] * 2\n    );\n  }\n  return 0;\n}\n","import type { CSSUnitValue } from '../cssom';\nimport { parseColor } from './color';\nimport { parseDimension } from './dimension';\n\nexport interface ParsedFilterStyleProperty {\n  name: string;\n  params: CSSUnitValue[];\n}\n\nexport const parseParam = (css: string) =>\n  parseDimension(/deg|rad|grad|turn|px|%/g, css);\n\nconst supportedFilters = [\n  'blur',\n  'brightness',\n  'drop-shadow',\n  'contrast',\n  'grayscale',\n  'sepia',\n  'saturate',\n  'hue-rotate',\n  'invert',\n];\n\nexport function parseFilter(filterStr = ''): ParsedFilterStyleProperty[] {\n  filterStr = filterStr.toLowerCase().trim();\n  if (filterStr === 'none') {\n    return [];\n  }\n  const filterRegExp = /\\s*([\\w-]+)\\(([^)]*)\\)/g;\n  const result: ParsedFilterStyleProperty[] = [];\n  let match;\n  let prevLastIndex = 0;\n  while ((match = filterRegExp.exec(filterStr))) {\n    if (match.index !== prevLastIndex) {\n      return [];\n    }\n    prevLastIndex = match.index + match[0].length;\n\n    if (supportedFilters.indexOf(match[1]) > -1) {\n      result.push({\n        name: match[1],\n        params: match[2].split(' ').map((p) => parseParam(p) || parseColor(p)),\n      });\n    }\n\n    if (filterRegExp.lastIndex === filterStr.length) {\n      return result;\n    }\n  }\n\n  return [];\n}\n","import { clamp, isString } from '@antv/util';\nimport { memoize } from '../../utils/memoize';\nimport type { CSSUnitValue } from '../cssom';\nimport { getOrCreateUnitValue } from '../CSSStyleValuePool';\n\nexport function numberToString(x: number) {\n  // scale(0.00000001) -> scale(0)\n  // return x.toFixed(6).replace(/0+$/, '').replace(/\\.$/, '');\n  return x.toString();\n}\n\n/**\n * parse string or number to CSSUnitValue(numeric)\n *\n * eg.\n * * 0 -> CSSUnitValue(0)\n * * '2' -> CSSUnitValue(2)\n */\nexport const parseNumberUnmemoize = (string: string | number): CSSUnitValue => {\n  if (typeof string === 'number') {\n    return getOrCreateUnitValue(string);\n  }\n  if (/^\\s*[-+]?(\\d*\\.)?\\d+\\s*$/.test(string)) {\n    return getOrCreateUnitValue(Number(string));\n  }\n  return getOrCreateUnitValue(0);\n};\nexport const parseNumber = memoize(parseNumberUnmemoize);\n\n/**\n * separate string to array\n * eg.\n * * [0.5, 0.5] -> [CSSUnitValue, CSSUnitValue]\n */\nexport const parseNumberListUnmemoize = (\n  string: string | number[],\n): CSSUnitValue[] => {\n  if (isString(string)) {\n    return string.split(' ').map(parseNumberUnmemoize);\n  }\n  return string.map(parseNumberUnmemoize);\n};\nexport const parseNumberList = memoize(\n  (string: string | number[]): CSSUnitValue[] => {\n    if (isString(string)) {\n      return string.split(' ').map(parseNumber);\n    }\n    return string.map(parseNumber);\n  },\n);\n\nexport function mergeNumbers(\n  left: number,\n  right: number,\n): [number, number, (n: number) => string] {\n  return [left, right, numberToString];\n}\n\nexport function clampedMergeNumbers(min: number, max: number) {\n  return (\n    left: number,\n    right: number,\n  ): [number, number, (i: number) => string] => [\n    left,\n    right,\n    (x: number) => numberToString(clamp(x, min, max)),\n  ];\n}\n\nexport function mergeNumberLists(\n  left: number[],\n  right: number[],\n): [number[], number[], (numberList: number[]) => number[]] | undefined {\n  if (left.length !== right.length) {\n    return;\n  }\n  return [\n    left,\n    right,\n    (numberList: number[]) => {\n      return numberList;\n    },\n  ];\n}\n","/**\n * implements morph animation with cubic splitting\n * @see http://thednp.github.io/kute.js/svgCubicMorph.html\n */\nimport { arcBox, cubicBox, polylineLength, quadBox } from '@antv/g-math';\nimport type { AbsoluteArray, ASegment } from '@antv/util';\nimport {\n  clamp,\n  getTotalLength,\n  isNumberEqual,\n  max,\n  min,\n  mod,\n} from '@antv/util';\nimport { mat4, vec3 } from 'gl-matrix';\nimport type {\n  Circle,\n  Ellipse,\n  Line,\n  Path,\n  PathArcParams,\n  PathSegment,\n  PathSegmentBBox,\n  Polygon,\n  Polyline,\n  Rect,\n} from '../display-objects';\nimport type { PointLike } from '../shapes';\nimport { Shape } from '../types';\nimport { deg2rad } from './math';\n\nexport function getOrCalculatePathTotalLength(path: Path) {\n  if (path.parsedStyle.d.totalLength === 0) {\n    path.parsedStyle.d.totalLength = getTotalLength(\n      path.parsedStyle.d.absolutePath,\n    );\n  }\n  return path.parsedStyle.d.totalLength;\n}\n\nexport function getOrCalculatePolylineTotalLength(polyline: Polyline) {\n  if (polyline.parsedStyle.points.totalLength === 0) {\n    polyline.parsedStyle.points.totalLength = polylineLength(\n      polyline.parsedStyle.points.points as [number, number][],\n    );\n  }\n  return polyline.parsedStyle.points.totalLength;\n}\n\nexport function removeRedundantMCommand(path: AbsoluteArray) {\n  for (let i = 0; i < path.length; i++) {\n    const prevSegment = path[i - 1];\n    const segment = path[i];\n    const cmd = segment[0];\n    if (cmd === 'M') {\n      if (prevSegment) {\n        const prevCmd = prevSegment[0];\n        const srcPoint = [segment[1], segment[2]];\n        let destPoint: [number, number];\n\n        if (prevCmd === 'L' || prevCmd === 'M') {\n          destPoint = [prevSegment[1], prevSegment[2]];\n        } else if (prevCmd === 'C' || prevCmd === 'A' || prevCmd === 'Q') {\n          destPoint = [\n            prevSegment[prevSegment.length - 2] as number,\n            prevSegment[prevSegment.length - 1] as number,\n          ];\n        }\n\n        if (destPoint && isSamePoint(srcPoint, destPoint)) {\n          path.splice(i, 1);\n          i--;\n        }\n      }\n    }\n  }\n}\n\nexport function hasArcOrBezier(path: AbsoluteArray) {\n  let hasArc = false;\n  const count = path.length;\n  for (let i = 0; i < count; i++) {\n    const params = path[i];\n    const cmd = params[0];\n    if (cmd === 'C' || cmd === 'A' || cmd === 'Q') {\n      hasArc = true;\n      break;\n    }\n  }\n  return hasArc;\n}\n\nexport function extractPolygons(pathArray: AbsoluteArray) {\n  const polygons: [number, number][][] = [];\n  const polylines: [number, number][][] = [];\n  let points: [number, number][] = []; // 防止第一个命令不是 'M'\n  for (let i = 0; i < pathArray.length; i++) {\n    const params = pathArray[i];\n    const cmd = params[0];\n    if (cmd === 'M') {\n      // 遇到 'M' 判定是否是新数组，新数组中没有点\n      if (points.length) {\n        // 如果存在点，则说明没有遇到 'Z'，开始了一个新的多边形\n        polylines.push(points);\n        points = []; // 创建新的点\n      }\n      points.push([params[1], params[2]]);\n    } else if (cmd === 'Z') {\n      if (points.length) {\n        // 存在点\n        polygons.push(points);\n        points = []; // 开始新的点集合\n      }\n      // 如果不存在点，同时 'Z'，则说明是错误，不处理\n    } else {\n      points.push([params[1], params[2]]);\n    }\n  }\n  // 说明 points 未放入 polygons 或者 polyline\n  // 仅当只有一个 M，没有 Z 时会发生这种情况\n  if (points.length > 0) {\n    polylines.push(points);\n  }\n  return {\n    polygons,\n    polylines,\n  };\n}\n\nfunction isSamePoint(point1, point2) {\n  return point1[0] === point2[0] && point1[1] === point2[1];\n}\n\nexport function getPathBBox(segments: any[], lineWidth: number) {\n  let xArr = [];\n  let yArr = [];\n  const segmentsWithAngle = [];\n  for (let i = 0; i < segments.length; i++) {\n    const segment = segments[i];\n    const { currentPoint, params, prePoint } = segment;\n    let box: PathSegmentBBox;\n    switch (segment.command) {\n      case 'Q':\n        box = quadBox(\n          prePoint[0],\n          prePoint[1],\n          params[1],\n          params[2],\n          params[3],\n          params[4],\n        );\n        break;\n      case 'C':\n        box = cubicBox(\n          prePoint[0],\n          prePoint[1],\n          params[1],\n          params[2],\n          params[3],\n          params[4],\n          params[5],\n          params[6],\n        );\n        break;\n      case 'A':\n        const { arcParams } = segment;\n        box = arcBox(\n          arcParams.cx,\n          arcParams.cy,\n          arcParams.rx,\n          arcParams.ry,\n          arcParams.xRotation,\n          arcParams.startAngle,\n          arcParams.endAngle,\n        );\n        break;\n      default:\n        xArr.push(currentPoint[0]);\n        yArr.push(currentPoint[1]);\n        break;\n    }\n    if (box) {\n      segment.box = box;\n      xArr.push(box.x, box.x + box.width);\n      yArr.push(box.y, box.y + box.height);\n    }\n    if (\n      lineWidth &&\n      (segment.command === 'L' || segment.command === 'M') &&\n      segment.prePoint &&\n      segment.nextPoint\n    ) {\n      segmentsWithAngle.push(segment);\n    }\n  }\n  // bbox calculation should ignore NaN for path attribute\n  // ref: https://github.com/antvis/g/issues/210\n  // ref: https://github.com/antvis/G2/issues/3109\n  xArr = xArr.filter(\n    (item) => !Number.isNaN(item) && item !== Infinity && item !== -Infinity,\n  );\n  yArr = yArr.filter(\n    (item) => !Number.isNaN(item) && item !== Infinity && item !== -Infinity,\n  );\n  let minX = min(xArr);\n  let minY = min(yArr);\n  let maxX = max(xArr);\n  let maxY = max(yArr);\n  if (segmentsWithAngle.length === 0) {\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY,\n    };\n  }\n  for (let i = 0; i < segmentsWithAngle.length; i++) {\n    const segment = segmentsWithAngle[i];\n    const { currentPoint } = segment;\n    let extra;\n    if (currentPoint[0] === minX) {\n      extra = getExtraFromSegmentWithAngle(segment, lineWidth);\n      minX -= extra.xExtra;\n    } else if (currentPoint[0] === maxX) {\n      extra = getExtraFromSegmentWithAngle(segment, lineWidth);\n      maxX += extra.xExtra;\n    }\n    if (currentPoint[1] === minY) {\n      extra = getExtraFromSegmentWithAngle(segment, lineWidth);\n      minY -= extra.yExtra;\n    } else if (currentPoint[1] === maxY) {\n      extra = getExtraFromSegmentWithAngle(segment, lineWidth);\n      maxY += extra.yExtra;\n    }\n  }\n  return {\n    x: minX,\n    y: minY,\n    width: maxX - minX,\n    height: maxY - minY,\n  };\n}\n\nfunction getExtraFromSegmentWithAngle(segment, lineWidth: number) {\n  const { prePoint, currentPoint, nextPoint } = segment;\n  const currentAndPre =\n    (currentPoint[0] - prePoint[0]) ** 2 + (currentPoint[1] - prePoint[1]) ** 2;\n  const currentAndNext =\n    (currentPoint[0] - nextPoint[0]) ** 2 +\n    (currentPoint[1] - nextPoint[1]) ** 2;\n  const preAndNext =\n    (prePoint[0] - nextPoint[0]) ** 2 + (prePoint[1] - nextPoint[1]) ** 2;\n  // 以 currentPoint 为顶点的夹角\n  const currentAngle = Math.acos(\n    (currentAndPre + currentAndNext - preAndNext) /\n      (2 * Math.sqrt(currentAndPre) * Math.sqrt(currentAndNext)),\n  );\n  // 夹角为空、 0 或 PI 时，不需要计算夹角处的额外宽度\n  // 注意: 由于计算精度问题，夹角为 0 的情况计算出来的角度可能是一个很小的值，还需要判断其与 0 是否近似相等\n  if (\n    !currentAngle ||\n    Math.sin(currentAngle) === 0 ||\n    isNumberEqual(currentAngle, 0)\n  ) {\n    return {\n      xExtra: 0,\n      yExtra: 0,\n    };\n  }\n  let xAngle = Math.abs(\n    Math.atan2(nextPoint[1] - currentPoint[1], nextPoint[0] - currentPoint[0]),\n  );\n  let yAngle = Math.abs(\n    Math.atan2(nextPoint[0] - currentPoint[0], nextPoint[1] - currentPoint[1]),\n  );\n  // 将夹角转为锐角\n  xAngle = xAngle > Math.PI / 2 ? Math.PI - xAngle : xAngle;\n  yAngle = yAngle > Math.PI / 2 ? Math.PI - yAngle : yAngle;\n  // 这里不考虑在水平和垂直方向的投影，直接使用最大差值\n  // 由于上层统一加减了二分之一线宽，这里需要进行弥补\n  const extra = {\n    // 水平方向投影\n    xExtra:\n      Math.cos(currentAngle / 2 - xAngle) *\n        ((lineWidth / 2) * (1 / Math.sin(currentAngle / 2))) -\n        lineWidth / 2 || 0,\n    // 垂直方向投影\n    yExtra:\n      Math.cos(yAngle - currentAngle / 2) *\n        ((lineWidth / 2) * (1 / Math.sin(currentAngle / 2))) -\n        lineWidth / 2 || 0,\n  };\n  return extra;\n}\n\n// 点对称\nfunction toSymmetry(point: number[], center: number[]) {\n  return [\n    center[0] + (center[0] - point[0]),\n    center[1] + (center[1] - point[1]),\n  ];\n}\n\nconst angleBetween = (v0: PointLike, v1: PointLike) => {\n  const p = v0.x * v1.x + v0.y * v1.y;\n  const n = Math.sqrt((v0.x ** 2 + v0.y ** 2) * (v1.x ** 2 + v1.y ** 2));\n  const sign = v0.x * v1.y - v0.y * v1.x < 0 ? -1 : 1;\n  const angle = sign * Math.acos(p / n);\n\n  return angle;\n};\ninterface PointOnEllipticalArc {\n  x: number;\n  y: number;\n  ellipticalArcAngle: number;\n}\n/**\n * @see https://github.com/rveciana/svg-path-properties/blob/b6bd9a322966f6ef7a311872d80c56e3718de861/src/arc.ts#L121\n */\nconst pointOnEllipticalArc = (\n  p0: PointLike,\n  rx: number,\n  ry: number,\n  xAxisRotation: number,\n  largeArcFlag: boolean,\n  sweepFlag: boolean,\n  p1: PointLike,\n  t: number,\n): PointOnEllipticalArc => {\n  // In accordance to: http://www.w3.org/TR/SVG/implnote.html#ArcOutOfRangeParameters\n  rx = Math.abs(rx);\n  ry = Math.abs(ry);\n  xAxisRotation = mod(xAxisRotation, 360);\n  const xAxisRotationRadians = deg2rad(xAxisRotation);\n  // If the endpoints are identical, then this is equivalent to omitting the elliptical arc segment entirely.\n  if (p0.x === p1.x && p0.y === p1.y) {\n    return { x: p0.x, y: p0.y, ellipticalArcAngle: 0 }; // Check if angle is correct\n  }\n\n  // If rx = 0 or ry = 0 then this arc is treated as a straight line segment joining the endpoints.\n  if (rx === 0 || ry === 0) {\n    // return this.pointOnLine(p0, p1, t);\n    return { x: 0, y: 0, ellipticalArcAngle: 0 }; // Check if angle is correct\n  }\n\n  // Following \"Conversion from endpoint to center parameterization\"\n  // http://www.w3.org/TR/SVG/implnote.html#ArcConversionEndpointToCenter\n\n  // Step #1: Compute transformedPoint\n  const dx = (p0.x - p1.x) / 2;\n  const dy = (p0.y - p1.y) / 2;\n  const transformedPoint = {\n    x:\n      Math.cos(xAxisRotationRadians) * dx + Math.sin(xAxisRotationRadians) * dy,\n    y:\n      -Math.sin(xAxisRotationRadians) * dx +\n      Math.cos(xAxisRotationRadians) * dy,\n  };\n  // Ensure radii are large enough\n  const radiiCheck =\n    transformedPoint.x ** 2 / rx ** 2 + transformedPoint.y ** 2 / ry ** 2;\n  if (radiiCheck > 1) {\n    rx *= Math.sqrt(radiiCheck);\n    ry *= Math.sqrt(radiiCheck);\n  }\n\n  // Step #2: Compute transformedCenter\n  const cSquareNumerator =\n    rx ** 2 * ry ** 2 -\n    rx ** 2 * transformedPoint.y ** 2 -\n    ry ** 2 * transformedPoint.x ** 2;\n  const cSquareRootDenom =\n    rx ** 2 * transformedPoint.y ** 2 + ry ** 2 * transformedPoint.x ** 2;\n  let cRadicand = cSquareNumerator / cSquareRootDenom;\n  // Make sure this never drops below zero because of precision\n  cRadicand = cRadicand < 0 ? 0 : cRadicand;\n  const cCoef = (largeArcFlag !== sweepFlag ? 1 : -1) * Math.sqrt(cRadicand);\n  const transformedCenter = {\n    x: cCoef * ((rx * transformedPoint.y) / ry),\n    y: cCoef * (-(ry * transformedPoint.x) / rx),\n  };\n\n  // Step #3: Compute center\n  const center = {\n    x:\n      Math.cos(xAxisRotationRadians) * transformedCenter.x -\n      Math.sin(xAxisRotationRadians) * transformedCenter.y +\n      (p0.x + p1.x) / 2,\n    y:\n      Math.sin(xAxisRotationRadians) * transformedCenter.x +\n      Math.cos(xAxisRotationRadians) * transformedCenter.y +\n      (p0.y + p1.y) / 2,\n  };\n\n  // Step #4: Compute start/sweep angles\n  // Start angle of the elliptical arc prior to the stretch and rotate operations.\n  // Difference between the start and end angles\n  const startVector = {\n    x: (transformedPoint.x - transformedCenter.x) / rx,\n    y: (transformedPoint.y - transformedCenter.y) / ry,\n  };\n  const startAngle = angleBetween(\n    {\n      x: 1,\n      y: 0,\n    },\n    startVector,\n  );\n\n  const endVector = {\n    x: (-transformedPoint.x - transformedCenter.x) / rx,\n    y: (-transformedPoint.y - transformedCenter.y) / ry,\n  };\n  let sweepAngle = angleBetween(startVector, endVector);\n\n  if (!sweepFlag && sweepAngle > 0) {\n    sweepAngle -= 2 * Math.PI;\n  } else if (sweepFlag && sweepAngle < 0) {\n    sweepAngle += 2 * Math.PI;\n  }\n  // We use % instead of `mod(..)` because we want it to be -360deg to 360deg(but actually in radians)\n  sweepAngle %= 2 * Math.PI;\n\n  // From http://www.w3.org/TR/SVG/implnote.html#ArcParameterizationAlternatives\n  const angle = startAngle + sweepAngle * t;\n  const ellipseComponentX = rx * Math.cos(angle);\n  const ellipseComponentY = ry * Math.sin(angle);\n\n  const point = {\n    x:\n      Math.cos(xAxisRotationRadians) * ellipseComponentX -\n      Math.sin(xAxisRotationRadians) * ellipseComponentY +\n      center.x,\n    y:\n      Math.sin(xAxisRotationRadians) * ellipseComponentX +\n      Math.cos(xAxisRotationRadians) * ellipseComponentY +\n      center.y,\n    ellipticalArcStartAngle: startAngle,\n    ellipticalArcEndAngle: startAngle + sweepAngle,\n    ellipticalArcAngle: angle,\n    ellipticalArcCenter: center,\n    resultantRx: rx,\n    resultantRy: ry,\n  };\n\n  return point;\n};\n\nexport function path2Segments(path: AbsoluteArray): PathSegment[] {\n  const segments = [];\n  let currentPoint = null; // 当前图形\n  let nextParams = null; // 下一节点的 path 参数\n  let startMovePoint = null; // 开始 M 的点，可能会有多个\n  let lastStartMovePointIndex = 0; // 最近一个开始点 M 的索引\n  const count = path.length;\n  for (let i = 0; i < count; i++) {\n    const params = path[i];\n    nextParams = path[i + 1];\n    const command = params[0];\n    // 数学定义上的参数，便于后面的计算\n    const segment: PathSegment = {\n      command,\n      prePoint: currentPoint,\n      params,\n      startTangent: null,\n      endTangent: null,\n      currentPoint: null,\n      nextPoint: null,\n      arcParams: null,\n      box: null,\n      cubicParams: null,\n    };\n    switch (command) {\n      case 'M':\n        startMovePoint = [params[1], params[2]];\n        lastStartMovePointIndex = i;\n        break;\n      case 'A':\n        const arcParams = getArcParams(currentPoint, params);\n        segment.arcParams = arcParams;\n        break;\n      default:\n        break;\n    }\n    if (command === 'Z') {\n      // 有了 Z 后，当前节点从开始 M 的点开始\n      currentPoint = startMovePoint;\n      // 如果当前点的命令为 Z，相当于当前点为最近一个 M 点，则下一个点直接指向最近一个 M 点的下一个点\n      nextParams = path[lastStartMovePointIndex + 1];\n    } else {\n      const len = params.length;\n      currentPoint = [params[len - 2], params[len - 1]];\n    }\n    if (nextParams && nextParams[0] === 'Z') {\n      // 如果下一个点的命令为 Z，则下一个点直接指向最近一个 M 点\n      nextParams = path[lastStartMovePointIndex];\n      if (segments[lastStartMovePointIndex]) {\n        // 如果下一个点的命令为 Z，则最近一个 M 点的前一个点为当前点\n        segments[lastStartMovePointIndex].prePoint = currentPoint;\n      }\n    }\n    segment.currentPoint = currentPoint;\n    // 如果当前点与最近一个 M 点相同，则最近一个 M 点的前一个点为当前点的前一个点\n    if (\n      segments[lastStartMovePointIndex] &&\n      isSamePoint(currentPoint, segments[lastStartMovePointIndex].currentPoint)\n    ) {\n      segments[lastStartMovePointIndex].prePoint = segment.prePoint;\n    }\n    const nextPoint = nextParams\n      ? [nextParams[nextParams.length - 2], nextParams[nextParams.length - 1]]\n      : null;\n    segment.nextPoint = nextPoint as [number, number];\n    // Add startTangent and endTangent\n    const { prePoint } = segment;\n    if (['L', 'H', 'V'].includes(command)) {\n      segment.startTangent = [\n        prePoint[0] - currentPoint[0],\n        prePoint[1] - currentPoint[1],\n      ];\n      segment.endTangent = [\n        currentPoint[0] - prePoint[0],\n        currentPoint[1] - prePoint[1],\n      ];\n    } else if (command === 'Q') {\n      // 二次贝塞尔曲线只有一个控制点\n      const cp = [params[1], params[2]];\n      // 二次贝塞尔曲线的终点为 currentPoint\n      segment.startTangent = [prePoint[0] - cp[0], prePoint[1] - cp[1]];\n      segment.endTangent = [currentPoint[0] - cp[0], currentPoint[1] - cp[1]];\n    } else if (command === 'T') {\n      const preSegment = segments[i - 1];\n      const cp = toSymmetry(preSegment.currentPoint, prePoint);\n      if (preSegment.command === 'Q') {\n        segment.command = 'Q';\n        segment.startTangent = [prePoint[0] - cp[0], prePoint[1] - cp[1]];\n        segment.endTangent = [currentPoint[0] - cp[0], currentPoint[1] - cp[1]];\n      } else {\n        // @ts-ignore\n        segment.command = 'TL';\n        segment.startTangent = [\n          prePoint[0] - currentPoint[0],\n          prePoint[1] - currentPoint[1],\n        ];\n        segment.endTangent = [\n          currentPoint[0] - prePoint[0],\n          currentPoint[1] - prePoint[1],\n        ];\n      }\n    } else if (command === 'C') {\n      // 三次贝塞尔曲线有两个控制点\n      const cp1 = [params[1], params[2]];\n      const cp2 = [params[3], params[4]];\n      segment.startTangent = [prePoint[0] - cp1[0], prePoint[1] - cp1[1]];\n      segment.endTangent = [currentPoint[0] - cp2[0], currentPoint[1] - cp2[1]];\n\n      // horizontal line, eg. ['C', 100, 100, 100, 100, 200, 200]\n      if (segment.startTangent[0] === 0 && segment.startTangent[1] === 0) {\n        segment.startTangent = [cp1[0] - cp2[0], cp1[1] - cp2[1]];\n      }\n      if (segment.endTangent[0] === 0 && segment.endTangent[1] === 0) {\n        segment.endTangent = [cp2[0] - cp1[0], cp2[1] - cp1[1]];\n      }\n    } else if (command === 'S') {\n      const preSegment = segments[i - 1];\n      const cp1 = toSymmetry(preSegment.currentPoint, prePoint);\n      const cp2 = [params[1], params[2]];\n      if (preSegment.command === 'C') {\n        segment.command = 'C'; // 将 S 命令变换为 C 命令\n        segment.startTangent = [prePoint[0] - cp1[0], prePoint[1] - cp1[1]];\n        segment.endTangent = [\n          currentPoint[0] - cp2[0],\n          currentPoint[1] - cp2[1],\n        ];\n      } else {\n        // @ts-ignore\n        segment.command = 'SQ'; // 将 S 命令变换为 SQ 命令\n        segment.startTangent = [prePoint[0] - cp2[0], prePoint[1] - cp2[1]];\n        segment.endTangent = [\n          currentPoint[0] - cp2[0],\n          currentPoint[1] - cp2[1],\n        ];\n      }\n    } else if (command === 'A') {\n      const { x: dx1, y: dy1 } = getTangentAtRatio(segment, 0);\n      const { x: dx2, y: dy2 } = getTangentAtRatio(segment, 1, false);\n\n      segment.startTangent = [dx1, dy1];\n      segment.endTangent = [dx2, dy2];\n    }\n    segments.push(segment);\n  }\n  return segments;\n}\n\n/**\n * Use length instead of ratio\n */\nfunction getTangentAtRatio(segment: PathSegment, ratio: number, sign = true) {\n  const { rx = 0, ry = 0, xRotation, arcFlag, sweepFlag } = segment.arcParams;\n  const p1 = pointOnEllipticalArc(\n    { x: segment.prePoint[0], y: segment.prePoint[1] },\n    rx,\n    ry,\n    xRotation,\n    !!arcFlag,\n    !!sweepFlag,\n    { x: segment.currentPoint[0], y: segment.currentPoint[1] },\n    ratio,\n  );\n\n  const p2 = pointOnEllipticalArc(\n    { x: segment.prePoint[0], y: segment.prePoint[1] },\n    rx,\n    ry,\n    xRotation,\n    !!arcFlag,\n    !!sweepFlag,\n    { x: segment.currentPoint[0], y: segment.currentPoint[1] },\n    sign ? ratio + 0.005 : ratio - 0.005,\n  );\n\n  const xDist = p2.x - p1.x;\n  const yDist = p2.y - p1.y;\n\n  const dist = Math.sqrt(xDist * xDist + yDist * yDist);\n  return { x: -xDist / dist, y: -yDist / dist };\n}\n\n// 向量长度\nfunction vMag(v: number[]) {\n  return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n}\n\n// u.v/|u||v|，计算夹角的余弦值\nfunction vRatio(u: number[], v: number[]) {\n  // 当存在一个向量的长度为 0 时，夹角也为 0，即夹角的余弦值为 1\n  return vMag(u) * vMag(v)\n    ? (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v))\n    : 1;\n}\n\n// 向量角度\nfunction vAngle(u: number[], v: number[]) {\n  return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));\n}\n\nfunction getArcParams(\n  startPoint: [number, number],\n  params: ASegment,\n): PathArcParams {\n  let rx = params[1];\n  let ry = params[2];\n  const xRotation = mod(deg2rad(params[3]), Math.PI * 2);\n  const arcFlag = params[4];\n  const sweepFlag = params[5];\n  // 弧形起点坐标\n  const x1 = startPoint[0];\n  const y1 = startPoint[1];\n  // 弧形终点坐标\n  const x2 = params[6];\n  const y2 = params[7];\n  const xp =\n    (Math.cos(xRotation) * (x1 - x2)) / 2.0 +\n    (Math.sin(xRotation) * (y1 - y2)) / 2.0;\n  const yp =\n    (-1 * Math.sin(xRotation) * (x1 - x2)) / 2.0 +\n    (Math.cos(xRotation) * (y1 - y2)) / 2.0;\n  const lambda = (xp * xp) / (rx * rx) + (yp * yp) / (ry * ry);\n\n  if (lambda > 1) {\n    rx *= Math.sqrt(lambda);\n    ry *= Math.sqrt(lambda);\n  }\n  const diff = rx * rx * (yp * yp) + ry * ry * (xp * xp);\n\n  let f = diff ? Math.sqrt((rx * rx * (ry * ry) - diff) / diff) : 1;\n\n  if (arcFlag === sweepFlag) {\n    f *= -1;\n  }\n  if (isNaN(f)) {\n    f = 0;\n  }\n\n  // 旋转前的起点坐标，且当长半轴和短半轴的长度为 0 时，坐标按 (0, 0) 处理\n  const cxp = ry ? (f * rx * yp) / ry : 0;\n  const cyp = rx ? (f * -ry * xp) / rx : 0;\n\n  // 椭圆圆心坐标\n  const cx =\n    (x1 + x2) / 2.0 + Math.cos(xRotation) * cxp - Math.sin(xRotation) * cyp;\n  const cy =\n    (y1 + y2) / 2.0 + Math.sin(xRotation) * cxp + Math.cos(xRotation) * cyp;\n\n  // 起始点的单位向量\n  const u = [(xp - cxp) / rx, (yp - cyp) / ry];\n  // 终止点的单位向量\n  const v = [(-1 * xp - cxp) / rx, (-1 * yp - cyp) / ry];\n  // 计算起始点和圆心的连线，与 x 轴正方向的夹角\n  const theta = vAngle([1, 0], u);\n\n  // 计算圆弧起始点和终止点与椭圆圆心连线的夹角\n  let dTheta = vAngle(u, v);\n\n  if (vRatio(u, v) <= -1) {\n    dTheta = Math.PI;\n  }\n  if (vRatio(u, v) >= 1) {\n    dTheta = 0;\n  }\n  if (sweepFlag === 0 && dTheta > 0) {\n    dTheta -= 2 * Math.PI;\n  }\n  if (sweepFlag === 1 && dTheta < 0) {\n    dTheta += 2 * Math.PI;\n  }\n  return {\n    cx,\n    cy,\n    // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n    rx: isSamePoint(startPoint, [x2, y2]) ? 0 : rx,\n    ry: isSamePoint(startPoint, [x2, y2]) ? 0 : ry,\n    startAngle: theta,\n    endAngle: theta + dTheta,\n    xRotation,\n    arcFlag,\n    sweepFlag,\n  };\n}\n\nfunction commandsToPathString(\n  commands: AbsoluteArray,\n  object: Circle | Ellipse | Rect | Line | Polyline | Polygon | Path,\n  transform?: mat4,\n) {\n  return commands.reduce((prev, cur) => {\n    let path = '';\n    if (cur[0] === 'M' || cur[0] === 'L') {\n      const p = vec3.fromValues(cur[1], cur[2], 0);\n\n      if (transform) {\n        vec3.transformMat4(p, p, transform);\n      }\n\n      path = `${cur[0]}${p[0]},${p[1]}`;\n    } else if (cur[0] === 'Z') {\n      path = cur[0];\n    } else if (cur[0] === 'C') {\n      const p1 = vec3.fromValues(cur[1], cur[2], 0);\n      const p2 = vec3.fromValues(cur[3], cur[4], 0);\n      const p3 = vec3.fromValues(cur[5], cur[6], 0);\n\n      if (transform) {\n        vec3.transformMat4(p1, p1, transform);\n        vec3.transformMat4(p2, p2, transform);\n        vec3.transformMat4(p3, p3, transform);\n      }\n\n      path = `${cur[0]}${p1[0]},${p1[1]},${p2[0]},${p2[1]},${p3[0]},${p3[1]}`;\n    } else if (cur[0] === 'A') {\n      const c = vec3.fromValues(cur[6], cur[7], 0);\n      if (transform) {\n        vec3.transformMat4(c, c, transform);\n      }\n      path = `${cur[0]}${cur[1]},${cur[2]},${cur[3]},${cur[4]},${cur[5]},${c[0]},${c[1]}`;\n    } else if (cur[0] === 'Q') {\n      const p1 = vec3.fromValues(cur[1], cur[2], 0);\n      const p2 = vec3.fromValues(cur[3], cur[4], 0);\n      if (transform) {\n        vec3.transformMat4(p1, p1, transform);\n        vec3.transformMat4(p2, p2, transform);\n      }\n      path = `${cur[0]}${cur[1]},${cur[2]},${cur[3]},${cur[4]}}`;\n    }\n\n    return (prev += path);\n  }, '');\n}\n\nfunction lineToCommands(\n  x1: number,\n  y1: number,\n  x2: number,\n  y2: number,\n): AbsoluteArray {\n  return [\n    ['M', x1, y1],\n    ['L', x2, y2],\n  ];\n}\n\nfunction ellipseToCommands(\n  rx: number,\n  ry: number,\n  cx: number,\n  cy: number,\n): AbsoluteArray {\n  const factor = ((-1 + Math.sqrt(2)) / 3) * 4;\n  const dx = rx * factor;\n  const dy = ry * factor;\n  const left = cx - rx;\n  const right = cx + rx;\n  const top = cy - ry;\n  const bottom = cy + ry;\n\n  return [\n    ['M', left, cy],\n    ['C', left, cy - dy, cx - dx, top, cx, top],\n    ['C', cx + dx, top, right, cy - dy, right, cy],\n    ['C', right, cy + dy, cx + dx, bottom, cx, bottom],\n    ['C', cx - dx, bottom, left, cy + dy, left, cy],\n    ['Z'],\n  ];\n}\n\nfunction polygonToCommands(\n  points: ([number, number] | [number, number, number])[],\n  closed: boolean,\n): AbsoluteArray {\n  const result = points.map((point, i) => {\n    return [i === 0 ? 'M' : 'L', point[0], point[1]];\n  });\n\n  if (closed) {\n    result.push(['Z']);\n  }\n\n  return result as AbsoluteArray;\n}\n\nfunction rectToCommands(\n  width: number,\n  height: number,\n  x: number,\n  y: number,\n  radius?: [number, number, number, number],\n): AbsoluteArray {\n  // @see https://gist.github.com/danielpquinn/dd966af424030d47e476\n  if (radius) {\n    const [tlr, trr, brr, blr] = radius;\n    const signX = width > 0 ? 1 : -1;\n    const signY = height > 0 ? 1 : -1;\n    // sweep-flag @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Tutorial/Paths#arcs\n    const sweepFlag = signX + signY !== 0 ? 1 : 0;\n    return [\n      ['M', signX * tlr + x, y],\n      ['L', width - signX * trr + x, y],\n      trr ? ['A', trr, trr, 0, 0, sweepFlag, width + x, signY * trr + y] : null,\n      ['L', width + x, height - signY * brr + y],\n      brr\n        ? ['A', brr, brr, 0, 0, sweepFlag, width + x - signX * brr, height + y]\n        : null,\n      ['L', x + signX * blr, height + y],\n      blr\n        ? ['A', blr, blr, 0, 0, sweepFlag, x, height + y - signY * blr]\n        : null,\n      ['L', x, signY * tlr + y],\n      tlr ? ['A', tlr, tlr, 0, 0, sweepFlag, signX * tlr + x, y] : null,\n      ['Z'],\n    ].filter((command) => command) as AbsoluteArray;\n  }\n\n  return [\n    ['M', x, y],\n    ['L', x + width, y],\n    ['L', x + width, y + height],\n    ['L', x, y + height],\n    ['Z'],\n  ];\n}\n\n/**\n * convert object to path, should account for:\n * * transform & origin\n * * lineWidth\n */\nexport function convertToPath(\n  object: Circle | Ellipse | Rect | Line | Polyline | Polygon | Path,\n  transform: mat4 = object.getLocalTransform(),\n) {\n  let commands: AbsoluteArray = [] as unknown as AbsoluteArray;\n  switch (object.nodeName) {\n    case Shape.LINE:\n      const { x1 = 0, y1 = 0, x2 = 0, y2 = 0 } = (object as Line).parsedStyle;\n      commands = lineToCommands(x1, y1, x2, y2);\n      break;\n    case Shape.CIRCLE: {\n      const { r = 0, cx = 0, cy = 0 } = (object as Circle).parsedStyle;\n      commands = ellipseToCommands(r, r, cx, cy);\n      break;\n    }\n    case Shape.ELLIPSE: {\n      const {\n        rx = 0,\n        ry = 0,\n        cx = 0,\n        cy = 0,\n      } = (object as Ellipse).parsedStyle;\n      commands = ellipseToCommands(rx, ry, cx, cy);\n      break;\n    }\n    case Shape.POLYLINE:\n    case Shape.POLYGON:\n      const { points } = (object as Polyline).parsedStyle;\n      commands = polygonToCommands(\n        points.points,\n        object.nodeName === Shape.POLYGON,\n      );\n      break;\n    case Shape.RECT:\n      const {\n        width = 0,\n        height = 0,\n        x = 0,\n        y = 0,\n        radius,\n      } = (object as Rect).parsedStyle;\n\n      const hasRadius = radius && radius.some((r) => r !== 0);\n      commands = rectToCommands(\n        width,\n        height,\n        x,\n        y,\n        hasRadius &&\n          (radius.map((r) =>\n            clamp(r, 0, Math.min(Math.abs(width) / 2, Math.abs(height) / 2)),\n          ) as [number, number, number, number]),\n      );\n      break;\n    case Shape.PATH:\n      const { absolutePath } = (object as Path).parsedStyle.d;\n      commands = [...absolutePath];\n      break;\n  }\n\n  if (commands.length) {\n    return commandsToPathString(commands, object, transform);\n  }\n}\n\nexport function translatePathToString(\n  absolutePath: AbsoluteArray,\n  startOffsetX = 0,\n  startOffsetY = 0,\n  endOffsetX = 0,\n  endOffsetY = 0,\n) {\n  const newValue = absolutePath\n    .map((params, i) => {\n      const command = params[0];\n      const nextSegment = absolutePath[i + 1];\n      const useStartOffset =\n        i === 0 && (startOffsetX !== 0 || startOffsetY !== 0);\n      const useEndOffset =\n        (i === absolutePath.length - 1 ||\n          (nextSegment &&\n            (nextSegment[0] === 'M' || nextSegment[0] === 'Z'))) &&\n        endOffsetX !== 0 &&\n        endOffsetY !== 0;\n\n      switch (command) {\n        case 'M':\n          // Use start marker offset\n          if (useStartOffset) {\n            return `M ${params[1] + startOffsetX},${\n              params[2] + startOffsetY\n            } L ${params[1]},${params[2]}`;\n          }\n          return `M ${params[1]},${params[2]}`;\n\n        case 'L':\n          return `L ${params[1] + (useEndOffset ? endOffsetX : 0)},${\n            params[2] + (useEndOffset ? endOffsetY : 0)\n          }`;\n        case 'Q':\n          return `Q ${params[1]} ${params[2]},${params[3]} ${params[4]}${\n            useEndOffset\n              ? ` L ${params[3] + endOffsetX},${params[4] + endOffsetY}`\n              : ''\n          }`;\n        case 'C':\n          return `C ${params[1]} ${params[2]},${params[3]} ${params[4]},${params[5]} ${params[6]}${\n            useEndOffset\n              ? ` L ${params[5] + endOffsetX},${params[6] + endOffsetY}`\n              : ''\n          }`;\n        case 'A':\n          return `A ${params[1]} ${params[2]} ${params[3]} ${params[4]} ${params[5]} ${params[6]} ${params[7]}${\n            useEndOffset\n              ? ` L ${params[6] + endOffsetX},${params[7] + endOffsetY}`\n              : ''\n          }`;\n        case 'Z':\n          return 'Z';\n        default:\n          return null;\n      }\n    })\n    .filter((item) => item !== null)\n    .join(' ');\n  if (~newValue.indexOf('NaN')) {\n    return '';\n  }\n  return newValue;\n}\n","import type { AbsoluteArray, CurveArray, PathArray } from '@antv/util';\nimport {\n  clonePath,\n  equalizeSegments,\n  getDrawDirection,\n  getRotatedCurve,\n  isString,\n  normalizePath,\n  path2Curve,\n  reverseCurve,\n} from '@antv/util';\nimport type { ParsedPathStyleProps } from '../../display-objects';\nimport type { IElement } from '../../dom';\nimport { memoize } from '../../utils/memoize';\nimport {\n  extractPolygons,\n  getPathBBox,\n  hasArcOrBezier,\n  path2Segments,\n  removeRedundantMCommand,\n} from '../../utils/path';\n\nconst internalParsePath = (path: string | PathArray) => {\n  // empty path\n  if (path === '' || (Array.isArray(path) && path.length === 0)) {\n    return {\n      absolutePath: [],\n      hasArc: false,\n      segments: [],\n      polygons: [],\n      polylines: [],\n      curve: null,\n      totalLength: 0,\n      rect: {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n      },\n    };\n  }\n\n  let absolutePath: AbsoluteArray;\n  try {\n    absolutePath = normalizePath(path);\n  } catch {\n    absolutePath = normalizePath('');\n    console.error(`[g]: Invalid SVG Path definition: ${path}`);\n  }\n\n  removeRedundantMCommand(absolutePath);\n\n  const hasArc = hasArcOrBezier(absolutePath);\n\n  const { polygons, polylines } = extractPolygons(absolutePath);\n\n  // for later use\n  const segments = path2Segments(absolutePath);\n\n  // Only calculate bbox here since we don't need length now.\n  const { x, y, width, height } = getPathBBox(segments, 0);\n\n  return {\n    absolutePath,\n    hasArc,\n    segments,\n    polygons,\n    polylines,\n    // curve,\n    // Delay the calculation of length.\n    totalLength: 0,\n    rect: {\n      x: Number.isFinite(x) ? x : 0,\n      y: Number.isFinite(y) ? y : 0,\n      width: Number.isFinite(width) ? width : 0,\n      height: Number.isFinite(height) ? height : 0,\n    },\n  };\n};\n\nconst memoizedParsePath = memoize(internalParsePath);\n\nexport function parsePath(path: string | PathArray): ParsedPathStyleProps['d'] {\n  return (\n    isString(path) ? memoizedParsePath(path) : internalParsePath(path)\n  ) as ParsedPathStyleProps['d'];\n}\n\nexport function mergePaths(\n  left: ParsedPathStyleProps['d'],\n  right: ParsedPathStyleProps['d'],\n  object?: IElement,\n): [CurveArray, CurveArray, (b: CurveArray) => CurveArray] {\n  let curve1 = left.curve;\n  let curve2 = right.curve;\n  if (!curve1 || curve1.length === 0) {\n    // convert to curves to do morphing & picking later\n    // @see http://thednp.github.io/kute.js/svgCubicMorph.html\n    curve1 = path2Curve(left.absolutePath, false) as CurveArray;\n    left.curve = curve1;\n  }\n  if (!curve2 || curve2.length === 0) {\n    curve2 = path2Curve(right.absolutePath, false) as CurveArray;\n    right.curve = curve2;\n  }\n\n  let curves = [curve1, curve2];\n  if (curve1.length !== curve2.length) {\n    curves = equalizeSegments(curve1, curve2);\n  }\n\n  const curve0 =\n    getDrawDirection(curves[0]) !== getDrawDirection(curves[1])\n      ? reverseCurve(curves[0])\n      : (clonePath(curves[0]) as CurveArray);\n\n  return [\n    curve0,\n    getRotatedCurve(curves[1], curve0) as CurveArray,\n    (pathArray: CurveArray) => {\n      // need converting to path string?\n      return pathArray;\n    },\n  ];\n}\n","import { isString } from '@antv/util';\nimport type { DisplayObject } from '../..';\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/points\n *\n * @example\n * points=\"100,10 250,150 200,110\"\n */\nexport function parsePoints(\n  pointsOrStr: string | [number, number][],\n  object?: DisplayObject,\n) {\n  let points: [number, number][];\n  if (isString(pointsOrStr)) {\n    points = pointsOrStr.split(' ').map((pointStr) => {\n      const [x, y] = pointStr.split(',');\n      return [Number(x), Number(y)];\n    });\n  } else {\n    points = pointsOrStr;\n  }\n\n  return {\n    points,\n    totalLength: 0,\n    segments: [],\n  };\n}\n\nexport function mergePoints(\n  left,\n  right,\n):\n  | [\n      [number, number][],\n      [number, number][],\n      (numberList: [number, number][]) => [number, number][],\n    ]\n  | undefined {\n  return [\n    left.points,\n    right.points,\n    (points) => {\n      return points;\n    },\n  ];\n}\n","import { clamp } from '@antv/util';\nimport type { DisplayObject } from '../../display-objects';\nimport { decomposeMat4, deg2rad } from '../../utils/math';\nimport { getOrCreateUnitValue } from '../CSSStyleValuePool';\nimport { CSSUnitValue, Odeg, Opx } from '../cssom';\nimport {\n  convertAngleUnit,\n  convertPercentUnit,\n  mergeDimensions,\n  parseAngle,\n  parseAngleUnmemoize,\n  parseLength,\n  parseLengthUnmemoize,\n  parseLengthOrPercentage,\n  parseLengthOrPercentageUnmemoize,\n} from './dimension';\nimport { parseNumber, parseNumberUnmemoize } from './numeric';\nimport type { TransformArray, TransformType } from '../../types';\n\n// eg. { t: 'scale', d: [CSSUnitValue(1), CSSUnitValue(2)] }\nexport interface ParsedTransform {\n  t: string;\n  d: CSSUnitValue[];\n}\n\ntype PatternElement = string | number | null | CSSUnitValue;\ntype CastFunction =\n  | ((string: string) => string)\n  | ((contents: (number | PatternElement)[]) => PatternElement[]);\n\nconst _ = null;\nconst TRANSFORM_REGEXP = /\\s*(\\w+)\\(([^)]*)\\)/g;\nfunction cast(pattern: PatternElement[]) {\n  return function (contents: PatternElement[]) {\n    let i = 0;\n    return pattern.map((x) => {\n      return x === _ ? contents[i++] : x;\n    });\n  };\n}\n\nfunction id(x: string) {\n  return x;\n}\n\n// type: [argTypes, convertTo3D, convertTo2D]\n// In the argument types string, lowercase characters represent optional arguments\nconst transformFunctions: Record<\n  TransformType,\n  [string] | [string, CastFunction] | [string, CastFunction, CastFunction]\n> = {\n  // @ts-ignore\n  matrix: ['NNNNNN', [_, _, 0, 0, _, _, 0, 0, 0, 0, 1, 0, _, _, 0, 1], id],\n  matrix3d: ['NNNNNNNNNNNNNNNN', id],\n  rotate: ['A'],\n  rotateX: ['A'],\n  rotateY: ['A'],\n  rotateZ: ['A'],\n  rotate3d: ['NNNA'],\n  perspective: ['L'],\n  scale: ['Nn', cast([_, _, new CSSUnitValue(1)]), id],\n  scaleX: [\n    'N',\n    cast([_, new CSSUnitValue(1), new CSSUnitValue(1)]),\n    cast([_, new CSSUnitValue(1)]),\n  ],\n  scaleY: [\n    'N',\n    cast([new CSSUnitValue(1), _, new CSSUnitValue(1)]),\n    cast([new CSSUnitValue(1), _]),\n  ],\n  scaleZ: ['N', cast([new CSSUnitValue(1), new CSSUnitValue(1), _])],\n  scale3d: ['NNN', id],\n  skew: ['Aa', null, id],\n  skewX: ['A', null, cast([_, Odeg])],\n  skewY: ['A', null, cast([Odeg, _])],\n  translate: ['Tt', cast([_, _, Opx]), id],\n  translateX: ['T', cast([_, Opx, Opx]), cast([_, Opx])],\n  translateY: ['T', cast([Opx, _, Opx]), cast([Opx, _])],\n  translateZ: ['L', cast([Opx, Opx, _])],\n  translate3d: ['TTL', id],\n};\n\nfunction parseArrayTransform(transform: TransformArray): ParsedTransform[] {\n  const result: ParsedTransform[] = [];\n  const length = transform.length;\n\n  for (let i = 0; i < length; i++) {\n    const item = transform[i];\n    const name = item[0];\n    const args = item.slice(1) as number[];\n    // infer default value\n    if (name === 'translate' || name === 'skew') {\n      if (args.length === 1) args.push(0);\n    } else if (name === 'scale') {\n      if (args.length === 1) args.push(args[0]);\n    }\n\n    const functionData = transformFunctions[name];\n    if (!functionData) return [];\n    const parsedArgs = args.map((value) => getOrCreateUnitValue(value));\n    result.push({ t: name, d: parsedArgs });\n  }\n\n  return result;\n}\n\n/**\n * none\n * scale(1) scale(1, 2)\n * scaleX(1)\n */\nexport function parseTransform(\n  transform: string | TransformArray,\n): ParsedTransform[] {\n  if (Array.isArray(transform)) {\n    return parseArrayTransform(transform);\n  }\n\n  transform = (transform || 'none').trim();\n  if (transform === 'none') {\n    return [];\n  }\n  const result: ParsedTransform[] = [];\n  let match;\n  let prevLastIndex = 0;\n  TRANSFORM_REGEXP.lastIndex = 0;\n  while ((match = TRANSFORM_REGEXP.exec(transform))) {\n    if (match.index !== prevLastIndex) {\n      return [];\n    }\n    prevLastIndex = match.index + match[0].length;\n    const functionName = match[1] as TransformType; // scale\n    const functionData = transformFunctions[functionName]; // scale(1, 2)\n    if (!functionData) {\n      // invalid, eg. scale()\n      return [];\n    }\n    const args = match[2].split(','); // 1,2\n    const argTypes = functionData[0]; // Nn\n    if (argTypes.length < args.length) {\n      // scale(N, n)\n      return [];\n    }\n\n    const parsedArgs: CSSUnitValue[] = [];\n    for (let i = 0; i < argTypes.length; i++) {\n      const arg = args[i];\n      const type = argTypes[i];\n      let parsedArg;\n      if (!arg) {\n        // @ts-ignore\n        parsedArg = {\n          a: Odeg,\n          n: parsedArgs[0],\n          t: Opx,\n        }[type];\n      } else {\n        // @ts-ignore\n        parsedArg = {\n          A: (s: string) => {\n            return s.trim() === '0' ? Odeg : parseAngle(s);\n          },\n          N: parseNumber,\n          T: parseLengthOrPercentage,\n          L: parseLength,\n        }[type.toUpperCase()](arg);\n      }\n      if (parsedArg === undefined) {\n        return [];\n      }\n      parsedArgs.push(parsedArg);\n    }\n    result.push({ t: functionName, d: parsedArgs }); // { t: scale, d: [1, 2] }\n\n    if (TRANSFORM_REGEXP.lastIndex === transform.length) {\n      return result;\n    }\n  }\n\n  return [];\n}\nexport function parseTransformUnmemoize(\n  transform: string | TransformArray,\n): ParsedTransform[] {\n  if (Array.isArray(transform)) {\n    return parseArrayTransform(transform);\n  }\n\n  transform = (transform || 'none').trim();\n  if (transform === 'none') {\n    return [];\n  }\n  const result: ParsedTransform[] = [];\n  let match;\n  let prevLastIndex = 0;\n  TRANSFORM_REGEXP.lastIndex = 0;\n  while ((match = TRANSFORM_REGEXP.exec(transform))) {\n    if (match.index !== prevLastIndex) {\n      return [];\n    }\n    prevLastIndex = match.index + match[0].length;\n    const functionName = match[1] as TransformType; // scale\n    const functionData = transformFunctions[functionName]; // scale(1, 2)\n    if (!functionData) {\n      // invalid, eg. scale()\n      return [];\n    }\n    const args = match[2].split(','); // 1,2\n    const argTypes = functionData[0]; // Nn\n    if (argTypes.length < args.length) {\n      // scale(N, n)\n      return [];\n    }\n\n    const parsedArgs: CSSUnitValue[] = [];\n    for (let i = 0; i < argTypes.length; i++) {\n      const arg = args[i];\n      const type = argTypes[i];\n      let parsedArg;\n      if (!arg) {\n        // @ts-ignore\n        parsedArg = {\n          a: Odeg,\n          n: parsedArgs[0],\n          t: Opx,\n        }[type];\n      } else {\n        // @ts-ignore\n        parsedArg = {\n          A: (s: string) => {\n            return s.trim() === '0' ? Odeg : parseAngleUnmemoize(s);\n          },\n          N: parseNumberUnmemoize,\n          T: parseLengthOrPercentageUnmemoize,\n          L: parseLengthUnmemoize,\n        }[type.toUpperCase()](arg);\n      }\n      if (parsedArg === undefined) {\n        return [];\n      }\n      parsedArgs.push(parsedArg);\n    }\n    result.push({ t: functionName, d: parsedArgs }); // { t: scale, d: [1, 2] }\n\n    if (TRANSFORM_REGEXP.lastIndex === transform.length) {\n      return result;\n    }\n  }\n\n  return [];\n}\n\nexport function convertItemToMatrix(item: ParsedTransform): number[] {\n  let x: number;\n  let y: number;\n  let z: number;\n  let angle: number;\n  switch (item.t) {\n    case 'rotateX':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [\n        1,\n        0,\n        0,\n        0,\n        0,\n        Math.cos(angle),\n        Math.sin(angle),\n        0,\n        0,\n        -Math.sin(angle),\n        Math.cos(angle),\n        0,\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'rotateY':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [\n        Math.cos(angle),\n        0,\n        -Math.sin(angle),\n        0,\n        0,\n        1,\n        0,\n        0,\n        Math.sin(angle),\n        0,\n        Math.cos(angle),\n        0,\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'rotate':\n    case 'rotateZ':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [\n        Math.cos(angle),\n        Math.sin(angle),\n        0,\n        0,\n        -Math.sin(angle),\n        Math.cos(angle),\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'rotate3d':\n      x = item.d[0].value;\n      y = item.d[1].value;\n      z = item.d[2].value;\n      angle = deg2rad(convertAngleUnit(item.d[3]));\n\n      const sqrLength = x * x + y * y + z * z;\n      if (sqrLength === 0) {\n        x = 1;\n        y = 0;\n        z = 0;\n      } else if (sqrLength !== 1) {\n        const length = Math.sqrt(sqrLength);\n        x /= length;\n        y /= length;\n        z /= length;\n      }\n\n      const s = Math.sin(angle / 2);\n      const sc = s * Math.cos(angle / 2);\n      const sq = s * s;\n      return [\n        1 - 2 * (y * y + z * z) * sq,\n        2 * (x * y * sq + z * sc),\n        2 * (x * z * sq - y * sc),\n        0,\n\n        2 * (x * y * sq - z * sc),\n        1 - 2 * (x * x + z * z) * sq,\n        2 * (y * z * sq + x * sc),\n        0,\n\n        2 * (x * z * sq + y * sc),\n        2 * (y * z * sq - x * sc),\n        1 - 2 * (x * x + y * y) * sq,\n        0,\n\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'scale':\n      return [\n        item.d[0].value,\n        0,\n        0,\n        0,\n        0,\n        item.d[1].value,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'scaleX':\n      return [item.d[0].value, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'scaleY':\n      return [1, 0, 0, 0, 0, item.d[0].value, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'scaleZ':\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, item.d[0].value, 0, 0, 0, 0, 1];\n    case 'scale3d':\n      return [\n        item.d[0].value,\n        0,\n        0,\n        0,\n        0,\n        item.d[1].value,\n        0,\n        0,\n        0,\n        0,\n        item.d[2].value,\n        0,\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'skew':\n      const xAngle = deg2rad(convertAngleUnit(item.d[0]));\n      const yAngle = deg2rad(convertAngleUnit(item.d[1]));\n      return [\n        1,\n        Math.tan(yAngle),\n        0,\n        0,\n        Math.tan(xAngle),\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        0,\n        0,\n        0,\n        1,\n      ];\n    case 'skewX':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [1, 0, 0, 0, Math.tan(angle), 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'skewY':\n      angle = deg2rad(convertAngleUnit(item.d[0]));\n      return [1, Math.tan(angle), 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n    case 'translate':\n      // TODO: pass target\n      x = convertPercentUnit(item.d[0], 0, null) || 0;\n      y = convertPercentUnit(item.d[1], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, y, 0, 1];\n    case 'translateX':\n      x = convertPercentUnit(item.d[0], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, 0, 0, 1];\n    case 'translateY':\n      y = convertPercentUnit(item.d[0], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, y, 0, 1];\n    case 'translateZ':\n      z = convertPercentUnit(item.d[0], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, z, 1];\n    case 'translate3d':\n      x = convertPercentUnit(item.d[0], 0, null) || 0;\n      y = convertPercentUnit(item.d[1], 0, null) || 0;\n      z = convertPercentUnit(item.d[2], 0, null) || 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, x, y, z, 1];\n    case 'perspective':\n      const t = convertPercentUnit(item.d[0], 0, null) || 0;\n      const p = t ? -1 / t : 0;\n      return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, p, 0, 0, 0, 1];\n    case 'matrix':\n      return [\n        item.d[0].value,\n        item.d[1].value,\n        0,\n        0,\n        item.d[2].value,\n        item.d[3].value,\n        0,\n        0,\n        0,\n        0,\n        1,\n        0,\n        item.d[4].value,\n        item.d[5].value,\n        0,\n        1,\n      ];\n    case 'matrix3d':\n      return item.d.map((d) => d.value);\n    default:\n  }\n}\n\nfunction multiplyMatrices(a: number[], b: number[]) {\n  return [\n    a[0] * b[0] + a[4] * b[1] + a[8] * b[2] + a[12] * b[3],\n    a[1] * b[0] + a[5] * b[1] + a[9] * b[2] + a[13] * b[3],\n    a[2] * b[0] + a[6] * b[1] + a[10] * b[2] + a[14] * b[3],\n    a[3] * b[0] + a[7] * b[1] + a[11] * b[2] + a[15] * b[3],\n\n    a[0] * b[4] + a[4] * b[5] + a[8] * b[6] + a[12] * b[7],\n    a[1] * b[4] + a[5] * b[5] + a[9] * b[6] + a[13] * b[7],\n    a[2] * b[4] + a[6] * b[5] + a[10] * b[6] + a[14] * b[7],\n    a[3] * b[4] + a[7] * b[5] + a[11] * b[6] + a[15] * b[7],\n\n    a[0] * b[8] + a[4] * b[9] + a[8] * b[10] + a[12] * b[11],\n    a[1] * b[8] + a[5] * b[9] + a[9] * b[10] + a[13] * b[11],\n    a[2] * b[8] + a[6] * b[9] + a[10] * b[10] + a[14] * b[11],\n    a[3] * b[8] + a[7] * b[9] + a[11] * b[10] + a[15] * b[11],\n\n    a[0] * b[12] + a[4] * b[13] + a[8] * b[14] + a[12] * b[15],\n    a[1] * b[12] + a[5] * b[13] + a[9] * b[14] + a[13] * b[15],\n    a[2] * b[12] + a[6] * b[13] + a[10] * b[14] + a[14] * b[15],\n    a[3] * b[12] + a[7] * b[13] + a[11] * b[14] + a[15] * b[15],\n  ];\n}\n\nfunction convertToMatrix(transformList: ParsedTransform[]) {\n  if (transformList.length === 0) {\n    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\n  }\n  return transformList.map(convertItemToMatrix).reduce(multiplyMatrices);\n}\n\nfunction makeMatrixDecomposition(transformList: ParsedTransform[]) {\n  const translate = [0, 0, 0];\n  const scale = [1, 1, 1];\n  const skew = [0, 0, 0];\n  const perspective = [0, 0, 0, 1];\n  const quaternion = [0, 0, 0, 1];\n  decomposeMat4(\n    // @ts-ignore\n    convertToMatrix(transformList),\n    translate,\n    scale,\n    skew,\n    perspective,\n    quaternion,\n  );\n  return [[translate, scale, skew, quaternion, perspective]];\n}\n\nexport const composeMatrix = (function () {\n  function multiply(a, b) {\n    const result = [\n      [0, 0, 0, 0],\n      [0, 0, 0, 0],\n      [0, 0, 0, 0],\n      [0, 0, 0, 0],\n    ];\n    for (let i = 0; i < 4; i++) {\n      for (let j = 0; j < 4; j++) {\n        for (let k = 0; k < 4; k++) {\n          result[i][j] += b[i][k] * a[k][j];\n        }\n      }\n    }\n    return result;\n  }\n\n  function is2D(m) {\n    return (\n      m[0][2] === 0 &&\n      m[0][3] === 0 &&\n      m[1][2] === 0 &&\n      m[1][3] === 0 &&\n      m[2][0] === 0 &&\n      m[2][1] === 0 &&\n      m[2][2] === 1 &&\n      m[2][3] === 0 &&\n      m[3][2] === 0 &&\n      m[3][3] === 1\n    );\n  }\n\n  function composeMatrix(translate, scale, skew, quat, perspective) {\n    let matrix = [\n      [1, 0, 0, 0],\n      [0, 1, 0, 0],\n      [0, 0, 1, 0],\n      [0, 0, 0, 1],\n    ];\n\n    for (let i = 0; i < 4; i++) {\n      matrix[i][3] = perspective[i];\n    }\n\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        matrix[3][i] += translate[j] * matrix[j][i];\n      }\n    }\n\n    const x = quat[0];\n    const y = quat[1];\n    const z = quat[2];\n    const w = quat[3];\n\n    const rotMatrix = [\n      [1, 0, 0, 0],\n      [0, 1, 0, 0],\n      [0, 0, 1, 0],\n      [0, 0, 0, 1],\n    ];\n\n    rotMatrix[0][0] = 1 - 2 * (y * y + z * z);\n    rotMatrix[0][1] = 2 * (x * y - z * w);\n    rotMatrix[0][2] = 2 * (x * z + y * w);\n    rotMatrix[1][0] = 2 * (x * y + z * w);\n    rotMatrix[1][1] = 1 - 2 * (x * x + z * z);\n    rotMatrix[1][2] = 2 * (y * z - x * w);\n    rotMatrix[2][0] = 2 * (x * z - y * w);\n    rotMatrix[2][1] = 2 * (y * z + x * w);\n    rotMatrix[2][2] = 1 - 2 * (x * x + y * y);\n\n    matrix = multiply(matrix, rotMatrix);\n\n    const temp = [\n      [1, 0, 0, 0],\n      [0, 1, 0, 0],\n      [0, 0, 1, 0],\n      [0, 0, 0, 1],\n    ];\n    if (skew[2]) {\n      temp[2][1] = skew[2];\n      matrix = multiply(matrix, temp);\n    }\n\n    if (skew[1]) {\n      temp[2][1] = 0;\n      temp[2][0] = skew[0];\n      matrix = multiply(matrix, temp);\n    }\n\n    if (skew[0]) {\n      temp[2][0] = 0;\n      temp[1][0] = skew[0];\n      matrix = multiply(matrix, temp);\n    }\n\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        matrix[i][j] *= scale[i];\n      }\n    }\n\n    if (is2D(matrix)) {\n      return [\n        matrix[0][0],\n        matrix[0][1],\n        matrix[1][0],\n        matrix[1][1],\n        matrix[3][0],\n        matrix[3][1],\n      ];\n    }\n    return matrix[0].concat(matrix[1], matrix[2], matrix[3]);\n  }\n  return composeMatrix;\n})();\n\nfunction numberToLongString(x: number) {\n  return x.toFixed(6).replace('.000000', '');\n}\n\nfunction mergeMatrices(\n  left: ParsedTransform[],\n  right: ParsedTransform[],\n): [number[][], number[][], () => string] {\n  let leftArgs: number[][];\n  let rightArgs: number[][];\n  // @ts-ignore\n  if (left.decompositionPair !== right) {\n    // @ts-ignore\n    left.decompositionPair = right;\n    // @ts-ignore\n    leftArgs = makeMatrixDecomposition(left);\n  }\n  // @ts-ignore\n  if (right.decompositionPair !== left) {\n    // @ts-ignore\n    right.decompositionPair = left;\n    // @ts-ignore\n    rightArgs = makeMatrixDecomposition(right);\n  }\n  if (leftArgs[0] === null || rightArgs[0] === null)\n    return [\n      // @ts-ignore\n      [false],\n      // @ts-ignore\n      [true],\n      // @ts-ignore\n      (x) => {\n        return x ? right[0].d : left[0].d;\n      },\n    ];\n  leftArgs[0].push(0);\n  rightArgs[0].push(1);\n  return [\n    leftArgs,\n    rightArgs,\n    // @ts-ignore\n    (list) => {\n      // @ts-ignore\n      const q = quat(leftArgs[0][3], rightArgs[0][3], list[5]);\n      const mat = composeMatrix(list[0], list[1], list[2], q, list[4]);\n      const stringifiedArgs = mat.map(numberToLongString).join(',');\n      return stringifiedArgs;\n    },\n  ];\n}\n\nfunction dot(v1: number[], v2: number[]) {\n  let result = 0;\n  for (let i = 0; i < v1.length; i++) {\n    result += v1[i] * v2[i];\n  }\n  return result;\n}\n\nfunction quat(fromQ: number[], toQ: number[], f: number): number[] {\n  let product = dot(fromQ, toQ);\n  product = clamp(product, -1.0, 1.0);\n\n  let quat = [];\n  if (product === 1.0) {\n    quat = fromQ;\n  } else {\n    const theta = Math.acos(product);\n    const w = (Math.sin(f * theta) * 1) / Math.sqrt(1 - product * product);\n\n    for (let i = 0; i < 4; i++) {\n      quat.push(fromQ[i] * (Math.cos(f * theta) - product * w) + toQ[i] * w);\n    }\n  }\n  return quat;\n}\n\n// scaleX/Y/Z -> scale\nfunction typeTo2D(type: string) {\n  return type.replace(/[XY]/, '');\n}\n\n// scaleX/Y/Z -> scale3d\nfunction typeTo3D(type: string) {\n  return type.replace(/(X|Y|Z|3d)?$/, '3d');\n}\n\nconst isMatrixOrPerspective = function (lt: string, rt: string) {\n  return (\n    (lt === 'perspective' && rt === 'perspective') ||\n    ((lt === 'matrix' || lt === 'matrix3d') &&\n      (rt === 'matrix' || rt === 'matrix3d'))\n  );\n};\n\nexport function mergeTransforms(\n  left: ParsedTransform[],\n  right: ParsedTransform[],\n  target: DisplayObject | null,\n): [number[][], number[][], (d: number[][]) => string] {\n  let flipResults = false;\n  // padding empty transform, eg. merge 'scale(10)' with 'none' -> scale(1)\n  if (!left.length || !right.length) {\n    if (!left.length) {\n      flipResults = true;\n      left = right;\n      right = [];\n    }\n    for (let i = 0; i < left.length; i++) {\n      const { t: type, d: args } = left[i];\n      // none -> scale(1)/translateX(0)\n      const defaultValue = type.substring(0, 5) === 'scale' ? 1 : 0;\n      right.push({\n        t: type,\n        d: args.map((arg) => {\n          if (typeof arg === 'number') {\n            return getOrCreateUnitValue(defaultValue);\n          }\n          return getOrCreateUnitValue(defaultValue, arg.unit);\n          //   {\n          //     unit: arg.unit,\n          //     value: defaultValue,\n          //   };\n        }),\n      });\n    }\n  }\n\n  let leftResult: number[][] = [];\n  let rightResult: number[][] = [];\n  let types: any = [];\n\n  // merge matrix() with matrix3d()\n  if (left.length !== right.length) {\n    const merged = mergeMatrices(left, right);\n    // @ts-ignore\n    leftResult = [merged[0]];\n    // @ts-ignore\n    rightResult = [merged[1]];\n    types = [['matrix', [merged[2]]]];\n  } else {\n    for (let i = 0; i < left.length; i++) {\n      const leftType = left[i].t as TransformType;\n      const rightType = right[i].t as TransformType;\n      let leftArgs = left[i].d;\n      let rightArgs = right[i].d;\n\n      const leftFunctionData = transformFunctions[leftType];\n      const rightFunctionData = transformFunctions[rightType];\n\n      let type;\n      if (isMatrixOrPerspective(leftType, rightType)) {\n        const merged = mergeMatrices([left[i]], [right[i]]);\n        // @ts-ignore\n        leftResult.push(merged[0]);\n        // @ts-ignore\n        rightResult.push(merged[1]);\n        types.push(['matrix', [merged[2]]]);\n        continue;\n      } else if (leftType === rightType) {\n        type = leftType;\n      } else if (\n        leftFunctionData[2] &&\n        rightFunctionData[2] &&\n        typeTo2D(leftType) === typeTo2D(rightType)\n      ) {\n        type = typeTo2D(leftType);\n        // @ts-ignore\n        leftArgs = leftFunctionData[2](leftArgs);\n        // @ts-ignore\n        rightArgs = rightFunctionData[2](rightArgs);\n      } else if (\n        leftFunctionData[1] &&\n        rightFunctionData[1] &&\n        typeTo3D(leftType) === typeTo3D(rightType)\n      ) {\n        type = typeTo3D(leftType);\n        // @ts-ignore\n        leftArgs = leftFunctionData[1](leftArgs);\n        // @ts-ignore\n        rightArgs = rightFunctionData[1](rightArgs);\n      } else {\n        const merged = mergeMatrices(left, right);\n        // @ts-ignore\n        leftResult = [merged[0]];\n        // @ts-ignore\n        rightResult = [merged[1]];\n        types = [['matrix', [merged[2]]]];\n        break;\n      }\n\n      const leftArgsCopy = [];\n      const rightArgsCopy = [];\n      const stringConversions = [];\n      for (let j = 0; j < leftArgs.length; j++) {\n        // const merge = leftArgs[j].unit === UnitType.kNumber ? mergeDimensions : mergeDimensions;\n        const merged = mergeDimensions(\n          leftArgs[j],\n          rightArgs[j],\n          target,\n          false,\n          j,\n        );\n        leftArgsCopy[j] = merged[0];\n        rightArgsCopy[j] = merged[1];\n        stringConversions.push(merged[2]);\n      }\n      leftResult.push(leftArgsCopy);\n      rightResult.push(rightArgsCopy);\n      types.push([type, stringConversions]);\n    }\n  }\n\n  if (flipResults) {\n    const tmp = leftResult;\n    leftResult = rightResult;\n    rightResult = tmp;\n  }\n\n  return [\n    leftResult,\n    rightResult,\n    (list: number[][]) => {\n      return list\n        .map((args, i: number) => {\n          const stringifiedArgs = args\n            .map((arg, j: number) => {\n              return types[i][1][j](arg);\n            })\n            .join(',');\n          if (\n            types[i][0] === 'matrix' &&\n            stringifiedArgs.split(',').length === 16\n          ) {\n            types[i][0] = 'matrix3d';\n          }\n          if (\n            types[i][0] === 'matrix3d' &&\n            stringifiedArgs.split(',').length === 6\n          ) {\n            types[i][0] = 'matrix';\n          }\n          return `${types[i][0]}(${stringifiedArgs})`;\n        })\n        .join(' ');\n    },\n  ];\n}\n","import { isString } from '@antv/util';\nimport type { CSSUnitValue } from '../cssom';\nimport { getOrCreateUnitValue } from '../CSSStyleValuePool';\nimport { parseLengthOrPercentage } from './dimension';\nimport { memoize } from '../../utils/memoize';\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-origin\n * eg. 'center' 'top left' '50px 50px'\n */\nexport const parseTransformOrigin = memoize(\n  (value: string | number[]): [CSSUnitValue, CSSUnitValue] => {\n    if (isString(value)) {\n      if (value === 'text-anchor') {\n        return [getOrCreateUnitValue(0, 'px'), getOrCreateUnitValue(0, 'px')];\n      }\n\n      const values = value.split(' ');\n      if (values.length === 1) {\n        if (values[0] === 'top' || values[0] === 'bottom') {\n          // 'top' -> 'center top'\n          values[1] = values[0];\n          values[0] = 'center';\n        } else {\n          // '50px' -> '50px center'\n          values[1] = 'center';\n        }\n      }\n\n      if (values.length !== 2) {\n        return null;\n      }\n\n      // eg. center bottom\n      return [\n        parseLengthOrPercentage(\n          convertKeyword2Percent(values[0]),\n        ) as CSSUnitValue,\n        parseLengthOrPercentage(\n          convertKeyword2Percent(values[1]),\n        ) as CSSUnitValue,\n      ];\n    }\n    return [\n      getOrCreateUnitValue(value[0] || 0, 'px'),\n      getOrCreateUnitValue(value[1] || 0, 'px'),\n    ];\n  },\n);\n\nfunction convertKeyword2Percent(keyword: string) {\n  if (keyword === 'center') {\n    return '50%';\n  }\n  if (keyword === 'left' || keyword === 'top') {\n    return '0%';\n  }\n  if (keyword === 'right' || keyword === 'bottom') {\n    return '100%';\n  }\n  return keyword;\n}\n","import { isNil, isUndefined } from '@antv/util';\nimport { vec3 } from 'gl-matrix';\nimport type { DisplayObject } from '../display-objects';\nimport { EMPTY_PARSED_PATH } from '../display-objects/constants';\nimport type { GlobalRuntime } from '../global-runtime';\nimport { GeometryAABBUpdater } from '../services';\nimport { AABB } from '../shapes';\nimport type {\n  BaseStyleProps,\n  ParsedBaseStyleProps,\n  Tuple3Number,\n} from '../types';\nimport { Shape } from '../types';\nimport type { CSSRGB } from './cssom';\nimport type {\n  PropertyMetadata,\n  PropertyParseOptions,\n  StyleValueRegistry,\n} from './interfaces';\nimport { PropertySyntax } from './interfaces';\nimport {\n  parseColor,\n  parseFilter,\n  parsePath,\n  parsePoints,\n  parseTransform,\n  parseTransformOrigin,\n} from './parser';\nimport {\n  convertPercentUnit,\n  parseDimensionArrayFormat,\n} from './parser/dimension';\n\nexport type CSSGlobalKeywords = 'unset' | 'initial' | 'inherit' | '';\n\n/**\n * Blink used them in code generation(css_properties.json5)\n */\nexport const BUILT_IN_PROPERTIES: PropertyMetadata[] = [\n  {\n    /**\n     * used in CSS Layout API\n     * eg. `display: 'flex'`\n     */\n    n: 'display',\n    k: ['none'],\n  },\n  {\n    /**\n     * range [0.0, 1.0]\n     * @see https://developer.mozilla.org/en-US/docs/Web/CSS/opacity\n     */\n    n: 'opacity',\n    int: true,\n    inh: true,\n    d: '1',\n    syntax: PropertySyntax.OPACITY_VALUE,\n  },\n  {\n    /**\n     * inheritable, range [0.0, 1.0]\n     * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/fill-opacity\n     * @see https://svgwg.org/svg2-draft/painting.html#FillOpacity\n     */\n    n: 'fillOpacity',\n    int: true,\n    inh: true,\n    d: '1',\n    syntax: PropertySyntax.OPACITY_VALUE,\n  },\n  {\n    /**\n     * inheritable, range [0.0, 1.0]\n     * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-opacity\n     * @see https://svgwg.org/svg2-draft/painting.html#StrokeOpacity\n     */\n    n: 'strokeOpacity',\n    int: true,\n    inh: true,\n    d: '1',\n    syntax: PropertySyntax.OPACITY_VALUE,\n  },\n  {\n    /**\n     * background-color is not inheritable\n     * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Fills_and_Strokes\n     */\n    n: 'fill',\n    int: true,\n    k: ['none'],\n    d: 'none',\n    syntax: PropertySyntax.PAINT,\n  },\n  {\n    n: 'fillRule',\n    k: ['nonzero', 'evenodd'],\n    d: 'nonzero',\n  },\n  /**\n   * default to none\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke#usage_notes\n   */\n  {\n    n: 'stroke',\n    int: true,\n    k: ['none'],\n    d: 'none',\n    syntax: PropertySyntax.PAINT,\n    /**\n     * Stroke 'none' won't affect geometry but others will.\n     */\n    l: true,\n  },\n  {\n    n: 'shadowType',\n    k: ['inner', 'outer', 'both'],\n    d: 'outer',\n    l: true,\n  },\n  {\n    n: 'shadowColor',\n    int: true,\n    syntax: PropertySyntax.COLOR,\n  },\n  {\n    n: 'shadowOffsetX',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'shadowOffsetY',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'shadowBlur',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.SHADOW_BLUR,\n  },\n  {\n    /**\n     * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-width\n     */\n    n: 'lineWidth',\n    int: true,\n    inh: true,\n    d: '1',\n    l: true,\n    a: ['strokeWidth'],\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'increasedLineWidthForHitTesting',\n    inh: true,\n    d: '0',\n    l: true,\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'lineJoin',\n    inh: true,\n    l: true,\n    a: ['strokeLinejoin'],\n    k: ['miter', 'bevel', 'round'],\n    d: 'miter',\n  },\n  {\n    n: 'lineCap',\n    inh: true,\n    l: true,\n    a: ['strokeLinecap'],\n    k: ['butt', 'round', 'square'],\n    d: 'butt',\n  },\n  {\n    n: 'lineDash',\n    int: true,\n    inh: true,\n    k: ['none'],\n    a: ['strokeDasharray'],\n    syntax: PropertySyntax.LENGTH_PERCENTAGE_12,\n  },\n  {\n    n: 'lineDashOffset',\n    int: true,\n    inh: true,\n    d: '0',\n    a: ['strokeDashoffset'],\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'offsetPath',\n    syntax: PropertySyntax.DEFINED_PATH,\n  },\n  {\n    n: 'offsetDistance',\n    int: true,\n    syntax: PropertySyntax.OFFSET_DISTANCE,\n  },\n  {\n    n: 'dx',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'dy',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'zIndex',\n    ind: true,\n    int: true,\n    d: '0',\n    k: ['auto'],\n    syntax: PropertySyntax.Z_INDEX,\n  },\n  {\n    n: 'visibility',\n    k: ['visible', 'hidden'],\n    ind: true,\n    inh: true,\n    /**\n     * support interpolation\n     * @see https://developer.mozilla.org/en-US/docs/Web/CSS/visibility#interpolation\n     */\n    int: true,\n    d: 'visible',\n  },\n  {\n    n: 'pointerEvents',\n    inh: true,\n    k: [\n      'none',\n      'auto',\n      'stroke',\n      'fill',\n      'painted',\n      'visible',\n      'visiblestroke',\n      'visiblefill',\n      'visiblepainted',\n      // 'bounding-box',\n      'all',\n    ],\n    d: 'auto',\n  },\n  {\n    n: 'filter',\n    ind: true,\n    l: true,\n    k: ['none'],\n    d: 'none',\n    syntax: PropertySyntax.FILTER,\n  },\n  {\n    n: 'clipPath',\n    syntax: PropertySyntax.DEFINED_PATH,\n  },\n  {\n    n: 'textPath',\n    syntax: PropertySyntax.DEFINED_PATH,\n  },\n  {\n    n: 'textPathSide',\n    k: ['left', 'right'],\n    d: 'left',\n  },\n  {\n    n: 'textPathStartOffset',\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'transform',\n    p: 100,\n    int: true,\n    k: ['none'],\n    d: 'none',\n    syntax: PropertySyntax.TRANSFORM,\n  },\n  {\n    n: 'transformOrigin',\n    p: 100,\n    d: '0 0',\n    // // int: true,\n    // d: (nodeName: string) => {\n    //   if (nodeName === Shape.CIRCLE || nodeName === Shape.ELLIPSE) {\n    //     return 'center';\n    //   }\n    //   if (nodeName === Shape.TEXT) {\n    //     return 'text-anchor';\n    //   }\n    //   return 'left top';\n    // },\n    l: true,\n    syntax: PropertySyntax.TRANSFORM_ORIGIN,\n  },\n  {\n    n: 'cx',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'cy',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'cz',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'r',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'rx',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'ry',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  // Rect Image Group\n  {\n    // x in local space\n    n: 'x',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    // y in local space\n    n: 'y',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    // z in local space\n    n: 'z',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'width',\n    int: true,\n    l: true,\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/width\n     */\n    k: ['auto', 'fit-content', 'min-content', 'max-content'],\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'height',\n    int: true,\n    l: true,\n    /**\n     * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/height\n     */\n    k: ['auto', 'fit-content', 'min-content', 'max-content'],\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'radius',\n    int: true,\n    l: true,\n    d: '0',\n    syntax: PropertySyntax.LENGTH_PERCENTAGE_14,\n  },\n  // Line\n  {\n    n: 'x1',\n    int: true,\n    l: true,\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'y1',\n    int: true,\n    l: true,\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'z1',\n    int: true,\n    l: true,\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'x2',\n    int: true,\n    l: true,\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'y2',\n    int: true,\n    l: true,\n    syntax: PropertySyntax.COORDINATE,\n  },\n  {\n    n: 'z2',\n    int: true,\n    l: true,\n    syntax: PropertySyntax.COORDINATE,\n  },\n  // Path\n  {\n    n: 'd',\n    int: true,\n    l: true,\n    d: '',\n    syntax: PropertySyntax.PATH,\n    p: 50,\n  },\n  // Polyline & Polygon\n  {\n    n: 'points',\n    /**\n     * support interpolation\n     */\n    int: true,\n    l: true,\n    syntax: PropertySyntax.LIST_OF_POINTS,\n    p: 50,\n  },\n  // Text\n  {\n    n: 'text',\n    l: true,\n    d: '',\n    syntax: PropertySyntax.TEXT,\n    p: 50,\n  },\n  {\n    n: 'textTransform',\n    l: true,\n    inh: true,\n    k: ['capitalize', 'uppercase', 'lowercase', 'none'],\n    d: 'none',\n    syntax: PropertySyntax.TEXT_TRANSFORM,\n    p: 51, // it must get parsed after text\n  },\n  {\n    n: 'font',\n    l: true,\n  },\n  {\n    n: 'fontSize',\n    int: true,\n    inh: true,\n    /**\n     * @see https://www.w3schools.com/css/css_font_size.asp\n     */\n    d: '16px',\n    l: true,\n    syntax: PropertySyntax.LENGTH_PERCENTAGE,\n  },\n  {\n    n: 'fontFamily',\n    l: true,\n    inh: true,\n    d: 'sans-serif',\n  },\n  {\n    n: 'fontStyle',\n    l: true,\n    inh: true,\n    k: ['normal', 'italic', 'oblique'],\n    d: 'normal',\n  },\n  {\n    n: 'fontWeight',\n    l: true,\n    inh: true,\n    k: ['normal', 'bold', 'bolder', 'lighter'],\n    d: 'normal',\n  },\n  {\n    n: 'fontVariant',\n    l: true,\n    inh: true,\n    k: ['normal', 'small-caps'],\n    d: 'normal',\n  },\n  {\n    n: 'lineHeight',\n    l: true,\n    syntax: PropertySyntax.LENGTH,\n    int: true,\n    d: '0',\n  },\n  {\n    n: 'letterSpacing',\n    l: true,\n    syntax: PropertySyntax.LENGTH,\n    int: true,\n    d: '0',\n  },\n  {\n    n: 'miterLimit',\n    l: true,\n    syntax: PropertySyntax.NUMBER,\n    d: (nodeName: string) => {\n      if (\n        nodeName === Shape.PATH ||\n        nodeName === Shape.POLYGON ||\n        nodeName === Shape.POLYLINE\n      ) {\n        return '4';\n      }\n      return '10';\n    },\n  },\n  {\n    n: 'wordWrap',\n    l: true,\n  },\n  {\n    n: 'wordWrapWidth',\n    l: true,\n  },\n  {\n    n: 'maxLines',\n    l: true,\n  },\n  {\n    n: 'textOverflow',\n    l: true,\n    d: 'clip',\n  },\n  {\n    n: 'leading',\n    l: true,\n  },\n  {\n    n: 'textBaseline',\n    l: true,\n    inh: true,\n    k: ['top', 'hanging', 'middle', 'alphabetic', 'ideographic', 'bottom'],\n    d: 'alphabetic',\n  },\n  {\n    n: 'textAlign',\n    l: true,\n    inh: true,\n    k: ['start', 'center', 'middle', 'end', 'left', 'right'],\n    d: 'start',\n  },\n  // {\n  //   n: 'whiteSpace',\n  //   l: true,\n  // },\n  {\n    n: 'markerStart',\n    syntax: PropertySyntax.MARKER,\n  },\n  {\n    n: 'markerEnd',\n    syntax: PropertySyntax.MARKER,\n  },\n  {\n    n: 'markerMid',\n    syntax: PropertySyntax.MARKER,\n  },\n  {\n    n: 'markerStartOffset',\n    syntax: PropertySyntax.LENGTH,\n    l: true,\n    int: true,\n    d: '0',\n  },\n  {\n    n: 'markerEndOffset',\n    syntax: PropertySyntax.LENGTH,\n    l: true,\n    int: true,\n    d: '0',\n  },\n];\n\nconst GEOMETRY_ATTRIBUTE_NAMES = BUILT_IN_PROPERTIES.filter((n) => !!n.l).map(\n  (n) => n.n,\n);\n\nexport const propertyMetadataCache: Record<string, PropertyMetadata> = {};\n\nexport class DefaultStyleValueRegistry implements StyleValueRegistry {\n  constructor(private runtime: GlobalRuntime) {\n    BUILT_IN_PROPERTIES.forEach((property) => {\n      this.registerMetadata(property);\n    });\n  }\n\n  registerMetadata(metadata: PropertyMetadata) {\n    [metadata.n, ...(metadata.a || [])].forEach((name) => {\n      propertyMetadataCache[name] = metadata;\n    });\n  }\n\n  getPropertySyntax(syntax: string) {\n    return this.runtime.CSSPropertySyntaxFactory[syntax];\n  }\n\n  /**\n   * * parse value, eg.\n   * fill: 'red' => CSSRGB\n   * translateX: '10px' => CSSUnitValue { unit: 'px', value: 10 }\n   * fontSize: '2em' => { unit: 'px', value: 32 }\n   *\n   * * calculate used value\n   * * post process\n   */\n  processProperties(\n    object: DisplayObject,\n    attributes: BaseStyleProps,\n    options: Partial<PropertyParseOptions> = {\n      skipUpdateAttribute: false,\n      skipParse: false,\n      forceUpdateGeometry: false,\n      usedAttributes: [],\n      memoize: true,\n    },\n  ) {\n    Object.assign(object.attributes, attributes);\n\n    // clipPath\n    const oldClipPath = object.parsedStyle.clipPath;\n    const oldOffsetPath = object.parsedStyle.offsetPath;\n\n    Object.assign(object.parsedStyle, attributes);\n\n    let needUpdateGeometry = !!options.forceUpdateGeometry;\n\n    if (\n      !needUpdateGeometry &&\n      GEOMETRY_ATTRIBUTE_NAMES.some((name) => name in attributes)\n    ) {\n      needUpdateGeometry = true;\n    }\n\n    if (attributes.fill) {\n      object.parsedStyle.fill = parseColor(attributes.fill);\n    }\n    if (attributes.stroke) {\n      object.parsedStyle.stroke = parseColor(attributes.stroke);\n    }\n    if (attributes.shadowColor) {\n      object.parsedStyle.shadowColor = parseColor(attributes.shadowColor);\n    }\n    if (attributes.filter) {\n      object.parsedStyle.filter = parseFilter(attributes.filter);\n    }\n    // Rect\n    // @ts-ignore\n    if (!isNil(attributes.radius)) {\n      // @ts-ignore\n      object.parsedStyle.radius = parseDimensionArrayFormat(\n        // @ts-ignore\n        attributes.radius,\n        4,\n      );\n    }\n    // Polyline\n    if (!isNil(attributes.lineDash)) {\n      object.parsedStyle.lineDash = parseDimensionArrayFormat(\n        attributes.lineDash,\n        2,\n      );\n    }\n    // @ts-ignore\n    if (attributes.points) {\n      // @ts-ignore\n      object.parsedStyle.points = parsePoints(attributes.points, object);\n    }\n    // Path\n    // @ts-ignore\n    if (attributes.d === '') {\n      object.parsedStyle.d = {\n        ...EMPTY_PARSED_PATH,\n      };\n    }\n    // @ts-ignore\n    if (attributes.d) {\n      object.parsedStyle.d = parsePath(\n        // @ts-ignore\n        attributes.d,\n      );\n    }\n    // Text\n    if (attributes.textTransform) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.TEXT_TRANSFORM\n      ].calculator(\n        null,\n        null,\n        { value: attributes.textTransform },\n        object,\n        null,\n      );\n    }\n    if (!isUndefined(attributes.clipPath)) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.DEFINED_PATH\n      ].calculator(\n        'clipPath',\n        oldClipPath,\n        attributes.clipPath,\n        object,\n        this.runtime,\n      );\n    }\n    if (attributes.offsetPath) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.DEFINED_PATH\n      ].calculator(\n        'offsetPath',\n        oldOffsetPath,\n        attributes.offsetPath,\n        object,\n        this.runtime,\n      );\n    }\n    if (attributes.transform) {\n      object.parsedStyle.transform = parseTransform(attributes.transform);\n    }\n    if (attributes.transformOrigin) {\n      object.parsedStyle.transformOrigin = parseTransformOrigin(\n        attributes.transformOrigin,\n      );\n    }\n    // Marker\n    // @ts-ignore\n    if (attributes.markerStart) {\n      object.parsedStyle.markerStart = this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.MARKER\n      ].calculator(\n        null,\n        // @ts-ignore\n        attributes.markerStart,\n        // @ts-ignore\n        attributes.markerStart,\n        null,\n        null,\n      );\n    }\n    // @ts-ignore\n    if (attributes.markerEnd) {\n      object.parsedStyle.markerEnd = this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.MARKER\n      ].calculator(\n        null,\n        // @ts-ignore\n        attributes.markerEnd,\n        // @ts-ignore\n        attributes.markerEnd,\n        null,\n        null,\n      );\n    }\n    // @ts-ignore\n    if (attributes.markerMid) {\n      object.parsedStyle.markerMid = this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.MARKER\n      ].calculator(\n        '',\n        // @ts-ignore\n        attributes.markerMid,\n        // @ts-ignore\n        attributes.markerMid,\n        null,\n        null,\n      );\n    }\n\n    if (!isNil(attributes.zIndex)) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.Z_INDEX\n      ].postProcessor(object);\n    }\n    if (!isNil(attributes.offsetDistance)) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.OFFSET_DISTANCE\n      ].postProcessor(object);\n    }\n    if (attributes.transform) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.TRANSFORM\n      ].postProcessor(object);\n    }\n    if (attributes.transformOrigin) {\n      this.runtime.CSSPropertySyntaxFactory[\n        PropertySyntax.TRANSFORM_ORIGIN\n      ].postProcessor(object);\n    }\n\n    if (needUpdateGeometry) {\n      object.geometry.dirty = true;\n      object.renderable.boundsDirty = true;\n      object.renderable.renderBoundsDirty = true;\n\n      if (!options.forceUpdateGeometry) {\n        this.runtime.sceneGraphService.dirtifyToRoot(object);\n      }\n    }\n  }\n\n  /**\n   * update geometry when relative props changed,\n   * eg. r of Circle, width/height of Rect\n   */\n  updateGeometry(object: DisplayObject) {\n    const { nodeName } = object;\n    const geometryUpdater = this.runtime.geometryUpdaterFactory[\n      nodeName\n    ] as GeometryAABBUpdater;\n    if (geometryUpdater) {\n      const { geometry } = object;\n      if (!geometry.contentBounds) {\n        geometry.contentBounds = new AABB();\n      }\n      if (!geometry.renderBounds) {\n        geometry.renderBounds = new AABB();\n      }\n      const parsedStyle = object.parsedStyle as ParsedBaseStyleProps;\n      const {\n        cx = 0,\n        cy = 0,\n        cz = 0,\n        hwidth = 0,\n        hheight = 0,\n        hdepth = 0,\n      } = geometryUpdater.update(parsedStyle, object);\n      // init with content box\n      const halfExtents: Tuple3Number = [\n        Math.abs(hwidth),\n        Math.abs(hheight),\n        hdepth,\n      ];\n      // anchor is center by default, don't account for lineWidth here\n      const {\n        stroke,\n        lineWidth = 1,\n        // lineCap,\n        // lineJoin,\n        // miterLimit,\n        increasedLineWidthForHitTesting = 0,\n        shadowType = 'outer',\n        shadowColor,\n        filter = [],\n        transformOrigin,\n      } = parsedStyle;\n      const center: Tuple3Number = [cx, cy, cz];\n      // update geometry's AABB\n      geometry.contentBounds.update(center, halfExtents);\n      // @see https://github.molgen.mpg.de/git-mirror/cairo/blob/master/src/cairo-stroke-style.c#L97..L128\n      const expansion =\n        nodeName === Shape.POLYLINE ||\n        nodeName === Shape.POLYGON ||\n        nodeName === Shape.PATH\n          ? Math.SQRT2\n          : 0.5;\n      // append border only if stroke existed\n      const hasStroke = stroke && !(stroke as CSSRGB).isNone;\n      if (hasStroke) {\n        const halfLineWidth =\n          ((lineWidth || 0) + (increasedLineWidthForHitTesting || 0)) *\n          expansion;\n        halfExtents[0] += halfLineWidth;\n        halfExtents[1] += halfLineWidth;\n      }\n      geometry.renderBounds.update(center, halfExtents);\n      // account for shadow, only support constant value now\n      if (shadowColor && shadowType && shadowType !== 'inner') {\n        const { min, max } = geometry.renderBounds;\n        const { shadowBlur, shadowOffsetX, shadowOffsetY } = parsedStyle;\n        const shadowBlurInPixels = shadowBlur || 0;\n        const shadowOffsetXInPixels = shadowOffsetX || 0;\n        const shadowOffsetYInPixels = shadowOffsetY || 0;\n        const shadowLeft = min[0] - shadowBlurInPixels + shadowOffsetXInPixels;\n        const shadowRight = max[0] + shadowBlurInPixels + shadowOffsetXInPixels;\n        const shadowTop = min[1] - shadowBlurInPixels + shadowOffsetYInPixels;\n        const shadowBottom =\n          max[1] + shadowBlurInPixels + shadowOffsetYInPixels;\n        min[0] = Math.min(min[0], shadowLeft);\n        max[0] = Math.max(max[0], shadowRight);\n        min[1] = Math.min(min[1], shadowTop);\n        max[1] = Math.max(max[1], shadowBottom);\n        geometry.renderBounds.setMinMax(min, max);\n      }\n      // account for filter, eg. blur(5px), drop-shadow()\n      filter.forEach(({ name, params }) => {\n        if (name === 'blur') {\n          const blurRadius = params[0].value;\n          geometry.renderBounds.update(\n            geometry.renderBounds.center,\n            vec3.add(\n              geometry.renderBounds.halfExtents,\n              geometry.renderBounds.halfExtents,\n              [blurRadius, blurRadius, 0],\n            ) as Tuple3Number,\n          );\n        } else if (name === 'drop-shadow') {\n          const shadowOffsetX = params[0].value;\n          const shadowOffsetY = params[1].value;\n          const shadowBlur = params[2].value;\n          const { min, max } = geometry.renderBounds;\n          const shadowLeft = min[0] - shadowBlur + shadowOffsetX;\n          const shadowRight = max[0] + shadowBlur + shadowOffsetX;\n          const shadowTop = min[1] - shadowBlur + shadowOffsetY;\n          const shadowBottom = max[1] + shadowBlur + shadowOffsetY;\n          min[0] = Math.min(min[0], shadowLeft);\n          max[0] = Math.max(max[0], shadowRight);\n          min[1] = Math.min(min[1], shadowTop);\n          max[1] = Math.max(max[1], shadowBottom);\n          geometry.renderBounds.setMinMax(min, max);\n        }\n      });\n\n      object.geometry.dirty = false;\n\n      // @see https://github.com/antvis/g/issues/957\n      const flipY = hwidth < 0;\n      const flipX = hheight < 0;\n      // set transform origin\n      const usedOriginXValue =\n        (flipY ? -1 : 1) *\n        (transformOrigin\n          ? convertPercentUnit(transformOrigin[0], 0, object, true)\n          : 0);\n      const usedOriginYValue =\n        (flipX ? -1 : 1) *\n        (transformOrigin\n          ? convertPercentUnit(transformOrigin[1], 1, object, true)\n          : 0);\n\n      if (usedOriginXValue || usedOriginYValue) {\n        object.setOrigin(usedOriginXValue, usedOriginYValue);\n      }\n    }\n  }\n\n  updateSizeAttenuation(node: DisplayObject, zoom: number) {\n    if (node.style.isSizeAttenuation) {\n      if (!node.style.rawLineWidth) {\n        node.style.rawLineWidth = node.style.lineWidth;\n      }\n      node.style.lineWidth = (node.style.rawLineWidth || 1) / zoom;\n\n      if (node.nodeName === Shape.CIRCLE) {\n        if (!node.style.rawR) {\n          node.style.rawR = node.style.r;\n        }\n        node.style.r = (node.style.rawR || 1) / zoom;\n      }\n    } else {\n      if (node.style.rawLineWidth) {\n        node.style.lineWidth = node.style.rawLineWidth;\n        delete node.style.rawLineWidth;\n      }\n      if (node.nodeName === Shape.CIRCLE) {\n        if (node.style.rawR) {\n          node.style.r = node.style.rawR;\n          delete node.style.rawR;\n        }\n      }\n    }\n  }\n}\n","import type { DisplayObject } from '../../display-objects';\nimport type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { mergeNumbers } from '../parser';\nimport { convertAngleUnit } from '../parser/dimension';\n\nexport class CSSPropertyAngle\n  implements Partial<CSSProperty<CSSUnitValue, number>>\n{\n  mixer = mergeNumbers;\n\n  calculator(\n    name: string,\n    oldParsed: CSSUnitValue,\n    parsed: CSSUnitValue,\n    object: DisplayObject,\n  ) {\n    return convertAngleUnit(parsed);\n  }\n}\n","import type { DisplayObject } from '../../display-objects';\nimport type { GlobalRuntime } from '../../global-runtime';\nimport type { CSSProperty } from '../CSSProperty';\nimport { CSSKeywordValue } from '../cssom';\n\n/**\n * clipPath / textPath / offsetPath\n */\nexport class CSSPropertyClipPath\n  implements Partial<CSSProperty<DisplayObject, DisplayObject>>\n{\n  calculator(\n    name: string,\n    oldPath: DisplayObject,\n    newPath: DisplayObject,\n    object: DisplayObject,\n    runtime: GlobalRuntime,\n  ) {\n    // unset\n    if (newPath instanceof CSSKeywordValue) {\n      newPath = null;\n    }\n\n    runtime.sceneGraphService.updateDisplayObjectDependency(\n      name,\n      oldPath,\n      newPath,\n      object,\n    );\n\n    if (name === 'clipPath') {\n      // should affect children\n      object.forEach((leaf) => {\n        if (leaf.childNodes.length === 0) {\n          runtime.sceneGraphService.dirtifyToRoot(leaf);\n        }\n      });\n    }\n\n    return newPath;\n  }\n}\n","import type { DisplayObject } from '../../display-objects';\nimport type { CSSGradientValue, CSSRGB } from '../cssom';\nimport { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { noneColor, transparentColor } from '../CSSStyleValuePool';\nimport type { Pattern } from '../parser/color';\nimport { mergeColors, parseColor } from '../parser/color';\n\nexport class CSSPropertyColor\n  implements\n    Partial<\n      CSSProperty<\n        CSSRGB | CSSGradientValue[] | Pattern | CSSKeywordValue,\n        CSSRGB | CSSGradientValue[] | Pattern\n      >\n    >\n{\n  parser = parseColor;\n  calculator(\n    name: string,\n    oldParsed: CSSRGB | CSSGradientValue[] | CSSKeywordValue | Pattern,\n    parsed: CSSRGB | CSSGradientValue[] | CSSKeywordValue | Pattern,\n    object: DisplayObject,\n  ) {\n    if (parsed instanceof CSSKeywordValue) {\n      // 'unset' 'none'\n      return parsed.value === 'none' ? noneColor : transparentColor;\n    }\n    return parsed;\n  }\n\n  mixer = mergeColors;\n}\n","import { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport type { ParsedFilterStyleProperty } from '../parser';\n\nexport class CSSPropertyFilter\n  implements\n    Partial<\n      CSSProperty<ParsedFilterStyleProperty[], ParsedFilterStyleProperty[]>\n    >\n{\n  calculator(\n    name: string,\n    oldParsed: ParsedFilterStyleProperty[],\n    parsed: ParsedFilterStyleProperty[],\n  ) {\n    // unset or none\n    if (parsed instanceof CSSKeywordValue) {\n      return [];\n    }\n    return parsed;\n  }\n}\n","import { isNil, isNumber } from '@antv/util';\nimport type {\n  DisplayObject,\n  ParsedTextStyleProps,\n} from '../../display-objects';\nimport type { GlobalRuntime } from '../../global-runtime';\nimport type { CSSProperty } from '../CSSProperty';\nimport { CSSUnitValue, UnitType } from '../cssom';\nimport { mergeNumbers } from '../parser';\n\nfunction getFontSize(object: DisplayObject): number {\n  const { fontSize } = object.parsedStyle as ParsedTextStyleProps;\n  return isNil(fontSize) ? null : fontSize;\n}\n\n/**\n * <length> & <percentage>\n */\nexport class CSSPropertyLengthOrPercentage\n  implements Partial<CSSProperty<CSSUnitValue, number>>\n{\n  mixer = mergeNumbers;\n\n  /**\n   * according to parent's bounds\n   *\n   * @example\n   * CSS.percent(50) -> CSS.px(0.5 * parent.width)\n   */\n  calculator(\n    name: string,\n    oldParsed: CSSUnitValue,\n    computed: CSSUnitValue,\n    object: DisplayObject,\n    runtime: GlobalRuntime,\n  ): number {\n    if (isNumber(computed)) {\n      return computed;\n    }\n\n    if (CSSUnitValue.isRelativeUnit(computed.unit)) {\n      if (computed.unit === UnitType.kPercentage) {\n        // TODO: merge dimensions\n        return 0;\n      }\n      if (computed.unit === UnitType.kEms) {\n        if (object.parentNode) {\n          let fontSize = getFontSize(object.parentNode as DisplayObject);\n          if (fontSize) {\n            fontSize *= computed.value;\n            return fontSize;\n          }\n        }\n        return 0;\n      }\n      if (computed.unit === UnitType.kRems) {\n        if (object?.ownerDocument?.documentElement) {\n          let fontSize = getFontSize(\n            object.ownerDocument.documentElement as DisplayObject,\n          );\n\n          if (fontSize) {\n            fontSize *= computed.value;\n            return fontSize;\n          }\n        }\n        return 0;\n      }\n    } else {\n      // remove listener if exists\n      // registry.unregisterParentGeometryBoundsChangedHandler(object, name);\n\n      // return absolute value\n      return computed.value;\n    }\n  }\n}\n","import type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { mergeNumberLists } from '../parser';\n\n/**\n * format to Tuple2<CSSUnitValue>\n *\n * @example\n * rect.style.lineDash = 10;\n * rect.style.lineDash = [10, 10];\n * rect.style.lineDash = '10 10';\n */\nexport class CSSPropertyLengthOrPercentage12\n  implements\n    Partial<CSSProperty<[CSSUnitValue, CSSUnitValue], [number, number]>>\n{\n  calculator(\n    name: string,\n    oldParsed: [CSSUnitValue, CSSUnitValue],\n    computed: [CSSUnitValue, CSSUnitValue],\n  ): [number, number] {\n    return computed.map((c) => c.value) as [number, number];\n  }\n\n  mixer = mergeNumberLists;\n}\n","import type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { mergeNumberLists } from '../parser';\n\n/**\n * used in rounded rect\n *\n * @example\n * rect.style.radius = 10;\n * rect.style.radius = '10 10';\n * rect.style.radius = '10 10 10 10';\n */\nexport class CSSPropertyLengthOrPercentage14\n  implements\n    Partial<\n      CSSProperty<\n        [CSSUnitValue, CSSUnitValue, CSSUnitValue, CSSUnitValue],\n        [number, number, number, number]\n      >\n    >\n{\n  calculator(\n    name: string,\n    oldParsed: [CSSUnitValue, CSSUnitValue, CSSUnitValue, CSSUnitValue],\n    computed: [CSSUnitValue, CSSUnitValue, CSSUnitValue, CSSUnitValue],\n  ): [number, number, number, number] {\n    return computed.map((c) => c.value) as [number, number, number, number];\n  }\n\n  mixer = mergeNumberLists;\n}\n","import type { DisplayObject } from '../../display-objects';\nimport { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\n\nexport class CSSPropertyMarker\n  implements Partial<CSSProperty<DisplayObject, DisplayObject>>\n{\n  calculator(\n    name: string,\n    oldMarker: DisplayObject,\n    newMarker: DisplayObject,\n    object: DisplayObject,\n  ) {\n    // unset\n    if (newMarker instanceof CSSKeywordValue) {\n      newMarker = null;\n    }\n\n    const cloned = newMarker?.cloneNode(true);\n    if (cloned) {\n      // FIXME: SVG should not inherit parent's style, add a flag here\n      cloned.style.isMarker = true;\n    }\n\n    return cloned;\n  }\n}\n","import type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { mergeNumbers } from '../parser/numeric';\n\nexport class CSSPropertyNumber\n  implements Partial<CSSProperty<CSSUnitValue, number>>\n{\n  mixer = mergeNumbers;\n  calculator(\n    name: string,\n    oldParsed: CSSUnitValue,\n    computed: CSSUnitValue,\n  ): number {\n    return computed.value;\n  }\n}\n","import { Shape } from '../../types';\nimport type { DisplayObject } from '../../display-objects';\nimport type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { clampedMergeNumbers } from '../parser/numeric';\n\nexport class CSSPropertyOffsetDistance\n  implements Partial<CSSProperty<CSSUnitValue, number>>\n{\n  calculator(\n    name: string,\n    oldParsed: CSSUnitValue,\n    computed: CSSUnitValue,\n  ): number {\n    return computed.value;\n  }\n\n  mixer = clampedMergeNumbers(0, 1);\n\n  postProcessor(object: DisplayObject) {\n    const { offsetPath, offsetDistance } = object.parsedStyle;\n    if (!offsetPath) {\n      return;\n    }\n\n    const { nodeName } = offsetPath;\n    if (\n      nodeName === Shape.LINE ||\n      nodeName === Shape.PATH ||\n      nodeName === Shape.POLYLINE\n    ) {\n      // set position in world space\n      const point = offsetPath.getPoint(offsetDistance);\n      if (point) {\n        object.setLocalPosition(point.x, point.y);\n      }\n    }\n  }\n}\n","import type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { clampedMergeNumbers } from '../parser/numeric';\n\n/**\n * opacity\n */\nexport class CSSPropertyOpacity\n  implements Partial<CSSProperty<CSSUnitValue, number>>\n{\n  calculator(\n    name: string,\n    oldParsed: CSSUnitValue,\n    computed: CSSUnitValue,\n  ): number {\n    return computed.value;\n  }\n\n  mixer = clampedMergeNumbers(0, 1);\n}\n","import type { AbsoluteArray } from '@antv/util';\nimport type { ParsedPathStyleProps } from '../../display-objects';\nimport { Rectangle } from '../../shapes';\nimport { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport { mergePaths, parsePath } from '../parser/path';\n\nexport class CSSPropertyPath\n  implements\n    Partial<CSSProperty<ParsedPathStyleProps['d'], ParsedPathStyleProps['d']>>\n{\n  /**\n   * path2Curve\n   */\n  parser = parsePath;\n\n  calculator(\n    name: string,\n    oldParsed: ParsedPathStyleProps['d'],\n    parsed: ParsedPathStyleProps['d'],\n  ) {\n    // unset\n    if (parsed instanceof CSSKeywordValue && parsed.value === 'unset') {\n      return {\n        absolutePath: [] as unknown as AbsoluteArray,\n        hasArc: false,\n        segments: [],\n        polygons: [],\n        polylines: [],\n        curve: null,\n        totalLength: 0,\n        rect: new Rectangle(0, 0, 0, 0),\n      };\n    }\n\n    return parsed;\n  }\n\n  mixer = mergePaths;\n}\n","import type { CSSProperty } from '../CSSProperty';\nimport { mergePoints } from '../parser/points';\n\nexport class CSSPropertyPoints\n  implements\n    Partial<\n      CSSProperty<\n        {\n          points: [number, number][];\n          totalLength: number;\n          segments: [number, number][];\n        },\n        {\n          points: [number, number][];\n          totalLength: number;\n          segments: [number, number][];\n        }\n      >\n    >\n{\n  mixer = mergePoints;\n}\n","import { clampedMergeNumbers } from '../parser/numeric';\nimport { CSSPropertyLengthOrPercentage } from './CSSPropertyLengthOrPercentage';\n\nexport class CSSPropertyShadowBlur extends CSSPropertyLengthOrPercentage {\n  mixer = clampedMergeNumbers(0, Infinity);\n}\n","import type { DisplayObject } from '../../display-objects';\nimport { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\n\nexport class CSSPropertyText\n  implements Partial<CSSProperty<CSSKeywordValue | string, string>>\n{\n  calculator(\n    name: string,\n    oldParsed: CSSKeywordValue | string,\n    parsed: CSSKeywordValue | string,\n    object: DisplayObject,\n  ) {\n    if (parsed instanceof CSSKeywordValue) {\n      if (parsed.value === 'unset') {\n        return '';\n      }\n      return parsed.value;\n    }\n\n    // allow number as valid text content\n    return `${parsed}`;\n  }\n\n  postProcessor(object: DisplayObject) {\n    object.nodeValue = `${object.parsedStyle.text}` || '';\n  }\n}\n","import type { TextTransform } from '../..';\nimport type { DisplayObject } from '../../display-objects';\nimport type { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\n\n/**\n * it must transform after text get parsed\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/text-transform\n */\nexport class CSSPropertyTextTransform\n  implements Partial<CSSProperty<CSSKeywordValue, TextTransform>>\n{\n  calculator(\n    name: string,\n    oldParsed: CSSKeywordValue,\n    parsed: CSSKeywordValue,\n    object: DisplayObject,\n  ) {\n    const rawText = object.getAttribute('text');\n    if (rawText) {\n      let transformedText = rawText;\n      if (parsed.value === 'capitalize') {\n        transformedText = rawText.charAt(0).toUpperCase() + rawText.slice(1);\n      } else if (parsed.value === 'lowercase') {\n        transformedText = rawText.toLowerCase();\n      } else if (parsed.value === 'uppercase') {\n        transformedText = rawText.toUpperCase();\n      }\n\n      object.parsedStyle.text = transformedText;\n    }\n\n    return parsed.value as TextTransform;\n  }\n}\n","export const definedProps = (obj: Record<string, unknown>) =>\n  Object.fromEntries(Object.entries(obj).filter(([, v]) => v !== undefined));\n","import type { Canvas } from '../Canvas';\n\nconst CANVAS_Map = new WeakMap<Element, Canvas>();\n\n/**\n * destroy existed canvas with the same id\n */\nexport function cleanExistedCanvas(\n  container: string | HTMLElement,\n  canvas: Canvas,\n  cleanUp?: boolean,\n) {\n  if (container) {\n    const $dom =\n      typeof container === 'string'\n        ? document.getElementById(container)\n        : container;\n    if (CANVAS_Map.has($dom)) CANVAS_Map.get($dom).destroy(cleanUp);\n    CANVAS_Map.set($dom, canvas);\n  }\n}\n\nexport const isBrowser =\n  typeof window !== 'undefined' && typeof window.document !== 'undefined';\n","import type { DisplayObject } from '../display-objects';\nimport type { IElement, IEventTarget, INode } from '../dom';\nimport type { CanvasLike } from '../types';\nimport { isBrowser } from './canvas';\n\nexport function isElement(\n  target: IEventTarget | INode | IElement,\n): target is IElement {\n  return !!(target as IElement).getAttribute;\n}\n\nexport function sortedIndex(array: IElement[], value: IElement) {\n  let low = 0;\n  let high = array.length;\n\n  while (low < high) {\n    const mid = (low + high) >>> 1;\n    if (sortByZIndex(array[mid], value) < 0) {\n      low = mid + 1;\n    } else {\n      high = mid;\n    }\n  }\n  return low;\n}\n\nexport function sortByZIndex(o1: IElement, o2: IElement) {\n  const zIndex1 = Number(o1.parsedStyle.zIndex || 0);\n  const zIndex2 = Number(o2.parsedStyle.zIndex || 0);\n  if (zIndex1 === zIndex2) {\n    const parent = o1.parentNode;\n    if (parent) {\n      const children = parent.childNodes || [];\n      return children.indexOf(o1) - children.indexOf(o2);\n    }\n  }\n  return zIndex1 - zIndex2;\n}\n\nexport function findClosestClipPathTarget(\n  object: DisplayObject,\n): DisplayObject {\n  let el = object;\n  do {\n    const clipPath = el.parsedStyle?.clipPath;\n    if (clipPath) return el;\n    el = el.parentElement as DisplayObject;\n  } while (el !== null);\n  return null;\n}\n\nconst PX_SUFFIX = 'px';\nexport function setDOMSize($el: CanvasLike, width: number, height: number) {\n  if (isBrowser && ($el as unknown as HTMLElement).style) {\n    ($el as unknown as HTMLElement).style.width = width + PX_SUFFIX;\n    ($el as unknown as HTMLElement).style.height = height + PX_SUFFIX;\n  }\n}\n\nexport function getStyle($el: HTMLElement | CanvasLike, property: string) {\n  if (isBrowser) {\n    return document.defaultView\n      .getComputedStyle($el as Element, null)\n      .getPropertyValue(property);\n  }\n}\n\nexport function getWidth($el: HTMLElement | CanvasLike) {\n  const width = getStyle($el, 'width');\n  if (width === 'auto') {\n    return ($el as HTMLElement).offsetWidth;\n  }\n  return parseFloat(width);\n}\n\nexport function getHeight($el: HTMLElement | CanvasLike) {\n  const height = getStyle($el, 'height');\n  if (height === 'auto') {\n    return ($el as HTMLElement).offsetHeight;\n  }\n  return parseFloat(height);\n}\n","// borrow from hammer.js\nexport const MOUSE_POINTER_ID = 1;\nexport const TOUCH_TO_POINTER: Record<string, string> = {\n  touchstart: 'pointerdown',\n  touchend: 'pointerup',\n  touchendoutside: 'pointerupoutside',\n  touchmove: 'pointermove',\n  touchcancel: 'pointercancel',\n};\n\nexport interface FormattedPointerEvent extends PointerEvent {\n  isPrimary: boolean;\n  width: number;\n  height: number;\n  tiltX: number;\n  tiltY: number;\n  pointerType: string;\n  pointerId: number;\n  pressure: number;\n  twist: number;\n  tangentialPressure: number;\n  isNormalized: boolean;\n  type: string;\n}\n\nexport interface FormattedTouch extends Touch {\n  button: number;\n  buttons: number;\n  isPrimary: boolean;\n  width: number;\n  height: number;\n  tiltX: number;\n  tiltY: number;\n  pointerType: string;\n  pointerId: number;\n  pressure: number;\n  twist: number;\n  tangentialPressure: number;\n  layerY: number;\n  offsetX: number;\n  offsetY: number;\n  isNormalized: boolean;\n  type: string;\n}\n\nexport const clock =\n  typeof performance === 'object' && performance.now ? performance : Date;\n","import { INode } from '../dom';\nimport { Shape } from '../types';\n\nexport function isInFragment(node: INode) {\n  if (node.nodeName === Shape.FRAGMENT) return true;\n  return node.getRootNode().nodeName === Shape.FRAGMENT;\n}\n","import type { CSSRGB } from '../css';\nimport type { ParsedBaseStyleProps } from '../types';\n\nexport function isFillOrStrokeAffected(\n  pointerEvents: ParsedBaseStyleProps['pointerEvents'] = 'auto',\n  fill: ParsedBaseStyleProps['fill'],\n  stroke: ParsedBaseStyleProps['stroke'],\n): [boolean, boolean] {\n  // account for pointerEvents\n  // @see https://developer.mozilla.org/en-US/docs/Web/CSS/pointer-events\n\n  let hasFill = false;\n  let hasStroke = false;\n  const isFillOtherThanNone = !!fill && !(fill as CSSRGB).isNone;\n  const isStrokeOtherThanNone = !!stroke && !(stroke as CSSRGB).isNone;\n  if (\n    pointerEvents === 'visiblepainted' ||\n    pointerEvents === 'painted' ||\n    pointerEvents === 'auto'\n  ) {\n    hasFill = isFillOtherThanNone;\n    hasStroke = isStrokeOtherThanNone;\n  } else if (pointerEvents === 'visiblefill' || pointerEvents === 'fill') {\n    hasFill = true;\n  } else if (pointerEvents === 'visiblestroke' || pointerEvents === 'stroke') {\n    hasStroke = true;\n  } else if (pointerEvents === 'visible' || pointerEvents === 'all') {\n    // The values of the fill and stroke do not affect event processing.\n    hasFill = true;\n    hasStroke = true;\n  }\n\n  return [hasFill, hasStroke];\n}\n","/**\n * Thanks for following contributor of codes\n * https://gist.github.com/1866474\n * http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n * http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n * https://github.com/Financial-Times/polyfill-library/blob/master/polyfills/requestAnimationFrame/polyfill.js\n * */\n\nlet uId = 1;\nconst uniqueId = () => uId++;\n\n// We use `self` instead of `window` for `WebWorker` support.\nexport const root: any =\n  // eslint-disable-next-line no-nested-ternary\n  typeof self === 'object' && self.self === self\n    ? self\n    : // @ts-ignore\n      typeof global === 'object' && global.global === global\n      ? // @ts-ignore\n        global\n      : {};\n\nconst nowOffset = Date.now();\n\n// use performance api if exist, otherwise use Date.now.\n// Date.now polyfill required.\nexport const pnow = (): number => {\n  if (root.performance && typeof root.performance.now === 'function') {\n    return root.performance.now();\n  }\n\n  // fallback\n  return Date.now() - nowOffset;\n};\n\ninterface IReservedCBs {\n  [key: string]: (...args: any[]) => any;\n}\nlet reservedCBs: IReservedCBs = {};\n\nlet lastTime = Date.now();\n\nconst polyfillRaf = (callback: (...args: any[]) => any) => {\n  if (typeof callback !== 'function') {\n    throw new TypeError(`${callback} is not a function`);\n  }\n\n  const currentTime = Date.now();\n  const gap = currentTime - lastTime;\n  const delay = gap > 16 ? 0 : 16 - gap;\n\n  const id = uniqueId();\n  reservedCBs[id] = callback;\n\n  // keys(reservedCBs).length > 1 의미는 이미 setTimeout 이 걸려있는 경우.\n  // 함께 callback 이 실행될 수 있게 reservedCBs 에만 추가해주고 return\n  if (Object.keys(reservedCBs).length > 1) return id;\n\n  setTimeout(() => {\n    lastTime = currentTime;\n    const copied = reservedCBs;\n    reservedCBs = {};\n\n    Object.keys(copied).forEach((key: string) => copied[key](pnow()));\n  }, delay);\n\n  return id;\n};\n\nconst polyfillCaf = (id: number) => {\n  delete reservedCBs[id];\n};\n\nconst vendorPrefixes = ['', 'webkit', 'moz', 'ms', 'o'];\n\ntype TRequestAnimationFrame = (callback: (...args: any[]) => any) => number;\ntype TCancelAnimationFrame = (id: number) => void;\n\nconst getRequestAnimationFrame = (\n  vp: string | void,\n): TRequestAnimationFrame => {\n  if (typeof vp !== 'string') return polyfillRaf;\n  if (vp === '') return root.requestAnimationFrame;\n  return root[`${vp}RequestAnimationFrame`];\n};\n\nconst getCancelAnimationFrame = (vp: string | void): TCancelAnimationFrame => {\n  if (typeof vp !== 'string') return polyfillCaf;\n  if (vp === '') return root.cancelAnimationFrame;\n  return (\n    root[`${vp}CancelAnimationFrame`] ||\n    root[`${vp}CancelRequestAnimationFrame`]\n  );\n};\n\nconst find = (arr: any[], predicate: (...args: any[]) => any) => {\n  let i = 0;\n  while (arr[i] !== undefined) {\n    if (predicate(arr[i])) return arr[i];\n\n    i += 1;\n  }\n};\n\nconst vp = find(vendorPrefixes, (vp: string) => !!getRequestAnimationFrame(vp));\n\nexport const raf: TRequestAnimationFrame = getRequestAnimationFrame(vp);\nexport const caf: TCancelAnimationFrame = getCancelAnimationFrame(vp);\n\nroot.requestAnimationFrame = raf;\nroot.cancelAnimationFrame = caf;\n","export class AsyncParallelHook<T> {\n  private callbacks: ((...args: T[]) => Promise<void>)[] = [];\n\n  getCallbacksNum() {\n    return this.callbacks.length;\n  }\n\n  tapPromise(options: string, fn: (...args: T[]) => Promise<void>) {\n    this.callbacks.push(fn);\n  }\n\n  promise(...args: T[]): Promise<void[]> {\n    return Promise.all(\n      this.callbacks.map((callback) => {\n        return callback(...args);\n      }),\n    );\n  }\n}\n","import type { AsArray } from './Hook';\n\nexport class AsyncSeriesWaterfallHook<T, R> {\n  private callbacks: ((...args: AsArray<T>) => Promise<R>)[] = [];\n\n  tapPromise(options: string, fn: (...args: AsArray<T>) => Promise<R>) {\n    this.callbacks.push(fn);\n  }\n\n  async promise(...args: AsArray<T>): Promise<R> {\n    if (this.callbacks.length) {\n      let result: R = await this.callbacks[0](...args);\n      for (let i = 0; i < this.callbacks.length - 1; i++) {\n        const callback = this.callbacks[i];\n        // @ts-ignore\n        // eslint-disable-next-line no-await-in-loop\n        result = await callback(result);\n      }\n\n      return result;\n    }\n\n    return null;\n  }\n}\n","import type { AsArray } from './Hook';\n\nexport class SyncHook<T, R = void> {\n  private callbacks: ((...args: AsArray<T>) => R)[] = [];\n\n  tap(options: string, fn: (...args: AsArray<T>) => R) {\n    this.callbacks.push(fn);\n  }\n\n  call(...args: AsArray<T>): void {\n    /* eslint-disable-next-line prefer-rest-params */\n    const argsArr = arguments;\n    this.callbacks.forEach(function (callback) {\n      /* eslint-disable-next-line prefer-spread */\n      callback.apply(undefined, argsArr);\n    });\n  }\n}\n","import type { AsArray } from './Hook';\n\nexport class SyncWaterfallHook<T, R> {\n  private callbacks: ((...args: AsArray<T>) => R)[] = [];\n\n  tap(options: string, fn: (...args: AsArray<T>) => R) {\n    this.callbacks.push(fn);\n  }\n\n  call(...args: AsArray<T>): R {\n    if (this.callbacks.length) {\n      /* eslint-disable-next-line prefer-rest-params */\n      const argsArr = arguments;\n      /* eslint-disable-next-line prefer-spread */\n      let result: R = this.callbacks[0].apply(undefined, argsArr);\n      for (let i = 0; i < this.callbacks.length - 1; i++) {\n        const callback = this.callbacks[i];\n        // @ts-ignore\n        result = callback(result);\n      }\n\n      return result;\n    }\n\n    return null;\n  }\n}\n","import { isNumber } from '@antv/util';\nimport type { ParsedTextStyleProps } from '../display-objects/Text';\n\nconst genericFontFamilies = [\n  'serif',\n  'sans-serif',\n  'monospace',\n  'cursive',\n  'fantasy',\n  'system-ui',\n];\nconst stringRegExp = /([\\\"\\'])[^\\'\\\"]+\\1/;\n\nexport function toFontString(attributes: Partial<ParsedTextStyleProps>) {\n  const {\n    fontSize = 16,\n    fontFamily = 'sans-serif',\n    fontStyle = 'normal',\n    fontVariant = 'normal',\n    fontWeight = 'normal',\n  } = attributes;\n\n  // build canvas api font setting from individual components. Convert a numeric this.fontSize to px\n  // const fontSizeString: string = isNumber(fontSize) ? `${fontSize}px` : fontSize.toString();\n  const fontSizeString: string =\n    (isNumber(fontSize) && `${fontSize}px`) || '16px';\n  // Clean-up fontFamily property by quoting each font name\n  // this will support font names with spaces\n\n  const fontFamilies: string[] = fontFamily.split(',');\n\n  for (let i = fontFamilies.length - 1; i >= 0; i--) {\n    // Trim any extra white-space\n    let fontFamily = fontFamilies[i].trim();\n    // Check if font already contains strings\n    if (\n      !stringRegExp.test(fontFamily) &&\n      genericFontFamilies.indexOf(fontFamily) < 0\n    ) {\n      fontFamily = `\"${fontFamily}\"`;\n    }\n    fontFamilies[i] = fontFamily;\n  }\n  return `${fontStyle} ${fontVariant} ${fontWeight} ${fontSizeString} ${fontFamilies.join(\n    ',',\n  )}`;\n}\n","import { mat4, vec3 } from 'gl-matrix';\nimport type { CSSUnitValue } from '../css/cssom';\nimport { ParsedTransform, convertAngleUnit } from '../css/parser';\nimport type { DisplayObject } from '../display-objects/DisplayObject';\nimport { runtime } from '../global-runtime';\nimport type { TransformType } from '../types';\nimport { deg2rad } from './math';\n\nfunction createSkewMatrix(skewMatrix: mat4, skewX: number, skewY: number) {\n  // Create an identity matrix\n  mat4.identity(skewMatrix);\n  // Apply skew to the matrix\n  skewMatrix[4] = Math.tan(skewX); // Skew Y axis in X direction\n  skewMatrix[1] = Math.tan(skewY); // Skew X axis in Y direction\n\n  return skewMatrix;\n}\n\nconst $mat4_1 = mat4.create();\nconst $mat4_2 = mat4.create();\n\nconst parser: Record<TransformType, (d: CSSUnitValue[]) => void> = {\n  scale: (d: CSSUnitValue[]) => {\n    mat4.fromScaling($mat4_1, [d[0].value, d[1].value, 1]);\n  },\n  scaleX: (d: CSSUnitValue[]) => {\n    mat4.fromScaling($mat4_1, [d[0].value, 1, 1]);\n  },\n  scaleY: (d: CSSUnitValue[]) => {\n    mat4.fromScaling($mat4_1, [1, d[0].value, 1]);\n  },\n  scaleZ: (d: CSSUnitValue[]) => {\n    mat4.fromScaling($mat4_1, [1, 1, d[0].value]);\n  },\n  scale3d: (d: CSSUnitValue[]) => {\n    mat4.fromScaling($mat4_1, [d[0].value, d[1].value, d[2].value]);\n  },\n  translate: (d: CSSUnitValue[]) => {\n    mat4.fromTranslation($mat4_1, [d[0].value, d[1].value, 0]);\n  },\n  translateX: (d: CSSUnitValue[]) => {\n    mat4.fromTranslation($mat4_1, [d[0].value, 0, 0]);\n  },\n  translateY: (d: CSSUnitValue[]) => {\n    mat4.fromTranslation($mat4_1, [0, d[0].value, 0]);\n  },\n  translateZ: (d: CSSUnitValue[]) => {\n    mat4.fromTranslation($mat4_1, [0, 0, d[0].value]);\n  },\n  translate3d: (d: CSSUnitValue[]) => {\n    mat4.fromTranslation($mat4_1, [d[0].value, d[1].value, d[2].value]);\n  },\n  rotate: (d: CSSUnitValue[]) => {\n    mat4.fromZRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotateX: (d: CSSUnitValue[]) => {\n    mat4.fromXRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotateY: (d: CSSUnitValue[]) => {\n    mat4.fromYRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotateZ: (d: CSSUnitValue[]) => {\n    mat4.fromZRotation($mat4_1, deg2rad(convertAngleUnit(d[0])));\n  },\n  rotate3d: (d: CSSUnitValue[]) => {\n    mat4.fromRotation($mat4_1, deg2rad(convertAngleUnit(d[3])), [\n      d[0].value,\n      d[1].value,\n      d[2].value,\n    ]);\n  },\n  skew: (d: CSSUnitValue[]) => {\n    createSkewMatrix($mat4_1, deg2rad(d[0].value), deg2rad(d[1].value));\n  },\n  skewX: (d: CSSUnitValue[]) => {\n    createSkewMatrix($mat4_1, deg2rad(d[0].value), 0);\n  },\n  skewY: (d: CSSUnitValue[]) => {\n    createSkewMatrix($mat4_1, 0, deg2rad(d[0].value));\n  },\n  matrix: (d: CSSUnitValue[]) => {\n    // prettier-ignore\n    mat4.set(\n      $mat4_1,\n      d[0].value, d[1].value, 0, 0,\n      d[2].value, d[3].value, 0, 0,\n      0,                   0, 1, 0,\n      d[4].value, d[5].value, 0, 1,\n    );\n  },\n  matrix3d: (d: CSSUnitValue[]) => {\n    // @ts-ignore\n    mat4.set($mat4_1, ...d.map((s) => s.value));\n  },\n};\n\nconst $vec3One = vec3.fromValues(1, 1, 1);\nconst $vec3Zero = vec3.create();\nconst optimizer: {\n  [key in TransformType]?: (object: DisplayObject, d: CSSUnitValue[]) => void;\n} = {\n  translate: (object: DisplayObject, d: CSSUnitValue[]) => {\n    runtime.sceneGraphService.setLocalScale(object, $vec3One, false);\n    runtime.sceneGraphService.setLocalEulerAngles(\n      object,\n      $vec3Zero,\n      undefined,\n      undefined,\n      false,\n    );\n    runtime.sceneGraphService.setLocalPosition(\n      object,\n      [d[0].value, d[1].value, 0],\n      false,\n    );\n    runtime.sceneGraphService.dirtifyLocal(object, object.transformable);\n  },\n};\n\nexport function parsedTransformToMat4(\n  transform: ParsedTransform[],\n  object: DisplayObject,\n): mat4 {\n  if (transform.length) {\n    if (transform.length === 1 && optimizer[transform[0].t]) {\n      optimizer[transform[0].t](object, transform[0].d);\n      return;\n    }\n    const m = mat4.identity($mat4_2);\n    for (let i = 0; i < transform.length; i++) {\n      const { t, d } = transform[i];\n      const p = parser[t];\n      if (p) {\n        p(d);\n        mat4.mul(m, m, $mat4_1);\n      }\n    }\n\n    object.setLocalTransform(m);\n  } else {\n    object.resetLocalTransform();\n  }\n\n  return object.getLocalTransform();\n}\n","import type { DisplayObject } from '../../display-objects';\nimport { parsedTransformToMat4 } from '../../utils';\nimport { CSSKeywordValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\nimport type { ParsedTransform } from '../parser/transform';\nimport { mergeTransforms, parseTransformUnmemoize } from '../parser/transform';\n\n/**\n * @see /zh/docs/api/animation#支持变换的属性\n *\n * support the following formats like CSS Transform:\n *\n * scale\n * * scale(x, y)\n * * scaleX(x)\n * * scaleY(x)\n * * scaleZ(z)\n * * scale3d(x, y, z)\n *\n * translate (unit: none, px, %(relative to its bounds))\n * * translate(x, y) eg. translate(0, 0) translate(0, 30px) translate(100%, 100%)\n * * translateX(0)\n * * translateY(0)\n * * translateZ(0)\n * * translate3d(0, 0, 0)\n *\n * rotate (unit: deg rad turn)\n * * rotate(0.5turn) rotate(30deg) rotate(1rad)\n *\n * none\n *\n * unsupported for now:\n * * calc() eg. translate(calc(100% + 10px))\n * * matrix/matrix3d()\n * * skew/skewX/skewY\n * * perspective\n */\nexport class CSSPropertyTransform\n  implements\n    Partial<\n      CSSProperty<CSSKeywordValue | ParsedTransform[], ParsedTransform[]>\n    >\n{\n  parser = parseTransformUnmemoize;\n\n  calculator(\n    name: string,\n    oldParsed: CSSKeywordValue | ParsedTransform[],\n    parsed: CSSKeywordValue | ParsedTransform[],\n    object: DisplayObject,\n  ): ParsedTransform[] {\n    // 'none'\n    if (parsed instanceof CSSKeywordValue) {\n      return [];\n    }\n    return parsed;\n  }\n\n  mixer = mergeTransforms;\n\n  postProcessor(object: DisplayObject) {\n    parsedTransformToMat4(object.parsedStyle.transform, object);\n  }\n}\n","import { DisplayObject } from '../../display-objects';\nimport { ParsedBaseStyleProps } from '../../types';\nimport { UnitType, type CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform-origin\n * @example\n * [10px, 10px] [10%, 10%]\n */\nexport class CSSPropertyTransformOrigin\n  implements\n    Partial<\n      CSSProperty<[CSSUnitValue, CSSUnitValue], [CSSUnitValue, CSSUnitValue]>\n    >\n{\n  postProcessor(object: DisplayObject) {\n    const { transformOrigin } = object.parsedStyle as ParsedBaseStyleProps;\n    if (\n      transformOrigin[0].unit === UnitType.kPixels &&\n      transformOrigin[1].unit === UnitType.kPixels\n    ) {\n      object.setOrigin(transformOrigin[0].value, transformOrigin[1].value);\n    } else {\n      // Relative to geometry bounds, calculate later.\n      object.getGeometryBounds();\n    }\n  }\n}\n","import { SortReason } from '../../components';\nimport type { DisplayObject } from '../../display-objects';\nimport type { CSSUnitValue } from '../cssom';\nimport type { CSSProperty } from '../CSSProperty';\n\nexport class CSSPropertyZIndex\n  implements Partial<CSSProperty<CSSUnitValue, number>>\n{\n  calculator(\n    name: string,\n    oldParsed: CSSUnitValue,\n    computed: CSSUnitValue,\n    object: DisplayObject,\n  ): number {\n    return computed.value;\n  }\n\n  postProcessor(object: DisplayObject) {\n    if (object.parentNode) {\n      const parentEntity = object.parentNode as DisplayObject;\n      const parentRenderable = parentEntity.renderable;\n      const parentSortable = parentEntity.sortable;\n      if (parentRenderable) {\n        parentRenderable.dirty = true;\n      }\n      // need re-sort on parent\n      if (parentSortable) {\n        parentSortable.dirty = true;\n        parentSortable.dirtyReason = SortReason.Z_INDEX_CHANGED;\n      }\n    }\n  }\n}\n","import type {\n  Circle,\n  ParsedCircleStyleProps,\n} from '../../display-objects/Circle';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class CircleUpdater\n  implements GeometryAABBUpdater<ParsedCircleStyleProps>\n{\n  update(parsedStyle: ParsedCircleStyleProps, object: Circle) {\n    const { cx = 0, cy = 0, r = 0 } = parsedStyle;\n\n    return {\n      cx,\n      cy,\n      hwidth: r,\n      hheight: r,\n    };\n  }\n}\n","import type {\n  Ellipse,\n  ParsedEllipseStyleProps,\n} from '../../display-objects/Ellipse';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class EllipseUpdater\n  implements GeometryAABBUpdater<ParsedEllipseStyleProps>\n{\n  update(parsedStyle: ParsedEllipseStyleProps, object: Ellipse) {\n    const { cx = 0, cy = 0, rx = 0, ry = 0 } = parsedStyle;\n\n    return {\n      cx,\n      cy,\n      hwidth: rx,\n      hheight: ry,\n    };\n  }\n}\n","import type { ParsedLineStyleProps } from '../../display-objects/Line';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class LineUpdater implements GeometryAABBUpdater<ParsedLineStyleProps> {\n  update(parsedStyle: ParsedLineStyleProps) {\n    const { x1, y1, x2, y2 } = parsedStyle;\n\n    const minX = Math.min(x1, x2);\n    const maxX = Math.max(x1, x2);\n    const minY = Math.min(y1, y2);\n    const maxY = Math.max(y1, y2);\n\n    const width = maxX - minX;\n    const height = maxY - minY;\n    const hwidth = width / 2;\n    const hheight = height / 2;\n\n    return {\n      cx: minX + hwidth,\n      cy: minY + hheight,\n      hwidth,\n      hheight,\n    };\n  }\n}\n","import type { ParsedPathStyleProps } from '../../display-objects';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class PathUpdater implements GeometryAABBUpdater<ParsedPathStyleProps> {\n  update(parsedStyle: ParsedPathStyleProps) {\n    const { d } = parsedStyle;\n\n    const { x, y, width, height } = d.rect;\n    const hwidth = width / 2;\n    const hheight = height / 2;\n\n    return {\n      cx: x + hwidth,\n      cy: y + hheight,\n      hwidth,\n      hheight,\n    };\n  }\n}\n","import { isArray } from '@antv/util';\nimport type { ParsedPolylineStyleProps } from '../../display-objects';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class PolylineUpdater\n  implements GeometryAABBUpdater<ParsedPolylineStyleProps>\n{\n  update(parsedStyle: ParsedPolylineStyleProps) {\n    if (parsedStyle.points && isArray(parsedStyle.points.points)) {\n      const { points } = parsedStyle.points;\n\n      // FIXME: account for miter lineJoin\n      const minX = Math.min(...points.map((point) => point[0]));\n      const maxX = Math.max(...points.map((point) => point[0]));\n      const minY = Math.min(...points.map((point) => point[1]));\n      const maxY = Math.max(...points.map((point) => point[1]));\n\n      const width = maxX - minX;\n      const height = maxY - minY;\n      const hwidth = width / 2;\n      const hheight = height / 2;\n\n      return {\n        cx: minX + hwidth,\n        cy: minY + hheight,\n        hwidth,\n        hheight,\n      };\n    }\n    return {\n      cx: 0,\n      cy: 0,\n      hwidth: 0,\n      hheight: 0,\n    };\n  }\n}\n","import { isString } from '@antv/util';\nimport type {\n  Group,\n  Image,\n  ParsedImageStyleProps,\n  Rect,\n} from '../../display-objects';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class RectUpdater implements GeometryAABBUpdater<ParsedImageStyleProps> {\n  update(parsedStyle: ParsedImageStyleProps, object: Image | Rect | Group) {\n    const { x = 0, y = 0, src, width = 0, height = 0 } = parsedStyle;\n\n    let contentWidth = width;\n    let contentHeight = height;\n\n    // resize with HTMLImageElement's size\n    if (src && !isString(src)) {\n      if (!contentWidth) {\n        contentWidth = src.width;\n        parsedStyle.width = contentWidth;\n      }\n      if (!contentHeight) {\n        contentHeight = src.height;\n        parsedStyle.height = contentHeight;\n      }\n    }\n\n    return {\n      cx: x + contentWidth / 2,\n      cy: y + contentHeight / 2,\n      hwidth: contentWidth / 2,\n      hheight: contentHeight / 2,\n    };\n  }\n}\n","import type {\n  DisplayObject,\n  ParsedTextStyleProps,\n} from '../../display-objects';\nimport { GlobalRuntime } from '../../global-runtime';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class TextUpdater implements GeometryAABBUpdater<ParsedTextStyleProps> {\n  constructor(private globalRuntime: GlobalRuntime) {}\n\n  private isReadyToMeasure(\n    parsedStyle: ParsedTextStyleProps,\n    object: DisplayObject,\n  ) {\n    const { text } = parsedStyle;\n\n    return text;\n  }\n\n  update(parsedStyle: ParsedTextStyleProps, object: DisplayObject) {\n    const {\n      text,\n      textAlign = 'start',\n      lineWidth = 1,\n      textBaseline = 'alphabetic',\n      dx = 0,\n      dy = 0,\n      x = 0,\n      y = 0,\n    } = parsedStyle;\n\n    if (!this.isReadyToMeasure(parsedStyle, object)) {\n      parsedStyle.metrics = {\n        font: '',\n        width: 0,\n        height: 0,\n        lines: [],\n        lineWidths: [],\n        lineHeight: 0,\n        maxLineWidth: 0,\n        fontProperties: {\n          ascent: 0,\n          descent: 0,\n          fontSize: 0,\n        },\n        lineMetrics: [],\n      };\n      return {\n        hwidth: 0,\n        hheight: 0,\n        cx: 0,\n        cy: 0,\n      };\n    }\n\n    const { offscreenCanvas } =\n      object?.ownerDocument?.defaultView?.getConfig() || {};\n    const metrics = this.globalRuntime.textService.measureText(\n      text,\n      parsedStyle,\n      offscreenCanvas,\n    );\n    parsedStyle.metrics = metrics;\n\n    const { width, height } = metrics;\n\n    const hwidth = width / 2;\n    const hheight = height / 2;\n\n    // default 'left'\n    let lineXOffset = x + hwidth;\n    if (textAlign === 'center' || textAlign === 'middle') {\n      lineXOffset += lineWidth / 2 - hwidth;\n    } else if (textAlign === 'right' || textAlign === 'end') {\n      lineXOffset += lineWidth - hwidth * 2;\n    }\n\n    let lineYOffset = y - hheight;\n    if (textBaseline === 'middle') {\n      lineYOffset += hheight;\n    } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n      lineYOffset += hheight * 2;\n    } else if (textBaseline === 'alphabetic') {\n      // alphabetic has been removed in the latest version, will be treated as bottom\n    } else if (textBaseline === 'bottom' || textBaseline === 'ideographic') {\n      lineYOffset += 0;\n    }\n    // TODO: ideographic & bottom\n\n    if (dx) {\n      lineXOffset += dx;\n    }\n    if (dy) {\n      lineYOffset += dy;\n    }\n\n    return {\n      cx: lineXOffset,\n      cy: lineYOffset,\n      hwidth,\n      hheight,\n    };\n  }\n}\n","import type { Group, ParsedImageStyleProps } from '../../display-objects';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class GroupUpdater\n  implements GeometryAABBUpdater<ParsedImageStyleProps>\n{\n  update(parsedStyle: ParsedImageStyleProps, object: Group) {\n    return {\n      cx: 0,\n      cy: 0,\n      hwidth: 0,\n      hheight: 0,\n    };\n  }\n}\n","import type { HTML, ParsedHTMLStyleProps } from '../../display-objects/HTML';\nimport type { GeometryAABBUpdater } from './interfaces';\n\nexport class HTMLUpdater implements GeometryAABBUpdater<ParsedHTMLStyleProps> {\n  update(parsedStyle: ParsedHTMLStyleProps, object: HTML) {\n    const { x = 0, y = 0, width = 0, height = 0 } = parsedStyle;\n\n    return {\n      cx: x + width / 2,\n      cy: y + height / 2,\n      hwidth: width / 2,\n      hheight: height / 2,\n    };\n  }\n}\n","import type { EventService } from '../services';\nimport { Point } from '../shapes/Point';\nimport { ERROR_MSG_METHOD_NOT_IMPLEMENTED } from '../utils';\nimport type { IEventTarget } from './interfaces';\n\nexport function isFederatedEvent(value: any): value is FederatedEvent {\n  return !!(value as FederatedEvent).type;\n}\n\n/**\n * An DOM-compatible synthetic event implementation that is \"forwarded\" on behalf of an original\n * FederatedEvent or native Event.\n */\nexport class FederatedEvent<N extends Event = Event, T = any> {\n  /**\n   * The type of event, supports the following:\n   * * pointerdown\n   * * touchstart\n   * * mousedown\n   * * rightdown\n   * * ...\n   */\n  type: string;\n\n  /**\n   * @deprecated\n   */\n  get name() {\n    return this.type;\n  }\n\n  /**\n   * The propagation phase.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Event/eventPhase\n   */\n  eventPhase = FederatedEvent.prototype.NONE;\n\n  /**\n   * can be used to implement event delegation\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/target\n   */\n  target: IEventTarget | null;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/bubbles\n   */\n  bubbles = true;\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/cancelBubble\n   */\n  cancelBubble = true;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Event/cancelable\n   */\n  readonly cancelable = false;\n\n  /** the event target when listeners binded */\n  currentTarget: IEventTarget | null;\n\n  /** Flags whether the default response of the user agent was prevent through this event. */\n  defaultPrevented = false;\n\n  /**\n   * timestamp when the event created\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/timeStamp\n   */\n  timeStamp: number;\n\n  /**\n   * the original event.\n   */\n  nativeEvent: N;\n\n  /** The original event that caused this event, if any. */\n  originalEvent: FederatedEvent<N>;\n\n  /** Flags whether propagation was stopped. */\n  propagationStopped = false;\n\n  /** Flags whether propagation was immediately stopped. */\n  propagationImmediatelyStopped = false;\n\n  manager: EventService | null;\n\n  /** Event-specific detail */\n  detail: T;\n\n  /**\n   * The coordinates of the evnet relative to the nearest DOM layer.\n   * This is a non-standard property.\n   */\n  layer: Point = new Point();\n  get layerX(): number {\n    return this.layer.x;\n  }\n  get layerY(): number {\n    return this.layer.y;\n  }\n\n  /**\n   * The coordinates of the event relative to the DOM document.\n   * This is a non-standard property.\n   * relative to the DOM document.\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent/pageX\n   */\n  page: Point = new Point();\n  get pageX(): number {\n    return this.page.x;\n  }\n  get pageY(): number {\n    return this.page.y;\n  }\n\n  /**\n   * relative to Canvas, origin is left-top\n   */\n  canvas: Point = new Point();\n  get x(): number {\n    return this.canvas.x;\n  }\n  get y(): number {\n    return this.canvas.y;\n  }\n  get canvasX(): number {\n    return this.canvas.x;\n  }\n  get canvasY(): number {\n    return this.canvas.y;\n  }\n\n  /**\n   * relative to Viewport, account for Camera\n   */\n  viewport: Point = new Point();\n  get viewportX(): number {\n    return this.viewport.x;\n  }\n  get viewportY(): number {\n    return this.viewport.y;\n  }\n\n  /**\n   * The event boundary which manages this event. Propagation can only occur\n   *  within the boundary's jurisdiction.\n   */\n  constructor(manager: EventService | null) {\n    this.manager = manager;\n  }\n\n  path: IEventTarget[];\n  /**\n   * The propagation path for this event\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/composedPath\n   *\n   * So composedPath()[0] represents the original target.\n   * @see https://polymer-library.polymer-project.org/3.0/docs/devguide/events#retargeting\n   */\n  composedPath(): IEventTarget[] {\n    if (this.manager && (!this.path || this.path[0] !== this.target)) {\n      this.path = this.target ? this.manager.propagationPath(this.target) : [];\n    }\n\n    return this.path;\n  }\n  /**\n   * @deprecated\n   */\n  get propagationPath() {\n    return this.composedPath();\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/preventDefault\n   */\n  preventDefault(): void {\n    if (this.nativeEvent instanceof Event && this.nativeEvent.cancelable) {\n      this.nativeEvent.preventDefault();\n    }\n\n    this.defaultPrevented = true;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopImmediatePropagation\n   */\n  stopImmediatePropagation(): void {\n    this.propagationImmediatelyStopped = true;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopPropagation\n   */\n  stopPropagation(): void {\n    this.propagationStopped = true;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/UIEvent/view\n   */\n  view: any;\n\n  /**\n   * added for compatibility with DOM Event,\n   * deprecated props and methods\n   */\n  initEvent(): void {}\n  initUIEvent(): void {}\n  which: number;\n  returnValue: boolean;\n  srcElement: IEventTarget;\n  readonly composed = false;\n  isTrusted: boolean;\n\n  clone() {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  NONE = 0;\n  CAPTURING_PHASE = 1;\n  AT_TARGET = 2;\n  BUBBLING_PHASE = 3;\n}\n","import type { DisplayObject } from '../display-objects/DisplayObject';\nimport { Point } from '../shapes/Point';\nimport { ERROR_MSG_METHOD_NOT_IMPLEMENTED } from '../utils';\nimport { FederatedEvent } from './FederatedEvent';\n\nexport class FederatedMouseEvent\n  extends FederatedEvent<MouseEvent | PointerEvent | TouchEvent>\n  implements MouseEvent\n{\n  /** Whether the \"alt\" key was pressed when this mouse event occurred. */\n  altKey: boolean;\n\n  /** The specific button that was pressed in this mouse event. */\n  button: number;\n\n  /** The button depressed when this event occurred. */\n  buttons: number;\n\n  /** Whether the \"control\" key was pressed when this mouse event occurred. */\n  ctrlKey: boolean;\n\n  /** Whether the \"meta\" key was pressed when this mouse event occurred. */\n  metaKey: boolean;\n\n  /** This is currently not implemented in the Federated Events API. */\n  // @ts-ignore\n  relatedTarget: DisplayObject | null;\n\n  /** Whether the \"shift\" key was pressed when this mouse event occurred. */\n  shiftKey: boolean;\n\n  /**\n   * The coordinates of the mouse event relative to the canvas.\n   */\n  client: Point = new Point();\n  get clientX(): number {\n    return this.client.x;\n  }\n  get clientY(): number {\n    return this.client.y;\n  }\n\n  /**\n   * The movement in this pointer relative to the last `mousemove` event.\n   */\n  movement: Point = new Point();\n  get movementX(): number {\n    return this.movement.x;\n  }\n  get movementY(): number {\n    return this.movement.y;\n  }\n\n  /**\n   * The offset of the pointer coordinates w.r.t. target DisplayObject in world space. This is\n   * not supported at the moment.\n   */\n  offset: Point = new Point();\n  get offsetX(): number {\n    return this.offset.x;\n  }\n  get offsetY(): number {\n    return this.offset.y;\n  }\n\n  /**\n   * The pointer coordinates in world space.\n   */\n  global: Point = new Point();\n  get globalX(): number {\n    return this.global.x;\n  }\n  get globalY(): number {\n    return this.global.y;\n  }\n\n  /**\n   * The pointer coordinates in sceen space.\n   */\n  screen: Point = new Point();\n  get screenX(): number {\n    return this.screen.x;\n  }\n  get screenY(): number {\n    return this.screen.y;\n  }\n\n  getModifierState(key: string): boolean {\n    return (\n      'getModifierState' in this.nativeEvent &&\n      this.nativeEvent.getModifierState(key)\n    );\n  }\n  initMouseEvent(): void {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n}\n","import { FederatedMouseEvent } from './FederatedMouseEvent';\n\n// @ts-ignore\nexport class FederatedPointerEvent\n  extends FederatedMouseEvent\n  implements PointerEvent\n{\n  /**\n   * The unique identifier of the pointer.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerId\n   */\n  pointerId: number;\n\n  /**\n   * The width of the pointer's contact along the x-axis, measured in CSS pixels.\n   * radiusX of TouchEvents will be represented by this value.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/width\n   */\n  width = 0;\n\n  /**\n   * The height of the pointer's contact along the y-axis, measured in CSS pixels.\n   * radiusY of TouchEvents will be represented by this value.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/height\n   */\n  height = 0;\n\n  /**\n   * Indicates whether or not the pointer device that created the event is the primary pointer.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/isPrimary\n   */\n  isPrimary = false;\n\n  /**\n   * The type of pointer that triggered the event.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pointerType\n   */\n  pointerType: string;\n\n  /**\n   * Pressure applied by the pointing device during the event.\n   *s\n   * A Touch's force property will be represented by this value.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/pressure\n   */\n  pressure: number;\n\n  /**\n   * Barrel pressure on a stylus pointer.\n   *\n   * @see https://w3c.github.io/pointerevents/#pointerevent-interface\n   */\n  tangentialPressure: number;\n\n  /**\n   * The angle, in degrees, between the pointer device and the screen.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltX\n   */\n  tiltX: number;\n\n  /**\n   * The angle, in degrees, between the pointer device and the screen.\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/tiltY\n   */\n  tiltY: number;\n\n  /**\n   * Twist of a stylus pointer.\n   *\n   * @see https://w3c.github.io/pointerevents/#pointerevent-interface\n   */\n  twist: number;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/PointerEvent/getCoalescedEvents\n   */\n  getCoalescedEvents(): PointerEvent[] {\n    if (\n      this.type === 'pointermove' ||\n      this.type === 'mousemove' ||\n      this.type === 'touchmove'\n    ) {\n      // @ts-ignore\n      return [this];\n    }\n    return [];\n  }\n\n  /**\n   * @see https://chromestatus.com/feature/5765569655603200\n   */\n  getPredictedEvents(): PointerEvent[] {\n    throw new Error('getPredictedEvents is not supported!');\n  }\n\n  /**\n   * @see https://github.com/antvis/G/issues/1115\n   * We currently reuses event objects in the event system,\n   * avoiding the creation of a large number of event objects.\n   * Reused objects are only used to carry different data,\n   * such as coordinate information, native event objects,\n   * and therefore the lifecycle is limited to the event handler,\n   * which can lead to unintended consequences if an attempt is made to cache the entire event object.\n   *\n   * Therefore, while keeping the above performance considerations in mind, it is possible to provide a clone method that creates a new object when the user really wants to cache it, e.g.\n   */\n  clone() {\n    return this.manager.clonePointerEvent(this);\n  }\n}\n","import { FederatedMouseEvent } from './FederatedMouseEvent';\n\n// @ts-ignore\nexport class FederatedWheelEvent\n  extends FederatedMouseEvent\n  implements WheelEvent\n{\n  /**\n   * The units of `deltaX`, `deltaY`, and `deltaZ`. This is one of `DOM_DELTA_LINE`,\n   * `DOM_DELTA_PAGE`, `DOM_DELTA_PIXEL`.\n   */\n  deltaMode: number;\n\n  /** Horizontal scroll amount */\n  deltaX: number;\n\n  /** Vertical scroll amount */\n  deltaY: number;\n\n  /** z-axis scroll amount. */\n  deltaZ: number;\n\n  readonly DOM_DELTA_PIXEL: 0x00;\n  readonly DOM_DELTA_LINE: 0x01;\n  readonly DOM_DELTA_PAGE: 0x02;\n\n  clone() {\n    return this.manager.cloneWheelEvent(this);\n  }\n}\n","import { FederatedEvent } from './FederatedEvent';\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/Events/Creating_and_triggering_events\n *\n * @example\n  const event = new CustomEvent('build', { detail: { prop1: 'xx' } });\n  circle.addEventListener('build', (e) => {\n    e.target; // circle\n    e.detail; // { prop1: 'xx' }\n  });\n\n  circle.dispatchEvent(event);\n */\nexport class CustomEvent extends FederatedEvent {\n  constructor(eventName: string, object?: object) {\n    super(null);\n\n    this.type = eventName;\n    this.detail = object;\n\n    // compatible with G 3.0\n    Object.assign(this, object);\n  }\n}\n","import { isBoolean, isFunction } from '@antv/util';\nimport EventEmitter from 'eventemitter3';\nimport { CustomEvent } from './CustomEvent';\nimport { FederatedEvent } from './FederatedEvent';\nimport type {\n  EventListenerOrEventListenerObject,\n  ICanvas,\n  IDocument,\n  IEventTarget,\n  INode,\n} from './interfaces';\n\nconst CANVAS_CACHE = new WeakMap<IEventTarget, ICanvas>();\n\n/**\n * Objects that can receive events and may have listeners for them.\n * eg. Element, Canvas, DisplayObject\n * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n */\nexport class EventTarget implements IEventTarget {\n  /**\n   * event emitter\n   */\n  emitter = new EventEmitter();\n\n  /**\n   * @deprecated\n   * @alias addEventListener\n   */\n  on(\n    type: string,\n    listener: EventListenerOrEventListenerObject | ((...args: any[]) => void),\n    options?: boolean | AddEventListenerOptions,\n  ) {\n    this.addEventListener(type, listener, options);\n    return this;\n  }\n  /**\n   * support `capture` & `once` in options\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener\n   */\n  addEventListener(\n    type: string,\n    listener: EventListenerOrEventListenerObject | ((...args: any[]) => void),\n    options?: boolean | AddEventListenerOptions,\n  ) {\n    let capture = false;\n    let once = false;\n\n    if (isBoolean(options)) capture = options;\n    else if (options) ({ capture = false, once = false } = options);\n\n    if (capture) type += 'capture';\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    listener = isFunction(listener) ? listener : listener.handleEvent;\n\n    const context = isFunction(listener) ? undefined : listener;\n\n    if (once) this.emitter.once(type, listener, context);\n    else this.emitter.on(type, listener, context);\n\n    return this;\n  }\n  /**\n   * @deprecated\n   * @alias removeEventListener\n   */\n  off(\n    type: string,\n    listener: EventListenerOrEventListenerObject | ((...args: any[]) => void),\n    options?: boolean | AddEventListenerOptions,\n  ) {\n    if (type) {\n      this.removeEventListener(type, listener, options);\n    } else {\n      // remove all listeners\n      this.removeAllEventListeners();\n    }\n    return this;\n  }\n\n  removeAllEventListeners() {\n    this.emitter?.removeAllListeners();\n  }\n\n  removeEventListener(\n    type: string,\n    listener?: EventListenerOrEventListenerObject | ((...args: any[]) => void),\n    options?: boolean | AddEventListenerOptions,\n  ) {\n    if (!this.emitter) return this;\n\n    const capture = isBoolean(options) ? options : options?.capture;\n    if (capture) type += 'capture';\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    listener = isFunction(listener) ? listener : listener?.handleEvent;\n    const context = isFunction(listener) ? undefined : listener;\n\n    this.emitter.off(type, listener, context);\n    return this;\n  }\n  /**\n   * @deprecated\n   * @alias dispatchEvent\n   */\n  emit(eventName: string, object: object) {\n    this.dispatchEvent(new CustomEvent(eventName, object));\n  }\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\n   */\n  dispatchEvent<T extends FederatedEvent>(\n    e: T,\n    skipPropagate = false,\n  ): boolean {\n    let canvas: ICanvas = CANVAS_CACHE.get(this);\n\n    if (!canvas) {\n      // @ts-expect-error document may be defined in inherited class\n      if (this.document) canvas = this as unknown as ICanvas;\n      // @ts-expect-error defaultView may be defined in inherited class\n      else if (this.defaultView)\n        canvas = (this as unknown as IDocument).defaultView;\n      else canvas = (this as unknown as INode).ownerDocument?.defaultView;\n\n      if (canvas) CANVAS_CACHE.set(this, canvas);\n    }\n\n    if (canvas) {\n      e.manager = canvas.getEventService();\n      if (!e.manager) return false;\n\n      e.defaultPrevented = false;\n      if (e.path) e.path.length = 0;\n      // @ts-ignore\n      else e.page = [];\n\n      if (!skipPropagate) e.target = this;\n      e.manager.dispatchEvent(e, e.type, skipPropagate);\n    }\n\n    return !e.defaultPrevented;\n  }\n}\n","import { Shape } from '../types';\nimport { ERROR_MSG_METHOD_NOT_IMPLEMENTED } from '../utils';\n// import { Text } from '../display-objects/Text';\nimport { EventTarget } from './EventTarget';\nimport type {\n  IChildNode,\n  IDocument,\n  IElement,\n  IEventTarget,\n  INode,\n  IParentNode,\n} from './interfaces';\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Node\n */\nexport abstract class Node extends EventTarget implements INode {\n  /**\n   * Both nodes are in different documents or different trees in the same document.\n   */\n  static DOCUMENT_POSITION_DISCONNECTED = 1;\n\n  /**\n   * otherNode precedes the node in either a pre-order depth-first traversal\n   * of a tree containing both (e.g., as an ancestor or previous sibling or a descendant of a previous sibling or previous sibling of an ancestor) or (if they are disconnected) in an arbitrary but consistent ordering.\n   */\n  static DOCUMENT_POSITION_PRECEDING = 2;\n\n  /**\n   * otherNode follows the node in either a pre-order depth-first traversal of a tree containing both (e.g., as a descendant or following sibling or a descendant of a following sibling or following sibling of an ancestor) or (if they are disconnected) in an arbitrary but consistent ordering.\n   */\n  static DOCUMENT_POSITION_FOLLOWING = 4;\n\n  /**\n   * otherNode is an ancestor of the node.\n   */\n  static DOCUMENT_POSITION_CONTAINS = 8;\n\n  /**\n   * otherNode is a descendant of the node.\n   */\n  static DOCUMENT_POSITION_CONTAINED_BY = 16;\n\n  /**\n   * The result relies upon arbitrary and/or implementation-specific behavior and is not guaranteed to be portable.\n   */\n  static DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 32;\n\n  static isNode(target: IEventTarget | INode): target is INode {\n    return !!(target as INode).childNodes;\n  }\n\n  shadow = false;\n  /**\n   * points to canvas.document\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/ownerDocument\n   */\n  ownerDocument: IDocument | null = null;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/isConnected\n   * @example\n      circle.isConnected; // false\n      canvas.appendChild(circle);\n      circle.isConnected; // true\n   */\n  isConnected = false;\n\n  /**\n   * Returns node's node document's document base URL.\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node\n   */\n  readonly baseURI: string = '';\n\n  /**\n   * Returns the children.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/childNodes\n   */\n  childNodes: IChildNode[] = [];\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeType\n   */\n  nodeType = 0;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeName\n   */\n  nodeName = '';\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/nodeValue\n   */\n  nodeValue: string | null = null;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/textContent\n   */\n  get textContent(): string {\n    let out = '';\n\n    if (this.nodeName === Shape.TEXT) {\n      // @ts-ignore\n      out += this.style.text;\n    }\n\n    for (const child of this.childNodes) {\n      if (child.nodeName === Shape.TEXT) {\n        out += child.nodeValue;\n      } else {\n        out += child.textContent;\n      }\n    }\n\n    return out;\n  }\n\n  set textContent(content: string) {\n    // remove all children\n    this.childNodes.slice().forEach((child) => {\n      this.removeChild(child);\n    });\n\n    if (this.nodeName === Shape.TEXT) {\n      // @ts-ignore\n      this.style.text = `${content}`;\n    } else {\n      // this.appendChild(\n      //   new Text({\n      //     style: {\n      //       text: content,\n      //     },\n      //   }),\n      // );\n    }\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/getRootNode\n   */\n  getRootNode(opts: { composed?: boolean } = {}): INode {\n    if (this.parentNode) {\n      return this.parentNode.getRootNode(opts);\n    }\n    if (opts.composed && (this as any).host) {\n      return (this as any).host.getRootNode(opts);\n    }\n    return this;\n  }\n  hasChildNodes(): boolean {\n    return this.childNodes.length > 0;\n  }\n\n  isDefaultNamespace(namespace: string | null): boolean {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  lookupNamespaceURI(prefix: string | null): string | null {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  lookupPrefix(namespace: string | null): string | null {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  normalize(): void {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/isEqualNode\n   */\n  isEqualNode(otherNode: INode | null): boolean {\n    // TODO: compare 2 nodes, not sameness\n    return this === otherNode;\n  }\n  isSameNode(otherNode: INode | null): boolean {\n    return this.isEqualNode(otherNode);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/ParentNode\n   */\n  parentNode: (INode & IParentNode) | null = null;\n\n  /**\n   * @deprecated\n   * @alias parentNode\n   */\n  get parent(): INode | null {\n    return this.parentNode;\n  }\n  get parentElement(): IElement | null {\n    return null;\n  }\n  get nextSibling(): IChildNode | null {\n    return null;\n  }\n  get previousSibling(): IChildNode | null {\n    return null;\n  }\n  get firstChild(): IChildNode | null {\n    return this.childNodes.length > 0 ? this.childNodes[0] : null;\n  }\n  get lastChild(): IChildNode | null {\n    return this.childNodes.length > 0\n      ? this.childNodes[this.childNodes.length - 1]\n      : null;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/compareDocumentPosition\n   * @see https://github.com/b-fuze/deno-dom/blob/master/src/dom/node.ts#L338\n   */\n  compareDocumentPosition(other: INode): number {\n    if (other === this) {\n      // same node\n      return 0;\n    }\n\n    // if (!(other instanceof Node)) {\n    //   throw new TypeError(\n    //     'Node.compareDocumentPosition: Argument 1 does not implement interface Node.',\n    //   );\n    // }\n\n    let node1Root: INode = other;\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let node2Root: INode = this;\n    const node1Hierarchy: INode[] = [node1Root];\n    const node2Hierarchy: INode[] = [node2Root];\n    while (node1Root.parentNode ?? node2Root.parentNode) {\n      node1Root = node1Root.parentNode\n        ? (node1Hierarchy.push(node1Root.parentNode), node1Root.parentNode)\n        : node1Root;\n      node2Root = node2Root.parentNode\n        ? (node2Hierarchy.push(node2Root.parentNode), node2Root.parentNode)\n        : node2Root;\n    }\n\n    // Check if they don't share the same root node\n    if (node1Root !== node2Root) {\n      return (\n        Node.DOCUMENT_POSITION_DISCONNECTED |\n        Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC |\n        Node.DOCUMENT_POSITION_PRECEDING\n      );\n    }\n\n    const longerHierarchy =\n      node1Hierarchy.length > node2Hierarchy.length\n        ? node1Hierarchy\n        : node2Hierarchy;\n    const shorterHierarchy =\n      longerHierarchy === node1Hierarchy ? node2Hierarchy : node1Hierarchy;\n\n    // Check if either is a container of the other\n    if (\n      longerHierarchy[longerHierarchy.length - shorterHierarchy.length] ===\n      shorterHierarchy[0]\n    ) {\n      return longerHierarchy === node1Hierarchy\n        ? // other is a child of this\n          Node.DOCUMENT_POSITION_CONTAINED_BY | Node.DOCUMENT_POSITION_FOLLOWING\n        : // this is a child of other\n          Node.DOCUMENT_POSITION_CONTAINS | Node.DOCUMENT_POSITION_PRECEDING;\n    }\n\n    // Find their first common ancestor and see whether they\n    // are preceding or following\n    const longerStart = longerHierarchy.length - shorterHierarchy.length;\n    for (let i = shorterHierarchy.length - 1; i >= 0; i--) {\n      const shorterHierarchyNode = shorterHierarchy[i];\n      const longerHierarchyNode = longerHierarchy[longerStart + i];\n\n      // We found the first common ancestor\n      if (longerHierarchyNode !== shorterHierarchyNode) {\n        const siblings = shorterHierarchyNode.parentNode.childNodes as INode[];\n\n        if (\n          siblings.indexOf(shorterHierarchyNode) <\n          siblings.indexOf(longerHierarchyNode)\n        ) {\n          // Shorter is before longer\n          if (shorterHierarchy === node1Hierarchy) {\n            // Other is before this\n            return Node.DOCUMENT_POSITION_PRECEDING;\n          }\n          // This is before other\n          return Node.DOCUMENT_POSITION_FOLLOWING;\n        }\n        // Longer is before shorter\n        if (longerHierarchy === node1Hierarchy) {\n          // Other is before this\n          return Node.DOCUMENT_POSITION_PRECEDING;\n        }\n        // Other is after this\n        return Node.DOCUMENT_POSITION_FOLLOWING;\n      }\n    }\n\n    return Node.DOCUMENT_POSITION_FOLLOWING;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode\n   */\n  abstract cloneNode(deep?: boolean): this;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\n   */\n  abstract appendChild<T extends INode>(newChild: T, index?: number): T;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore\n   */\n  abstract insertBefore<T extends INode>(\n    newChild: T,\n    refChild: INode | null,\n  ): T;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Node/removeChild\n   */\n  abstract removeChild<T extends INode>(child: T): T;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Node/replaceChild\n   */\n  abstract replaceChild<T extends INode>(newChild: INode, oldChild: T): T;\n\n  abstract destroy(): void;\n\n  /**\n   * @deprecated\n   * @alias contains\n   */\n  contain<T extends INode>(other: T | null) {\n    return this.contains(other);\n  }\n  contains<T extends INode>(other: T | null): boolean {\n    // the node itself, one of its direct children\n    let tmp: INode | null = other;\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/Node/contains\n    while (tmp && this !== tmp) {\n      tmp = tmp.parentNode;\n    }\n    return !!tmp;\n  }\n\n  getAncestor(n: number): INode | null {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let temp: INode | null = this;\n    while (n > 0 && temp) {\n      temp = temp.parentNode;\n      n--;\n    }\n    return temp;\n  }\n\n  /**\n   * iterate current node and its descendants\n   * @param callback - callback to execute for each node, return false to break\n   * @param assigned - whether to iterate assigned nodes\n   */\n  forEach(callback: (o: INode) => void | boolean) {\n    const result = callback(this);\n\n    if (result !== false) {\n      const nodes = this.childNodes;\n      const length = nodes.length;\n      for (let i = 0; i < length; i++) {\n        nodes[i].forEach(callback);\n      }\n    }\n  }\n}\n","import EventEmitter from 'eventemitter3';\nimport { mat4, vec3 } from 'gl-matrix';\nimport type { CanvasContext, GlobalRuntime, InteractivePointerEvent } from '..';\nimport type { HTML } from '../display-objects';\nimport type { FederatedEvent } from '../dom/FederatedEvent';\nimport { FederatedMouseEvent } from '../dom/FederatedMouseEvent';\nimport { FederatedPointerEvent } from '../dom/FederatedPointerEvent';\nimport { FederatedWheelEvent } from '../dom/FederatedWheelEvent';\nimport { Node } from '../dom/Node';\nimport type {\n  ICanvas,\n  IDocument,\n  IEventTarget,\n  INode,\n} from '../dom/interfaces';\nimport type { PointLike } from '../shapes';\nimport { Point } from '../shapes';\nimport type { Cursor, EventPosition } from '../types';\nimport { isElement } from '../utils/dom';\nimport { clock } from '../utils/event';\n\ntype Picker = (position: EventPosition) => IEventTarget | null;\ntype TrackingData = {\n  pressTargetsByButton: Record<number, IEventTarget[]>;\n  clicksByButton: Record<\n    number,\n    {\n      clickCount: number;\n      target: IEventTarget;\n      timeStamp: number;\n    }\n  >;\n  overTargets: IEventTarget[] | null;\n};\nexport type EmitterListeners = Record<\n  string,\n  | { fn: (...args: any[]) => any; context: any; once: boolean }[]\n  | { fn: (...args: any[]) => any; context: any; once: boolean }\n>;\nconst PROPAGATION_LIMIT = 2048;\n\nexport class EventService {\n  constructor(\n    private globalRuntime: GlobalRuntime,\n    private context: CanvasContext,\n  ) {}\n\n  private rootTarget: IEventTarget;\n\n  private emitter = new EventEmitter();\n\n  /**\n   * Store HTML elements in current canvas.\n   */\n  nativeHTMLMap = new WeakMap<HTMLElement, HTML>();\n\n  cursor: Cursor | null = 'default';\n\n  private mappingTable: Record<\n    string,\n    {\n      fn: (e: FederatedEvent) => void;\n      priority: number;\n    }[]\n  > = {};\n  private mappingState: Record<string, any> = {\n    trackingData: {},\n  };\n  private eventPool: Map<typeof FederatedEvent, FederatedEvent[]> = new Map();\n\n  private pickHandler: Picker;\n\n  private tmpMatrix = mat4.create();\n  private tmpVec3 = vec3.create();\n\n  init() {\n    this.rootTarget = this.context.renderingContext.root.parentNode; // document\n    this.addEventMapping('pointerdown', this.onPointerDown);\n    this.addEventMapping('pointerup', this.onPointerUp);\n    this.addEventMapping('pointermove', this.onPointerMove);\n    this.addEventMapping('pointerout', this.onPointerOut);\n    this.addEventMapping('pointerleave', this.onPointerOut);\n    this.addEventMapping('pointercancel', this.onPointerCancel);\n    this.addEventMapping('pointerover', this.onPointerOver);\n    this.addEventMapping('pointerupoutside', this.onPointerUpOutside);\n    this.addEventMapping('wheel', this.onWheel);\n    this.addEventMapping('click', this.onClick);\n  }\n\n  destroy() {\n    this.emitter.removeAllListeners();\n    this.mappingTable = {};\n    this.mappingState = {};\n    this.eventPool.clear();\n  }\n\n  private getScale() {\n    const bbox = this.context.contextService.getBoundingClientRect();\n    let scaleX = 1;\n    let scaleY = 1;\n    const $el =\n      this.context.contextService.getDomElement() as HTMLCanvasElement;\n    if ($el && bbox) {\n      const { offsetWidth, offsetHeight } = $el;\n      if (offsetWidth && offsetHeight) {\n        scaleX = bbox.width / offsetWidth;\n        scaleY = bbox.height / offsetHeight;\n      }\n    }\n    return {\n      scaleX,\n      scaleY,\n      bbox,\n    };\n  }\n\n  /**\n   * Should account for CSS Transform applied on container.\n   * @see https://github.com/antvis/G/issues/1161\n   * @see https://github.com/antvis/G/issues/1677\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/MouseEvent/offsetX\n   */\n  client2Viewport(client: PointLike): PointLike {\n    const { scaleX, scaleY, bbox } = this.getScale();\n    return new Point(\n      (client.x - (bbox?.left || 0)) / scaleX,\n      (client.y - (bbox?.top || 0)) / scaleY,\n    );\n  }\n\n  viewport2Client(canvas: PointLike): PointLike {\n    const { scaleX, scaleY, bbox } = this.getScale();\n    return new Point(\n      (canvas.x + (bbox?.left || 0)) * scaleX,\n      (canvas.y + (bbox?.top || 0)) * scaleY,\n    );\n  }\n\n  viewport2Canvas({ x, y }: PointLike): PointLike {\n    const canvas = (this.rootTarget as IDocument).defaultView;\n    const camera = canvas.getCamera();\n\n    const { width, height } = this.context.config;\n\n    const projectionMatrixInverse = camera.getPerspectiveInverse();\n    const worldMatrix = camera.getWorldTransform();\n    const vpMatrix = mat4.multiply(\n      this.tmpMatrix,\n      worldMatrix,\n      projectionMatrixInverse,\n    );\n\n    const viewport = vec3.set(\n      this.tmpVec3,\n      (x / width) * 2 - 1,\n      (1 - y / height) * 2 - 1,\n      0,\n    );\n\n    vec3.transformMat4(viewport, viewport, vpMatrix);\n\n    return new Point(viewport[0], viewport[1]);\n  }\n\n  canvas2Viewport(canvasP: PointLike): PointLike {\n    const canvas = (this.rootTarget as IDocument).defaultView;\n    const camera = canvas.getCamera();\n\n    // World -> Clip\n    const projectionMatrix = camera.getPerspective();\n    const viewMatrix = camera.getViewTransform();\n    const vpMatrix = mat4.multiply(\n      this.tmpMatrix,\n      projectionMatrix,\n      viewMatrix,\n    );\n\n    const clip = vec3.set(this.tmpVec3, canvasP.x, canvasP.y, 0);\n    vec3.transformMat4(this.tmpVec3, this.tmpVec3, vpMatrix);\n\n    // Clip -> NDC -> Viewport, flip Y\n    const { width, height } = this.context.config;\n    return new Point(\n      ((clip[0] + 1) / 2) * width,\n      (1 - (clip[1] + 1) / 2) * height,\n    );\n  }\n\n  setPickHandler(pickHandler: Picker) {\n    this.pickHandler = pickHandler;\n  }\n\n  addEventMapping(type: string, fn: (e: FederatedEvent) => void) {\n    if (!this.mappingTable[type]) {\n      this.mappingTable[type] = [];\n    }\n\n    this.mappingTable[type].push({\n      fn,\n      priority: 0,\n    });\n    this.mappingTable[type].sort((a, b) => a.priority - b.priority);\n  }\n\n  mapEvent(e: FederatedEvent) {\n    if (!this.rootTarget) {\n      return;\n    }\n\n    const mappers = this.mappingTable[e.type];\n\n    if (mappers) {\n      for (let i = 0, j = mappers.length; i < j; i++) {\n        mappers[i].fn(e);\n      }\n    } else {\n      console.warn(`[EventService]: Event mapping not defined for ${e.type}`);\n    }\n  }\n\n  onPointerDown = (from: FederatedPointerEvent) => {\n    const e = this.createPointerEvent(from);\n\n    this.dispatchEvent(e, 'pointerdown');\n\n    if (e.pointerType === 'touch') {\n      this.dispatchEvent(e, 'touchstart');\n    } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n      const isRightButton = e.button === 2;\n      this.dispatchEvent(e, isRightButton ? 'rightdown' : 'mousedown');\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n\n    trackingData.pressTargetsByButton[from.button] = e.composedPath();\n\n    this.freeEvent(e);\n  };\n\n  onPointerUp = (from: FederatedPointerEvent) => {\n    const now = clock.now();\n    const e = this.createPointerEvent(\n      from,\n      undefined,\n      undefined,\n      this.context.config.alwaysTriggerPointerEventOnCanvas\n        ? this.rootTarget\n        : undefined,\n    );\n\n    this.dispatchEvent(e, 'pointerup');\n\n    if (e.pointerType === 'touch') {\n      this.dispatchEvent(e, 'touchend');\n    } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n      const isRightButton = e.button === 2;\n      this.dispatchEvent(e, isRightButton ? 'rightup' : 'mouseup');\n    }\n\n    const trackingData = this.trackingData(from.pointerId);\n    const pressTarget = this.findMountedTarget(\n      trackingData.pressTargetsByButton[from.button],\n    );\n\n    let clickTarget = pressTarget;\n\n    // pointerupoutside only bubbles. It only bubbles upto the parent that doesn't contain\n    // the pointerup location.\n    if (pressTarget && !e.composedPath().includes(pressTarget)) {\n      let currentTarget: IEventTarget | null = pressTarget;\n\n      while (currentTarget && !e.composedPath().includes(currentTarget)) {\n        e.currentTarget = currentTarget;\n\n        this.notifyTarget(e, 'pointerupoutside');\n\n        if (e.pointerType === 'touch') {\n          this.notifyTarget(e, 'touchendoutside');\n        } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n          const isRightButton = e.button === 2;\n\n          this.notifyTarget(\n            e,\n            isRightButton ? 'rightupoutside' : 'mouseupoutside',\n          );\n        }\n\n        if (Node.isNode(currentTarget)) {\n          currentTarget = currentTarget.parentNode;\n        }\n      }\n\n      delete trackingData.pressTargetsByButton[from.button];\n\n      // currentTarget is the most specific ancestor holding both the pointerdown and pointerup\n      // targets. That is - it's our click target!\n      clickTarget = currentTarget;\n    }\n\n    if (clickTarget) {\n      const clickEvent = this.clonePointerEvent(e, 'click');\n\n      clickEvent.target = clickTarget;\n      clickEvent.path = [];\n\n      if (!trackingData.clicksByButton[from.button]) {\n        trackingData.clicksByButton[from.button] = {\n          clickCount: 0,\n          target: clickEvent.target,\n          timeStamp: now,\n        };\n      }\n\n      const canvas =\n        this.context.renderingContext.root.ownerDocument.defaultView;\n      const clickHistory = trackingData.clicksByButton[from.button];\n\n      if (\n        clickHistory.target === clickEvent.target &&\n        now - clickHistory.timeStamp < canvas.dblClickSpeed\n      ) {\n        ++clickHistory.clickCount;\n      } else {\n        clickHistory.clickCount = 1;\n      }\n\n      clickHistory.target = clickEvent.target;\n      clickHistory.timeStamp = now;\n\n      clickEvent.detail = clickHistory.clickCount;\n\n      // @see https://github.com/antvis/G/issues/1091\n      if (!e.detail?.preventClick) {\n        if (\n          !this.context.config.useNativeClickEvent &&\n          (clickEvent.pointerType === 'mouse' ||\n            clickEvent.pointerType === 'touch')\n        ) {\n          this.dispatchEvent(clickEvent, 'click');\n        }\n        this.dispatchEvent(clickEvent, 'pointertap');\n      }\n\n      this.freeEvent(clickEvent);\n    }\n\n    this.freeEvent(e);\n  };\n\n  onPointerMove = (from: FederatedPointerEvent) => {\n    const e = this.createPointerEvent(\n      from,\n      undefined,\n      undefined,\n      this.context.config.alwaysTriggerPointerEventOnCanvas\n        ? this.rootTarget\n        : undefined,\n    );\n\n    const isMouse = e.pointerType === 'mouse' || e.pointerType === 'pen';\n    const trackingData = this.trackingData(from.pointerId);\n    const outTarget = this.findMountedTarget(trackingData.overTargets);\n\n    // First pointerout/pointerleave\n    if (trackingData.overTargets && outTarget !== e.target) {\n      // pointerout always occurs on the overTarget when the pointer hovers over another element.\n      const outType = from.type === 'mousemove' ? 'mouseout' : 'pointerout';\n      const outEvent = this.createPointerEvent(\n        from,\n        outType,\n        outTarget || undefined,\n      );\n\n      this.dispatchEvent(outEvent, 'pointerout');\n      if (isMouse) this.dispatchEvent(outEvent, 'mouseout');\n\n      // If the pointer exits overTarget and its descendants, then a pointerleave event is also fired. This event\n      // is dispatched to all ancestors that no longer capture the pointer.\n      if (!e.composedPath().includes(outTarget)) {\n        const leaveEvent = this.createPointerEvent(\n          from,\n          'pointerleave',\n          outTarget || undefined,\n        );\n\n        leaveEvent.eventPhase = leaveEvent.AT_TARGET;\n\n        while (\n          leaveEvent.target &&\n          !e.composedPath().includes(leaveEvent.target)\n        ) {\n          leaveEvent.currentTarget = leaveEvent.target;\n\n          this.notifyTarget(leaveEvent);\n          if (isMouse) {\n            this.notifyTarget(leaveEvent, 'mouseleave');\n          }\n\n          if (Node.isNode(leaveEvent.target)) {\n            leaveEvent.target = leaveEvent.target.parentNode;\n          }\n        }\n\n        this.freeEvent(leaveEvent);\n      }\n\n      this.freeEvent(outEvent);\n    }\n\n    // Then pointerover\n    if (outTarget !== e.target) {\n      // pointerover always occurs on the new overTarget\n      const overType = from.type === 'mousemove' ? 'mouseover' : 'pointerover';\n      const overEvent = this.clonePointerEvent(e, overType); // clone faster\n\n      this.dispatchEvent(overEvent, 'pointerover');\n      if (isMouse) this.dispatchEvent(overEvent, 'mouseover');\n\n      // Probe whether the newly hovered Node is an ancestor of the original overTarget.\n      let overTargetAncestor =\n        outTarget && Node.isNode(outTarget) && outTarget.parentNode;\n\n      while (\n        overTargetAncestor &&\n        overTargetAncestor !==\n          (Node.isNode(this.rootTarget) && this.rootTarget.parentNode)\n      ) {\n        if (overTargetAncestor === e.target) break;\n\n        overTargetAncestor = overTargetAncestor.parentNode;\n      }\n\n      // The pointer has entered a non-ancestor of the original overTarget. This means we need a pointerentered\n      // event.\n      const didPointerEnter =\n        !overTargetAncestor ||\n        overTargetAncestor ===\n          (Node.isNode(this.rootTarget) && this.rootTarget.parentNode);\n\n      if (didPointerEnter) {\n        const enterEvent = this.clonePointerEvent(e, 'pointerenter');\n\n        enterEvent.eventPhase = enterEvent.AT_TARGET;\n\n        while (\n          enterEvent.target &&\n          enterEvent.target !== outTarget &&\n          enterEvent.target !==\n            (Node.isNode(this.rootTarget) && this.rootTarget.parentNode)\n        ) {\n          enterEvent.currentTarget = enterEvent.target;\n\n          this.notifyTarget(enterEvent);\n          if (isMouse) this.notifyTarget(enterEvent, 'mouseenter');\n\n          if (Node.isNode(enterEvent.target)) {\n            enterEvent.target = enterEvent.target.parentNode;\n          }\n        }\n\n        this.freeEvent(enterEvent);\n      }\n\n      this.freeEvent(overEvent);\n    }\n\n    // Then pointermove\n    this.dispatchEvent(e, 'pointermove');\n\n    if (e.pointerType === 'touch') this.dispatchEvent(e, 'touchmove');\n\n    if (isMouse) {\n      this.dispatchEvent(e, 'mousemove');\n      this.cursor = this.getCursor(e.target);\n    }\n\n    trackingData.overTargets = e.composedPath();\n\n    this.freeEvent(e);\n  };\n\n  onPointerOut = (from: FederatedPointerEvent) => {\n    const trackingData = this.trackingData(from.pointerId);\n\n    if (trackingData.overTargets) {\n      const isMouse =\n        from.pointerType === 'mouse' || from.pointerType === 'pen';\n      const outTarget = this.findMountedTarget(trackingData.overTargets);\n\n      // pointerout first\n      const outEvent = this.createPointerEvent(\n        from,\n        'pointerout',\n        outTarget || undefined,\n      );\n\n      this.dispatchEvent(outEvent);\n      if (isMouse) this.dispatchEvent(outEvent, 'mouseout');\n\n      // pointerleave(s) are also dispatched b/c the pointer must've left rootTarget and its descendants to\n      // get an upstream pointerout event (upstream events do not know rootTarget has descendants).\n      const leaveEvent = this.createPointerEvent(\n        from,\n        'pointerleave',\n        outTarget || undefined,\n      );\n\n      leaveEvent.eventPhase = leaveEvent.AT_TARGET;\n\n      while (\n        leaveEvent.target &&\n        leaveEvent.target !==\n          (Node.isNode(this.rootTarget) && this.rootTarget.parentNode)\n      ) {\n        leaveEvent.currentTarget = leaveEvent.target;\n\n        this.notifyTarget(leaveEvent);\n        if (isMouse) {\n          this.notifyTarget(leaveEvent, 'mouseleave');\n        }\n\n        if (Node.isNode(leaveEvent.target)) {\n          leaveEvent.target = leaveEvent.target.parentNode;\n        }\n      }\n\n      trackingData.overTargets = null;\n\n      this.freeEvent(outEvent);\n      this.freeEvent(leaveEvent);\n    }\n\n    this.cursor = null;\n  };\n\n  onPointerOver = (from: FederatedPointerEvent) => {\n    const trackingData = this.trackingData(from.pointerId);\n    const e = this.createPointerEvent(from);\n\n    const isMouse = e.pointerType === 'mouse' || e.pointerType === 'pen';\n\n    this.dispatchEvent(e, 'pointerover');\n    if (isMouse) this.dispatchEvent(e, 'mouseover');\n    if (e.pointerType === 'mouse') this.cursor = this.getCursor(e.target);\n\n    // pointerenter events must be fired since the pointer entered from upstream.\n    const enterEvent = this.clonePointerEvent(e, 'pointerenter');\n\n    enterEvent.eventPhase = enterEvent.AT_TARGET;\n\n    while (\n      enterEvent.target &&\n      enterEvent.target !==\n        (Node.isNode(this.rootTarget) && this.rootTarget.parentNode)\n    ) {\n      enterEvent.currentTarget = enterEvent.target;\n\n      this.notifyTarget(enterEvent);\n      if (isMouse) {\n        // mouseenter should not bubble\n        // @see https://developer.mozilla.org/en-US/docs/Web/API/Element/mouseenter_event#usage_notes\n        this.notifyTarget(enterEvent, 'mouseenter');\n      }\n\n      if (Node.isNode(enterEvent.target)) {\n        enterEvent.target = enterEvent.target.parentNode;\n      }\n    }\n\n    trackingData.overTargets = e.composedPath();\n\n    this.freeEvent(e);\n    this.freeEvent(enterEvent);\n  };\n\n  onPointerUpOutside = (from: FederatedPointerEvent) => {\n    const trackingData = this.trackingData(from.pointerId);\n    const pressTarget = this.findMountedTarget(\n      trackingData.pressTargetsByButton[from.button],\n    );\n    const e = this.createPointerEvent(from);\n\n    if (pressTarget) {\n      let currentTarget: IEventTarget | null = pressTarget;\n\n      while (currentTarget) {\n        e.currentTarget = currentTarget;\n\n        this.notifyTarget(e, 'pointerupoutside');\n\n        if (e.pointerType === 'touch') {\n          // this.notifyTarget(e, 'touchendoutside');\n        } else if (e.pointerType === 'mouse' || e.pointerType === 'pen') {\n          this.notifyTarget(\n            e,\n            e.button === 2 ? 'rightupoutside' : 'mouseupoutside',\n          );\n        }\n\n        if (Node.isNode(currentTarget)) {\n          currentTarget = currentTarget.parentNode;\n        }\n      }\n\n      delete trackingData.pressTargetsByButton[from.button];\n    }\n\n    this.freeEvent(e);\n  };\n\n  onWheel = (from: FederatedWheelEvent) => {\n    const wheelEvent = this.createWheelEvent(from);\n\n    this.dispatchEvent(wheelEvent);\n    this.freeEvent(wheelEvent);\n  };\n\n  onClick = (from: FederatedPointerEvent) => {\n    if (this.context.config.useNativeClickEvent) {\n      const e = this.createPointerEvent(from);\n      this.dispatchEvent(e);\n      this.freeEvent(e);\n    }\n  };\n\n  onPointerCancel = (from: FederatedPointerEvent) => {\n    const e = this.createPointerEvent(\n      from,\n      undefined,\n      undefined,\n      this.context.config.alwaysTriggerPointerEventOnCanvas\n        ? this.rootTarget\n        : undefined,\n    );\n\n    this.dispatchEvent(e);\n    this.freeEvent(e);\n  };\n\n  dispatchEvent(e: FederatedEvent, type?: string, skipPropagate?: boolean) {\n    // Canvas should skip\n    if (!skipPropagate) {\n      e.propagationStopped = false;\n      e.propagationImmediatelyStopped = false;\n      this.propagate(e, type);\n    } else {\n      // target phase\n      e.eventPhase = e.AT_TARGET;\n      const canvas = (this.rootTarget as IDocument).defaultView || null;\n      e.currentTarget = canvas;\n      this.notifyListeners(e, type);\n    }\n\n    this.emitter.emit(type || e.type, e);\n  }\n\n  propagate(e: FederatedEvent, type?: string) {\n    if (!e.target) {\n      return;\n    }\n\n    // [target, parent, root, Canvas]\n    const composedPath = e.composedPath();\n\n    // event flow: capture -> target -> bubbling\n\n    // capture phase\n    e.eventPhase = e.CAPTURING_PHASE;\n    for (let i = composedPath.length - 1; i >= 1; i--) {\n      e.currentTarget = composedPath[i];\n      this.notifyTarget(e, type);\n      if (e.propagationStopped || e.propagationImmediatelyStopped) return;\n    }\n\n    // target phase\n    e.eventPhase = e.AT_TARGET;\n    e.currentTarget = e.target;\n    this.notifyTarget(e, type);\n    if (e.propagationStopped || e.propagationImmediatelyStopped) return;\n\n    // find current target in composed path\n    const index = composedPath.indexOf(e.currentTarget);\n\n    // bubbling phase\n    e.eventPhase = e.BUBBLING_PHASE;\n    for (let i = index + 1; i < composedPath.length; i++) {\n      e.currentTarget = composedPath[i];\n      this.notifyTarget(e, type);\n      if (e.propagationStopped || e.propagationImmediatelyStopped) return;\n    }\n  }\n\n  propagationPath(target: IEventTarget): IEventTarget[] {\n    const propagationPath = [target];\n    const canvas = (this.rootTarget as IDocument).defaultView || null;\n\n    if (canvas && canvas === (target as unknown as ICanvas)) {\n      propagationPath.unshift(canvas.document);\n      return propagationPath;\n    }\n\n    for (let i = 0; i < PROPAGATION_LIMIT && target !== this.rootTarget; i++) {\n      // if (Node.isNode(target) && !target.parentNode) {\n      //   throw new Error('Cannot find propagation path to disconnected target');\n      // }\n\n      if (Node.isNode(target) && target.parentNode) {\n        // [target, parent, parent, root]\n        propagationPath.push(target.parentNode);\n        target = target.parentNode;\n      }\n    }\n\n    if (canvas) {\n      // @ts-ignore\n      propagationPath.push(canvas);\n    }\n\n    return propagationPath;\n  }\n\n  hitTest(position: EventPosition): IEventTarget | null {\n    const { viewportX, viewportY } = position;\n    const { width, height, disableHitTesting } = this.context.config;\n    // outside canvas\n    if (\n      viewportX < 0 ||\n      viewportY < 0 ||\n      viewportX > width ||\n      viewportY > height\n    ) {\n      return null;\n    }\n\n    return (\n      (!disableHitTesting && this.pickHandler(position)) ||\n      this.rootTarget || // return Document\n      null\n    );\n  }\n\n  /**\n   * whether the native event trigger came from Canvas,\n   * should account for HTML shape\n   */\n  isNativeEventFromCanvas(\n    $el: HTMLCanvasElement,\n    nativeEvent: InteractivePointerEvent,\n  ) {\n    let target = nativeEvent?.target as Element;\n    // Get event target inside a web component.\n    // @see https://stackoverflow.com/questions/57963312/get-event-target-inside-a-web-component\n    if (target?.shadowRoot) {\n      target = nativeEvent.composedPath()[0] as Element;\n    }\n\n    if (target) {\n      // from <canvas>\n      if (target === $el) {\n        return true;\n      }\n\n      // from <svg>\n      if ($el && ($el as unknown as HTMLCanvasElement).contains) {\n        return ($el as unknown as HTMLCanvasElement).contains(target as any);\n      }\n    }\n\n    if (nativeEvent?.composedPath) {\n      return nativeEvent.composedPath().indexOf($el as EventTarget) > -1;\n    }\n\n    // account for Touch\n    return false;\n  }\n\n  /**\n   * Find HTML from composed path in native UI event.\n   */\n  private getExistedHTML(event: FederatedEvent): HTML {\n    if (event.nativeEvent.composedPath) {\n      for (const eventTarget of event.nativeEvent.composedPath() as HTMLElement[]) {\n        const existed = this.nativeHTMLMap.get(eventTarget);\n        if (existed) {\n          return existed;\n        }\n      }\n    }\n\n    return null;\n  }\n\n  private pickTarget(\n    event: FederatedPointerEvent | FederatedWheelEvent,\n  ): INode {\n    return this.hitTest({\n      clientX: event.clientX,\n      clientY: event.clientY,\n      viewportX: event.viewportX,\n      viewportY: event.viewportY,\n      x: event.canvasX,\n      y: event.canvasY,\n    }) as INode;\n  }\n\n  private createPointerEvent(\n    from: FederatedPointerEvent,\n    type?: string,\n    target?: IEventTarget,\n    fallbackTarget?: IEventTarget,\n  ): FederatedPointerEvent {\n    const event = this.allocateEvent(FederatedPointerEvent);\n\n    this.copyPointerData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from;\n\n    const existedHTML = this.getExistedHTML(event);\n    const $el =\n      this.context.contextService.getDomElement() as HTMLCanvasElement;\n    event.target =\n      target ??\n      (existedHTML ||\n        (this.isNativeEventFromCanvas($el, event.nativeEvent) &&\n          this.pickTarget(event)) ||\n        fallbackTarget);\n\n    if (typeof type === 'string') {\n      event.type = type;\n    }\n\n    return event;\n  }\n\n  private createWheelEvent(from: FederatedWheelEvent): FederatedWheelEvent {\n    const event = this.allocateEvent(FederatedWheelEvent);\n\n    this.copyWheelData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from;\n    const existedHTML = this.getExistedHTML(event);\n\n    const $el =\n      this.context.contextService.getDomElement() as HTMLCanvasElement;\n    event.target =\n      existedHTML ||\n      (this.isNativeEventFromCanvas($el, event.nativeEvent) &&\n        this.pickTarget(event));\n    return event;\n  }\n\n  private trackingData(id: number): TrackingData {\n    if (!this.mappingState.trackingData[id]) {\n      this.mappingState.trackingData[id] = {\n        pressTargetsByButton: {},\n        clicksByButton: {},\n        overTarget: null,\n      };\n    }\n\n    return this.mappingState.trackingData[id];\n  }\n\n  cloneWheelEvent(from: FederatedWheelEvent) {\n    const event = this.allocateEvent(FederatedWheelEvent);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from.originalEvent;\n\n    this.copyWheelData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.target = from.target;\n    event.path = from.composedPath().slice();\n    event.type = from.type;\n\n    return event;\n  }\n\n  clonePointerEvent(\n    from: FederatedPointerEvent,\n    type?: string,\n  ): FederatedPointerEvent {\n    const event = this.allocateEvent(FederatedPointerEvent);\n\n    event.nativeEvent = from.nativeEvent;\n    event.originalEvent = from.originalEvent;\n\n    this.copyPointerData(from, event);\n    this.copyMouseData(from, event);\n    this.copyData(from, event);\n\n    event.target = from.target;\n    event.path = from.composedPath().slice();\n    event.type = type ?? event.type;\n\n    return event;\n  }\n\n  private copyPointerData(\n    from: FederatedPointerEvent,\n    to: FederatedPointerEvent,\n  ) {\n    // if (\n    //   !(\n    //     from instanceof FederatedPointerEvent &&\n    //     to instanceof FederatedPointerEvent\n    //   )\n    // )\n    //   return;\n\n    to.pointerId = from.pointerId;\n    to.width = from.width;\n    to.height = from.height;\n    to.isPrimary = from.isPrimary;\n    to.pointerType = from.pointerType;\n    to.pressure = from.pressure;\n    to.tangentialPressure = from.tangentialPressure;\n    to.tiltX = from.tiltX;\n    to.tiltY = from.tiltY;\n    to.twist = from.twist;\n  }\n\n  private copyMouseData(from: FederatedMouseEvent, to: FederatedMouseEvent) {\n    // if (\n    //   !(\n    //     from instanceof FederatedMouseEvent && to instanceof FederatedMouseEvent\n    //   )\n    // )\n    //   return;\n\n    to.altKey = from.altKey;\n    to.button = from.button;\n    to.buttons = from.buttons;\n    to.ctrlKey = from.ctrlKey;\n    to.metaKey = from.metaKey;\n    to.shiftKey = from.shiftKey;\n    to.client.copyFrom(from.client);\n    to.movement.copyFrom(from.movement);\n    to.canvas.copyFrom(from.canvas);\n    to.screen.copyFrom(from.screen);\n    to.global.copyFrom(from.global);\n    to.offset.copyFrom(from.offset);\n  }\n\n  private copyWheelData(from: FederatedWheelEvent, to: FederatedWheelEvent) {\n    to.deltaMode = from.deltaMode;\n    to.deltaX = from.deltaX;\n    to.deltaY = from.deltaY;\n    to.deltaZ = from.deltaZ;\n  }\n\n  private copyData(from: FederatedEvent, to: FederatedEvent) {\n    to.isTrusted = from.isTrusted;\n    to.timeStamp = clock.now();\n    to.type = from.type;\n    to.detail = from.detail;\n    to.view = from.view;\n    to.page.copyFrom(from.page);\n    to.viewport.copyFrom(from.viewport);\n  }\n\n  private allocateEvent<T extends FederatedEvent>(constructor: {\n    new (boundary: EventService): T;\n  }): T {\n    if (!this.eventPool.has(constructor as any)) {\n      this.eventPool.set(constructor as any, []);\n    }\n\n    // @ts-ignore\n    const event =\n      (this.eventPool.get(constructor as any).pop() as T) ||\n      new constructor(this);\n\n    event.eventPhase = event.NONE;\n    event.currentTarget = null;\n    event.path = [];\n    event.target = null;\n\n    return event;\n  }\n\n  private freeEvent<T extends FederatedEvent>(event: T) {\n    if (event.manager !== this)\n      throw new Error(\n        'It is illegal to free an event not managed by this EventBoundary!',\n      );\n\n    const { constructor } = event;\n\n    if (!this.eventPool.has(constructor as any)) {\n      this.eventPool.set(constructor as any, []);\n    }\n\n    // @ts-ignore\n    this.eventPool.get(constructor as any).push(event);\n  }\n\n  private notifyTarget(e: FederatedEvent, type?: string) {\n    type = type ?? e.type;\n    const key =\n      e.eventPhase === e.CAPTURING_PHASE || e.eventPhase === e.AT_TARGET\n        ? `${type}capture`\n        : type;\n\n    this.notifyListeners(e, key);\n\n    if (e.eventPhase === e.AT_TARGET) {\n      this.notifyListeners(e, type);\n    }\n  }\n\n  private notifyListeners(e: FederatedEvent, type: string) {\n    // hack EventEmitter, stops if the `propagationImmediatelyStopped` flag is set\n    // @ts-ignore\n    const { emitter } = e.currentTarget;\n    // @ts-ignore\n    const listeners = (emitter._events as EmitterListeners)[type];\n\n    if (!listeners) return;\n\n    if ('fn' in listeners) {\n      if (listeners.once) {\n        emitter.removeListener(type, listeners.fn, undefined, true);\n      }\n      listeners.fn.call(e.currentTarget || listeners.context, e);\n      // listeners.fn.call(listeners.context, e);\n    } else {\n      for (\n        let i = 0;\n        i < listeners.length && !e.propagationImmediatelyStopped;\n        i++\n      ) {\n        if (listeners[i].once) {\n          emitter.removeListener(type, listeners[i].fn, undefined, true);\n        }\n        listeners[i].fn.call(e.currentTarget || listeners[i].context, e);\n        // listeners[i].fn.call(listeners[i].context, e);\n      }\n    }\n  }\n\n  /**\n   * some detached nodes may exist in propagation path, need to skip them\n   */\n  private findMountedTarget(\n    propagationPath: IEventTarget[] | null,\n  ): IEventTarget | null {\n    if (!propagationPath) {\n      return null;\n    }\n\n    let currentTarget = propagationPath[propagationPath.length - 1];\n    for (let i = propagationPath.length - 2; i >= 0; i--) {\n      const target = propagationPath[i];\n      if (\n        target === this.rootTarget ||\n        (Node.isNode(target) && target.parentNode === currentTarget)\n      ) {\n        currentTarget = propagationPath[i];\n      } else {\n        break;\n      }\n    }\n\n    return currentTarget;\n  }\n\n  private getCursor(target: IEventTarget | null) {\n    let tmp: IEventTarget | null = target;\n    while (tmp) {\n      const cursor = isElement(tmp) && tmp.getAttribute('cursor');\n      if (cursor) {\n        return cursor;\n      }\n      tmp = Node.isNode(tmp) && tmp.parentNode;\n    }\n  }\n}\n","import type { CanvasLike } from '..';\nimport { runtime } from '../global-runtime';\n\n/**\n * used in following scenes:\n * - g `ctx.measureText`\n * - g-plugin-canvas-picker `ctx.isPointInPath`\n * - g-plugin-device-renderer `ctx.createLinearGradient` and generate texture\n *\n * @see https://blog.scottlogic.com/2020/03/19/offscreen-canvas.html\n */\nexport class OffscreenCanvasCreator {\n  private canvas: CanvasLike;\n  private context: CanvasRenderingContext2D | OffscreenCanvasRenderingContext2D;\n\n  /**\n   * @returns new canvas instance\n   */\n  static createCanvas(): HTMLCanvasElement | OffscreenCanvas | null {\n    try {\n      return new window.OffscreenCanvas(0, 0);\n    } catch {\n      //\n    }\n\n    try {\n      return document.createElement('canvas');\n    } catch {\n      //\n    }\n\n    return null;\n  }\n\n  getOrCreateCanvas(\n    offscreenCanvas: CanvasLike,\n    contextAttributes?: CanvasRenderingContext2DSettings,\n  ): CanvasLike {\n    if (this.canvas) {\n      return this.canvas;\n    }\n\n    // user-defined offscreen canvas\n    if (offscreenCanvas || runtime.offscreenCanvas) {\n      this.canvas = offscreenCanvas || runtime.offscreenCanvas;\n      this.context = this.canvas.getContext('2d', {\n        willReadFrequently: true,\n        ...contextAttributes,\n      });\n    } else {\n      try {\n        // OffscreenCanvas2D measureText can be up to 40% faster.\n        this.canvas = new window.OffscreenCanvas(0, 0) as unknown as CanvasLike;\n        this.context = this.canvas.getContext('2d', {\n          willReadFrequently: true,\n          ...contextAttributes,\n        });\n        if (!this.context || !this.context.measureText) {\n          this.canvas = document.createElement('canvas');\n          this.context = this.canvas.getContext('2d');\n        }\n      } catch {\n        this.canvas = document.createElement('canvas');\n        this.context = this.canvas.getContext('2d', {\n          willReadFrequently: true,\n          ...contextAttributes,\n        });\n      }\n    }\n\n    this.canvas.width = 10;\n    this.canvas.height = 10;\n\n    return this.canvas;\n  }\n\n  getOrCreateContext(\n    offscreenCanvas: CanvasLike,\n    contextAttributes?: CanvasRenderingContext2DSettings,\n  ) {\n    if (this.context) {\n      return this.context;\n    }\n\n    this.getOrCreateCanvas(offscreenCanvas, contextAttributes);\n    return this.context;\n  }\n}\n","import type { DisplayObject, Group } from '../display-objects';\n\n/**\n * why we need re-render\n */\nexport enum RenderReason {\n  CAMERA_CHANGED,\n  DISPLAY_OBJECT_CHANGED,\n  NONE,\n}\nexport interface RenderingContext {\n  /**\n   * root of scenegraph\n   */\n  root: Group;\n\n  /**\n   * force rendering at next frame\n   */\n  force: boolean;\n\n  /**\n   * reason of re-render, reset after every renderred frame\n   */\n  renderReasons: Set<RenderReason>;\n\n  renderListCurrentFrame: DisplayObject[];\n\n  unculledEntities: number[];\n\n  dirty: boolean;\n}\n","import type { ICamera } from '../camera';\nimport { SortReason, Sortable } from '../components';\nimport type { DisplayObject } from '../display-objects';\nimport type { CanvasContext, IChildNode, IElement } from '../dom';\nimport type { GlobalRuntime } from '../global-runtime';\nimport type {\n  CanvasConfig,\n  EventPosition,\n  InteractivePointerEvent,\n} from '../types';\nimport {\n  AsyncParallelHook,\n  AsyncSeriesWaterfallHook,\n  SyncHook,\n  SyncWaterfallHook,\n  sortByZIndex,\n  sortedIndex,\n} from '../utils';\nimport type { RenderingContext } from './RenderingContext';\nimport { RenderReason } from './RenderingContext';\n\nexport type RenderingPluginContext = CanvasContext & GlobalRuntime;\n\nexport interface RenderingPlugin {\n  apply: (context: RenderingPluginContext, runtime: GlobalRuntime) => void;\n}\n\nexport interface PickingResult {\n  /**\n   * position in canvas coordinate\n   */\n  position: EventPosition;\n  picked: DisplayObject[];\n  /**\n   * only return the topmost object if there are multiple objects overlapped\n   */\n  topmost?: boolean;\n}\n\n/**\n * Use frame renderer implemented by `g-canvas/svg/webgl`, in every frame we do followings:\n * * update & merge dirty rectangles\n * * begin frame\n * * filter by visible\n * * sort by z-index in scene graph\n * * culling with strategies registered in `g-canvas/webgl`\n * * end frame\n */\nexport class RenderingService {\n  constructor(\n    private globalRuntime: GlobalRuntime,\n    private context: CanvasContext,\n  ) {}\n\n  private inited = false;\n\n  private stats = {\n    /**\n     * total display objects in scenegraph\n     */\n    total: 0,\n    /**\n     * number of display objects need to render in current frame\n     */\n    rendered: 0,\n  };\n\n  private zIndexCounter = 0;\n\n  hooks = {\n    /**\n     * called before any frame rendered\n     */\n    init: new SyncHook<[]>(),\n    initAsync: new AsyncParallelHook<[]>(),\n    /**\n     * only dirty object which has sth changed will be rendered\n     */\n    dirtycheck: new SyncWaterfallHook<[DisplayObject], DisplayObject>(),\n    /**\n     * do culling\n     */\n    cull: new SyncWaterfallHook<[DisplayObject, ICamera], DisplayObject>(),\n    /**\n     * called at beginning of each frame, won't get called if nothing to re-render\n     */\n    beginFrame: new SyncHook<[XRFrame]>(),\n    /**\n     * called before every dirty object get rendered\n     */\n    beforeRender: new SyncHook<[DisplayObject]>(),\n    /**\n     * called when every dirty object rendering even it's culled\n     */\n    render: new SyncHook<[DisplayObject]>(),\n    /**\n     * called after every dirty object get rendered\n     */\n    afterRender: new SyncHook<[DisplayObject]>(),\n    endFrame: new SyncHook<[XRFrame]>(),\n    destroy: new SyncHook<[]>(),\n    /**\n     * use async but faster method such as GPU-based picking in `g-plugin-device-renderer`\n     */\n    pick: new AsyncSeriesWaterfallHook<[PickingResult], PickingResult>(),\n\n    /**\n     * Unsafe but sync version of pick.\n     */\n    pickSync: new SyncWaterfallHook<[PickingResult], PickingResult>(),\n    /**\n     * used in event system\n     */\n    pointerDown: new SyncHook<[InteractivePointerEvent]>(),\n    pointerUp: new SyncHook<[InteractivePointerEvent]>(),\n    pointerMove: new SyncHook<[InteractivePointerEvent]>(),\n    pointerOut: new SyncHook<[InteractivePointerEvent]>(),\n    pointerOver: new SyncHook<[InteractivePointerEvent]>(),\n    pointerWheel: new SyncHook<[InteractivePointerEvent]>(),\n    pointerCancel: new SyncHook<[InteractivePointerEvent]>(),\n    click: new SyncHook<[InteractivePointerEvent]>(),\n  };\n\n  init(callback: () => void) {\n    const context = { ...this.globalRuntime, ...this.context };\n\n    // register rendering plugins\n    this.context.renderingPlugins.forEach((plugin) => {\n      plugin.apply(context, this.globalRuntime);\n    });\n    this.hooks.init.call();\n\n    if (this.hooks.initAsync.getCallbacksNum() === 0) {\n      this.inited = true;\n      callback();\n    } else {\n      this.hooks.initAsync.promise().then(() => {\n        this.inited = true;\n        callback();\n      });\n    }\n  }\n\n  getStats() {\n    return this.stats;\n  }\n\n  /**\n   * Meet the following conditions:\n   * * disable DirtyRectangleRendering\n   * * camera changed\n   */\n  disableDirtyRectangleRendering() {\n    const { renderer } = this.context.config;\n    const { enableDirtyRectangleRendering } = renderer.getConfig();\n    return (\n      !enableDirtyRectangleRendering ||\n      this.context.renderingContext.renderReasons.has(\n        RenderReason.CAMERA_CHANGED,\n      )\n    );\n  }\n\n  render(\n    canvasConfig: Partial<CanvasConfig>,\n    frame: XRFrame,\n    rerenderCallback: () => void,\n  ) {\n    this.stats.total = 0;\n    this.stats.rendered = 0;\n    this.zIndexCounter = 0;\n\n    const { renderingContext } = this.context;\n\n    this.globalRuntime.sceneGraphService.syncHierarchy(renderingContext.root);\n    this.globalRuntime.sceneGraphService.triggerPendingEvents();\n\n    if (renderingContext.renderReasons.size && this.inited) {\n      // @ts-ignore\n      renderingContext.dirtyRectangleRenderingDisabled =\n        this.disableDirtyRectangleRendering();\n\n      const onlyCameraChanged =\n        renderingContext.renderReasons.size === 1 &&\n        renderingContext.renderReasons.has(RenderReason.CAMERA_CHANGED);\n      const shouldTriggerRenderHooks =\n        !canvasConfig.disableRenderHooks ||\n        !(canvasConfig.disableRenderHooks && onlyCameraChanged);\n\n      if (shouldTriggerRenderHooks) {\n        this.renderDisplayObject(\n          renderingContext.root,\n          canvasConfig,\n          renderingContext,\n        );\n      }\n\n      this.hooks.beginFrame.call(frame);\n\n      if (shouldTriggerRenderHooks) {\n        renderingContext.renderListCurrentFrame.forEach((object) => {\n          this.hooks.beforeRender.call(object);\n          this.hooks.render.call(object);\n          this.hooks.afterRender.call(object);\n        });\n      }\n\n      this.hooks.endFrame.call(frame);\n      renderingContext.renderListCurrentFrame = [];\n      renderingContext.renderReasons.clear();\n\n      rerenderCallback();\n    }\n\n    // console.log('stats', this.stats);\n  }\n\n  private renderDisplayObject(\n    displayObject: DisplayObject,\n    canvasConfig: Partial<CanvasConfig>,\n    renderingContext: RenderingContext,\n  ) {\n    const { enableDirtyCheck, enableCulling } =\n      canvasConfig.renderer.getConfig();\n\n    // TODO: relayout\n\n    // dirtycheck first\n    const { renderable } = displayObject;\n    // eslint-disable-next-line no-nested-ternary\n    const objectChanged = enableDirtyCheck\n      ? // @ts-ignore\n        renderable.dirty || renderingContext.dirtyRectangleRenderingDisabled\n        ? displayObject\n        : null\n      : displayObject;\n\n    if (objectChanged) {\n      const objectToRender = enableCulling\n        ? this.hooks.cull.call(objectChanged, this.context.camera)\n        : objectChanged;\n\n      if (objectToRender) {\n        this.stats.rendered++;\n        renderingContext.renderListCurrentFrame.push(objectToRender);\n      }\n    }\n\n    displayObject.renderable.dirty = false;\n    displayObject.sortable.renderOrder = this.zIndexCounter++;\n\n    this.stats.total++;\n\n    // sort is very expensive, use cached result if possible\n    const { sortable } = displayObject;\n    if (sortable.dirty) {\n      this.sort(displayObject, sortable);\n      sortable.dirty = false;\n      sortable.dirtyChildren = [];\n      sortable.dirtyReason = undefined;\n    }\n\n    // recursive rendering its children\n    (sortable.sorted || displayObject.childNodes).forEach(\n      (child: DisplayObject) => {\n        this.renderDisplayObject(child, canvasConfig, renderingContext);\n      },\n    );\n  }\n\n  private sort(displayObject: DisplayObject, sortable: Sortable) {\n    if (\n      sortable.sorted &&\n      sortable.dirtyReason !== SortReason.Z_INDEX_CHANGED\n    ) {\n      // avoid re-sorting the whole children list\n      sortable.dirtyChildren.forEach((child) => {\n        const index = displayObject.childNodes.indexOf(child as IChildNode);\n        if (index === -1) {\n          // remove from sorted list\n          const index = sortable.sorted.indexOf(child);\n          if (index >= 0) {\n            sortable.sorted.splice(index, 1);\n          }\n        } else if (sortable.sorted.length === 0) {\n          sortable.sorted.push(child);\n        } else {\n          const index = sortedIndex(\n            sortable.sorted as IElement[],\n            child as IElement,\n          );\n          sortable.sorted.splice(index, 0, child);\n        }\n      });\n    } else {\n      sortable.sorted = displayObject.childNodes.slice().sort(sortByZIndex);\n    }\n  }\n\n  destroy() {\n    this.inited = false;\n    this.hooks.destroy.call();\n    this.globalRuntime.sceneGraphService.clearPendingEvents();\n  }\n\n  dirtify() {\n    // need re-render\n    this.context.renderingContext.renderReasons.add(\n      RenderReason.DISPLAY_OBJECT_CHANGED,\n    );\n  }\n}\n","import { isNil } from '@antv/util';\nimport type { IElement } from '../dom/interfaces';\n\nexport interface SceneGraphSelector {\n  selectOne: <R extends IElement, T extends IElement>(\n    query: string,\n    root: R,\n  ) => T | null;\n  selectAll: <R extends IElement, T extends IElement>(\n    query: string,\n    root: R,\n  ) => T[];\n  is: <T extends IElement>(query: string, element: T) => boolean;\n}\n\nconst ATTRIBUTE_REGEXP = /\\[\\s*(.*)=(.*)\\s*\\]/;\n\n/**\n * support the following DOM API:\n * * getElementById\n * * getElementsByClassName\n * * getElementsByName\n * * getElementsByTag\n * * querySelector\n * * querySelectorAll\n */\nexport class DefaultSceneGraphSelector implements SceneGraphSelector {\n  selectOne<R extends IElement, T extends IElement>(\n    query: string,\n    root: R,\n  ): T | null {\n    if (query.startsWith('.')) {\n      return root.find((node) => {\n        // return !node.shadow && node.id === query.substring(1);\n        return (\n          (node?.classList || []).indexOf(this.getIdOrClassname(query)) > -1\n        );\n      });\n    }\n    if (query.startsWith('#')) {\n      // getElementById('id')\n      return root.find((node) => {\n        // return !node.shadow && node.id === query.substring(1);\n        return node.id === this.getIdOrClassname(query);\n      });\n    }\n    if (query.startsWith('[')) {\n      const { name, value } = this.getAttribute(query);\n      if (name) {\n        // getElementByName();\n        return root.find(\n          (node) =>\n            (root as unknown as T) !== node &&\n            (name === 'name'\n              ? node.name === value\n              : this.attributeToString(node, name) === value),\n        );\n      }\n      return null;\n    }\n    // getElementsByTag('circle');\n    return root.find(\n      (node) => (root as unknown as T) !== node && node.nodeName === query,\n    );\n  }\n\n  selectAll<R extends IElement, T extends IElement>(\n    query: string,\n    root: R,\n  ): T[] {\n    // only support `[name=\"${name}\"]` `.className` `#id`\n    if (query.startsWith('.')) {\n      // getElementsByClassName('className');\n      // should not include itself\n      return root.findAll(\n        (node) =>\n          (root as unknown as T) !== node &&\n          (node?.classList || []).indexOf(this.getIdOrClassname(query)) > -1,\n      );\n    }\n    if (query.startsWith('#')) {\n      return root.findAll(\n        (node) =>\n          (root as unknown as T) !== node &&\n          node.id === this.getIdOrClassname(query),\n      );\n    }\n    if (query.startsWith('[')) {\n      const { name, value } = this.getAttribute(query);\n      if (name) {\n        // getElementsByName();\n        return root.findAll(\n          (node) =>\n            (root as unknown as T) !== node &&\n            (name === 'name'\n              ? node.name === value\n              : this.attributeToString(node, name) === value),\n        );\n      }\n      return [];\n    }\n    // getElementsByTag('circle');\n    return root.findAll(\n      (node) => (root as unknown as T) !== node && node.nodeName === query,\n    );\n  }\n\n  is<T extends IElement>(query: string, node: T): boolean {\n    // a simple `matches` implementation\n    if (query.startsWith('.')) {\n      return node.className === this.getIdOrClassname(query);\n    }\n    if (query.startsWith('#')) {\n      return node.id === this.getIdOrClassname(query);\n    }\n    if (query.startsWith('[')) {\n      const { name, value } = this.getAttribute(query);\n      return name === 'name'\n        ? node.name === value\n        : this.attributeToString(node, name) === value;\n    }\n    return node.nodeName === query;\n  }\n\n  private getIdOrClassname(query: string): string {\n    return query.substring(1);\n  }\n\n  private getAttribute(query: string): Record<string, string> {\n    const matches = query.match(ATTRIBUTE_REGEXP);\n    let name = '';\n    let value = '';\n    if (matches && matches.length > 2) {\n      name = matches[1].replace(/\"/g, '');\n      value = matches[2].replace(/\"/g, '');\n    }\n    return { name, value };\n  }\n\n  private attributeToString(node: IElement, name: string): string {\n    if (!node.getAttribute) {\n      return '';\n    }\n\n    const value = node.getAttribute(name);\n\n    if (isNil(value)) {\n      return '';\n    }\n\n    if (value.toString) {\n      return value.toString();\n    }\n\n    return '';\n  }\n}\n","import type RBush from 'rbush';\nimport type { GlobalRuntime } from '..';\nimport type { ICamera } from '../camera';\nimport type { RBushNodeAABB } from '../components';\nimport type { DisplayObject } from '../display-objects';\nimport type {\n  ContextService,\n  EventService,\n  RenderingContext,\n  RenderingPlugin,\n  RenderingService,\n} from '../services';\nimport type { AABB, PointLike, Rectangle } from '../shapes';\nimport type {\n  BaseStyleProps,\n  CanvasConfig,\n  InteractivePointerEvent,\n  Shape,\n  TypeEasingFunction,\n} from '../types';\nimport type { CustomElementRegistry } from './CustomElementRegistry';\nimport type { FederatedEvent } from './FederatedEvent';\n\n/**\n * built-in events for element\n * @see https://developer.mozilla.org/en-US/docs/Web/API/MutationEvent\n *\n * TODO: use MutationObserver instead\n * @see https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver\n */\nexport enum ElementEvent {\n  REPARENT = 'reparent',\n\n  DESTROY = 'destroy',\n\n  /**\n   * @see https://www.w3.org/TR/DOM-Level-3-Events/#event-type-DOMAttrModified\n   */\n  ATTR_MODIFIED = 'DOMAttrModified',\n\n  /**\n   * it has been inserted\n   * @see https://www.w3.org/TR/DOM-Level-3-Events/#event-type-DOMNodeInserted\n   */\n  INSERTED = 'DOMNodeInserted',\n\n  /**\n   * it is being removed\n   * @see https://www.w3.org/TR/DOM-Level-3-Events/#event-type-DOMNodeRemoved\n   */\n  REMOVED = 'removed',\n\n  /**\n   * @see https://www.w3.org/TR/DOM-Level-3-Events/#domnodeinsertedintodocument\n   */\n  MOUNTED = 'DOMNodeInsertedIntoDocument',\n\n  /**\n   * @see https://www.w3.org/TR/DOM-Level-3-Events/#domnoderemovedfromdocument\n   */\n  UNMOUNTED = 'DOMNodeRemovedFromDocument',\n\n  BOUNDS_CHANGED = 'bounds-changed',\n\n  CULLED = 'culled',\n}\n\nexport interface IEventTarget {\n  // emitter: EventEmitter;\n\n  // on: (\n  //   type: string,\n  //   listener: EventListenerOrEventListenerObject | ((...args: any[]) => void),\n  //   options?: boolean | AddEventListenerOptions,\n  // ) => void;\n  addEventListener: (\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n  ) => void;\n\n  // off: (\n  //   type: string,\n  //   listener: EventListenerOrEventListenerObject | ((...args: any[]) => void),\n  //   options?: boolean | AddEventListenerOptions,\n  // ) => void;\n  removeEventListener: (\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n  ) => void;\n  // removeAllEventListeners: () => void;\n\n  dispatchEvent: <T extends FederatedEvent>(\n    e: T,\n    skipPropagate?: boolean,\n  ) => boolean;\n\n  // emit: (eventName: string, object: object) => void;\n}\n\nexport interface INode extends IEventTarget {\n  shadow: boolean;\n  /**\n   * Returns node's node document's document base URL.\n   */\n  readonly baseURI: string;\n  /**\n   * Returns the children.\n   */\n  readonly childNodes: IChildNode[];\n  /**\n   * Returns the first child.\n   */\n  readonly firstChild: IChildNode | null;\n  /**\n   * Returns true if node is connected and false otherwise.\n   */\n  isConnected: boolean;\n  /**\n   * Returns the last child.\n   */\n  readonly lastChild: IChildNode | null;\n\n  /**\n   * Returns the next sibling.\n   */\n  readonly nextSibling: IChildNode | null;\n  /**\n   * Returns a string appropriate for the type of node.\n   */\n  readonly nodeName: string;\n  /**\n   * Returns the type of node.\n   */\n  readonly nodeType: number;\n  nodeValue: string | null;\n  /**\n   * Returns the node document. Returns null for documents.\n   */\n  ownerDocument: IDocument | null;\n  /**\n   * Returns the parent element.\n   */\n  readonly parentElement: IElement | null;\n  /**\n   * Returns the parent.\n   */\n  parentNode: (INode & IParentNode) | null;\n  /**\n   * Returns the previous sibling.\n   */\n  readonly previousSibling: IChildNode | null;\n  textContent: string | null;\n  appendChild: <T extends INode>(newChild: T, index?: number) => T;\n  /**\n   * Returns a copy of node. If deep is true, the copy also includes the node's descendants.\n   */\n  cloneNode: (deep?: boolean) => INode;\n  /**\n   * Returns a bitmask indicating the position of other relative to node.\n   */\n  compareDocumentPosition: (other: INode) => number;\n  /**\n   * Returns true if other is an inclusive descendant of node, and false otherwise.\n   */\n  contains: (other: INode | null) => boolean;\n  /**\n   * Returns node's root.\n   */\n  getRootNode: (options?: GetRootNodeOptions) => INode;\n  /**\n   * Returns node's ancestor.\n   */\n  getAncestor: (n: number) => INode | null;\n  /**\n   * Traverse in sub tree.\n   */\n  forEach: (callback: (o: INode) => void | boolean) => void;\n  /**\n   * Returns whether node has children.\n   */\n  hasChildNodes: () => boolean;\n  insertBefore: <T extends INode>(newChild: T, refChild: INode | null) => T;\n  isDefaultNamespace: (namespace: string | null) => boolean;\n  /**\n   * Returns whether node and otherNode have the same properties.\n   */\n  isEqualNode: (otherNode: INode | null) => boolean;\n  isSameNode: (otherNode: INode | null) => boolean;\n  lookupNamespaceURI: (prefix: string | null) => string | null;\n  lookupPrefix: (namespace: string | null) => string | null;\n  /**\n   * Removes empty exclusive Text nodes and concatenates the data of remaining contiguous exclusive Text nodes into the first of their nodes.\n   */\n  normalize: () => void;\n  removeChild: <T extends INode>(oldChild: T) => T;\n  replaceChild: <T extends INode>(newChild: INode, oldChild: T) => T;\n\n  /**\n   * Destroy itself.\n   */\n  destroy: () => void;\n}\n\nexport interface IParentNode {\n  readonly childElementCount: number;\n  /**\n   * Returns the child elements.\n   */\n  readonly children: IElement[];\n  /**\n   * Returns the first child that is an element, and null otherwise.\n   */\n  readonly firstElementChild: IElement | null;\n  /**\n   * Returns the last child that is an element, and null otherwise.\n   */\n  readonly lastElementChild: IElement | null;\n  /**\n   * Inserts nodes after the last child of node, while replacing strings in nodes with equivalent Text nodes.\n   *\n   * Throws a \"HierarchyRequestError\" DOMException if the constraints of the node tree are violated.\n   */\n  append: (...nodes: INode[]) => void;\n  /**\n   * Inserts nodes before the first child of node, while replacing strings in nodes with equivalent Text nodes.\n   *\n   * Throws a \"HierarchyRequestError\" DOMException if the constraints of the node tree are violated.\n   */\n  prepend: (...nodes: INode[]) => void;\n  /**\n   * Returns the first element that is a descendant of node that matches selectors.\n   */\n  querySelector: <E extends IElement = IElement>(selectors: string) => E | null;\n  /**\n   * Returns all element descendants of node that match selectors.\n   */\n  querySelectorAll: <E extends IElement = IElement>(selectors: string) => E[];\n  /**\n   * Similar to querySelector, use custom filter instead of selectors.\n   */\n  find: <E extends IElement = IElement>(\n    filter: (node: E) => boolean,\n  ) => E | null;\n  /**\n   * Similar to querySelectorAll, use custom filter instead of selectors.\n   */\n  findAll: <E extends IElement = IElement>(filter: (node: E) => boolean) => E[];\n}\n\nexport interface IChildNode extends INode {\n  /**\n   * Inserts nodes just after node, while replacing strings in nodes with equivalent Text nodes.\n   *\n   * Throws a \"HierarchyRequestError\" DOMException if the constraints of the node tree are violated.\n   */\n  after: (...nodes: INode[]) => void;\n  /**\n   * Inserts nodes just before node, while replacing strings in nodes with equivalent Text nodes.\n   *\n   * Throws a \"HierarchyRequestError\" DOMException if the constraints of the node tree are violated.\n   */\n  before: (...nodes: INode[]) => void;\n  /**\n   * Removes node.\n   */\n  remove: () => void;\n  /**\n   * Replaces node with nodes, while replacing strings in nodes with equivalent Text nodes.\n   *\n   * Throws a \"HierarchyRequestError\" DOMException if the constraints of the node tree are violated.\n   */\n  replaceWith: (...nodes: INode[]) => void;\n}\n\nexport interface DisplayObjectConfig<StyleProps> {\n  /**\n   * element's identifier, must be unique in a document.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/id\n   */\n  id?: string;\n\n  name?: string;\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/className\n   */\n  class?: string;\n  className?: string;\n\n  /**\n   * all styles properties, not read-only\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style\n   */\n  style?: StyleProps;\n  initialParsedStyle?: any;\n  /**\n   * compatible with G 3.0\n   * @alias style\n   * @deprecated\n   */\n  attrs?: StyleProps;\n\n  type?: Shape | string;\n\n  /**\n   * @deprecated use `style.zIndex` instead\n   */\n  zIndex?: number;\n  /**\n   * @deprecated use `style.visibility = 'visible'` instead\n   */\n  visible?: boolean;\n  /**\n   * compatible with G 3.0\n   * @alias interactive\n   * @deprecated\n   */\n  capture?: boolean;\n\n  /**\n   * enable interaction events for the DisplayObject\n   * @deprecated use `style.pointerEvents = 'auto'` instead\n   */\n  interactive?: boolean;\n}\n\nexport interface IElement<StyleProps = any, ParsedStyleProps = any>\n  extends INode,\n    IChildNode,\n    IParentNode {\n  /**\n   * Returns the value of element's id content attribute. Can be set to change it.\n   */\n  id: string;\n\n  /**\n   * Returns the qualified name.\n   */\n  tagName: string;\n\n  name: string;\n\n  /**\n   * Returns the value of element's class content attribute. Can be set to change it.\n   */\n  className: string;\n  classList: string[];\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/attributes\n   */\n  attributes: StyleProps;\n\n  /**\n   * compatible with `style`\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style\n   */\n  style: StyleProps & ICSSStyleDeclaration<StyleProps>;\n  parsedStyle: ParsedStyleProps;\n\n  getElementById: <E extends IElement = IElement>(id: string) => E | null;\n  getElementsByName: <E extends IElement = IElement>(name: string) => E[];\n  getElementsByClassName: <E extends IElement = IElement>(\n    className: string,\n  ) => E[];\n  getElementsByTagName: <E extends IElement = IElement>(tagName: string) => E[];\n\n  scrollLeft: number;\n  scrollTop: number;\n  clientLeft: number;\n  clientTop: number;\n\n  getGeometryBounds(): AABB;\n  getRenderBounds(): AABB;\n  getBounds(): AABB;\n  getLocalBounds(): AABB;\n  getBoundingClientRect(): Rectangle;\n  getClientRects(): Rectangle[];\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute\n   */\n  setAttribute: <Key extends keyof StyleProps>(\n    attributeName: Key,\n    value: StyleProps[Key],\n    force?: boolean,\n    memoize?: boolean,\n  ) => void;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute\n   */\n  getAttribute: (\n    attributeName: keyof StyleProps,\n  ) => StyleProps[keyof StyleProps] | undefined;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/removeAttribute\n   */\n  removeAttribute: (attributeName: keyof StyleProps) => void;\n\n  hasAttribute: (qualifiedName: string) => boolean;\n}\n\nexport interface IAnimationTimeline {\n  currentTime: number | null;\n  destroy: () => void;\n  play: (\n    target: IElement,\n    keyframes: Keyframe[] | PropertyIndexedKeyframes | null,\n    options?: number | KeyframeAnimationOptions,\n  ) => IAnimation;\n  restart: () => boolean;\n  getAnimations: () => IAnimation[];\n}\n\nexport interface IAnimation {\n  effect: IKeyframeEffect;\n  timeline: IAnimationTimeline;\n  id: string;\n  pending: boolean;\n  playState: AnimationPlayState;\n  ready: Promise<this>;\n  finished: Promise<this>;\n  onfinish: ((this: this, ev: AnimationPlaybackEvent) => any) | null;\n  oncancel: ((this: this, ev: AnimationPlaybackEvent) => any) | null;\n  onframe: ((this: this, ev: AnimationPlaybackEvent) => any) | null;\n  currentTime: number;\n  startTime: number;\n  playbackRate: number;\n  totalDuration: number;\n  play: () => void;\n  pause: () => void;\n  finish: () => void;\n  cancel: () => void;\n  reverse: () => void;\n  updatePlaybackRate: (playbackRate: number) => void;\n  tick: (timelineTime: number, isAnimationFrame: boolean) => void;\n}\n\nexport interface IAnimationEffectTiming extends EffectTiming {\n  easingFunction: TypeEasingFunction;\n}\n\nexport interface IKeyframeEffect {\n  composite: CompositeOperation;\n  iterationComposite: IterationCompositeOperation;\n  // pseudoElement: string | null;\n  target: IElement | null;\n\n  animation: IAnimation | null;\n\n  timing: IAnimationEffectTiming;\n\n  normalizedKeyframes: ComputedKeyframe[];\n\n  applyInterpolations: () => void;\n\n  update: (localTime: number | null) => boolean;\n\n  getKeyframes: () => ComputedKeyframe[];\n\n  setKeyframes: (\n    keyframes: Keyframe[] | PropertyIndexedKeyframes | null,\n  ) => void;\n\n  getComputedTiming: () => ComputedEffectTiming;\n\n  getTiming: () => EffectTiming;\n\n  updateTiming: (timing?: OptionalEffectTiming) => void;\n}\n\nexport interface IDocument extends INode, IParentNode {\n  /**\n   * Returns the Window object of the active document.\n   */\n  readonly defaultView: ICanvas | null;\n\n  /**\n   * Gets a reference to the root node of the document.\n   */\n  readonly documentElement: IElement;\n\n  readonly ownerDocument: null;\n  readonly timeline: IAnimationTimeline;\n\n  /**\n   * Creates an instance of the element for the specified tag.\n   */\n  createElement: <\n    T extends DisplayObject<StyleProps>,\n    StyleProps extends BaseStyleProps,\n  >(\n    tagName: string,\n    options: DisplayObjectConfig<StyleProps>,\n  ) => T;\n\n  elementFromPoint: (x: number, y: number) => Promise<DisplayObject>;\n  elementsFromPoint: (x: number, y: number) => Promise<DisplayObject[]>;\n  elementsFromBBox: (\n    minX: number,\n    minY: number,\n    maxX: number,\n    maxY: number,\n  ) => DisplayObject[];\n}\n\n/**\n * @see https://developer.mozilla.org/zh-CN/docs/Web/API/CSSStyleDeclaration\n */\nexport interface ICSSStyleDeclaration<StyleProps> {\n  setProperty: <Key extends keyof StyleProps>(\n    propertyName: Key,\n    value: StyleProps[Key],\n    priority?: string,\n  ) => void;\n  getPropertyValue: (\n    propertyName: keyof StyleProps,\n  ) => StyleProps[keyof StyleProps] | undefined;\n  removeProperty: (propertyName: keyof StyleProps) => void;\n  item: (index: number) => string;\n}\n\nexport interface CanvasContext {\n  config: Partial<CanvasConfig>;\n  camera: ICamera;\n\n  /**\n   * ContextServiceContribution\n   */\n  ContextService: new (\n    context: GlobalRuntime & CanvasContext,\n  ) => ContextService<unknown>;\n\n  contextService: ContextService<unknown>;\n  renderingService: RenderingService;\n  eventService: EventService;\n  rBushRoot: RBush<RBushNodeAABB>;\n  renderingContext: RenderingContext;\n  renderingPlugins: RenderingPlugin[];\n}\n\nexport interface ICanvas extends IEventTarget {\n  document: IDocument;\n  customElements: CustomElementRegistry;\n\n  devicePixelRatio: number;\n  requestAnimationFrame: (callback: FrameRequestCallback) => number;\n  cancelAnimationFrame: (handle: number) => void;\n\n  supportsTouchEvents: boolean;\n  supportsPointerEvents: boolean;\n  isTouchEvent: (event: InteractivePointerEvent) => event is TouchEvent;\n  isMouseEvent: (event: InteractivePointerEvent) => event is MouseEvent;\n  dblClickSpeed?: number;\n\n  render: () => void;\n  destroy: (destroyScenegraph?: boolean) => void;\n  resize: (width: number, height: number) => void;\n\n  context: CanvasContext;\n\n  mountChildren: (parent: INode) => void;\n  unmountChildren: (parent: INode) => void;\n  mountFragment: (fragment: INode) => void;\n\n  getConfig: () => Partial<CanvasConfig>;\n  getCamera: () => ICamera;\n  getContextService: () => ContextService<unknown>;\n  getRenderingService: () => RenderingService;\n  getEventService: () => EventService;\n\n  client2Viewport: (client: PointLike) => PointLike;\n  viewport2Client: (viewport: PointLike) => PointLike;\n  canvas2Viewport: (canvas: PointLike) => PointLike;\n  viewport2Canvas: (viewport: PointLike) => PointLike;\n}\n\ninterface EventListener {\n  (evt: FederatedEvent): void;\n}\ninterface EventListenerObject {\n  handleEvent(object: FederatedEvent): void;\n}\n\nexport type EventListenerOrEventListenerObject =\n  | EventListener\n  | EventListenerObject;\n","import { FederatedEvent } from './FederatedEvent';\nimport type { ElementEvent, IElement } from './interfaces';\n\nexport class MutationEvent extends FederatedEvent {\n  static readonly ADDITION: number = 2;\n  static readonly MODIFICATION: number = 1;\n  static readonly REMOVAL: number = 3;\n\n  constructor(\n    typeArg: ElementEvent,\n    public relatedNode: IElement,\n    public prevValue: any,\n    public newValue: any,\n    public attrName: string,\n    public attrChange: number,\n    public prevParsedValue: any,\n    public newParsedValue: any,\n  ) {\n    super(null);\n\n    this.type = typeArg;\n  }\n}\n","import { isNumber } from '@antv/util';\nimport { mat4, quat, vec2, vec3 } from 'gl-matrix';\nimport { SortReason, Transform } from '../components';\nimport type { CustomElement, DisplayObject } from '../display-objects';\nimport type { Element, IChildNode, IElement, INode, IParentNode } from '../dom';\nimport { CustomEvent } from '../dom/CustomEvent';\nimport { ElementEvent } from '../dom/interfaces';\nimport { MutationEvent } from '../dom/MutationEvent';\nimport { GlobalRuntime, runtime } from '../global-runtime';\nimport { AABB, Rectangle } from '../shapes';\nimport { Shape } from '../types';\nimport { findClosestClipPathTarget, isInFragment } from '../utils';\nimport type { SceneGraphService } from './interfaces';\n\nfunction markRenderableDirty(e: Element) {\n  const { renderable } = e;\n  if (renderable) {\n    renderable.renderBoundsDirty = true;\n    renderable.boundsDirty = true;\n  }\n}\n\nconst reparentEvent = new MutationEvent(\n  ElementEvent.REPARENT,\n  null,\n  '',\n  '',\n  '',\n  0,\n  '',\n  '',\n);\n\n// Object pooling\n/** do not modify this objects */\nconst $vec2Zero = vec2.create();\n/** do not modify this objects */\nconst $vec3Zero = vec3.create();\n/** do not modify this objects */\nconst $vec3One = vec3.fromValues(1, 1, 1);\n/** do not modify this objects */\nconst $mat4Identity = mat4.create();\n\n/** shared objects */\nconst $vec2 = vec2.create();\n/** shared objects */\nconst $vec3 = vec3.create();\n/** shared objects */\nconst $mat4 = mat4.create();\n/** shared objects */\nconst $quat = quat.create();\n\nconst $setLocalTransform_1 = vec3.create();\nconst $setLocalTransform_2 = quat.create();\nconst $setLocalTransform_3 = vec3.create();\nconst $setLocalPosition = vec3.create();\nconst $setPosition_1 = vec3.create();\nconst $setPosition_ParentInvertMatrix = mat4.create();\nconst $setEulerAngles_InvParentRot = quat.create();\nconst $rotateLocal = quat.create();\nconst $rotate_ParentInvertRotation = quat.create();\n\nconst $triggerPendingEvents_detail = { affectChildren: true };\n\n/**\n * update transform in scene graph\n *\n * @see https://community.khronos.org/t/scene-graphs/50542/7\n */\nexport class DefaultSceneGraphService implements SceneGraphService {\n  // target -> affectChildren\n  private pendingEvents = new Map<DisplayObject, boolean>();\n  private boundsChangedEvent = new CustomEvent(ElementEvent.BOUNDS_CHANGED);\n\n  constructor(private runtime: GlobalRuntime) {}\n\n  matches<T extends IElement>(query: string, root: T) {\n    return this.runtime.sceneGraphSelector.is(query, root);\n  }\n\n  querySelector<R extends IElement, T extends IElement>(\n    query: string,\n    root: R,\n  ): T | null {\n    return this.runtime.sceneGraphSelector.selectOne<R, T>(query, root);\n  }\n\n  querySelectorAll<R extends IElement, T extends IElement>(\n    query: string,\n    root: R,\n  ): T[] {\n    return this.runtime.sceneGraphSelector.selectAll<R, T>(query, root);\n    // .filter((node) => !node.shadow);\n  }\n\n  attach<C extends INode, P extends INode & IParentNode>(\n    child: C,\n    parent: P,\n    index?: number,\n  ) {\n    let detached = false;\n    if (child.parentNode) {\n      detached = child.parentNode !== parent;\n      this.detach(child);\n    }\n\n    const isChildFragment = child.nodeName === Shape.FRAGMENT;\n    const isAttachToFragment = isInFragment(parent);\n\n    child.parentNode = parent;\n\n    const nodes = isChildFragment\n      ? (child.childNodes as DisplayObject[])\n      : [child];\n\n    if (isNumber(index)) {\n      nodes.forEach((node) => {\n        parent.childNodes.splice(index, 0, node);\n        node.parentNode = parent;\n      });\n    } else {\n      nodes.forEach((node) => {\n        parent.childNodes.push(node);\n        node.parentNode = parent;\n      });\n    }\n\n    // parent needs re-sort\n    const { sortable } = parent as unknown as Element;\n    if (\n      sortable?.sorted?.length ||\n      (child as unknown as Element).parsedStyle.zIndex\n    ) {\n      if (sortable.dirtyChildren.indexOf(child) === -1) {\n        sortable.dirtyChildren.push(child);\n      }\n      // if (sortable) {\n      // only child has z-Index\n      sortable.dirty = true;\n      sortable.dirtyReason = SortReason.ADDED;\n    }\n\n    if (isAttachToFragment) return;\n\n    if (isChildFragment) this.dirtifyFragment(child);\n    else {\n      const transform = (child as unknown as Element).transformable;\n      if (transform) {\n        this.dirtifyWorld(child, transform);\n      }\n    }\n\n    if (detached) {\n      child.dispatchEvent(reparentEvent);\n    }\n  }\n\n  detach<C extends INode>(child: C) {\n    if (child.parentNode) {\n      const transform = (child as unknown as Element).transformable;\n      // if (transform) {\n      //   const worldTransform = this.getWorldTransform(child, transform);\n      //   mat4.getScaling(transform.localScale, worldTransform);\n      //   mat4.getTranslation(transform.localPosition, worldTransform);\n      //   mat4.getRotation(transform.localRotation, worldTransform);\n      //   transform.localDirtyFlag = true;\n      // }\n\n      // parent needs re-sort\n      const { sortable } = child.parentNode as Element;\n      // if (sortable) {\n      if (\n        sortable?.sorted?.length ||\n        (child as unknown as Element).style?.zIndex\n      ) {\n        if (sortable.dirtyChildren.indexOf(child) === -1) {\n          sortable.dirtyChildren.push(child);\n        }\n        sortable.dirty = true;\n        sortable.dirtyReason = SortReason.REMOVED;\n      }\n\n      const index = child.parentNode.childNodes.indexOf(\n        child as unknown as IChildNode & INode,\n      );\n      if (index > -1) {\n        child.parentNode.childNodes.splice(index, 1);\n      }\n\n      if (transform) {\n        this.dirtifyWorld(child, transform);\n      }\n      child.parentNode = null;\n    }\n  }\n\n  getOrigin(element: INode) {\n    (element as Element).getGeometryBounds();\n    return (element as Element).transformable.origin;\n  }\n\n  /**\n   * same as pivot in Pixi.js\n   *\n   * @see https://stackoverflow.com/questions/40748452/how-to-change-css-transform-origin-but-preserve-transformation\n   */\n  setOrigin(element: INode, origin: vec3 | number, y = 0, z = 0) {\n    if (typeof origin === 'number') {\n      origin = [origin, y, z];\n    }\n    const transform = (element as Element).transformable;\n    if (\n      origin[0] === transform.origin[0] &&\n      origin[1] === transform.origin[1] &&\n      origin[2] === transform.origin[2]\n    ) {\n      return;\n    }\n\n    const originVec = transform.origin;\n\n    // const delta = vec3.subtract(vec3.create(), origin, originVec);\n    // vec3.add(transform.localPosition, transform.localPosition, delta);\n\n    // update origin\n    originVec[0] = origin[0];\n    originVec[1] = origin[1];\n    originVec[2] = origin[2] || 0;\n    this.dirtifyLocal(element, transform);\n  }\n\n  /**\n   * rotate in world space\n   */\n  rotate(element: INode, degrees: vec3 | number, y = 0, z = 0) {\n    if (typeof degrees === 'number') {\n      degrees = vec3.fromValues(degrees, y, z);\n    }\n\n    const transform = (element as Element).transformable;\n\n    if (\n      element.parentNode === null ||\n      !(element.parentNode as Element).transformable\n    ) {\n      this.rotateLocal(element, degrees);\n    } else {\n      const rotation = $quat;\n      quat.fromEuler(rotation, degrees[0], degrees[1], degrees[2]);\n      const rot = this.getRotation(element);\n      const parentRot = this.getRotation(element.parentNode);\n\n      quat.copy($rotate_ParentInvertRotation, parentRot);\n      quat.invert($rotate_ParentInvertRotation, $rotate_ParentInvertRotation);\n      quat.multiply(rotation, $rotate_ParentInvertRotation, rotation);\n      quat.multiply(transform.localRotation, rotation, rot);\n      quat.normalize(transform.localRotation, transform.localRotation);\n\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  /**\n   * rotate in local space\n   * @see @see https://docs.microsoft.com/en-us/windows/win32/api/directxmath/nf-directxmath-xmquaternionrotationrollpitchyaw\n   */\n  rotateLocal(element: INode, degrees: vec3 | number, y = 0, z = 0) {\n    if (typeof degrees === 'number') {\n      degrees = vec3.fromValues(degrees, y, z);\n    }\n    const transform = (element as Element).transformable;\n    quat.fromEuler($rotateLocal, degrees[0], degrees[1], degrees[2]);\n    quat.mul(transform.localRotation, transform.localRotation, $rotateLocal);\n\n    this.dirtifyLocal(element, transform);\n  }\n\n  /**\n   * set euler angles(degrees) in world space\n   */\n  setEulerAngles(element: INode, degrees: vec3 | number, y = 0, z = 0) {\n    if (typeof degrees === 'number') {\n      degrees = vec3.fromValues(degrees, y, z);\n    }\n\n    const transform = (element as Element).transformable;\n\n    if (\n      element.parentNode === null ||\n      !(element.parentNode as Element).transformable\n    ) {\n      this.setLocalEulerAngles(element, degrees);\n    } else {\n      quat.fromEuler(\n        transform.localRotation,\n        degrees[0],\n        degrees[1],\n        degrees[2],\n      );\n      const parentRotation = this.getRotation(element.parentNode);\n      quat.copy(\n        $setEulerAngles_InvParentRot,\n        quat.invert($quat, parentRotation),\n      );\n      quat.mul(\n        transform.localRotation,\n        transform.localRotation,\n        $setEulerAngles_InvParentRot,\n      );\n\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  /**\n   * set euler angles(degrees) in local space\n   */\n  setLocalEulerAngles(\n    element: INode,\n    degrees: vec3 | number,\n    y = 0,\n    z = 0,\n    dirtify = true,\n  ) {\n    if (typeof degrees === 'number') {\n      degrees = vec3.fromValues(degrees, y, z);\n    }\n    const transform = (element as Element).transformable;\n    quat.fromEuler(transform.localRotation, degrees[0], degrees[1], degrees[2]);\n    if (dirtify) {\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  /**\n   * translate in local space\n   *\n   * @example\n   * ```\n   * translateLocal(x, y, z)\n   * translateLocal(vec3(x, y, z))\n   * ```\n   */\n  translateLocal(element: INode, translation: vec3 | number, y = 0, z = 0) {\n    if (typeof translation === 'number') {\n      translation = vec3.fromValues(translation, y, z);\n    }\n    const transform = (element as Element).transformable;\n    if (vec3.equals(translation, $vec3Zero)) return;\n\n    vec3.transformQuat(translation, translation, transform.localRotation);\n    vec3.add(transform.localPosition, transform.localPosition, translation);\n\n    this.dirtifyLocal(element, transform);\n  }\n\n  /**\n   * move to position in world space\n   *\n   * 对应 g 原版的 move/moveTo\n   * @see https://github.com/antvis/g/blob/master/packages/g-base/src/abstract/element.ts#L684-L689\n   */\n  setPosition(element: INode, position: vec3 | vec2) {\n    const transform = (element as Element).transformable;\n\n    $setPosition_1[0] = position[0];\n    $setPosition_1[1] = position[1];\n    $setPosition_1[2] = position[2] ?? 0;\n\n    if (vec3.equals(this.getPosition(element), $setPosition_1)) {\n      return;\n    }\n\n    vec3.copy(transform.position, $setPosition_1);\n\n    if (\n      element.parentNode === null ||\n      !(element.parentNode as Element).transformable\n    ) {\n      vec3.copy(transform.localPosition, $setPosition_1);\n    } else {\n      const parentTransform = (element.parentNode as Element).transformable;\n      mat4.copy(\n        $setPosition_ParentInvertMatrix,\n        parentTransform.worldTransform,\n      );\n      mat4.invert(\n        $setPosition_ParentInvertMatrix,\n        $setPosition_ParentInvertMatrix,\n      );\n      vec3.transformMat4(\n        transform.localPosition,\n        $setPosition_1,\n        $setPosition_ParentInvertMatrix,\n      );\n    }\n\n    this.dirtifyLocal(element, transform);\n  }\n\n  /**\n   * move to position in local space\n   */\n  setLocalPosition(element: INode, position: vec3 | vec2, dirtify = true) {\n    const transform = (element as Element).transformable;\n\n    $setLocalPosition[0] = position[0];\n    $setLocalPosition[1] = position[1];\n    $setLocalPosition[2] = position[2] ?? 0;\n\n    if (vec3.equals(transform.localPosition, $setLocalPosition)) {\n      return;\n    }\n\n    vec3.copy(transform.localPosition, $setLocalPosition);\n    if (dirtify) {\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  /**\n   * scale in local space\n   */\n  scaleLocal(element: INode, scaling: vec3 | vec2) {\n    const transform = (element as Element).transformable;\n    vec3.multiply(\n      transform.localScale,\n      transform.localScale,\n      vec3.set($vec3, scaling[0], scaling[1], scaling[2] ?? 1),\n    );\n    this.dirtifyLocal(element, transform);\n  }\n\n  setLocalScale(element: INode, scaling: vec3 | vec2, dirtify = true) {\n    const transform = (element as Element).transformable;\n\n    vec3.set(\n      $vec3,\n      scaling[0],\n      scaling[1],\n      scaling[2] ?? transform.localScale[2],\n    );\n\n    if (vec3.equals($vec3, transform.localScale)) {\n      return;\n    }\n\n    vec3.copy(transform.localScale, $vec3);\n    if (dirtify) {\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  /**\n   * translate in world space\n   *\n   * @example\n   * ```\n   * translate(x, y, z)\n   * translate(vec3(x, y, z))\n   * ```\n   *\n   * 对应 g 原版的 translate 2D\n   * @see https://github.com/antvis/g/blob/master/packages/g-base/src/abstract/element.ts#L665-L676\n   */\n  translate(element: INode, translation: vec3 | number, y = 0, z = 0) {\n    if (typeof translation === 'number') {\n      translation = vec3.set($vec3, translation, y, z);\n    }\n    if (vec3.equals(translation, $vec3Zero)) return;\n\n    vec3.add($vec3, this.getPosition(element), translation);\n\n    this.setPosition(element, $vec3);\n  }\n\n  setRotation(\n    element: INode,\n    rotation: quat | number,\n    y?: number,\n    z?: number,\n    w?: number,\n  ) {\n    const transform = (element as Element).transformable;\n    if (typeof rotation === 'number') {\n      rotation = quat.fromValues(rotation, y, z, w);\n    }\n\n    if (\n      element.parentNode === null ||\n      !(element.parentNode as Element).transformable\n    ) {\n      this.setLocalRotation(element, rotation);\n    } else {\n      const parentRot = this.getRotation(element.parentNode);\n\n      quat.copy($quat, parentRot);\n      quat.invert($quat, $quat);\n      quat.multiply(transform.localRotation, $quat, rotation);\n      quat.normalize(transform.localRotation, transform.localRotation);\n\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  setLocalRotation(\n    element: INode,\n    rotation: quat | number,\n    y?: number,\n    z?: number,\n    w?: number,\n    dirtify = true,\n  ) {\n    if (typeof rotation === 'number') {\n      rotation = quat.set($quat, rotation, y, z, w);\n    }\n    const transform = (element as Element).transformable;\n    quat.copy(transform.localRotation, rotation);\n    if (dirtify) {\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  setLocalSkew(\n    element: INode,\n    skew: vec2 | number,\n    y?: number,\n    dirtify = true,\n  ) {\n    if (typeof skew === 'number') {\n      skew = vec2.set($vec2, skew, y);\n    }\n    const transform = (element as Element).transformable;\n    vec2.copy(transform.localSkew, skew);\n    if (dirtify) {\n      this.dirtifyLocal(element, transform);\n    }\n  }\n\n  dirtifyLocal(element: INode, transform: Transform) {\n    if (isInFragment(element)) return;\n\n    if (!transform.localDirtyFlag) {\n      transform.localDirtyFlag = true;\n      if (!transform.dirtyFlag) {\n        this.dirtifyWorld(element, transform);\n      }\n    }\n  }\n\n  dirtifyWorld(element: INode, transform: Transform) {\n    if (!transform.dirtyFlag) {\n      this.unfreezeParentToRoot(element);\n    }\n\n    this.dirtifyWorldInternal(element, transform);\n    this.dirtifyToRoot(element, true);\n  }\n\n  dirtifyFragment(element: INode) {\n    const transform = (element as Element).transformable;\n    if (transform) {\n      transform.frozen = false;\n      transform.dirtyFlag = true;\n      transform.localDirtyFlag = true;\n    }\n    const renderable = (element as Element).renderable;\n    if (renderable) {\n      renderable.renderBoundsDirty = true;\n      renderable.boundsDirty = true;\n      renderable.dirty = true;\n    }\n\n    const length = element.childNodes.length;\n    for (let i = 0; i < length; i++) {\n      this.dirtifyFragment(element.childNodes[i]);\n    }\n\n    if (element.nodeName === Shape.FRAGMENT) {\n      this.pendingEvents.set(element as DisplayObject, false);\n    }\n  }\n\n  triggerPendingEvents() {\n    const triggered = new Set<DisplayObject>();\n    const skipped = new Set<DisplayObject>();\n\n    this.pendingEvents.forEach((_, element) => {\n      if (element.nodeName === Shape.FRAGMENT) {\n        element.forEach((e) => {\n          if (e !== element) skipped.add(e as DisplayObject);\n        });\n      }\n    });\n\n    const trigger = (element: DisplayObject, detail) => {\n      if (\n        element.isConnected &&\n        !triggered.has(element) &&\n        !skipped.has(element)\n      ) {\n        this.boundsChangedEvent.detail = detail;\n        this.boundsChangedEvent.target = element;\n        if (element.isMutationObserved) {\n          element.dispatchEvent(this.boundsChangedEvent);\n        } else {\n          element.ownerDocument.defaultView.dispatchEvent(\n            this.boundsChangedEvent,\n            true,\n          );\n        }\n\n        triggered.add(element);\n      }\n    };\n\n    this.pendingEvents.forEach((affectChildren, element) => {\n      $triggerPendingEvents_detail.affectChildren = affectChildren;\n      if (affectChildren) {\n        element.forEach((e: DisplayObject) => {\n          trigger(e, $triggerPendingEvents_detail);\n        });\n      } else trigger(element, $triggerPendingEvents_detail);\n    });\n    triggered.clear();\n    skipped.clear();\n    this.clearPendingEvents();\n  }\n\n  clearPendingEvents() {\n    this.pendingEvents.clear();\n  }\n\n  dirtifyToRoot(element: INode, affectChildren = false) {\n    let p = element;\n\n    // only need to re-render itself\n    if ((p as Element).renderable) {\n      (p as Element).renderable.dirty = true;\n    }\n\n    while (p) {\n      markRenderableDirty(p as Element);\n      p = p.parentNode;\n    }\n\n    if (affectChildren) {\n      element.forEach((e: Element) => {\n        markRenderableDirty(e);\n      });\n    }\n\n    this.informDependentDisplayObjects(element as DisplayObject);\n\n    this.pendingEvents.set(element as DisplayObject, affectChildren);\n  }\n\n  private displayObjectDependencyMap: WeakMap<\n    DisplayObject,\n    Record<string, DisplayObject[]>\n  > = new WeakMap();\n  updateDisplayObjectDependency(\n    name: string,\n    oldPath: DisplayObject,\n    newPath: DisplayObject,\n    object: DisplayObject,\n  ) {\n    // clear ref to old clip path\n    if (oldPath && oldPath !== newPath) {\n      const oldDependencyMap = this.displayObjectDependencyMap.get(oldPath);\n      if (oldDependencyMap && oldDependencyMap[name]) {\n        const index = oldDependencyMap[name].indexOf(object);\n        oldDependencyMap[name].splice(index, 1);\n      }\n    }\n\n    if (newPath) {\n      let newDependencyMap = this.displayObjectDependencyMap.get(newPath);\n      if (!newDependencyMap) {\n        this.displayObjectDependencyMap.set(newPath, {});\n        newDependencyMap = this.displayObjectDependencyMap.get(newPath);\n      }\n      if (!newDependencyMap[name]) {\n        newDependencyMap[name] = [];\n      }\n      newDependencyMap[name].push(object);\n    }\n  }\n\n  informDependentDisplayObjects(object: DisplayObject) {\n    const dependencyMap = this.displayObjectDependencyMap.get(object);\n    if (dependencyMap) {\n      Object.keys(dependencyMap).forEach((name) => {\n        dependencyMap[name].forEach((target) => {\n          this.dirtifyToRoot(target, true);\n\n          target.dispatchEvent(\n            new MutationEvent(\n              ElementEvent.ATTR_MODIFIED,\n              target as IElement,\n              this,\n              this,\n              name,\n              MutationEvent.MODIFICATION,\n              this,\n              this,\n            ),\n          );\n\n          if (target.isCustomElement && target.isConnected) {\n            if ((target as CustomElement<any>).attributeChangedCallback) {\n              (target as CustomElement<any>).attributeChangedCallback(\n                name,\n                this,\n                this,\n              );\n            }\n          }\n        });\n      });\n    }\n  }\n\n  getPosition(element: INode) {\n    const transform = (element as Element).transformable;\n    return mat4.getTranslation(\n      transform.position,\n      this.getWorldTransform(element, transform),\n    );\n  }\n\n  getRotation(element: INode) {\n    const transform = (element as Element).transformable;\n    return mat4.getRotation(\n      transform.rotation,\n      this.getWorldTransform(element, transform),\n    );\n  }\n\n  getScale(element: INode) {\n    const transform = (element as Element).transformable;\n    return mat4.getScaling(\n      transform.scaling,\n      this.getWorldTransform(element, transform),\n    );\n  }\n\n  getWorldTransform(\n    element: INode,\n    transform: Transform = (element as Element).transformable,\n  ) {\n    if (!transform.localDirtyFlag && !transform.dirtyFlag) {\n      return transform.worldTransform;\n    }\n\n    if (element.parentNode && (element.parentNode as Element).transformable) {\n      this.getWorldTransform(element.parentNode);\n    }\n\n    this.sync(element, transform);\n\n    return transform.worldTransform;\n  }\n\n  getLocalPosition(element: INode) {\n    return (element as Element).transformable.localPosition;\n  }\n\n  getLocalRotation(element: INode) {\n    return (element as Element).transformable.localRotation;\n  }\n\n  getLocalScale(element: INode) {\n    return (element as Element).transformable.localScale;\n  }\n\n  getLocalSkew(element: INode) {\n    return (element as Element).transformable.localSkew;\n  }\n\n  private calcLocalTransform(transform: Transform) {\n    const hasSkew =\n      transform.localSkew[0] !== 0 || transform.localSkew[1] !== 0;\n\n    if (hasSkew) {\n      mat4.fromRotationTranslationScaleOrigin(\n        transform.localTransform,\n        transform.localRotation,\n        transform.localPosition,\n        vec3.fromValues(1, 1, 1),\n        transform.origin,\n      );\n\n      // apply skew2D\n      if (transform.localSkew[0] !== 0 || transform.localSkew[1] !== 0) {\n        mat4.identity($mat4);\n        $mat4[4] = Math.tan(transform.localSkew[0]);\n        $mat4[1] = Math.tan(transform.localSkew[1]);\n        mat4.multiply(\n          transform.localTransform,\n          transform.localTransform,\n          $mat4,\n        );\n      }\n\n      const scaling = mat4.fromRotationTranslationScaleOrigin(\n        $mat4,\n        quat.set($quat, 0, 0, 0, 1),\n        vec3.set($vec3, 1, 1, 1),\n        transform.localScale,\n        transform.origin,\n      );\n      mat4.multiply(\n        transform.localTransform,\n        transform.localTransform,\n        scaling,\n      );\n    } else {\n      const {\n        localTransform,\n        localPosition,\n        localRotation,\n        localScale,\n        origin,\n      } = transform;\n\n      const hasPosition =\n        localPosition[0] !== 0 ||\n        localPosition[1] !== 0 ||\n        localPosition[2] !== 0;\n\n      const hasRotation =\n        localRotation[3] !== 1 ||\n        localRotation[0] !== 0 ||\n        localRotation[1] !== 0 ||\n        localRotation[2] !== 0;\n\n      const hasScale =\n        localScale[0] !== 1 || localScale[1] !== 1 || localScale[2] !== 1;\n\n      const hasOrigin = origin[0] !== 0 || origin[1] !== 0 || origin[2] !== 0;\n\n      if (!hasRotation && !hasScale && !hasOrigin) {\n        if (hasPosition) {\n          mat4.fromTranslation(localTransform, localPosition);\n        } else {\n          mat4.identity(localTransform);\n        }\n      } else {\n        // @see https://github.com/mattdesl/css-mat4/blob/master/index.js\n        mat4.fromRotationTranslationScaleOrigin(\n          localTransform,\n          localRotation,\n          localPosition,\n          localScale,\n          origin,\n        );\n      }\n    }\n  }\n\n  getLocalTransform(element: INode) {\n    const transform = (element as Element).transformable;\n    if (transform.localDirtyFlag) {\n      this.calcLocalTransform(transform);\n      transform.localDirtyFlag = false;\n    }\n    return transform.localTransform;\n  }\n\n  setLocalTransform(element: INode, transform: mat4) {\n    const t = mat4.getTranslation($setLocalTransform_1, transform);\n    const r = mat4.getRotation($setLocalTransform_2, transform);\n    const s = mat4.getScaling($setLocalTransform_3, transform);\n    this.setLocalScale(element, s, false);\n    this.setLocalPosition(element, t, false);\n    this.setLocalRotation(element, r, undefined, undefined, undefined, false);\n    this.dirtifyLocal(element, (element as Element).transformable);\n  }\n\n  resetLocalTransform(element: INode) {\n    this.setLocalScale(element, $vec3One, false);\n    this.setLocalPosition(element, $vec3Zero, false);\n    this.setLocalEulerAngles(element, $vec3Zero, undefined, undefined, false);\n    this.setLocalSkew(element, $vec2Zero, undefined, false);\n    this.dirtifyLocal(element, (element as Element).transformable);\n  }\n\n  private getTransformedGeometryBounds(\n    element: INode,\n    render = false,\n    existedAABB?: AABB,\n  ): AABB | null {\n    const bounds = this.getGeometryBounds(element, render);\n    if (!AABB.isEmpty(bounds)) {\n      const aabb = existedAABB || new AABB();\n      aabb.setFromTransformedAABB(bounds, this.getWorldTransform(element));\n      return aabb;\n    }\n    return null;\n  }\n\n  /**\n   * won't account for children\n   */\n  getGeometryBounds(element: INode, render = false): AABB {\n    const { geometry } = element as Element;\n\n    if (geometry.dirty) {\n      runtime.styleValueRegistry.updateGeometry(element as DisplayObject);\n    }\n\n    const bounds = render\n      ? geometry.renderBounds\n      : geometry.contentBounds || null;\n    // return (bounds && new AABB(bounds.center, bounds.halfExtents)) || new AABB();\n    return bounds || new AABB();\n  }\n\n  /**\n   * account for children in world space\n   */\n  getBounds(element: INode, render = false): AABB {\n    const { renderable } = element as Element;\n\n    if (!renderable.boundsDirty && !render && renderable.bounds) {\n      return renderable.bounds;\n    }\n\n    if (!renderable.renderBoundsDirty && render && renderable.renderBounds) {\n      return renderable.renderBounds;\n    }\n\n    // reuse existed if possible\n    const existedAABB = render ? renderable.renderBounds : renderable.bounds;\n\n    // reset with geometry's aabb\n    let aabb: AABB = this.getTransformedGeometryBounds(\n      element,\n      render,\n      existedAABB,\n    );\n\n    // merge children's aabbs\n    const children = element.childNodes as IElement[];\n    children.forEach((child) => {\n      const childBounds = this.getBounds(child, render);\n      if (childBounds) {\n        if (!aabb) {\n          aabb = existedAABB || new AABB();\n          aabb.update(childBounds.center, childBounds.halfExtents);\n        } else {\n          aabb.add(childBounds);\n        }\n      }\n    });\n\n    if (!aabb) {\n      aabb = new AABB();\n    }\n\n    if (render) {\n      // FIXME: account for clip path\n      const clipped = findClosestClipPathTarget(element as DisplayObject);\n      if (clipped) {\n        // use bounds under world space\n        const clipPathBounds = clipped.parsedStyle.clipPath.getBounds(render);\n        if (!aabb) {\n          aabb.update(clipPathBounds.center, clipPathBounds.halfExtents);\n        } else if (clipPathBounds) {\n          aabb = clipPathBounds.intersection(aabb);\n        }\n      }\n    }\n\n    if (render) {\n      renderable.renderBounds = aabb;\n      renderable.renderBoundsDirty = false;\n    } else {\n      renderable.bounds = aabb;\n      renderable.boundsDirty = false;\n    }\n\n    return aabb;\n  }\n\n  /**\n   * account for children in local space\n   */\n  getLocalBounds(element: INode): AABB {\n    if (element.parentNode) {\n      let parentInvert = $mat4Identity;\n\n      if ((element.parentNode as Element).transformable) {\n        parentInvert = mat4.invert(\n          $mat4,\n          this.getWorldTransform(element.parentNode),\n        );\n      }\n\n      const bounds = this.getBounds(element);\n\n      if (!AABB.isEmpty(bounds)) {\n        const localBounds = new AABB();\n        localBounds.setFromTransformedAABB(bounds, parentInvert);\n        return localBounds;\n      }\n    }\n\n    return this.getBounds(element);\n  }\n\n  getBoundingClientRect(element: INode): Rectangle {\n    let aabb: AABB;\n    const bounds = this.getGeometryBounds(element);\n    if (!AABB.isEmpty(bounds)) {\n      aabb = new AABB();\n      // apply transformation to aabb\n      aabb.setFromTransformedAABB(bounds, this.getWorldTransform(element));\n    }\n\n    // calc context's offset\n    const bbox = element.ownerDocument?.defaultView\n      ?.getContextService()\n      .getBoundingClientRect();\n\n    if (aabb) {\n      const [left, top] = aabb.getMin();\n      const [right, bottom] = aabb.getMax();\n\n      return new Rectangle(\n        left + (bbox?.left || 0),\n        top + (bbox?.top || 0),\n        right - left,\n        bottom - top,\n      );\n    }\n\n    return new Rectangle(bbox?.left || 0, bbox?.top || 0, 0, 0);\n  }\n\n  private dirtifyWorldInternal(element: INode, transform: Transform) {\n    if (!transform.dirtyFlag) {\n      transform.dirtyFlag = true;\n      transform.frozen = false;\n      element.childNodes.forEach((child) => {\n        const childTransform = (child as Element).transformable;\n        if (!childTransform.dirtyFlag) {\n          this.dirtifyWorldInternal(child as IElement, childTransform);\n        }\n      });\n\n      const { renderable } = element as Element;\n      if (renderable) {\n        renderable.renderBoundsDirty = true;\n        renderable.boundsDirty = true;\n        renderable.dirty = true;\n      }\n    }\n  }\n\n  syncHierarchy(element: INode) {\n    const transform = (element as Element).transformable;\n    if (transform.frozen) {\n      return;\n    }\n    transform.frozen = true;\n\n    if (transform.localDirtyFlag || transform.dirtyFlag) {\n      this.sync(element, transform);\n    }\n\n    const children = element.childNodes;\n    for (let i = 0; i < children.length; i++) {\n      this.syncHierarchy(children[i]);\n    }\n  }\n\n  private sync(element: INode, transform: Transform) {\n    if (transform.localDirtyFlag) {\n      this.calcLocalTransform(transform);\n      transform.localDirtyFlag = false;\n    }\n\n    if (transform.dirtyFlag) {\n      const parent = element.parentNode;\n      const parentTransform = parent && (parent as Element).transformable;\n      if (parent === null || !parentTransform) {\n        mat4.copy(transform.worldTransform, transform.localTransform);\n      } else {\n        // TODO: should we support scale compensation?\n        // @see https://github.com/playcanvas/engine/issues/1077#issuecomment-359765557\n        mat4.multiply(\n          transform.worldTransform,\n          parentTransform.worldTransform,\n          transform.localTransform,\n        );\n      }\n\n      transform.dirtyFlag = false;\n    }\n  }\n\n  private unfreezeParentToRoot(child: INode) {\n    let p = child.parentNode;\n    while (p) {\n      const transform = (p as Element).transformable;\n      if (transform) {\n        transform.frozen = false;\n      }\n      p = p.parentNode;\n    }\n  }\n}\n","import { CanvasLike, GlobalRuntime } from '..';\nimport type { ParsedTextStyleProps } from '../display-objects';\nimport { Rectangle } from '../shapes';\nimport { toFontString } from '../utils';\n\nexport interface TextMetrics {\n  font: string;\n  width: number;\n  height: number;\n  lines: string[];\n  lineWidths: number[];\n  lineHeight: number;\n  maxLineWidth: number;\n  fontProperties: IFontMetrics;\n  lineMetrics: Rectangle[];\n}\n\ninterface IFontMetrics {\n  ascent: number;\n  descent: number;\n  fontSize: number;\n}\ntype CharacterWidthCache = Record<string, number>;\n\nconst TEXT_METRICS = {\n  MetricsString: '|ÉqÅ',\n  BaselineSymbol: 'M',\n  BaselineMultiplier: 1.4,\n  HeightMultiplier: 2,\n  Newlines: [\n    0x000a, // line feed\n    0x000d, // carriage return\n  ],\n  BreakingSpaces: [\n    0x0009, // character tabulation\n    0x0020, // space\n    0x2000, // en quad\n    0x2001, // em quad\n    0x2002, // en space\n    0x2003, // em space\n    0x2004, // three-per-em space\n    0x2005, // four-per-em space\n    0x2006, // six-per-em space\n    0x2008, // punctuation space\n    0x2009, // thin space\n    0x200a, // hair space\n    0x205f, // medium mathematical space\n    0x3000, // ideographic space\n  ],\n};\n\nconst LATIN_REGEX =\n  /[a-zA-Z0-9\\u00C0-\\u00D6\\u00D8-\\u00f6\\u00f8-\\u00ff!\"#$%&'()*+,-./:;]/;\n\n// Line breaking rules in CJK (Kinsoku Shori)\n// Refer from https://en.wikipedia.org/wiki/Line_breaking_rules_in_East_Asian_languages\nconst regexCannotStartZhCn =\n  /[!%),.:;?\\]}¢°·'\"\"†‡›℃∶、。〃〆〕〗〞﹚﹜！＂％＇），．：；？！］｝～]/;\nconst regexCannotEndZhCn = /[$(£¥·'\"〈《「『【〔〖〝﹙﹛＄（．［｛￡￥]/;\nconst regexCannotStartZhTw =\n  /[!),.:;?\\]}¢·–—'\"•\"、。〆〞〕〉》」︰︱︲︳﹐﹑﹒﹓﹔﹕﹖﹘﹚﹜！），．：；？︶︸︺︼︾﹀﹂﹗］｜｝､]/;\nconst regexCannotEndZhTw = /[([{£¥'\"‵〈《「『〔〝︴﹙﹛（｛︵︷︹︻︽︿﹁﹃﹏]/;\nconst regexCannotStartJaJp =\n  /[)\\]｝〕〉》」』】〙〗〟'\"｠»ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻‐゠–〜?!‼⁇⁈⁉・、:;,。.]/;\nconst regexCannotEndJaJp = /[([｛〔〈《「『【〘〖〝'\"｟«—...‥〳〴〵]/;\nconst regexCannotStartKoKr =\n  /[!%),.:;?\\]}¢°'\"†‡℃〆〈《「『〕！％），．：；？］｝]/;\nconst regexCannotEndKoKr = /[$([{£¥'\"々〇〉》」〔＄（［｛｠￥￦#]/;\n\nconst regexCannotStart = new RegExp(\n  `${regexCannotStartZhCn.source}|${regexCannotStartZhTw.source}|${regexCannotStartJaJp.source}|${regexCannotStartKoKr.source}`,\n);\nconst regexCannotEnd = new RegExp(\n  `${regexCannotEndZhCn.source}|${regexCannotEndZhTw.source}|${regexCannotEndJaJp.source}|${regexCannotEndKoKr.source}`,\n);\n\n/**\n * Borrow from pixi/packages/text/src/TextMetrics.ts\n */\nexport class TextService {\n  constructor(private runtime: GlobalRuntime) {}\n\n  /**\n   * font metrics cache\n   */\n  private fontMetricsCache: Record<string, IFontMetrics> = {};\n\n  /**\n   * Calculates the ascent, descent and fontSize of a given font-style.\n   */\n  measureFont(font: string, offscreenCanvas: CanvasLike): IFontMetrics {\n    // as this method is used for preparing assets, don't recalculate things if we don't need to\n    if (this.fontMetricsCache[font]) {\n      return this.fontMetricsCache[font];\n    }\n    const properties: IFontMetrics = {\n      ascent: 0,\n      descent: 0,\n      fontSize: 0,\n    };\n\n    const canvas =\n      this.runtime.offscreenCanvasCreator.getOrCreateCanvas(offscreenCanvas);\n    const context = this.runtime.offscreenCanvasCreator.getOrCreateContext(\n      offscreenCanvas,\n      {\n        willReadFrequently: true,\n      },\n    );\n\n    context.font = font;\n    const metricsString =\n      TEXT_METRICS.MetricsString + TEXT_METRICS.BaselineSymbol;\n    const width = Math.ceil(context.measureText(metricsString).width);\n    let baseline = Math.ceil(\n      context.measureText(TEXT_METRICS.BaselineSymbol).width,\n    );\n    const height = TEXT_METRICS.HeightMultiplier * baseline;\n    baseline = (baseline * TEXT_METRICS.BaselineMultiplier) | 0;\n    // @ts-ignore\n    canvas.width = width;\n    // @ts-ignore\n    canvas.height = height;\n    context.fillStyle = '#f00';\n    context.fillRect(0, 0, width, height);\n    context.font = font;\n    context.textBaseline = 'alphabetic';\n    context.fillStyle = '#000';\n    context.fillText(metricsString, 0, baseline);\n    const imagedata = context.getImageData(0, 0, width || 1, height || 1).data;\n    const pixels = imagedata.length;\n    const line = width * 4;\n    let i = 0;\n    let idx = 0;\n    let stop = false;\n    // ascent. scan from top to bottom until we find a non red pixel\n    for (i = 0; i < baseline; ++i) {\n      for (let j = 0; j < line; j += 4) {\n        if (imagedata[idx + j] !== 255) {\n          stop = true;\n          break;\n        }\n      }\n      if (!stop) {\n        idx += line;\n      } else {\n        break;\n      }\n    }\n    properties.ascent = baseline - i;\n    idx = pixels - line;\n    stop = false;\n    // descent. scan from bottom to top until we find a non red pixel\n    for (i = height; i > baseline; --i) {\n      for (let j = 0; j < line; j += 4) {\n        if (imagedata[idx + j] !== 255) {\n          stop = true;\n          break;\n        }\n      }\n      if (!stop) {\n        idx -= line;\n      } else {\n        break;\n      }\n    }\n    properties.descent = i - baseline;\n    properties.fontSize = properties.ascent + properties.descent;\n\n    this.fontMetricsCache[font] = properties;\n    return properties;\n  }\n\n  measureText(\n    text: string,\n    parsedStyle: ParsedTextStyleProps,\n    offscreenCanvas: CanvasLike,\n  ): TextMetrics {\n    const {\n      fontSize = 16,\n      wordWrap = false,\n      lineHeight: strokeHeight,\n      lineWidth = 1,\n      textBaseline = 'alphabetic',\n      textAlign = 'start',\n      letterSpacing = 0,\n      textPath,\n      textPathSide,\n      textPathStartOffset,\n      // dropShadow = 0,\n      // dropShadowDistance = 0,\n      leading = 0,\n    } = parsedStyle;\n\n    const font = toFontString(parsedStyle);\n\n    const fontProperties = this.measureFont(font, offscreenCanvas);\n    // fallback in case UA disallow canvas data extraction\n    if (fontProperties.fontSize === 0) {\n      fontProperties.fontSize = fontSize;\n      fontProperties.ascent = fontSize;\n    }\n\n    const context =\n      this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);\n    context.font = font;\n\n    // no overflowing by default\n    parsedStyle.isOverflowing = false;\n    const outputText = wordWrap\n      ? this.wordWrap(text, parsedStyle, offscreenCanvas)\n      : text;\n\n    const lines = outputText.split(/(?:\\r\\n|\\r|\\n)/);\n    const lineWidths = new Array<number>(lines.length);\n    let maxLineWidth = 0;\n\n    // account for textPath\n    if (textPath) {\n      const totalPathLength = textPath.getTotalLength();\n\n      // const startingPoint = textPath.getPoint(0);\n\n      for (let i = 0; i < lines.length; i++) {\n        let positionInPath: number;\n        const width =\n          context.measureText(lines[i]).width +\n          (lines[i].length - 1) * letterSpacing;\n        const reverse = textPathSide === 'right';\n\n        // TODO: should we support textPathStartOffsetY?\n        switch (textAlign) {\n          case 'left':\n          case 'start':\n            positionInPath = reverse ? totalPathLength - width : 0;\n            break;\n          case 'center':\n          case 'middle':\n            positionInPath = (totalPathLength - width) / 2;\n            break;\n          case 'right':\n          case 'end':\n            positionInPath = reverse ? 0 : totalPathLength - width;\n            break;\n        }\n\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        positionInPath += textPathStartOffset * (reverse ? -1 : 1);\n        // for (\n        //   let i = reverse ? lines[0].length - 1 : 0;\n        //   reverse ? i >= 0 : i < lines[0].length;\n        //   reverse ? i-- : i++\n        // ) {\n        //   graphemeInfo = lineBounds[i];\n        //   if (positionInPath > totalPathLength) {\n        //     positionInPath %= totalPathLength;\n        //   } else if (positionInPath < 0) {\n        //     positionInPath += totalPathLength;\n        //   }\n        //   // it would probably much faster to send all the grapheme position for a line\n        //   // and calculate path position/angle at once.\n        //   this.setGraphemeOnPath(\n        //     positionInPath,\n        //     graphemeInfo,\n        //     startingPoint\n        //   );\n        //   positionInPath += graphemeInfo.kernedWidth;\n        // }\n      }\n    } else {\n      for (let i = 0; i < lines.length; i++) {\n        // char width + letterSpacing\n        const lineWidth =\n          context.measureText(lines[i]).width +\n          (lines[i].length - 1) * letterSpacing;\n        lineWidths[i] = lineWidth;\n        maxLineWidth = Math.max(maxLineWidth, lineWidth);\n      }\n      const width = maxLineWidth + lineWidth;\n\n      // if (dropShadow) {\n      //   width += dropShadowDistance;\n      // }\n      let lineHeight = strokeHeight || fontProperties.fontSize + lineWidth;\n      const height =\n        Math.max(lineHeight, fontProperties.fontSize + lineWidth) +\n        (lines.length - 1) * (lineHeight + leading);\n      // if (dropShadow) {\n      //   height += dropShadowDistance;\n      // }\n      lineHeight += leading;\n\n      // handle vertical text baseline\n      let offsetY = 0;\n      if (textBaseline === 'middle') {\n        offsetY = -height / 2;\n      } else if (\n        textBaseline === 'bottom' ||\n        textBaseline === 'alphabetic' ||\n        textBaseline === 'ideographic'\n      ) {\n        offsetY = -height;\n      } else if (textBaseline === 'top' || textBaseline === 'hanging') {\n        offsetY = 0;\n      }\n\n      return {\n        font,\n        width,\n        height,\n        lines,\n        lineWidths,\n        lineHeight,\n        maxLineWidth,\n        fontProperties,\n        lineMetrics: lineWidths.map((width, i) => {\n          let offsetX = 0;\n          // handle horizontal text align\n          if (textAlign === 'center' || textAlign === 'middle') {\n            offsetX -= width / 2;\n          } else if (textAlign === 'right' || textAlign === 'end') {\n            offsetX -= width;\n          }\n\n          return new Rectangle(\n            offsetX - lineWidth / 2,\n            offsetY + i * lineHeight,\n            width + lineWidth,\n            lineHeight,\n          );\n        }),\n      };\n    }\n  }\n\n  private setGraphemeOnPath() {}\n\n  private wordWrap(\n    text: string,\n    parsedStyle: ParsedTextStyleProps,\n    offscreenCanvas: CanvasLike,\n  ): string {\n    const {\n      wordWrapWidth = 0,\n      letterSpacing = 0,\n      maxLines = Infinity,\n      textOverflow,\n    } = parsedStyle;\n    const context =\n      this.runtime.offscreenCanvasCreator.getOrCreateContext(offscreenCanvas);\n    const maxWidth = wordWrapWidth + letterSpacing;\n\n    let ellipsis = '';\n    if (textOverflow === 'ellipsis') {\n      ellipsis = '...';\n    } else if (textOverflow && textOverflow !== 'clip') {\n      ellipsis = textOverflow;\n    }\n\n    let lines: string[] = [];\n    let currentIndex = 0;\n    let currentWidth = 0;\n\n    const cache: { [key in string]: number } = {};\n    const calcWidth = (char: string): number => {\n      return this.getFromCache(\n        char,\n        letterSpacing,\n        cache,\n        context as CanvasRenderingContext2D,\n      );\n    };\n    const ellipsisWidth = Array.from(ellipsis).reduce((prev, cur) => {\n      return prev + calcWidth(cur);\n    }, 0);\n\n    const chars = Array.from(text);\n    for (let i = 0; i < chars.length; i++) {\n      const char = chars[i];\n\n      const prevChar = text[i - 1];\n      const nextChar = text[i + 1];\n      const charWidth = calcWidth(char);\n\n      if (this.isNewline(char)) {\n        currentIndex++;\n\n        // exceed maxLines, break immediately\n        if (currentIndex >= maxLines) {\n          parsedStyle.isOverflowing = true;\n          break;\n        }\n\n        currentWidth = 0;\n        lines[currentIndex] = '';\n        continue;\n      }\n\n      if (currentWidth > 0 && currentWidth + charWidth > maxWidth) {\n        if (currentIndex + 1 >= maxLines) {\n          parsedStyle.isOverflowing = true;\n\n          // If there is not enough space to display the string itself, it is clipped.\n          // @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-overflow#values\n          if (ellipsisWidth > 0 && ellipsisWidth <= maxWidth) {\n            // Backspace from line's end.\n            const currentLineLength = lines[currentIndex].length;\n            let lastLineWidth = 0;\n            let lastLineIndex = currentLineLength;\n            for (let i = 0; i < currentLineLength; i++) {\n              const width = calcWidth(lines[currentIndex][i]);\n              if (lastLineWidth + width + ellipsisWidth > maxWidth) {\n                lastLineIndex = i;\n                break;\n              }\n\n              lastLineWidth += width;\n            }\n\n            lines[currentIndex] =\n              (lines[currentIndex] || '').slice(0, lastLineIndex) + ellipsis;\n          }\n\n          break;\n        }\n\n        currentIndex++;\n        currentWidth = 0;\n        lines[currentIndex] = '';\n\n        if (this.isBreakingSpace(char)) {\n          continue;\n        }\n\n        if (!this.canBreakInLastChar(char)) {\n          lines = this.trimToBreakable(lines);\n          currentWidth = this.sumTextWidthByCache(\n            lines[currentIndex] || '',\n            cache,\n          );\n        }\n\n        if (this.shouldBreakByKinsokuShorui(char, nextChar)) {\n          lines = this.trimByKinsokuShorui(lines);\n          currentWidth += calcWidth(prevChar || '');\n        }\n      }\n\n      currentWidth += charWidth;\n      lines[currentIndex] = (lines[currentIndex] || '') + char;\n    }\n\n    return lines.join('\\n');\n  }\n\n  private isBreakingSpace(char: string): boolean {\n    if (typeof char !== 'string') {\n      return false;\n    }\n    return TEXT_METRICS.BreakingSpaces.indexOf(char.charCodeAt(0)) >= 0;\n  }\n\n  private isNewline(char: string): boolean {\n    if (typeof char !== 'string') {\n      return false;\n    }\n    return TEXT_METRICS.Newlines.indexOf(char.charCodeAt(0)) >= 0;\n  }\n\n  private trimToBreakable(prev: string[]): string[] {\n    const next = [...prev];\n    const prevLine = next[next.length - 2];\n\n    const index = this.findBreakableIndex(prevLine);\n    if (index === -1 || !prevLine) return next;\n\n    const trimmedChar = prevLine.slice(index, index + 1);\n    const isTrimmedWithSpace = this.isBreakingSpace(trimmedChar);\n\n    const trimFrom = index + 1;\n    const trimTo = index + (isTrimmedWithSpace ? 0 : 1);\n    next[next.length - 1] += prevLine.slice(trimFrom, prevLine.length);\n    next[next.length - 2] = prevLine.slice(0, trimTo);\n\n    return next;\n  }\n\n  private shouldBreakByKinsokuShorui = (\n    char: string | undefined,\n    nextChar: string,\n  ): boolean => {\n    if (this.isBreakingSpace(nextChar)) return false;\n\n    if (char) {\n      // Line breaking rules in CJK (Kinsoku Shori)\n      if (regexCannotEnd.exec(nextChar) || regexCannotStart.exec(char)) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  private trimByKinsokuShorui = (prev: string[]): string[] => {\n    const next = [...prev];\n    const prevLine = next[next.length - 2];\n    if (!prevLine) {\n      return prev;\n    }\n\n    const lastChar = prevLine[prevLine.length - 1];\n\n    next[next.length - 2] = prevLine.slice(0, -1);\n    next[next.length - 1] = lastChar + next[next.length - 1];\n    return next;\n  };\n\n  private canBreakInLastChar(char: string | undefined): boolean {\n    if (char && LATIN_REGEX.test(char)) return false;\n    return true;\n  }\n\n  private sumTextWidthByCache(\n    text: string,\n    cache: { [key in string]: number },\n  ) {\n    return text.split('').reduce((sum: number, c) => {\n      if (!cache[c]) throw Error('cannot count the word without cache');\n      return sum + cache[c];\n    }, 0);\n  }\n\n  private findBreakableIndex(line: string): number {\n    for (let i = line.length - 1; i >= 0; i--) {\n      if (!LATIN_REGEX.test(line[i])) return i;\n    }\n    return -1;\n  }\n\n  private getFromCache(\n    key: string,\n    letterSpacing: number,\n    cache: CharacterWidthCache,\n    context: CanvasRenderingContext2D,\n  ): number {\n    let width = cache[key];\n    if (typeof width !== 'number') {\n      const spacing = key.length * letterSpacing;\n      width = context.measureText(key).width + spacing;\n      cache[key] = width;\n    }\n    return width;\n  }\n}\n","import { Camera } from './camera';\nimport type { LayoutRegistry } from './css';\nimport type { CSSProperty } from './css/CSSProperty';\nimport { DefaultStyleValueRegistry } from './css/StyleValueRegistry';\nimport { PropertySyntax } from './css/interfaces';\nimport {\n  CSSPropertyAngle,\n  CSSPropertyClipPath,\n  CSSPropertyColor,\n  CSSPropertyFilter,\n  CSSPropertyLengthOrPercentage,\n  CSSPropertyLengthOrPercentage12,\n  CSSPropertyLengthOrPercentage14,\n  CSSPropertyMarker,\n  CSSPropertyNumber,\n  CSSPropertyOffsetDistance,\n  CSSPropertyOpacity,\n  CSSPropertyPath,\n  CSSPropertyPoints,\n  CSSPropertyShadowBlur,\n  CSSPropertyText,\n  CSSPropertyTextTransform,\n  CSSPropertyTransform,\n  CSSPropertyTransformOrigin,\n  CSSPropertyZIndex,\n} from './css/properties';\nimport type {\n  GeometryAABBUpdater,\n  SceneGraphSelector,\n  SceneGraphService,\n} from './services';\nimport {\n  CircleUpdater,\n  DefaultSceneGraphSelector,\n  DefaultSceneGraphService,\n  EllipseUpdater,\n  GroupUpdater,\n  LineUpdater,\n  OffscreenCanvasCreator,\n  PathUpdater,\n  PolylineUpdater,\n  RectUpdater,\n  TextService,\n  TextUpdater,\n  HTMLUpdater,\n} from './services';\nimport { CanvasLike, Shape } from './types';\n\nexport const runtime: GlobalRuntime = {} as GlobalRuntime;\n\nexport interface GlobalRuntime {\n  CameraContribution: new () => Camera;\n  // AnimationTimeline: new (doc: IDocument) => IAnimationTimeline;\n  AnimationTimeline: any;\n  EasingFunction: (...args: any[]) => (t: number) => number;\n  offscreenCanvasCreator: OffscreenCanvasCreator;\n  offscreenCanvas: CanvasLike;\n  sceneGraphSelector: SceneGraphSelector;\n  sceneGraphService: SceneGraphService;\n  textService: TextService;\n  geometryUpdaterFactory: Record<Shape, GeometryAABBUpdater<any>>;\n  styleValueRegistry: DefaultStyleValueRegistry;\n  layoutRegistry: LayoutRegistry;\n  CSSPropertySyntaxFactory: Record<\n    PropertySyntax,\n    Partial<CSSProperty<any, any>>\n  >;\n  globalThis: any;\n\n  /**\n   * circle.style.r = 100;\n   */\n  enableStyleSyntax: boolean;\n\n  enableSizeAttenuation: boolean;\n}\n\n/**\n * Replace with IoC container\n */\nconst geometryUpdaterFactory: Record<Shape, GeometryAABBUpdater<any>> = (() => {\n  const rectUpdater = new RectUpdater();\n  const polylineUpdater = new PolylineUpdater();\n  return {\n    [Shape.CIRCLE]: new CircleUpdater(),\n    [Shape.ELLIPSE]: new EllipseUpdater(),\n    [Shape.RECT]: rectUpdater,\n    [Shape.IMAGE]: rectUpdater,\n    [Shape.GROUP]: new GroupUpdater(),\n    [Shape.LINE]: new LineUpdater(),\n    [Shape.TEXT]: new TextUpdater(runtime),\n    [Shape.POLYLINE]: polylineUpdater,\n    [Shape.POLYGON]: polylineUpdater,\n    [Shape.PATH]: new PathUpdater(),\n    [Shape.HTML]: new HTMLUpdater(),\n    [Shape.MESH]: null,\n  };\n})();\n\nconst CSSPropertySyntaxFactory: Record<\n  PropertySyntax,\n  Partial<CSSProperty<any, any>>\n> = (() => {\n  const color = new CSSPropertyColor();\n  const length = new CSSPropertyLengthOrPercentage();\n  return {\n    [PropertySyntax.PERCENTAGE]: null,\n    [PropertySyntax.NUMBER]: new CSSPropertyNumber(),\n    [PropertySyntax.ANGLE]: new CSSPropertyAngle(),\n    [PropertySyntax.DEFINED_PATH]: new CSSPropertyClipPath(),\n    [PropertySyntax.PAINT]: color,\n    [PropertySyntax.COLOR]: color,\n    [PropertySyntax.FILTER]: new CSSPropertyFilter(),\n    [PropertySyntax.LENGTH]: length,\n    [PropertySyntax.LENGTH_PERCENTAGE]: length,\n    [PropertySyntax.LENGTH_PERCENTAGE_12]:\n      new CSSPropertyLengthOrPercentage12(),\n    [PropertySyntax.LENGTH_PERCENTAGE_14]:\n      new CSSPropertyLengthOrPercentage14(),\n    [PropertySyntax.COORDINATE]: new CSSPropertyLengthOrPercentage(),\n    [PropertySyntax.OFFSET_DISTANCE]: new CSSPropertyOffsetDistance(),\n    [PropertySyntax.OPACITY_VALUE]: new CSSPropertyOpacity(),\n    [PropertySyntax.PATH]: new CSSPropertyPath(),\n    [PropertySyntax.LIST_OF_POINTS]: new CSSPropertyPoints(),\n    [PropertySyntax.SHADOW_BLUR]: new CSSPropertyShadowBlur(),\n    [PropertySyntax.TEXT]: new CSSPropertyText(),\n    [PropertySyntax.TEXT_TRANSFORM]: new CSSPropertyTextTransform(),\n    [PropertySyntax.TRANSFORM]: new CSSPropertyTransform(),\n    [PropertySyntax.TRANSFORM_ORIGIN]: new CSSPropertyTransformOrigin(),\n    [PropertySyntax.Z_INDEX]: new CSSPropertyZIndex(),\n    [PropertySyntax.MARKER]: new CSSPropertyMarker(),\n  };\n})();\n\nconst getGlobalThis = () => {\n  if (typeof globalThis !== 'undefined') return globalThis;\n  if (typeof self !== 'undefined') return self;\n  if (typeof window !== 'undefined') return window;\n  // @ts-ignore\n  if (typeof global !== 'undefined') return global;\n  return {};\n  // [!] Error: The 'this' keyword is equivalent to 'undefined' at the top level of an ES module, and has been rewritten\n  // @see https://rollupjs.org/troubleshooting/#error-this-is-undefined\n  // if (typeof this !== 'undefined') return this;\n};\n\n/**\n * Camera\n * `g-camera-api` will provide an advanced implementation\n */\nruntime.CameraContribution = Camera;\n\n/**\n * `g-web-animations-api` will provide an AnimationTimeline\n */\nruntime.AnimationTimeline = null;\n\nruntime.EasingFunction = null;\n\nruntime.offscreenCanvasCreator = new OffscreenCanvasCreator();\n\nruntime.sceneGraphSelector = new DefaultSceneGraphSelector();\n\nruntime.sceneGraphService = new DefaultSceneGraphService(runtime);\n\nruntime.textService = new TextService(runtime);\n\nruntime.geometryUpdaterFactory = geometryUpdaterFactory;\n\nruntime.CSSPropertySyntaxFactory = CSSPropertySyntaxFactory;\nruntime.styleValueRegistry = new DefaultStyleValueRegistry(runtime);\nruntime.layoutRegistry = null;\nruntime.globalThis = getGlobalThis();\nruntime.enableStyleSyntax = true;\nruntime.enableSizeAttenuation = false;\n","import type {\n  Cullable,\n  Geometry,\n  RBushNode,\n  Renderable,\n  Sortable,\n  Transform,\n} from '../components';\nimport { Strategy } from '../components';\nimport { runtime } from '../global-runtime';\nimport type { AABB, Rectangle } from '../shapes';\nimport {\n  Shape,\n  type BaseStyleProps,\n  type ParsedBaseStyleProps,\n} from '../types';\nimport { isInFragment } from '../utils';\nimport {\n  ERROR_MSG_APPEND_DESTROYED_ELEMENT,\n  ERROR_MSG_METHOD_NOT_IMPLEMENTED,\n} from '../utils/error';\nimport { CustomEvent } from './CustomEvent';\nimport { MutationEvent } from './MutationEvent';\nimport { Node } from './Node';\nimport type {\n  ICSSStyleDeclaration,\n  IChildNode,\n  IElement,\n  INode,\n} from './interfaces';\nimport { ElementEvent } from './interfaces';\n\nlet entityCounter = 0;\nexport function resetEntityCounter() {\n  entityCounter = 0;\n}\n\nconst insertedEvent = new MutationEvent(\n  ElementEvent.INSERTED,\n  null,\n  '',\n  '',\n  '',\n  0,\n  '',\n  '',\n);\nconst removedEvent = new MutationEvent(\n  ElementEvent.REMOVED,\n  null,\n  '',\n  '',\n  '',\n  0,\n  '',\n  '',\n);\nconst destroyEvent = new CustomEvent(ElementEvent.DESTROY);\n\n/**\n * Has following capabilities:\n * * Node insert/remove, eg. appendChild, removeChild, remove...\n * * Query eg. querySelector getElementById...\n * * Animation\n */\nexport class Element<\n    StyleProps extends BaseStyleProps = any,\n    ParsedStyleProps extends ParsedBaseStyleProps = any,\n  >\n  extends Node\n  implements IElement<StyleProps, ParsedStyleProps>\n{\n  /**\n   * Unique id.\n   */\n  entity = entityCounter++;\n\n  renderable: Renderable = {\n    bounds: undefined,\n    boundsDirty: true,\n    renderBounds: undefined,\n    renderBoundsDirty: true,\n    dirtyRenderBounds: undefined,\n    dirty: false,\n  };\n\n  cullable: Cullable = {\n    strategy: Strategy.Standard,\n    visibilityPlaneMask: -1,\n    visible: true,\n    enable: true,\n  };\n\n  transformable: Transform = {\n    dirtyFlag: false,\n    localDirtyFlag: false,\n    frozen: false,\n    localPosition: [0, 0, 0],\n    localRotation: [0, 0, 0, 1],\n    localScale: [1, 1, 1],\n    localTransform: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\n    localSkew: [0, 0],\n    position: [0, 0, 0],\n    rotation: [0, 0, 0, 1],\n    scaling: [1, 1, 1],\n    worldTransform: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],\n    origin: [0, 0, 0],\n  };\n\n  sortable: Sortable = {\n    dirty: false,\n    sorted: undefined,\n    renderOrder: 0,\n    dirtyChildren: [],\n    dirtyReason: undefined,\n  };\n\n  geometry: Geometry = {\n    contentBounds: undefined,\n    renderBounds: undefined,\n    dirty: true,\n  };\n\n  rBushNode: RBushNode = {\n    aabb: undefined,\n  };\n\n  /**\n   * used with `getElementById()`\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/id\n   */\n  id: string;\n\n  /**\n   * used in `getElementsByClassName`\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByClassName\n   */\n  get className() {\n    // @ts-ignore\n    return this.getAttribute('class') || '';\n  }\n\n  set className(className: string) {\n    this.setAttribute('class', className);\n  }\n\n  /**\n   * used in `getElementsByName`\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementsByName\n   */\n  name: string;\n\n  /**\n   * https://developer.mozilla.org/zh-CN/docs/Web/API/Element/namespaceURI\n   */\n  namespaceURI = 'g';\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/classList\n   */\n  get classList() {\n    return this.className.split(' ').filter((c) => c !== '');\n  }\n\n  scrollLeft = 0;\n  scrollTop = 0;\n\n  /**\n   * We don't support border now\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/clientTop\n   */\n  clientTop = 0;\n  clientLeft = 0;\n\n  get tagName(): string {\n    return this.nodeName;\n  }\n\n  get children(): IElement[] {\n    return this.childNodes as IElement[];\n  }\n\n  get childElementCount(): number {\n    return this.childNodes.length;\n  }\n  get firstElementChild(): IElement | null {\n    return this.firstChild as IElement;\n  }\n  get lastElementChild(): IElement | null {\n    return this.lastChild as IElement;\n  }\n\n  get parentElement(): IElement | null {\n    return this.parentNode as IElement;\n  }\n\n  get nextSibling(): IElement | null {\n    if (this.parentNode) {\n      const index = this.parentNode.childNodes.indexOf(this);\n      return (this.parentNode.childNodes[index + 1] as IElement) || null;\n    }\n\n    return null;\n  }\n\n  get previousSibling(): IElement | null {\n    if (this.parentNode) {\n      const index = this.parentNode.childNodes.indexOf(this);\n      return (this.parentNode.childNodes[index - 1] as IElement) || null;\n    }\n\n    return null;\n  }\n\n  cloneNode(deep?: boolean): this {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  appendChild<T extends INode>(child: T, index?: number): T {\n    if ((child as unknown as Element).destroyed) {\n      throw new Error(ERROR_MSG_APPEND_DESTROYED_ELEMENT);\n    }\n\n    runtime.sceneGraphService.attach(child, this, index);\n\n    if (this.ownerDocument?.defaultView) {\n      if (!isInFragment(this) && child.nodeName === Shape.FRAGMENT) {\n        this.ownerDocument.defaultView.mountFragment(child);\n      } else {\n        this.ownerDocument.defaultView.mountChildren(child);\n      }\n    }\n\n    // @ts-ignore\n    if (this.isMutationObserved) {\n      insertedEvent.relatedNode = this as IElement;\n      child.dispatchEvent(insertedEvent);\n    }\n\n    return child;\n  }\n\n  insertBefore<T extends INode>(newChild: T, refChild: INode | null): T {\n    if (!refChild) {\n      this.appendChild(newChild);\n    } else {\n      if (newChild.parentElement) {\n        newChild.parentElement.removeChild(newChild);\n      }\n\n      const index = this.childNodes.indexOf(refChild as IChildNode);\n      if (index === -1) {\n        this.appendChild(newChild);\n      } else {\n        this.appendChild(newChild, index);\n      }\n    }\n    return newChild;\n  }\n\n  replaceChild<T extends INode>(newChild: INode, oldChild: T): T {\n    const index = this.childNodes.indexOf(oldChild as unknown as IChildNode);\n    this.removeChild(oldChild);\n    this.appendChild(newChild, index);\n    return oldChild;\n  }\n\n  removeChild<T extends INode>(child: T): T {\n    // should emit on itself before detach\n    removedEvent.relatedNode = this as IElement;\n    child.dispatchEvent(removedEvent);\n\n    if (child.ownerDocument?.defaultView) {\n      child.ownerDocument.defaultView.unmountChildren(child);\n    }\n\n    // remove from scene graph\n    runtime.sceneGraphService.detach(child);\n    return child;\n  }\n\n  /**\n   * Remove all children which can be appended to its original parent later again.\n   */\n  removeChildren() {\n    for (let i = this.childNodes.length - 1; i >= 0; i--) {\n      const child = this.childNodes[i] as this;\n      this.removeChild(child);\n    }\n  }\n\n  /**\n   * Recursively destroy all children which can not be appended to its original parent later again.\n   */\n  destroyChildren() {\n    for (let i = this.childNodes.length - 1; i >= 0; i--) {\n      const child = this.childNodes[i] as this;\n      if (child.childNodes.length) {\n        child.destroyChildren();\n      }\n      child.destroy();\n    }\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/matches\n   */\n  matches(selector: string): boolean {\n    return runtime.sceneGraphService.matches(selector, this as IElement);\n  }\n  getElementById<E extends IElement = IElement>(id: string): E | null {\n    return runtime.sceneGraphService.querySelector<IElement, E>(\n      `#${id}`,\n      this as IElement,\n    );\n  }\n  getElementsByName<E extends IElement = IElement>(name: string): E[] {\n    return runtime.sceneGraphService.querySelectorAll<IElement, E>(\n      `[name=\"${name}\"]`,\n      this as IElement,\n    );\n  }\n  getElementsByClassName<E extends IElement = IElement>(\n    className: string,\n  ): E[] {\n    return runtime.sceneGraphService.querySelectorAll<IElement, E>(\n      `.${className}`,\n      this as IElement,\n    );\n  }\n  getElementsByTagName<E extends IElement = IElement>(tagName: string): E[] {\n    return runtime.sceneGraphService.querySelectorAll<IElement, E>(\n      tagName,\n      this as IElement,\n    );\n  }\n  querySelector<E extends IElement = IElement>(selectors: string): E | null {\n    return runtime.sceneGraphService.querySelector<IElement, E>(\n      selectors,\n      this as IElement,\n    );\n  }\n  querySelectorAll<E extends IElement = IElement>(selectors: string): E[] {\n    return runtime.sceneGraphService.querySelectorAll<IElement, E>(\n      selectors,\n      this as IElement,\n    );\n  }\n\n  /**\n   * should traverses the element and its parents (heading toward the document root)\n   * until it finds a node that matches the specified CSS selector.\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/closest\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/closest#polyfill\n   */\n  closest<E extends IElement = IElement>(selectors: string): E | null {\n    let el = this as unknown as E;\n    do {\n      if (runtime.sceneGraphService.matches(selectors, el)) return el;\n      el = el.parentElement as E;\n    } while (el !== null);\n    return null;\n  }\n\n  /**\n   * search in scene group, but should not include itself\n   */\n  find<E extends IElement = IElement>(filter: (node: E) => boolean): E | null {\n    let target: E | null = null;\n    this.forEach((object) => {\n      if (object !== this && filter(object as E)) {\n        target = object as E;\n        return false;\n      }\n      return true;\n    });\n    return target;\n  }\n  findAll<E extends IElement = IElement>(filter: (node: E) => boolean): E[] {\n    const objects: E[] = [];\n    this.forEach((object) => {\n      if (object !== this && filter(object as E)) {\n        objects.push(object as E);\n      }\n    });\n    return objects;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/after\n   */\n  after(...nodes: INode[]) {\n    if (this.parentNode) {\n      const index = this.parentNode.childNodes.indexOf(this);\n      nodes.forEach((node, i) =>\n        this.parentNode?.appendChild(node, index + i + 1),\n      );\n    }\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/before\n   */\n  before(...nodes: INode[]) {\n    if (this.parentNode) {\n      const index = this.parentNode.childNodes.indexOf(this);\n      const [first, ...rest] = nodes;\n      this.parentNode.appendChild(first, index);\n      (first as IChildNode).after(...rest);\n    }\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceWith\n   */\n  replaceWith(...nodes: INode[]) {\n    this.after(...nodes);\n    this.remove();\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/append\n   */\n  append(...nodes: INode[]) {\n    nodes.forEach((node) => this.appendChild(node));\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/prepend\n   */\n  prepend(...nodes: INode[]) {\n    nodes.forEach((node, i) => this.appendChild(node, i));\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/replaceChildren\n   */\n  replaceChildren(...nodes: INode[]) {\n    while (this.childNodes.length && this.firstChild) {\n      this.removeChild(this.firstChild);\n    }\n    this.append(...nodes);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/remove\n   */\n  remove(): this {\n    if (this.parentNode) {\n      return this.parentNode.removeChild(this);\n    }\n    return this;\n  }\n\n  /**\n   * is destroyed or not\n   */\n  destroyed = false;\n  destroy() {\n    // destroy itself before remove\n    this.dispatchEvent(destroyEvent);\n\n    // remove from scenegraph first\n    this.remove();\n\n    // remove event listeners\n    this.emitter.removeAllListeners();\n\n    this.destroyed = true;\n  }\n\n  getGeometryBounds(): AABB {\n    return runtime.sceneGraphService.getGeometryBounds(this);\n  }\n\n  getRenderBounds(): AABB {\n    return runtime.sceneGraphService.getBounds(this, true);\n  }\n\n  /**\n   * get bounds in world space, account for children\n   */\n  getBounds(): AABB {\n    return runtime.sceneGraphService.getBounds(this);\n  }\n\n  /**\n   * get bounds in local space, account for children\n   */\n  getLocalBounds(): AABB {\n    return runtime.sceneGraphService.getLocalBounds(this);\n  }\n\n  /**\n   * account for context's bounds in client space,\n   * but not accounting for children\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect\n   */\n  getBoundingClientRect(): Rectangle {\n    return runtime.sceneGraphService.getBoundingClientRect(this);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getClientRects\n   */\n  getClientRects() {\n    return [this.getBoundingClientRect()];\n  }\n\n  /**\n   * compatible with `style`\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style\n   */\n  style: StyleProps & ICSSStyleDeclaration<StyleProps> = {} as StyleProps &\n    ICSSStyleDeclaration<StyleProps>;\n  computedStyle = {};\n\n  /**\n   * Renderers will use these used values.\n   */\n  parsedStyle: ParsedStyleProps = {\n    // opacity: '',\n    // fillOpacity: '',\n    // strokeOpacity: '',\n    // transformOrigin: '',\n    // visibility: '',\n    // pointerEvents: '',\n    // lineWidth: '',\n    // lineCap: '',\n    // lineJoin: '',\n    // increasedLineWidthForHitTesting: '',\n    // fontSize: '',\n    // fontFamily: '',\n    // fontStyle: '',\n    // fontWeight: '',\n    // fontVariant: '',\n    // textAlign: '',\n    // textBaseline: '',\n    // textTransform: '',\n  } as ParsedStyleProps;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/computedStyleMap\n   * eg. circle.computedStyleMap().get('fill');\n   */\n  computedStyleMap() {\n    return new Map(Object.entries(this.computedStyle));\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/attributes\n   */\n  readonly attributes: StyleProps = {} as StyleProps;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttributeNames\n   */\n  getAttributeNames(): string[] {\n    return Object.keys(this.attributes);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAttribute\n   */\n  getAttribute(name: keyof StyleProps) {\n    // @see https://github.com/antvis/G/issues/1267\n    if (typeof name === 'symbol') {\n      return undefined;\n    }\n\n    const value = this.attributes[name];\n    if (value === undefined) {\n      // if the given attribute does not exist, the value returned will either be null or \"\"\n      return value;\n    }\n\n    return value;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttribute\n   */\n  hasAttribute(qualifiedName: string): boolean {\n    return this.getAttributeNames().includes(qualifiedName);\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/hasAttributes\n   */\n  hasAttributes(): boolean {\n    return !!this.getAttributeNames().length;\n  }\n\n  /**\n   * should use removeAttribute() instead of setting the attribute value to null either directly or using setAttribute(). Many attributes will not behave as expected if you set them to null.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/removeAttribute\n   */\n  removeAttribute(attributeName: keyof StyleProps) {\n    this.setAttribute(attributeName, null);\n    delete this.attributes[attributeName];\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/setAttribute\n   */\n  setAttribute<Key extends keyof StyleProps>(\n    attributeName: Key,\n    value: StyleProps[Key],\n    force?: boolean,\n    memoize?: boolean,\n  ) {\n    this.attributes[attributeName] = value;\n  }\n\n  getAttributeNS(namespace: string, localName: string): string {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  getAttributeNode(qualifiedName: string): Attr {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  getAttributeNodeNS(namespace: string, localName: string): Attr {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  hasAttributeNS(namespace: string, localName: string): boolean {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  removeAttributeNS(namespace: string, localName: string): void {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  removeAttributeNode(attr: Attr): Attr {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  setAttributeNS(\n    namespace: string,\n    qualifiedName: string,\n    value: string,\n  ): void {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  setAttributeNode(attr: Attr): Attr {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  setAttributeNodeNS(attr: Attr): Attr {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n\n  toggleAttribute(qualifiedName: string, force?: boolean): boolean {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n}\n","import { isNil, isObject, isUndefined } from '@antv/util';\nimport type { mat3, vec2 } from 'gl-matrix';\nimport { mat4, quat, vec3 } from 'gl-matrix';\nimport type { PropertyParseOptions } from '../css';\nimport type {\n  DisplayObjectConfig,\n  IAnimation,\n  ICSSStyleDeclaration,\n  IChildNode,\n  IElement,\n} from '../dom';\nimport { Element } from '../dom/Element';\nimport { MutationEvent } from '../dom/MutationEvent';\nimport { ElementEvent } from '../dom/interfaces';\nimport { runtime } from '../global-runtime';\nimport { Rectangle } from '../shapes';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport {\n  createVec3,\n  decompose,\n  fromRotationTranslationScale,\n  getEuler,\n  rad2deg,\n} from '../utils';\nimport type { CustomElement } from './CustomElement';\n\nexport function isDisplayObject(value: any): value is DisplayObject {\n  return !!(value as DisplayObject)?.nodeName;\n}\n\nconst Proxy: ProxyConstructor = runtime.globalThis.Proxy\n  ? runtime.globalThis.Proxy\n  : function () {};\n\ntype ConstructorTypeOf<T> = new (...args: any[]) => T;\n\nconst mutationEvent: MutationEvent = new MutationEvent(\n  ElementEvent.ATTR_MODIFIED,\n  null,\n  null,\n  null,\n  null,\n  MutationEvent.MODIFICATION,\n  null,\n  null,\n);\n\nconst $vec3 = vec3.create();\nconst $quat = quat.create();\n\n/**\n * prototype chains: DisplayObject -> Element -> Node -> EventTarget\n *\n * mixins: Animatable, Transformable, Visible\n * @see https://github.com/tannerntannern/ts-mixer/blob/master/README.md#mixing-generic-classes\n *\n * Provide abilities in scene graph, such as:\n * * transform `translate/rotate/scale`\n * * add/remove child\n * * visibility and z-index\n *\n * Those abilities are implemented with those components: `Transform/Sortable/Visible`.\n *\n * Emit following events:\n * * init\n * * destroy\n * * attributeChanged\n */\nexport class DisplayObject<\n  StyleProps extends BaseStyleProps = any,\n  ParsedStyleProps extends ParsedBaseStyleProps = any,\n> extends Element<StyleProps, ParsedStyleProps> {\n  /**\n   * contains style props in constructor's params, eg. fill, stroke...\n   */\n  config: DisplayObjectConfig<StyleProps>;\n\n  isCustomElement = false;\n\n  isMutationObserved = false;\n\n  /**\n   * push to active animations after calling `animate()`\n   */\n  private activeAnimations: IAnimation[] = [];\n\n  constructor(config: DisplayObjectConfig<StyleProps>) {\n    super();\n\n    // assign name, id to config\n    // eg. group.get('name')\n    this.config = config;\n\n    // init scene graph node\n    this.id = config.id || '';\n    this.name = config.name || '';\n    if (config.className || config.class) {\n      this.className = config.className || config.class;\n    }\n    this.nodeName = config.type || Shape.GROUP;\n\n    if (config.initialParsedStyle) {\n      Object.assign(this.parsedStyle, config.initialParsedStyle);\n    }\n\n    // start to process attributes\n    this.initAttributes(config.style);\n\n    if (runtime.enableStyleSyntax) {\n      this.style = new Proxy<StyleProps & ICSSStyleDeclaration<StyleProps>>(\n        // @ts-ignore\n        {\n          // ...this.attributes,\n          setProperty: <Key extends keyof StyleProps>(\n            propertyName: Key,\n            value: StyleProps[Key],\n            // priority?: string,\n          ) => {\n            this.setAttribute(propertyName, value);\n          },\n          getPropertyValue: (propertyName: keyof StyleProps) => {\n            return this.getAttribute(propertyName);\n          },\n          removeProperty: (propertyName: keyof StyleProps) => {\n            this.removeAttribute(propertyName);\n          },\n          item: () => {\n            return '';\n          },\n        },\n        {\n          get: (target, name: string) => {\n            if (target[name] !== undefined) {\n              // if (name in target) {\n              return target[name];\n            }\n            return this.getAttribute(name as keyof StyleProps);\n          },\n          set: (_, prop, value) => {\n            this.setAttribute(prop as keyof StyleProps, value);\n            return true;\n          },\n        },\n      );\n    }\n  }\n\n  destroy() {\n    super.destroy();\n\n    // stop all active animations\n    this.getAnimations().forEach((animation) => {\n      animation.cancel();\n    });\n  }\n\n  cloneNode(\n    deep?: boolean,\n    customCloneFunc?: (name: string, attribute: any) => any,\n  ): this {\n    const clonedStyle = { ...this.attributes };\n    for (const attributeName in clonedStyle) {\n      const attribute = clonedStyle[attributeName];\n\n      // @see https://github.com/antvis/G/issues/1095\n      if (\n        isDisplayObject(attribute) &&\n        // share the same clipPath if possible\n        attributeName !== 'clipPath' &&\n        attributeName !== 'offsetPath' &&\n        attributeName !== 'textPath'\n      ) {\n        clonedStyle[attributeName] = attribute.cloneNode(deep);\n      }\n      // TODO: clone other type\n      if (customCloneFunc) {\n        clonedStyle[attributeName] = customCloneFunc(attributeName, attribute);\n      }\n    }\n\n    const cloned = new (this.constructor as ConstructorTypeOf<DisplayObject>)({\n      // copy id & name\n      // @see https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode#notes\n      id: this.id,\n      name: this.name,\n      className: this.name,\n      interactive: this.interactive,\n      style: clonedStyle,\n    });\n\n    // apply transform\n    cloned.setLocalTransform(this.getLocalTransform());\n\n    if (deep) {\n      this.children.forEach((child) => {\n        // skip marker\n        if (!child.style.isMarker) {\n          const clonedChild = child.cloneNode(deep);\n          cloned.appendChild(clonedChild);\n        }\n      });\n    }\n\n    return cloned as this;\n  }\n\n  private initAttributes(attributes: StyleProps = {} as StyleProps) {\n    const options = {\n      forceUpdateGeometry: true,\n    };\n\n    runtime.styleValueRegistry.processProperties(this, attributes, options);\n\n    // redraw at next frame\n    this.renderable.dirty = true;\n  }\n\n  setAttribute<Key extends keyof StyleProps>(\n    name: Key,\n    value: StyleProps[Key],\n    force = false,\n    memoize = true,\n  ) {\n    // ignore undefined value\n    if (isUndefined(value)) {\n      return;\n    }\n\n    if (force || value !== this.attributes[name]) {\n      this.internalSetAttribute(name, value, { memoize });\n      super.setAttribute(name, value);\n    }\n  }\n\n  /**\n   * called when attributes get changed or initialized\n   */\n  internalSetAttribute<Key extends keyof StyleProps>(\n    name: Key,\n    value: StyleProps[Key],\n    parseOptions: Partial<PropertyParseOptions> = {},\n  ) {\n    const { renderable } = this;\n\n    const oldValue = this.attributes[name];\n    const oldParsedValue = this.parsedStyle[name as string];\n\n    runtime.styleValueRegistry.processProperties(\n      this,\n      {\n        [name]: value,\n      },\n      parseOptions,\n    );\n\n    // redraw at next frame\n    renderable.dirty = true;\n\n    const newParsedValue = this.parsedStyle[name as string];\n    if (this.isConnected) {\n      mutationEvent.relatedNode = this as IElement;\n      mutationEvent.prevValue = oldValue;\n      mutationEvent.newValue = value;\n      mutationEvent.attrName = name as string;\n      mutationEvent.prevParsedValue = oldParsedValue;\n      mutationEvent.newParsedValue = newParsedValue;\n      if (this.isMutationObserved) {\n        this.dispatchEvent(mutationEvent);\n      } else {\n        mutationEvent.target = this;\n        this.ownerDocument.defaultView.dispatchEvent(mutationEvent, true);\n      }\n    }\n\n    if (\n      ((this.isCustomElement && this.isConnected) || !this.isCustomElement) &&\n      (this as unknown as CustomElement<any>).attributeChangedCallback\n    ) {\n      (this as unknown as CustomElement<any>).attributeChangedCallback(\n        name,\n        oldValue,\n        value,\n        oldParsedValue,\n        newParsedValue,\n      );\n    }\n  }\n\n  // #region transformable\n  /**\n   * returns different values than getBoundingClientRect(), as the latter returns value relative to the viewport\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGGraphicsElement/getBBox\n   *\n   * FIXME: It is worth noting that getBBox responds to original untransformed values of a drawn object.\n   * @see https://www.w3.org/Graphics/SVG/IG/resources/svgprimer.html#getBBox\n   */\n  getBBox(): DOMRect {\n    const aabb = this.getBounds();\n    const [left, top] = aabb.getMin();\n    const [right, bottom] = aabb.getMax();\n    return new Rectangle(left, top, right - left, bottom - top);\n  }\n\n  setOrigin(position: vec3 | vec2 | number, y = 0, z = 0) {\n    runtime.sceneGraphService.setOrigin(\n      this,\n      createVec3(position, y, z, false),\n    );\n    return this;\n  }\n\n  getOrigin(): vec3 {\n    return runtime.sceneGraphService.getOrigin(this);\n  }\n\n  /**\n   * set position in world space\n   */\n  setPosition(position: vec3 | vec2 | number, y = 0, z = 0) {\n    runtime.sceneGraphService.setPosition(\n      this,\n      createVec3(position, y, z, false),\n    );\n    return this;\n  }\n\n  /**\n   * set position in local space\n   */\n  setLocalPosition(position: vec3 | vec2 | number, y = 0, z = 0) {\n    runtime.sceneGraphService.setLocalPosition(\n      this,\n      createVec3(position, y, z, false),\n    );\n    return this;\n  }\n\n  /**\n   * translate in world space\n   */\n  translate(position: vec3 | vec2 | number, y = 0, z = 0) {\n    runtime.sceneGraphService.translate(\n      this,\n      createVec3(position, y, z, false),\n    );\n    return this;\n  }\n\n  /**\n   * translate in local space\n   */\n  translateLocal(position: vec3 | vec2 | number, y = 0, z = 0) {\n    runtime.sceneGraphService.translateLocal(\n      this,\n      createVec3(position, y, z, false),\n    );\n    return this;\n  }\n\n  getPosition(): vec3 {\n    return runtime.sceneGraphService.getPosition(this);\n  }\n\n  getLocalPosition(): vec3 {\n    return runtime.sceneGraphService.getLocalPosition(this);\n  }\n\n  /**\n   * compatible with G 3.0\n   *\n   * scaling in local space\n   * scale(10) = scale(10, 10, 10)\n   *\n   * we can't set scale in world space\n   */\n  scale(scaling: vec3 | vec2 | number, y?: number, z?: number) {\n    return this.scaleLocal(scaling, y, z);\n  }\n  scaleLocal(scaling: vec3 | vec2 | number, y?: number, z?: number) {\n    if (typeof scaling === 'number') {\n      y = y || scaling;\n      z = z || scaling;\n      scaling = createVec3(scaling, y, z, false);\n    }\n    runtime.sceneGraphService.scaleLocal(this, scaling);\n    return this;\n  }\n\n  /**\n   * set scaling in local space\n   */\n  setLocalScale(scaling: vec3 | vec2 | number, y?: number, z?: number) {\n    if (typeof scaling === 'number') {\n      y = y || scaling;\n      z = z || scaling;\n      scaling = createVec3(scaling, y, z, false);\n    }\n\n    runtime.sceneGraphService.setLocalScale(this, scaling);\n    return this;\n  }\n\n  /**\n   * get scaling in local space\n   */\n  getLocalScale(): vec3 {\n    return runtime.sceneGraphService.getLocalScale(this);\n  }\n\n  /**\n   * get scaling in world space\n   */\n  getScale(): vec3 {\n    return runtime.sceneGraphService.getScale(this);\n  }\n\n  /**\n   * only return degrees of Z axis in world space\n   */\n  getEulerAngles() {\n    const [, , ez] = getEuler(\n      $vec3,\n      runtime.sceneGraphService.getWorldTransform(this),\n    );\n    return rad2deg(ez);\n  }\n\n  /**\n   * only return degrees of Z axis in local space\n   */\n  getLocalEulerAngles() {\n    const [, , ez] = getEuler(\n      $vec3,\n      runtime.sceneGraphService.getLocalRotation(this),\n    );\n    return rad2deg(ez);\n  }\n\n  /**\n   * set euler angles(degrees) in world space\n   */\n  setEulerAngles(z: number) {\n    runtime.sceneGraphService.setEulerAngles(this, 0, 0, z);\n    return this;\n  }\n\n  /**\n   * set euler angles(degrees) in local space\n   */\n  setLocalEulerAngles(z: number) {\n    runtime.sceneGraphService.setLocalEulerAngles(this, 0, 0, z);\n    return this;\n  }\n\n  rotateLocal(x: number, y?: number, z?: number) {\n    if (isNil(y) && isNil(z)) {\n      runtime.sceneGraphService.rotateLocal(this, 0, 0, x);\n    } else {\n      runtime.sceneGraphService.rotateLocal(this, x, y, z);\n    }\n\n    return this;\n  }\n\n  rotate(x: number, y?: number, z?: number) {\n    if (isNil(y) && isNil(z)) {\n      runtime.sceneGraphService.rotate(this, 0, 0, x);\n    } else {\n      runtime.sceneGraphService.rotate(this, x, y, z);\n    }\n\n    return this;\n  }\n\n  setRotation(rotation: quat | number, y?: number, z?: number, w?: number) {\n    runtime.sceneGraphService.setRotation(this, rotation, y, z, w);\n    return this;\n  }\n\n  setLocalRotation(\n    rotation: quat | number,\n    y?: number,\n    z?: number,\n    w?: number,\n  ) {\n    runtime.sceneGraphService.setLocalRotation(this, rotation, y, z, w);\n    return this;\n  }\n\n  setLocalSkew(skew: vec2 | number, y?: number) {\n    runtime.sceneGraphService.setLocalSkew(this, skew, y);\n    return this;\n  }\n\n  getRotation(): quat {\n    return runtime.sceneGraphService.getRotation(this);\n  }\n\n  getLocalRotation(): quat {\n    return runtime.sceneGraphService.getLocalRotation(this);\n  }\n\n  getLocalSkew(): vec2 {\n    return runtime.sceneGraphService.getLocalSkew(this);\n  }\n\n  getLocalTransform(): mat4 {\n    return runtime.sceneGraphService.getLocalTransform(this);\n  }\n\n  getWorldTransform(): mat4 {\n    return runtime.sceneGraphService.getWorldTransform(this);\n  }\n\n  setLocalTransform(transform: mat4) {\n    runtime.sceneGraphService.setLocalTransform(this, transform);\n    return this;\n  }\n\n  resetLocalTransform(): void {\n    runtime.sceneGraphService.resetLocalTransform(this);\n  }\n  // #endregion transformable\n\n  // #region animatable\n  /**\n   * returns an array of all Animation objects affecting this element\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element/getAnimations\n   */\n  getAnimations(): IAnimation[] {\n    return this.activeAnimations;\n  }\n  /**\n   * create an animation with WAAPI\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/animate\n   */\n  animate(\n    keyframes: Keyframe[] | PropertyIndexedKeyframes | null,\n    options?: number | KeyframeAnimationOptions,\n  ): IAnimation | null {\n    const timeline = this.ownerDocument?.timeline;\n\n    if (timeline) {\n      return timeline.play(this as IElement, keyframes, options);\n    }\n    return null;\n  }\n  // #endregion animatable\n\n  // #region visible\n  /**\n   * shortcut for Used value of `visibility`\n   */\n  isVisible() {\n    return this.parsedStyle?.visibility !== 'hidden';\n  }\n\n  get interactive() {\n    return this.isInteractive();\n  }\n  set interactive(b: boolean) {\n    this.style.pointerEvents = b ? 'auto' : 'none';\n  }\n\n  isInteractive() {\n    return this.parsedStyle?.pointerEvents !== 'none';\n  }\n\n  isCulled() {\n    return !!(this.cullable && this.cullable.enable && !this.cullable.visible);\n  }\n\n  /**\n   * bring to front in current group\n   */\n  toFront() {\n    if (this.parentNode) {\n      this.style.zIndex =\n        Math.max(\n          ...this.parentNode.children.map((child) =>\n            Number(child.style.zIndex),\n          ),\n        ) + 1;\n    }\n    return this;\n  }\n\n  /**\n   * send to back in current group\n   */\n  toBack() {\n    if (this.parentNode) {\n      this.style.zIndex =\n        Math.min(\n          ...this.parentNode.children.map((child) =>\n            Number(child.style.zIndex),\n          ),\n        ) - 1;\n    }\n    return this;\n  }\n  // #endregion visible\n\n  // #region deprecated\n\n  /**\n   * compatible with G 3.0\n   * @alias object.config\n   * @deprecated\n   */\n  getConfig() {\n    return this.config;\n  }\n\n  /**\n   * @alias style\n   * @example\n   * circle.style.r = 10;\n   * const r = circle.style;\n   * @deprecated\n   */\n  attr(): StyleProps;\n  attr(name: Partial<StyleProps>): DisplayObject<StyleProps>;\n  attr<Key extends keyof StyleProps>(name: Key): StyleProps[Key];\n  attr<Key extends keyof StyleProps>(\n    name: Key,\n    value: StyleProps[Key],\n  ): DisplayObject<StyleProps>;\n  attr(...args: any): any {\n    const [name, value] = args;\n    if (!name) {\n      return this.attributes;\n    }\n    if (isObject(name)) {\n      Object.keys(name).forEach((key) => {\n        this.setAttribute(\n          key as keyof StyleProps,\n          (name as unknown as StyleProps)[key as keyof StyleProps],\n        );\n      });\n      return this;\n    }\n    if (args.length === 2) {\n      this.setAttribute(name, value);\n      return this;\n    }\n    return this.attributes[name as keyof StyleProps];\n  }\n\n  /**\n   * return 3x3 matrix in world space\n   * @deprecated\n   */\n  getMatrix(transformMat4?: mat4): mat3 {\n    const transform = transformMat4 || this.getWorldTransform();\n    const [tx, ty] = mat4.getTranslation($vec3, transform);\n    const [sx, sy] = mat4.getScaling($vec3, transform);\n    const rotation = mat4.getRotation($quat, transform);\n    const [eux, , euz] = getEuler($vec3, rotation);\n    // gimbal lock at 90 degrees\n    return fromRotationTranslationScale(eux || euz, tx, ty, sx, sy);\n  }\n\n  /**\n   * return 3x3 matrix in local space\n   * @deprecated\n   */\n  getLocalMatrix(): mat3 {\n    return this.getMatrix(this.getLocalTransform());\n  }\n\n  /**\n   * set 3x3 matrix in world space\n   * @deprecated\n   */\n  setMatrix(mat: mat3) {\n    const [tx, ty, scalingX, scalingY, angle] = decompose(mat);\n    this.setEulerAngles(angle)\n      .setPosition(tx, ty)\n      .setLocalScale(scalingX, scalingY);\n  }\n\n  /**\n   * set 3x3 matrix in local space\n   * @deprecated\n   */\n  setLocalMatrix(mat: mat3) {\n    const [tx, ty, scalingX, scalingY, angle] = decompose(mat);\n    this.setLocalEulerAngles(angle)\n      .setLocalPosition(tx, ty)\n      .setLocalScale(scalingX, scalingY);\n  }\n\n  /**\n   * Use `visibility: visible` instead.\n   * @deprecated\n   */\n  show() {\n    this.forEach((object: DisplayObject) => {\n      object.style.visibility = 'visible';\n    });\n  }\n\n  /**\n   * Use `visibility: hidden` instead.\n   * @deprecated\n   */\n  hide() {\n    this.forEach((object: DisplayObject) => {\n      object.style.visibility = 'hidden';\n    });\n  }\n\n  /**\n   * Use `childElementCount` instead.\n   * @deprecated\n   */\n  getCount() {\n    return this.childElementCount;\n  }\n\n  /**\n   * Use `parentElement` instead.\n   * @deprecated\n   */\n  getParent(): DisplayObject | null {\n    return this.parentElement as DisplayObject;\n  }\n\n  /**\n   * Use `children` instead.\n   * @deprecated\n   */\n  getChildren(): DisplayObject[] {\n    return this.children as DisplayObject[];\n  }\n\n  /**\n   * Use `firstElementChild` instead.\n   * @deprecated\n   */\n  getFirst(): DisplayObject | null {\n    return this.firstElementChild as DisplayObject;\n  }\n\n  /**\n   * Use `lastElementChild` instead.\n   * @deprecated\n   */\n  getLast(): DisplayObject | null {\n    return this.lastElementChild as DisplayObject;\n  }\n\n  /**\n   * Use `this.children[index]` instead.\n   * @deprecated\n   */\n  getChildByIndex(index: number): DisplayObject | null {\n    return (this.children[index] as DisplayObject) || null;\n  }\n\n  /**\n   * Use `appendChild` instead.\n   * @deprecated\n   */\n  add<T extends IChildNode>(child: T, index?: number): T {\n    return this.appendChild(child, index);\n  }\n\n  /**\n   * @deprecated\n   */\n  set<\n    StyleProps extends BaseStyleProps,\n    Key extends keyof DisplayObjectConfig<StyleProps>,\n  >(name: Key, value: DisplayObjectConfig<StyleProps>[Key]) {\n    // @ts-ignore\n    this.config[name] = value;\n  }\n\n  /**\n   * @deprecated\n   */\n  get<StyleProps extends BaseStyleProps>(\n    name: keyof DisplayObjectConfig<StyleProps>,\n  ) {\n    return this.config[name];\n  }\n\n  /**\n   * Use `setPosition` instead.\n   * @deprecated\n   */\n  moveTo(position: vec3 | vec2 | number, y = 0, z = 0) {\n    (this as unknown as DisplayObject).setPosition(position, y, z);\n    return this;\n  }\n\n  /**\n   * Use `setPosition` instead.\n   * @deprecated\n   */\n  move(position: vec3 | vec2 | number, y = 0, z = 0) {\n    (this as unknown as DisplayObject).setPosition(position, y, z);\n    return this;\n  }\n\n  /**\n   * Use `this.style.zIndex` instead.\n   * @deprecated\n   */\n  setZIndex(zIndex: number) {\n    this.style.zIndex = zIndex;\n    return this;\n  }\n\n  // #endregion deprecated\n}\n","import type { DisplayObjectConfig } from '../dom/interfaces';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface CircleStyleProps extends BaseStyleProps {\n  /**\n   * X coordinate of the center of the circle.\n   */\n  cx?: number | string | null;\n  /**\n   * Y coordinate of the center of the circle.\n   */\n  cy?: number | string | null;\n  /**\n   * Z coordinate of the center of the circle.\n   */\n  cz?: number | string | null;\n  /**\n   * Radius of the circle.\n   */\n  r: number | string | null;\n  /**\n   * Whether the circle is billboard.\n   */\n  isBillboard?: boolean;\n  /**\n   * Whether the circle is size attenuation.\n   */\n  isSizeAttenuation?: boolean;\n}\nexport interface ParsedCircleStyleProps extends ParsedBaseStyleProps {\n  cx: number;\n  cy: number;\n  cz?: number;\n  r: number;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n}\nexport class Circle extends DisplayObject<\n  CircleStyleProps,\n  ParsedCircleStyleProps\n> {\n  constructor(options: DisplayObjectConfig<CircleStyleProps> = {}) {\n    super({\n      type: Shape.CIRCLE,\n      ...options,\n    });\n  }\n}\n","import type { DisplayObjectConfig } from '../dom';\nimport type { BaseStyleProps } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface BaseCustomElementStyleProps extends BaseStyleProps {}\n\n/**\n * shadow root\n * @see https://yuque.antfin-inc.com/antv/czqvg5/pgqipg\n */\nexport abstract class CustomElement<\n  CustomElementStyleProps,\n> extends DisplayObject<CustomElementStyleProps & BaseCustomElementStyleProps> {\n  // static get observedAttributes(): string[] {\n  //   return [];\n  // }\n\n  isCustomElement = true;\n\n  // private shadowNodes: DisplayObject[] = [];\n\n  constructor({\n    style,\n    ...rest\n  }: DisplayObjectConfig<CustomElementStyleProps> = {}) {\n    super({\n      style,\n      ...rest,\n    });\n  }\n\n  /**\n   * fired after element insert into DOM tree\n   */\n  connectedCallback?(): void;\n\n  /**\n   * fired before element removed from DOM tree\n   */\n  disconnectedCallback?(): void;\n\n  attributeChangedCallback?<Key extends keyof CustomElementStyleProps>(\n    name: Key,\n    oldValue: CustomElementStyleProps[Key],\n    newValue: CustomElementStyleProps[Key],\n    oldParsedValue?: any,\n    newParsedValue?: any,\n  ): void;\n\n  // private handleMounted = (e: FederatedEvent) => {\n  //   if (e.target === this) {\n  //     // this.shadowNodes.forEach((node) => {\n  //     //   // every child and its children should turn into a shadow node\n  //     //   // a shadow node doesn't mean to be unrenderable, it's just unsearchable in scenegraph\n  //     //   node.shadow = true;\n  //     // });\n\n  //     if (this.connectedCallback) {\n  //       this.connectedCallback();\n  //     }\n  //   }\n  // };\n\n  // private handleUnmounted = (e: FederatedEvent) => {\n  //   if (e.target === this) {\n\n  //   }\n  // };\n\n  // private handleChildInserted = (e: FederatedEvent) => {\n  //   (e.target as DisplayObject).forEach((node) => {\n  //     // append children like other shapes after mounted\n  //     if (!this.isConnected) {\n  //       this.shadowNodes.push(node as DisplayObject);\n  //     }\n  //   });\n  // };\n\n  // private handleChildRemoved = (e: FederatedEvent) => {\n  //   (e.target as DisplayObject).forEach((node) => {\n  //     node.shadow = false;\n  //   });\n  // };\n\n  // private handleAttributeChanged = <Key extends keyof CustomElementStyleProps>(\n  //   e: MutationEvent,\n  // ) => {\n  //   // only listen itself\n  //   // RangeError: Maximum call stack size exceeded\n  //   if (e.target !== this) {\n  //     return;\n  //   }\n\n  //   const { attrName, prevValue, newValue } = e;\n  //   if (this.attributeChangedCallback) {\n  //     this.attributeChangedCallback(attrName as Key, prevValue, newValue);\n  //   }\n  // };\n}\n","import type { DisplayObjectConfig } from '../dom/interfaces';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface EllipseStyleProps extends BaseStyleProps {\n  cx?: number | string;\n  cy?: number | string;\n  cz?: number | string;\n  rx: number | string;\n  ry: number | string;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n}\nexport interface ParsedEllipseStyleProps extends ParsedBaseStyleProps {\n  cx: number;\n  cy: number;\n  cz?: number;\n  rx: number;\n  ry: number;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n}\nexport class Ellipse extends DisplayObject<\n  EllipseStyleProps,\n  ParsedEllipseStyleProps\n> {\n  constructor(options: DisplayObjectConfig<EllipseStyleProps> = {}) {\n    super({\n      type: Shape.ELLIPSE,\n      ...options,\n    });\n  }\n}\n","import { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\n/**\n * 节点片段，用于包裹多个节点并批量操作\n *\n *  向 Fragment 或者根节点为 Fragment 的节点添加子节点时，不会触发渲染和事件。\n *\n * 当 Fragment 被挂载到 Canvas 中的节点时，其子节点会一次性被渲染，并触发合并事件。\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/DocumentFragment\n */\nexport class Fragment extends DisplayObject {\n  constructor() {\n    super({ type: Shape.FRAGMENT });\n  }\n}\n","import type { CSSUnitValue } from '../css';\nimport type { DisplayObjectConfig } from '../dom';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface GroupStyleProps extends BaseStyleProps {\n  width?: number | string;\n  height?: number | string;\n}\n\nexport interface ParsedGroupStyleProps extends ParsedBaseStyleProps {\n  width?: CSSUnitValue;\n  height?: CSSUnitValue;\n}\n\n/**\n * its attributes are inherited by its children.\n * @see https://developer.mozilla.org/zh-CN/docs/Web/SVG/Element/g\n * \n * @example\n * <g fill=\"white\" stroke=\"green\" stroke-width=\"5\">\n    <circle cx=\"40\" cy=\"40\" r=\"25\" />\n    <circle cx=\"60\" cy=\"60\" r=\"25\" />\n  </g>\n */\nexport class Group extends DisplayObject {\n  constructor(options: DisplayObjectConfig<GroupStyleProps> = {}) {\n    super({\n      type: Shape.GROUP,\n      ...options,\n    });\n  }\n}\n","import { mat4 } from 'gl-matrix';\nimport type { DisplayObjectConfig } from '../dom';\nimport { AABB } from '../shapes';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface HTMLStyleProps extends BaseStyleProps {\n  x?: number | string;\n  y?: number | string;\n  innerHTML: string | HTMLElement;\n  width?: number | string;\n  height?: number | string;\n}\n\nexport interface ParsedHTMLStyleProps extends ParsedBaseStyleProps {\n  x: number;\n  y: number;\n  $el: HTMLElement;\n  innerHTML: string | HTMLElement;\n  width: number;\n  height: number;\n}\n\n/**\n * HTML container\n * @see https://github.com/pmndrs/drei#html\n */\nexport class HTML extends DisplayObject<HTMLStyleProps, ParsedHTMLStyleProps> {\n  constructor({ style, ...rest }: DisplayObjectConfig<HTMLStyleProps> = {}) {\n    super({\n      type: Shape.HTML,\n      style,\n      ...rest,\n    });\n\n    this.cullable.enable = false;\n  }\n\n  /**\n   * return wrapper HTMLElement\n   * * <div> in g-webgl/canvas\n   * * <foreignObject> in g-svg\n   */\n  getDomElement() {\n    return this.parsedStyle.$el;\n  }\n\n  /**\n   * override with $el.getBoundingClientRect\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect\n   *\n   * ! The calculation logic of the html element should be consistent with that of the canvas element\n   */\n  // getBoundingClientRect(): Rectangle {\n  //   if (this.parsedStyle.$el) {\n  //     return this.parsedStyle.$el.getBoundingClientRect();\n  //   } else {\n  //     const { x, y, width, height } = this.parsedStyle;\n  //     return new Rectangle(x, y, width, height);\n  //   }\n  // }\n\n  getClientRects() {\n    return [this.getBoundingClientRect()];\n  }\n\n  // getBounds() {\n  //   const clientRect = this.getBoundingClientRect();\n  //   // calc context's offset\n  //   // @ts-ignore\n  //   const canvasRect = this.ownerDocument?.defaultView\n  //     ?.getContextService()\n  //     .getBoundingClientRect();\n\n  //   const aabb = new AABB();\n  //   const minX = clientRect.left - (canvasRect?.left || 0);\n  //   const minY = clientRect.top - (canvasRect?.top || 0);\n  //   aabb.setMinMax(\n  //     [minX, minY, 0],\n  //     [minX + clientRect.width, minY + clientRect.height, 0],\n  //   );\n  //   return aabb;\n  // }\n\n  getLocalBounds() {\n    if (this.parentNode) {\n      const parentInvert = mat4.invert(\n        mat4.create(),\n        (this.parentNode as DisplayObject).getWorldTransform(),\n      );\n      const bounds = this.getBounds();\n\n      if (!AABB.isEmpty(bounds)) {\n        const localBounds = new AABB();\n        localBounds.setFromTransformedAABB(bounds, parentInvert);\n        return localBounds;\n      }\n    }\n\n    return this.getBounds();\n  }\n}\n","import type { DisplayObjectConfig } from '../dom';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface ImageStyleProps extends BaseStyleProps {\n  x?: number | string;\n  y?: number | string;\n  z?: number;\n  src?: string | HTMLImageElement;\n  width?: number | string;\n  height?: number | string;\n  /**\n   * Whether the circle is billboard.\n   */\n  isBillboard?: boolean;\n  /**\n   * When isBillboard enabled, whether the circle is size attenuation.\n   */\n  isSizeAttenuation?: boolean;\n  /**\n   * When isBillboard enabled, the rotation.\n   */\n  billboardRotation?: number;\n  /**\n   * Whether to keep the aspect ratio of the image, under such circumstances, either the width or height can be omitted.\n   */\n  keepAspectRatio?: boolean;\n}\nexport interface ParsedImageStyleProps extends ParsedBaseStyleProps {\n  x: number;\n  y: number;\n  z?: number;\n  src?: string | HTMLImageElement;\n  width?: number;\n  height?: number;\n  isBillboard?: boolean;\n  billboardRotation?: number;\n  isSizeAttenuation?: boolean;\n  keepAspectRatio?: boolean;\n}\nexport class Image extends DisplayObject<\n  ImageStyleProps,\n  ParsedImageStyleProps\n> {\n  constructor(options: DisplayObjectConfig<ImageStyleProps> = {}) {\n    super({\n      type: Shape.IMAGE,\n      ...options,\n    });\n  }\n}\n","import { lineLength, linePointAt } from '@antv/g-math';\nimport { vec3 } from 'gl-matrix';\nimport type { DisplayObjectConfig } from '../dom';\nimport { Point } from '../shapes';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject, isDisplayObject } from './DisplayObject';\n\nexport interface LineStyleProps extends BaseStyleProps {\n  /**\n   * X coordinate of the start of the line.\n   */\n  x1: number;\n  /**\n   * Y coordinate of the start of the line.\n   */\n  y1: number;\n  /**\n   * X coordinate of the end of the line.\n   */\n  x2: number;\n  /**\n   * Y coordinate of the end of the line.\n   */\n  y2: number;\n  /**\n   * Z coordinate of the start of the line.\n   */\n  z1?: number;\n  /**\n   * Z coordinate of the end of the line.\n   */\n  z2?: number;\n  /**\n   * Whether the line is billboard.\n   */\n  isBillboard?: boolean;\n  /**\n   * Whether the line is size attenuation.\n   */\n  isSizeAttenuation?: boolean;\n  /**\n   * marker will be positioned at x1/y1\n   */\n  markerStart?: DisplayObject | null;\n\n  /**\n   * marker will be positioned at x2/y2\n   */\n  markerEnd?: DisplayObject | null;\n\n  /**\n   * offset relative to original position\n   */\n  markerStartOffset?: number;\n\n  /**\n   * offset relative to original position\n   */\n  markerEndOffset?: number;\n}\nexport interface ParsedLineStyleProps extends ParsedBaseStyleProps {\n  x1: number;\n  y1: number;\n  x2: number;\n  y2: number;\n  z1?: number;\n  z2?: number;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n  markerStart?: DisplayObject | null;\n  markerEnd?: DisplayObject | null;\n  markerStartOffset?: number;\n  markerEndOffset?: number;\n}\n\n/**\n * Create a line connecting two points.\n * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Element/line\n *\n * Also support for using marker.\n */\nexport class Line extends DisplayObject<LineStyleProps, ParsedLineStyleProps> {\n  private markerStartAngle = 0;\n  private markerEndAngle = 0;\n\n  constructor({ style, ...rest }: DisplayObjectConfig<LineStyleProps> = {}) {\n    super({\n      type: Shape.LINE,\n      style: {\n        x1: 0,\n        y1: 0,\n        x2: 0,\n        y2: 0,\n        z1: 0,\n        z2: 0,\n        ...style,\n      },\n      ...rest,\n    });\n\n    const { markerStart, markerEnd } = this.parsedStyle;\n\n    if (markerStart && isDisplayObject(markerStart)) {\n      this.markerStartAngle = markerStart.getLocalEulerAngles();\n      this.appendChild(markerStart);\n    }\n\n    if (markerEnd && isDisplayObject(markerEnd)) {\n      this.markerEndAngle = markerEnd.getLocalEulerAngles();\n      this.appendChild(markerEnd);\n    }\n\n    this.transformMarker(true);\n    this.transformMarker(false);\n  }\n\n  attributeChangedCallback<Key extends keyof LineStyleProps>(\n    attrName: Key,\n    oldValue: LineStyleProps[Key],\n    newValue: LineStyleProps[Key],\n    prevParsedValue: ParsedLineStyleProps[Key],\n    newParsedValue: ParsedLineStyleProps[Key],\n  ) {\n    if (\n      attrName === 'x1' ||\n      attrName === 'y1' ||\n      attrName === 'x2' ||\n      attrName === 'y2' ||\n      attrName === 'markerStartOffset' ||\n      attrName === 'markerEndOffset'\n    ) {\n      this.transformMarker(true);\n      this.transformMarker(false);\n    } else if (attrName === 'markerStart') {\n      if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n        this.markerStartAngle = 0;\n        prevParsedValue.remove();\n      }\n\n      // CSSKeyword 'unset'\n      if (newParsedValue && isDisplayObject(newParsedValue)) {\n        this.markerStartAngle = newParsedValue.getLocalEulerAngles();\n        this.appendChild(newParsedValue);\n        this.transformMarker(true);\n      }\n    } else if (attrName === 'markerEnd') {\n      if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n        this.markerEndAngle = 0;\n        prevParsedValue.remove();\n      }\n\n      if (newParsedValue && isDisplayObject(newParsedValue)) {\n        this.markerEndAngle = newParsedValue.getLocalEulerAngles();\n        this.appendChild(newParsedValue);\n        this.transformMarker(false);\n      }\n    }\n  }\n\n  private transformMarker(isStart: boolean) {\n    const {\n      markerStart,\n      markerEnd,\n      markerStartOffset,\n      markerEndOffset,\n      x1,\n      x2,\n      y1,\n      y2,\n    } = this.parsedStyle;\n    const marker = isStart ? markerStart : markerEnd;\n\n    if (!marker || !isDisplayObject(marker)) {\n      return;\n    }\n\n    let rad = 0;\n    let x: number;\n    let y: number;\n    let ox: number;\n    let oy: number;\n    let offset: number;\n    let originalAngle: number;\n\n    if (isStart) {\n      ox = x1;\n      oy = y1;\n      x = x2 - x1;\n      y = y2 - y1;\n      offset = markerStartOffset || 0;\n      originalAngle = this.markerStartAngle;\n    } else {\n      ox = x2;\n      oy = y2;\n      x = x1 - x2;\n      y = y1 - y2;\n      offset = markerEndOffset || 0;\n      originalAngle = this.markerEndAngle;\n    }\n    rad = Math.atan2(y, x);\n\n    // account for markerOffset\n    marker.setLocalEulerAngles((rad * 180) / Math.PI + originalAngle);\n    marker.setLocalPosition(\n      ox + Math.cos(rad) * offset,\n      oy + Math.sin(rad) * offset,\n    );\n  }\n\n  getPoint(ratio: number, inWorldSpace = false): Point {\n    // TODO: account for z1/z2 in 3D line\n    const { x1, y1, x2, y2 } = this.parsedStyle;\n    const { x, y } = linePointAt(x1, y1, x2, y2, ratio);\n\n    const transformed = vec3.transformMat4(\n      vec3.create(),\n      vec3.fromValues(x, y, 0),\n      inWorldSpace ? this.getWorldTransform() : this.getLocalTransform(),\n    );\n\n    // apply local transformation\n    return new Point(transformed[0], transformed[1]);\n  }\n\n  getPointAtLength(distance: number, inWorldSpace = false): Point {\n    return this.getPoint(distance / this.getTotalLength(), inWorldSpace);\n  }\n\n  getTotalLength() {\n    // TODO: account for z1/z2 in 3D line\n    const { x1, y1, x2, y2 } = this.parsedStyle;\n    return lineLength(x1, y1, x2, y2);\n  }\n}\n","import type {\n  AbsoluteArray,\n  AbsoluteSegment,\n  CurveArray,\n  PathArray,\n} from '@antv/util';\nimport { getPointAtLength } from '@antv/util';\nimport { vec3 } from 'gl-matrix';\nimport type { DisplayObjectConfig } from '../dom';\nimport { Point } from '../shapes';\nimport { Rectangle } from '../shapes/Rectangle';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { getOrCalculatePathTotalLength } from '../utils';\nimport { DisplayObject, isDisplayObject } from './DisplayObject';\nimport { EMPTY_PARSED_PATH } from './constants';\n\nexport interface PathStyleProps extends BaseStyleProps {\n  d?: string | PathArray;\n  /**\n   * marker will be positioned at the first point\n   */\n  markerStart?: DisplayObject | null;\n\n  /**\n   * marker will be positioned at the last point\n   */\n  markerEnd?: DisplayObject | null;\n\n  markerMid?: DisplayObject | null;\n\n  /**\n   * offset relative to original position\n   */\n  markerStartOffset?: number;\n\n  /**\n   * offset relative to original position\n   */\n  markerEndOffset?: number;\n\n  /**\n   * Whether the circle is billboard.\n   */\n  isBillboard?: boolean;\n  /**\n   * Whether the circle is size attenuation.\n   */\n  isSizeAttenuation?: boolean;\n}\n\nexport interface PathSegmentBBox {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\nexport interface PathSegment {\n  command: 'M' | 'L' | 'V' | 'H' | 'C' | 'S' | 'Q' | 'T' | 'A' | 'Z';\n  currentPoint: [number, number];\n  prePoint: [number, number];\n  nextPoint: [number, number];\n  startTangent: [number, number];\n  endTangent: [number, number];\n  params: AbsoluteSegment;\n  arcParams: PathArcParams;\n  /**\n   * Used for hit test.\n   */\n  box: PathSegmentBBox;\n  /**\n   * Convert A to C.\n   */\n  cubicParams: [number, number, number, number, number, number];\n}\n\nexport interface PathArcParams {\n  cx: number;\n  cy: number;\n  // 弧形的起点和终点相同时，长轴和短轴的长度按 0 处理\n  rx: number;\n  ry: number;\n  startAngle: number;\n  endAngle: number;\n  xRotation: number;\n  arcFlag: number;\n  sweepFlag: number;\n}\nexport interface ParsedPathStyleProps extends ParsedBaseStyleProps {\n  d: {\n    absolutePath: AbsoluteArray;\n    hasArc: boolean;\n    segments: PathSegment[];\n    polygons: [number, number][][];\n    polylines: [number, number][][];\n    curve: CurveArray;\n    totalLength: number;\n    rect: Rectangle;\n  };\n  markerStart?: DisplayObject | null;\n  markerMid?: DisplayObject | null;\n  markerEnd?: DisplayObject | null;\n  markerStartOffset?: number;\n  markerEndOffset?: number;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n}\nexport class Path extends DisplayObject<PathStyleProps, ParsedPathStyleProps> {\n  private markerStartAngle = 0;\n  private markerEndAngle = 0;\n\n  /**\n   * markers placed at the mid\n   */\n  private markerMidList: DisplayObject[] = [];\n\n  constructor({ style, ...rest }: DisplayObjectConfig<PathStyleProps> = {}) {\n    super({\n      type: Shape.PATH,\n      style,\n      initialParsedStyle: {\n        miterLimit: 4,\n        d: {\n          ...EMPTY_PARSED_PATH,\n        },\n      },\n      ...rest,\n    });\n\n    const { markerStart, markerEnd, markerMid } = this.parsedStyle;\n\n    if (markerStart && isDisplayObject(markerStart)) {\n      this.markerStartAngle = markerStart.getLocalEulerAngles();\n      this.appendChild(markerStart);\n    }\n\n    if (markerMid && isDisplayObject(markerMid)) {\n      this.placeMarkerMid(markerMid);\n    }\n\n    if (markerEnd && isDisplayObject(markerEnd)) {\n      this.markerEndAngle = markerEnd.getLocalEulerAngles();\n      this.appendChild(markerEnd);\n    }\n\n    this.transformMarker(true);\n    this.transformMarker(false);\n  }\n\n  attributeChangedCallback<Key extends keyof PathStyleProps>(\n    attrName: Key,\n    oldValue: PathStyleProps[Key],\n    newValue: PathStyleProps[Key],\n    prevParsedValue: ParsedPathStyleProps[Key],\n    newParsedValue: ParsedPathStyleProps[Key],\n  ) {\n    if (attrName === 'd') {\n      // recalc markers\n      this.transformMarker(true);\n      this.transformMarker(false);\n      this.placeMarkerMid(this.parsedStyle.markerMid);\n    } else if (\n      attrName === 'markerStartOffset' ||\n      attrName === 'markerEndOffset'\n    ) {\n      this.transformMarker(true);\n      this.transformMarker(false);\n    } else if (attrName === 'markerStart') {\n      if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n        this.markerStartAngle = 0;\n        prevParsedValue.remove();\n      }\n\n      // CSSKeyword 'unset'\n      if (newParsedValue && isDisplayObject(newParsedValue)) {\n        this.markerStartAngle = newParsedValue.getLocalEulerAngles();\n        this.appendChild(newParsedValue);\n        this.transformMarker(true);\n      }\n    } else if (attrName === 'markerEnd') {\n      if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n        this.markerEndAngle = 0;\n        prevParsedValue.remove();\n      }\n\n      if (newParsedValue && isDisplayObject(newParsedValue)) {\n        this.markerEndAngle = newParsedValue.getLocalEulerAngles();\n        this.appendChild(newParsedValue);\n        this.transformMarker(false);\n      }\n    } else if (attrName === 'markerMid') {\n      this.placeMarkerMid(newParsedValue as DisplayObject);\n    }\n  }\n\n  private transformMarker(isStart: boolean) {\n    const { markerStart, markerEnd, markerStartOffset, markerEndOffset } =\n      this.parsedStyle;\n    const marker = isStart ? markerStart : markerEnd;\n\n    if (!marker || !isDisplayObject(marker)) {\n      return;\n    }\n\n    let rad = 0;\n    let x: number;\n    let y: number;\n    let ox: number;\n    let oy: number;\n    let offset: number;\n    let originalAngle: number;\n\n    if (isStart) {\n      const [p1, p2] = this.getStartTangent();\n      ox = p2[0];\n      oy = p2[1];\n      x = p1[0] - p2[0];\n      y = p1[1] - p2[1];\n      offset = markerStartOffset || 0;\n      originalAngle = this.markerStartAngle;\n    } else {\n      const [p1, p2] = this.getEndTangent();\n      ox = p2[0];\n      oy = p2[1];\n      x = p1[0] - p2[0];\n      y = p1[1] - p2[1];\n      offset = markerEndOffset || 0;\n      originalAngle = this.markerEndAngle;\n    }\n    rad = Math.atan2(y, x);\n\n    // account for markerOffset\n    marker.setLocalEulerAngles((rad * 180) / Math.PI + originalAngle);\n    marker.setLocalPosition(\n      ox + Math.cos(rad) * offset,\n      oy + Math.sin(rad) * offset,\n    );\n  }\n\n  private placeMarkerMid(marker: DisplayObject) {\n    const {\n      d: { segments },\n    } = this.parsedStyle;\n    // clear all existed markers\n    this.markerMidList.forEach((marker) => {\n      marker.remove();\n    });\n    if (marker && isDisplayObject(marker)) {\n      for (let i = 1; i < segments.length - 1; i++) {\n        const [ox, oy] = segments[i].currentPoint;\n        const cloned = i === 1 ? marker : marker.cloneNode(true);\n        this.markerMidList.push(cloned);\n        this.appendChild(cloned);\n        cloned.setLocalPosition(ox, oy);\n        // TODO: orient of marker\n      }\n    }\n  }\n\n  /**\n   * Returns the total length of the path.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGGeometryElement/getTotalLength\n   */\n  getTotalLength() {\n    return getOrCalculatePathTotalLength(this);\n  }\n\n  /**\n   * Returns the point at a given distance along the path.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGGeometryElement/getPointAtLength\n   */\n  getPointAtLength(distance: number, inWorldSpace = false): Point {\n    const {\n      d: { absolutePath },\n    } = this.parsedStyle;\n    const { x, y } = getPointAtLength(absolutePath, distance);\n\n    const transformed = vec3.transformMat4(\n      vec3.create(),\n      vec3.fromValues(x, y, 0),\n      inWorldSpace ? this.getWorldTransform() : this.getLocalTransform(),\n    );\n\n    // apply local transformation\n    return new Point(transformed[0], transformed[1]);\n  }\n\n  /**\n   * Returns the point at a given ratio of the total length in path.\n   */\n  getPoint(ratio: number, inWorldSpace = false): Point {\n    return this.getPointAtLength(\n      ratio * getOrCalculatePathTotalLength(this),\n      inWorldSpace,\n    );\n  }\n\n  /**\n   * Get start tangent vector\n   */\n  getStartTangent(): number[][] {\n    const { segments } = this.parsedStyle.d;\n    let result: number[][] = [];\n    if (segments.length > 1) {\n      const startPoint = segments[0].currentPoint;\n      const endPoint = segments[1].currentPoint;\n      const tangent = segments[1].startTangent;\n      result = [];\n      if (tangent) {\n        result.push([startPoint[0] - tangent[0], startPoint[1] - tangent[1]]);\n        result.push([startPoint[0], startPoint[1]]);\n      } else {\n        result.push([endPoint[0], endPoint[1]]);\n        result.push([startPoint[0], startPoint[1]]);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Get end tangent vector\n   */\n  getEndTangent(): number[][] {\n    const { segments } = this.parsedStyle.d;\n    const { length } = segments;\n    let result: number[][] = [];\n    if (length > 1) {\n      const startPoint = segments[length - 2].currentPoint;\n      const endPoint = segments[length - 1].currentPoint;\n      const tangent = segments[length - 1].endTangent;\n      result = [];\n      if (tangent) {\n        result.push([endPoint[0] - tangent[0], endPoint[1] - tangent[1]]);\n        result.push([endPoint[0], endPoint[1]]);\n      } else {\n        result.push([startPoint[0], startPoint[1]]);\n        result.push([endPoint[0], endPoint[1]]);\n      }\n    }\n    return result;\n  }\n}\n","import type { DisplayObjectConfig } from '../dom';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject, isDisplayObject } from './DisplayObject';\n\nexport interface PolygonStyleProps extends BaseStyleProps {\n  points: ([number, number] | [number, number, number])[];\n  /**\n   * marker will be positioned at the first point\n   */\n  markerStart?: DisplayObject | null;\n\n  /**\n   * marker will be positioned at the last point\n   */\n  markerEnd?: DisplayObject | null;\n\n  markerMid?: DisplayObject | null;\n\n  /**\n   * offset relative to original position\n   */\n  markerStartOffset?: number;\n\n  /**\n   * offset relative to original position\n   */\n  markerEndOffset?: number;\n  isClosed?: boolean;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n}\nexport interface ParsedPolygonStyleProps extends ParsedBaseStyleProps {\n  points: {\n    points: ([number, number] | [number, number, number])[];\n    segments: [number, number][];\n    totalLength: number;\n  };\n  markerStart?: DisplayObject | null;\n  markerMid?: DisplayObject | null;\n  markerEnd?: DisplayObject | null;\n  markerStartOffset?: number;\n  markerEndOffset?: number;\n  isClosed?: boolean;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n}\n\nexport class Polygon extends DisplayObject<\n  PolygonStyleProps,\n  ParsedPolygonStyleProps\n> {\n  private markerStartAngle = 0;\n  private markerEndAngle = 0;\n\n  /**\n   * markers placed at the mid\n   */\n  private markerMidList: DisplayObject[] = [];\n\n  constructor({ style, ...rest }: DisplayObjectConfig<PolygonStyleProps> = {}) {\n    super({\n      type: Shape.POLYGON,\n      style,\n      initialParsedStyle: {\n        points: {\n          points: [],\n          totalLength: 0,\n          segments: [],\n        },\n        miterLimit: 4,\n        isClosed: true,\n      },\n      ...rest,\n    });\n\n    const { markerStart, markerEnd, markerMid } = this.parsedStyle;\n\n    if (markerStart && isDisplayObject(markerStart)) {\n      this.markerStartAngle = markerStart.getLocalEulerAngles();\n      this.appendChild(markerStart);\n    }\n\n    if (markerMid && isDisplayObject(markerMid)) {\n      this.placeMarkerMid(markerMid);\n    }\n\n    if (markerEnd && isDisplayObject(markerEnd)) {\n      this.markerEndAngle = markerEnd.getLocalEulerAngles();\n      this.appendChild(markerEnd);\n    }\n\n    this.transformMarker(true);\n    this.transformMarker(false);\n  }\n\n  attributeChangedCallback<Key extends keyof PolygonStyleProps>(\n    attrName: Key,\n    oldValue: PolygonStyleProps[Key],\n    newValue: PolygonStyleProps[Key],\n    prevParsedValue: ParsedPolygonStyleProps[Key],\n    newParsedValue: ParsedPolygonStyleProps[Key],\n  ) {\n    if (attrName === 'points') {\n      // recalc markers\n      this.transformMarker(true);\n      this.transformMarker(false);\n      this.placeMarkerMid(this.parsedStyle.markerMid);\n    } else if (\n      attrName === 'markerStartOffset' ||\n      attrName === 'markerEndOffset'\n    ) {\n      this.transformMarker(true);\n      this.transformMarker(false);\n    } else if (attrName === 'markerStart') {\n      if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n        this.markerStartAngle = 0;\n        prevParsedValue.remove();\n      }\n\n      // CSSKeyword 'unset'\n      if (newParsedValue && isDisplayObject(newParsedValue)) {\n        this.markerStartAngle = newParsedValue.getLocalEulerAngles();\n        this.appendChild(newParsedValue);\n        this.transformMarker(true);\n      }\n    } else if (attrName === 'markerEnd') {\n      if (prevParsedValue && isDisplayObject(prevParsedValue)) {\n        this.markerEndAngle = 0;\n        prevParsedValue.remove();\n      }\n\n      if (newParsedValue && isDisplayObject(newParsedValue)) {\n        this.markerEndAngle = newParsedValue.getLocalEulerAngles();\n        this.appendChild(newParsedValue);\n        this.transformMarker(false);\n      }\n    } else if (attrName === 'markerMid') {\n      this.placeMarkerMid(newParsedValue as DisplayObject);\n    }\n  }\n\n  private transformMarker(isStart: boolean) {\n    const {\n      markerStart,\n      markerEnd,\n      markerStartOffset,\n      markerEndOffset,\n      points: P,\n    } = this.parsedStyle;\n    const { points } = P || {};\n    const marker = isStart ? markerStart : markerEnd;\n\n    if (!marker || !isDisplayObject(marker) || !points) {\n      return;\n    }\n\n    let rad = 0;\n    let x: number;\n    let y: number;\n    let ox: number;\n    let oy: number;\n    let offset: number;\n    let originalAngle: number;\n\n    ox = points[0][0];\n    oy = points[0][1];\n\n    if (isStart) {\n      x = points[1][0] - points[0][0];\n      y = points[1][1] - points[0][1];\n      offset = markerStartOffset || 0;\n      originalAngle = this.markerStartAngle;\n    } else {\n      const { length } = points;\n\n      if (!this.parsedStyle.isClosed) {\n        ox = points[length - 1][0];\n        oy = points[length - 1][1];\n        x = points[length - 2][0] - points[length - 1][0];\n        y = points[length - 2][1] - points[length - 1][1];\n      } else {\n        x = points[length - 1][0] - points[0][0];\n        y = points[length - 1][1] - points[0][1];\n      }\n      offset = markerEndOffset || 0;\n      originalAngle = this.markerEndAngle;\n    }\n    rad = Math.atan2(y, x);\n\n    // account for markerOffset\n    marker.setLocalEulerAngles((rad * 180) / Math.PI + originalAngle);\n    marker.setLocalPosition(\n      ox + Math.cos(rad) * offset,\n      oy + Math.sin(rad) * offset,\n    );\n  }\n\n  private placeMarkerMid(marker: DisplayObject) {\n    const { points: P } = this.parsedStyle;\n    const { points } = P || {};\n\n    // clear all existed markers\n    this.markerMidList.forEach((marker) => {\n      marker.remove();\n    });\n    this.markerMidList = [];\n\n    if (marker && isDisplayObject(marker) && points) {\n      for (\n        let i = 1;\n        i < (this.parsedStyle.isClosed ? points.length : points.length - 1);\n        i++\n      ) {\n        const ox = points[i][0];\n        const oy = points[i][1];\n\n        const cloned = i === 1 ? marker : marker.cloneNode(true);\n        this.markerMidList.push(cloned);\n\n        this.appendChild(cloned);\n        cloned.setLocalPosition(ox, oy);\n\n        // TODO: orient of marker\n      }\n    }\n  }\n}\n","import { lineLength, linePointAt } from '@antv/g-math';\nimport { vec3 } from 'gl-matrix';\nimport type { DisplayObjectConfig } from '../dom';\nimport { Point } from '../shapes';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport type { DisplayObject } from './DisplayObject';\nimport { Polygon } from './Polygon';\nimport { getOrCalculatePolylineTotalLength } from '../utils';\n\nexport interface PolylineStyleProps extends BaseStyleProps {\n  points: ([number, number] | [number, number, number])[];\n  /**\n   * marker will be positioned at the first point\n   */\n  markerStart?: DisplayObject | null;\n\n  /**\n   * marker will be positioned at the last point\n   */\n  markerEnd?: DisplayObject | null;\n\n  markerMid?: DisplayObject | null;\n\n  /**\n   * offset relative to original position\n   */\n  markerStartOffset?: number;\n\n  /**\n   * offset relative to original position\n   */\n  markerEndOffset?: number;\n  /**\n   * Whether the circle is billboard.\n   */\n  isBillboard?: boolean;\n  /**\n   * Whether the circle is size attenuation.\n   */\n  isSizeAttenuation?: boolean;\n}\nexport interface ParsedPolylineStyleProps extends ParsedBaseStyleProps {\n  points: {\n    points: ([number, number] | [number, number, number])[];\n    segments: [number, number][];\n    totalLength: number;\n  };\n  markerStart?: DisplayObject | null;\n  markerMid?: DisplayObject | null;\n  markerEnd?: DisplayObject | null;\n  markerStartOffset?: number;\n  markerEndOffset?: number;\n  isBillboard?: boolean;\n}\n\n/**\n * Polyline inherits the marker-related capabilities of Polygon.\n */\nexport class Polyline extends Polygon {\n  constructor({\n    style,\n    ...rest\n  }: DisplayObjectConfig<PolylineStyleProps> = {}) {\n    super({\n      type: Shape.POLYLINE,\n      style,\n      initialParsedStyle: {\n        points: {\n          points: [],\n          totalLength: 0,\n          segments: [],\n        },\n        miterLimit: 4,\n        isClosed: false,\n      },\n      ...rest,\n    });\n  }\n\n  getTotalLength() {\n    return getOrCalculatePolylineTotalLength(this);\n  }\n\n  getPointAtLength(distance: number, inWorldSpace = false): Point {\n    return this.getPoint(distance / this.getTotalLength(), inWorldSpace);\n  }\n\n  getPoint(ratio: number, inWorldSpace = false): Point {\n    const {\n      points: { points },\n    } = this.parsedStyle;\n\n    if (this.parsedStyle.points.segments.length === 0) {\n      const segments: [number, number][] = [];\n      let tempLength = 0;\n      let segmentT: [number, number];\n      let segmentL: number;\n\n      const totalLength = this.getTotalLength();\n\n      points.forEach((p, i) => {\n        if (points[i + 1]) {\n          segmentT = [0, 0];\n          segmentT[0] = tempLength / totalLength;\n          segmentL = lineLength(p[0], p[1], points[i + 1][0], points[i + 1][1]);\n          tempLength += segmentL;\n          segmentT[1] = tempLength / totalLength;\n          segments.push(segmentT);\n        }\n      });\n\n      this.parsedStyle.points.segments = segments;\n    }\n\n    let subt = 0;\n    let index = 0;\n    this.parsedStyle.points.segments.forEach((v, i) => {\n      if (ratio >= v[0] && ratio <= v[1]) {\n        subt = (ratio - v[0]) / (v[1] - v[0]);\n        index = i;\n      }\n    });\n\n    const { x, y } = linePointAt(\n      points[index][0],\n      points[index][1],\n      points[index + 1][0],\n      points[index + 1][1],\n      subt,\n    );\n\n    const transformed = vec3.transformMat4(\n      vec3.create(),\n      vec3.fromValues(x, y, 0),\n      inWorldSpace ? this.getWorldTransform() : this.getLocalTransform(),\n    );\n\n    // apply local transformation\n    return new Point(transformed[0], transformed[1]);\n  }\n\n  getStartTangent(): number[][] {\n    const { points } = this.parsedStyle.points;\n    const result = [];\n    result.push([points[1][0], points[1][1]]);\n    result.push([points[0][0], points[0][1]]);\n    return result;\n  }\n\n  getEndTangent(): number[][] {\n    const { points } = this.parsedStyle.points;\n    const l = points.length - 1;\n    const result = [];\n    result.push([points[l - 1][0], points[l - 1][1]]);\n    result.push([points[l][0], points[l][1]]);\n    return result;\n  }\n}\n","import type { DisplayObjectConfig } from '../dom';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\n\nexport interface RectStyleProps extends BaseStyleProps {\n  x?: number | string;\n  y?: number | string;\n  z?: number;\n  width: number | string;\n  height: number | string;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n  /**\n   * top-left, top-right, bottom-right, bottom-left\n   */\n  radius?: number | string | number[];\n}\n\nexport interface ParsedRectStyleProps extends ParsedBaseStyleProps {\n  x?: number;\n  y?: number;\n  z?: number;\n  width: number;\n  height: number;\n  isBillboard?: boolean;\n  isSizeAttenuation?: boolean;\n  radius?: [number, number, number, number];\n}\n\nexport class Rect extends DisplayObject<RectStyleProps, ParsedRectStyleProps> {\n  constructor(options: DisplayObjectConfig<RectStyleProps> = {}) {\n    super({\n      type: Shape.RECT,\n      ...options,\n    });\n  }\n}\n","import { CSSGlobalKeywords, CSSRGB } from '../css';\nimport type { DisplayObjectConfig } from '../dom/interfaces';\nimport type { TextMetrics } from '../services';\nimport type {\n  BaseStyleProps,\n  ParsedBaseStyleProps,\n  TextDecorationStyle,\n  TextOverflow,\n  TextDecorationLine,\n} from '../types';\nimport { Shape } from '../types';\nimport { DisplayObject } from './DisplayObject';\nimport type { Path } from './Path';\n\nexport interface TextStyleProps extends BaseStyleProps {\n  x?: number | string;\n  y?: number | string;\n  z?: number | string;\n\n  /**\n   * Always face the camera.\n   */\n  isBillboard?: boolean;\n\n  /**\n   * The rotation of the billboard in radians.\n   */\n  billboardRotation?: number;\n\n  /**\n   * Whether the size of the sprite is attenuated by the camera depth. (Perspective camera only.)\n   */\n  isSizeAttenuation?: boolean;\n\n  text: number | string;\n\n  /**\n   * The text-align property sets the horizontal alignment of the inline-level content.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-align\n   */\n  textAlign?:\n    | CSSGlobalKeywords\n    | 'start'\n    | 'center'\n    | 'middle'\n    | 'end'\n    | 'left'\n    | 'right';\n\n  /**\n   * It specifies the current text baseline used when drawing text.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textBaseline\n   */\n  textBaseline?:\n    | CSSGlobalKeywords\n    | 'top'\n    | 'hanging'\n    | 'middle'\n    | 'alphabetic'\n    | 'ideographic'\n    | 'bottom';\n\n  /**\n   * The text-overflow property sets how hidden overflow content is signaled to users.\n   * It can be clipped, display an ellipsis ('…'), or display a custom string.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-overflow#values\n   */\n  textOverflow?: TextOverflow;\n\n  /**\n   * Borrow from CanvasKit ParagraphStyle.\n   */\n  maxLines?: number;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Element/textPath\n   */\n  textPath?: Path;\n\n  /**\n   * The side attribute determines the side of a path the text is placed on (relative to the path direction).\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/side\n   */\n  textPathSide?: 'left' | 'right';\n\n  /**\n   * The startOffset attribute defines an offset from the start of the path for the initial current text position along the path after converting the path to the \\<textPath\\> element's coordinate system.\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/startOffset\n   */\n  textPathStartOffset?: number | string;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-decoration-line\n   */\n  textDecorationLine?: TextDecorationLine;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-decoration-color\n   */\n  textDecorationColor?: string;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/text-decoration-style\n   */\n  textDecorationStyle?: TextDecorationStyle;\n\n  /**\n   * The font-style property sets whether a font should be styled with a normal, italic, or oblique face from its font-family.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/font-style\n   */\n  fontStyle?: CSSGlobalKeywords | 'normal' | 'italic' | 'oblique';\n\n  /**\n   * The font-size property sets the size of the font.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/font-size\n   */\n  fontSize?: number | string;\n\n  /**\n   * The font-family property specifies a prioritized list of one or more font family names and/or generic family names for the selected element.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/font-family\n   */\n  fontFamily?: string;\n\n  /**\n   * The font-weight property sets the weight (or boldness) of the font. The weights available depend on the font-family that is currently set.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight\n   */\n  fontWeight?:\n    | CSSGlobalKeywords\n    | 'normal'\n    | 'bold'\n    | 'bolder'\n    | 'lighter'\n    | number;\n\n  /**\n   * The font-variant shorthand property allows you to set all the font variants for a font.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/font-variant\n   */\n  fontVariant?: CSSGlobalKeywords | 'normal' | 'small-caps' | string;\n\n  /**\n   * The line-height property sets the height of a line box.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/line-height\n   */\n  lineHeight?: number | string;\n\n  /**\n   * It specifies the spacing between letters when drawing text.\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/letterSpacing\n   */\n  letterSpacing?: number | string;\n\n  /**\n   * The white-space property sets how white space inside an element is handled.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/white-space\n   */\n  // whiteSpace?: 'pre';\n\n  /**\n   * There is no \"CSS leading\" property\n   * @see https://css-tricks.com/how-to-tame-line-height-in-css/\n   */\n  leading?: number;\n\n  /**\n   * The overflow-wrap CSS property applies to inline elements,\n   * setting whether the browser should insert line breaks within an otherwise unbreakable string to prevent text from overflowing its line box.\n   *\n   * The overflow-wrap property acts in the same way as the non-standard property word-wrap.\n   * The word-wrap property is now treated by browsers as an alias of the standard property.\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/overflow-wrap\n   */\n  wordWrap?: boolean;\n\n  /**\n   * Max width of overflowing box.\n   */\n  wordWrapWidth?: number;\n  // dropShadow?: boolean;\n  // dropShadowDistance?: number;\n\n  /**\n   * The dx attribute indicates a shift along the x-axis on the position of an element or its content.\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/dx\n   */\n  dx?: number | string;\n\n  /**\n   * The dy attribute indicates a shift along the y-axis on the position of an element or its content.\n   * @see https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/dy\n   */\n  dy?: number | string;\n}\nexport interface ParsedTextStyleProps extends ParsedBaseStyleProps {\n  x: number;\n  y: number;\n  z?: number;\n  isBillboard?: boolean;\n  billboardRotation?: number;\n  isSizeAttenuation?: boolean;\n  text: string;\n  textAlign?: 'start' | 'center' | 'middle' | 'end' | 'left' | 'right';\n  textBaseline?:\n    | 'top'\n    | 'hanging'\n    | 'middle'\n    | 'alphabetic'\n    | 'ideographic'\n    | 'bottom';\n  fontStyle?: 'normal' | 'italic' | 'oblique';\n  fontSize?: number;\n  fontFamily?: string;\n  fontWeight?: 'normal' | 'bold' | 'bolder' | 'lighter' | number;\n  fontVariant?: 'normal' | 'small-caps' | string;\n  lineHeight?: number;\n  letterSpacing?: number;\n  // whiteSpace?: 'pre';\n  leading?: number;\n  wordWrap?: boolean;\n  wordWrapWidth?: number;\n  maxLines?: number;\n  textOverflow?: TextOverflow;\n  isOverflowing?: boolean;\n  textPath?: Path;\n  textDecorationLine?: TextDecorationLine;\n  textDecorationColor?: CSSRGB;\n  textDecorationStyle?: TextDecorationStyle | string;\n  textPathSide?: 'left' | 'right';\n  textPathStartOffset?: number;\n  // dropShadow?: boolean;\n  // dropShadowDistance?: number;\n  metrics?: TextMetrics;\n  dx?: number;\n  dy?: number;\n}\n\n/**\n * <text> @see https://developer.mozilla.org/en-US/docs/Web/API/SVGTextElement\n */\nexport class Text extends DisplayObject<TextStyleProps, ParsedTextStyleProps> {\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGTextContentElement#constants\n   */\n  // LENGTHADJUST_SPACING: number = 1;\n  // LENGTHADJUST_SPACINGANDGLYPHS: number = 2;\n  // LENGTHADJUST_UNKNOWN: number = 0;\n\n  constructor({ style, ...rest }: DisplayObjectConfig<TextStyleProps> = {}) {\n    super({\n      type: Shape.TEXT,\n      style: {\n        fill: 'black',\n        ...style,\n      },\n      ...rest,\n    });\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/SVGTextContentElement\n   */\n  getComputedTextLength(): number {\n    this.getGeometryBounds();\n    return this.parsedStyle.metrics?.maxLineWidth || 0;\n  }\n\n  getLineBoundingRects() {\n    this.getGeometryBounds();\n    return this.parsedStyle.metrics?.lineMetrics || [];\n  }\n\n  isOverflowing() {\n    this.getGeometryBounds();\n    return !!this.parsedStyle.isOverflowing;\n  }\n}\n","import type { DisplayObject } from '../display-objects';\nimport {\n  Circle,\n  Ellipse,\n  Group,\n  HTML,\n  Image,\n  Line,\n  Path,\n  Polygon,\n  Polyline,\n  Rect,\n  Text,\n} from '../display-objects';\nimport { Shape } from '../types';\n\n/**\n * canvas.customElements\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry\n */\nexport class CustomElementRegistry {\n  private registry: Record<string, new (...args: any[]) => DisplayObject> = {};\n\n  constructor() {\n    this.define(Shape.CIRCLE, Circle);\n    this.define(Shape.ELLIPSE, Ellipse);\n    this.define(Shape.RECT, Rect);\n    this.define(Shape.IMAGE, Image);\n    this.define(Shape.LINE, Line);\n    this.define(Shape.GROUP, Group);\n    this.define(Shape.PATH, Path);\n    this.define(Shape.POLYGON, Polygon);\n    this.define(Shape.POLYLINE, Polyline);\n    this.define(Shape.TEXT, Text);\n    this.define(Shape.HTML, HTML);\n  }\n\n  define<T extends DisplayObject>(\n    name: string,\n    constructor: new (...args: any[]) => T,\n  ) {\n    this.registry[name] = constructor;\n  }\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/get\n   */\n  get<T extends DisplayObject>(name: string): new (...args: any[]) => T {\n    return this.registry[name] as new (...args: any[]) => T;\n  }\n}\n","import { runtime } from '../global-runtime';\nimport { CSSUnitValue } from './cssom';\nimport type { PropertySyntax } from './interfaces';\n\n/**\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/RegisterProperty#parameters\n */\nexport interface PropertyDefinition {\n  name: string;\n  /**\n   * representing the expected syntax of the defined property. Defaults to \"*\".\n   */\n  syntax: PropertySyntax;\n  /**\n   * A boolean value defining whether the defined property should be inherited (true), or not (false). Defaults to false.\n   */\n  inherits?: boolean;\n  interpolable?: boolean;\n  initialValue?: string;\n}\n\n/**\n * holds useful CSS-related methods.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS\n *\n * * CSS Typed OM @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/factory_functions\n * * register property @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/RegisterProperty\n * * CSS Layout API\n */\nexport const CSS = {\n  /**\n   * <number>\n   * @see https://drafts.csswg.org/css-values-4/#number-value\n   */\n  number: (n: number) => {\n    return new CSSUnitValue(n);\n  },\n\n  /**\n   * <percentage>\n   * @see https://drafts.csswg.org/css-values-4/#percentage-value\n   */\n  percent: (n: number) => {\n    return new CSSUnitValue(n, '%');\n  },\n\n  /**\n   * <length>\n   */\n  px: (n: number) => {\n    return new CSSUnitValue(n, 'px');\n  },\n\n  /**\n   * <length>\n   */\n  em: (n: number) => {\n    return new CSSUnitValue(n, 'em');\n  },\n\n  rem: (n: number) => {\n    return new CSSUnitValue(n, 'rem');\n  },\n\n  /**\n   * <angle>\n   */\n  deg: (n: number) => {\n    return new CSSUnitValue(n, 'deg');\n  },\n\n  /**\n   * <angle>\n   */\n  grad: (n: number) => {\n    return new CSSUnitValue(n, 'grad');\n  },\n\n  /**\n   * <angle>\n   */\n  rad: (n: number) => {\n    return new CSSUnitValue(n, 'rad');\n  },\n\n  /**\n   * <angle>\n   */\n  turn: (n: number) => {\n    return new CSSUnitValue(n, 'turn');\n  },\n\n  /**\n   * <time>\n   */\n  s: (n: number) => {\n    return new CSSUnitValue(n, 's');\n  },\n\n  /**\n   * <time>\n   */\n  ms: (n: number) => {\n    return new CSSUnitValue(n, 'ms');\n  },\n\n  /**\n   * CSS Properties & Values API\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS_Properties_and_Values_API\n   * @see https://drafts.css-houdini.org/css-properties-values-api/#registering-custom-properties\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CSS/RegisterProperty\n   */\n  registerProperty: (definition: PropertyDefinition) => {\n    const { name, inherits, interpolable, initialValue, syntax } = definition;\n    runtime.styleValueRegistry.registerMetadata({\n      n: name,\n      inh: inherits,\n      int: interpolable,\n      d: initialValue,\n      syntax,\n    });\n  },\n\n  /**\n   * CSS Layout API\n   * register layout\n   *\n   * @see https://github.com/w3c/css-houdini-drafts/blob/main/css-layout-api/EXPLAINER.md\n   * @see https://developer.mozilla.org/en-US/docs/Web/Guide/Houdini#css_layout_api\n   */\n  registerLayout: (name: string, clazz: any) => {\n    runtime.layoutRegistry.registerLayout(name, clazz);\n  },\n};\n","import { isFunction } from '@antv/util';\nimport { runtime } from '../global-runtime';\nimport { BUILT_IN_PROPERTIES } from '../css';\nimport { Group, Text } from '../display-objects';\nimport type { DisplayObject } from '../display-objects';\nimport type { BaseStyleProps, ParsedBaseStyleProps } from '../types';\nimport { Shape } from '../types';\nimport {\n  ERROR_MSG_METHOD_NOT_IMPLEMENTED,\n  ERROR_MSG_USE_DOCUMENT_ELEMENT,\n} from '../utils';\nimport type {\n  DisplayObjectConfig,\n  IAnimationTimeline,\n  ICanvas,\n  IDocument,\n  IElement,\n  INode,\n} from './interfaces';\nimport { Node } from './Node';\n\n/**\n * the entry of DOM tree\n * Document -> Node -> EventTarget\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Document\n */\nexport class Document extends Node implements IDocument {\n  constructor() {\n    super();\n\n    this.nodeName = 'document';\n\n    // create timeline\n    try {\n      this.timeline = new runtime.AnimationTimeline(this);\n    } catch {}\n\n    /**\n     * for inherited properties, the initial value is used on the root element only,\n     * as long as no specified value is supplied.\n     * @see https://developer.mozilla.org/en-US/docs/Web/CSS/initial_value\n     */\n    const initialStyle = {};\n    BUILT_IN_PROPERTIES.forEach(({ n, inh, d }) => {\n      if (inh && d) {\n        initialStyle[n] = isFunction(d) ? d(Shape.GROUP) : d;\n      }\n    });\n\n    // like <html> in DOM tree\n    this.documentElement = new Group({\n      id: 'g-root',\n      style: initialStyle,\n    });\n    this.documentElement.ownerDocument = this;\n    this.documentElement.parentNode = this;\n    this.childNodes = [this.documentElement];\n  }\n\n  get children(): IElement[] {\n    return this.childNodes as IElement[];\n  }\n  get childElementCount(): number {\n    return this.childNodes.length;\n  }\n  get firstElementChild(): IElement | null {\n    return this.firstChild as IElement;\n  }\n  get lastElementChild(): IElement | null {\n    return this.lastChild as IElement;\n  }\n\n  /**\n   * only document has defaultView, points to canvas,\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/defaultView\n   */\n  defaultView: ICanvas | null = null;\n\n  /**\n   * the root element of document, eg. <html>\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Document/documentElement\n   */\n  readonly documentElement: Group;\n\n  /**\n   * document.timeline in WAAPI\n   */\n  readonly timeline: IAnimationTimeline;\n\n  readonly ownerDocument = null;\n\n  /**\n   * @example const circle = document.createElement('circle', { style: { r: 10 } });\n   */\n  createElement<\n    T extends DisplayObject<StyleProps>,\n    StyleProps extends BaseStyleProps,\n  >(tagName: string, options: DisplayObjectConfig<StyleProps>): T {\n    // @observablehq/plot will create <svg>\n    if (tagName === 'svg') {\n      return this.documentElement as unknown as T;\n    }\n\n    // d3 will use <tspan>\n    let clazz = this.defaultView.customElements.get(tagName);\n\n    if (!clazz) {\n      console.warn('Unsupported tagName: ', tagName);\n      clazz = tagName === 'tspan' ? Text : Group;\n    }\n\n    const shape = new clazz(options) as unknown as T;\n    shape.ownerDocument = this;\n    return shape;\n  }\n\n  createElementNS<\n    T extends DisplayObject<StyleProps>,\n    StyleProps extends BaseStyleProps,\n  >(\n    namespaceURI: string,\n    tagName: string,\n    options: DisplayObjectConfig<StyleProps>,\n  ): T {\n    return this.createElement(tagName, options);\n  }\n\n  cloneNode(deep?: boolean): this {\n    throw new Error(ERROR_MSG_METHOD_NOT_IMPLEMENTED);\n  }\n  destroy(): void {\n    try {\n      this.documentElement.destroyChildren();\n      this.timeline.destroy();\n    } catch {}\n  }\n\n  /**\n   * Picking 2D graphics with RBush based on BBox, fast but inaccurate.\n   */\n  elementsFromBBox(\n    minX: number,\n    minY: number,\n    maxX: number,\n    maxY: number,\n  ): DisplayObject[] {\n    const rBush = this.defaultView.context.rBushRoot;\n    const rBushNodes = rBush.search({ minX, minY, maxX, maxY });\n\n    const hitTestList: DisplayObject[] = [];\n    rBushNodes.forEach(({ displayObject }) => {\n      const { pointerEvents = 'auto' } =\n        displayObject.parsedStyle as ParsedBaseStyleProps;\n\n      // account for `visibility`\n      // @see https://developer.mozilla.org/en-US/docs/Web/CSS/pointer-events\n      const isVisibilityAffected = [\n        'auto',\n        'visiblepainted',\n        'visiblefill',\n        'visiblestroke',\n        'visible',\n      ].includes(pointerEvents);\n\n      if (\n        (!isVisibilityAffected ||\n          (isVisibilityAffected && displayObject.isVisible())) &&\n        !displayObject.isCulled() &&\n        displayObject.isInteractive()\n      ) {\n        hitTestList.push(displayObject);\n      }\n    });\n    // find group with max z-index\n    hitTestList.sort((a, b) => b.sortable.renderOrder - a.sortable.renderOrder);\n\n    return hitTestList;\n  }\n\n  elementFromPointSync(x: number, y: number): DisplayObject {\n    const { x: viewportX, y: viewportY } = this.defaultView.canvas2Viewport({\n      x,\n      y,\n    });\n    const { width, height } = this.defaultView.getConfig();\n    // outside canvas' viewport\n    if (\n      viewportX < 0 ||\n      viewportY < 0 ||\n      viewportX > width ||\n      viewportY > height\n    ) {\n      return null;\n    }\n\n    const { x: clientX, y: clientY } = this.defaultView.viewport2Client({\n      x: viewportX,\n      y: viewportY,\n    });\n\n    const { picked } = this.defaultView\n      .getRenderingService()\n      .hooks.pickSync.call({\n        topmost: true,\n        position: {\n          x,\n          y,\n          viewportX,\n          viewportY,\n          clientX,\n          clientY,\n        },\n        picked: [],\n      });\n    return (picked && picked[0]) || this.documentElement;\n  }\n\n  /**\n   * Do picking with API instead of triggering interactive events.\n   *\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementFromPoint\n   */\n  async elementFromPoint(x: number, y: number): Promise<DisplayObject> {\n    const { x: viewportX, y: viewportY } = this.defaultView.canvas2Viewport({\n      x,\n      y,\n    });\n    const { width, height } = this.defaultView.getConfig();\n    // outside canvas' viewport\n    if (\n      viewportX < 0 ||\n      viewportY < 0 ||\n      viewportX > width ||\n      viewportY > height\n    ) {\n      return null;\n    }\n\n    const { x: clientX, y: clientY } = this.defaultView.viewport2Client({\n      x: viewportX,\n      y: viewportY,\n    });\n\n    const { picked } = await this.defaultView\n      .getRenderingService()\n      .hooks.pick.promise({\n        topmost: true,\n        position: {\n          x,\n          y,\n          viewportX,\n          viewportY,\n          clientX,\n          clientY,\n        },\n        picked: [],\n      });\n    return (picked && picked[0]) || this.documentElement;\n  }\n\n  elementsFromPointSync(x: number, y: number): DisplayObject[] {\n    const { x: viewportX, y: viewportY } = this.defaultView.canvas2Viewport({\n      x,\n      y,\n    });\n    const { width, height } = this.defaultView.getConfig();\n    // outside canvas' viewport\n    if (\n      viewportX < 0 ||\n      viewportY < 0 ||\n      viewportX > width ||\n      viewportY > height\n    ) {\n      return [];\n    }\n\n    const { x: clientX, y: clientY } = this.defaultView.viewport2Client({\n      x: viewportX,\n      y: viewportY,\n    });\n\n    const { picked } = this.defaultView\n      .getRenderingService()\n      .hooks.pickSync.call({\n        topmost: false,\n        position: {\n          x,\n          y,\n          viewportX,\n          viewportY,\n          clientX,\n          clientY,\n        },\n        picked: [],\n      });\n\n    if (picked[picked.length - 1] !== this.documentElement) {\n      picked.push(this.documentElement);\n    }\n    return picked;\n  }\n\n  /**\n   * Do picking with API instead of triggering interactive events.\n   *\n   * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint\n   */\n  async elementsFromPoint(x: number, y: number): Promise<DisplayObject[]> {\n    const { x: viewportX, y: viewportY } = this.defaultView.canvas2Viewport({\n      x,\n      y,\n    });\n    const { width, height } = this.defaultView.getConfig();\n    // outside canvas' viewport\n    if (\n      viewportX < 0 ||\n      viewportY < 0 ||\n      viewportX > width ||\n      viewportY > height\n    ) {\n      return [];\n    }\n\n    const { x: clientX, y: clientY } = this.defaultView.viewport2Client({\n      x: viewportX,\n      y: viewportY,\n    });\n\n    const { picked } = await this.defaultView\n      .getRenderingService()\n      .hooks.pick.promise({\n        topmost: false,\n        position: {\n          x,\n          y,\n          viewportX,\n          viewportY,\n          clientX,\n          clientY,\n        },\n        picked: [],\n      });\n\n    if (picked[picked.length - 1] !== this.documentElement) {\n      picked.push(this.documentElement);\n    }\n    return picked;\n  }\n\n  /**\n   * eg. Uncaught DOMException: Failed to execute 'appendChild' on 'Node': Only one element on document allowed.\n   */\n\n  appendChild<T extends INode>(newChild: T, index?: number): T {\n    throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n  }\n\n  insertBefore<T extends INode>(newChild: T, refChild: INode | null): T {\n    throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n  }\n\n  removeChild<T extends INode>(oldChild: T, destroy?: boolean): T {\n    throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n  }\n\n  replaceChild<T extends INode>(\n    newChild: INode,\n    oldChild: T,\n    destroy?: boolean,\n  ): T {\n    throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n  }\n\n  append(...nodes: INode[]): void {\n    throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n  }\n\n  prepend(...nodes: INode[]): void {\n    throw new Error(ERROR_MSG_USE_DOCUMENT_ELEMENT);\n  }\n\n  /**\n   * Execute query on documentElement.\n   */\n  getElementById<E extends IElement = IElement>(id: string): E | null {\n    return this.documentElement.getElementById(id);\n  }\n  getElementsByName<E extends IElement = IElement>(name: string): E[] {\n    return this.documentElement.getElementsByName(name);\n  }\n  getElementsByTagName<E extends IElement = IElement>(tagName: string): E[] {\n    return this.documentElement.getElementsByTagName(tagName);\n  }\n  getElementsByClassName<E extends IElement = IElement>(\n    className: string,\n  ): E[] {\n    return this.documentElement.getElementsByClassName(className);\n  }\n  querySelector<E extends IElement = IElement>(selectors: string): E | null {\n    return this.documentElement.querySelector(selectors);\n  }\n  querySelectorAll<E extends IElement = IElement>(selectors: string): E[] {\n    return this.documentElement.querySelectorAll(selectors);\n  }\n  find<E extends IElement = IElement>(filter: (node: E) => boolean): E | null {\n    return this.documentElement.find(filter);\n  }\n  findAll<E extends IElement = IElement>(filter: (node: E) => boolean): E[] {\n    return this.documentElement.findAll(filter);\n  }\n}\n","import type { ICamera } from '../camera';\nimport type { DisplayObject } from '../display-objects/DisplayObject';\nimport { CustomEvent, ElementEvent } from '../dom';\nimport type {\n  RenderingPlugin,\n  RenderingPluginContext,\n} from '../services/RenderingService';\n\nexport interface CullingStrategyContribution {\n  isVisible: (camera: ICamera, object: DisplayObject) => boolean;\n}\n\n/**\n * apply following rules:\n * 1. `visibility` in scenegraph node\n * 2. other custom culling strategies, eg. frustum culling\n */\nexport class CullingPlugin implements RenderingPlugin {\n  static tag = 'Culling';\n\n  constructor(private strategies: CullingStrategyContribution[]) {}\n\n  apply(context: RenderingPluginContext) {\n    const { camera, renderingService, renderingContext } = context;\n    const { strategies } = this;\n\n    renderingService.hooks.cull.tap(\n      CullingPlugin.tag,\n      (object: DisplayObject | null) => {\n        if (object) {\n          const { cullable } = object;\n          // cullable.visible = true;\n          // const renderBounds = object.getRenderBounds();\n          // if (AABB.isEmpty(renderBounds)) {\n          //   cullable.visible = false;\n          // } else {\n          //   const isShape2D = shape2D.indexOf(object.nodeName as Shape) > -1;\n          //   const [p0, p1, p2, p3] = camera.getFrustum().planes;\n          //   tmpAABB.setMinMax([-p1.distance, -p3.distance, 0], [p0.distance, p2.distance, 0]);\n\n          //   cullable.visible = isShape2D ? renderBounds.intersects(tmpAABB) : true;\n          // }\n\n          if (strategies.length === 0) {\n            cullable.visible =\n              renderingContext.unculledEntities.indexOf(object.entity) > -1;\n          } else {\n            // eg. implemented by g-webgl(frustum culling)\n            cullable.visible = strategies.every((strategy) =>\n              strategy.isVisible(camera, object),\n            );\n          }\n\n          if (!object.isCulled() && object.isVisible()) {\n            return object;\n          }\n          // if (this.renderingContext.renderListLastFrame.indexOf(object) > -1) {\n          object.dispatchEvent(new CustomEvent(ElementEvent.CULLED));\n          // }\n\n          return null;\n        }\n\n        return object;\n      },\n    );\n\n    renderingService.hooks.afterRender.tap(\n      CullingPlugin.tag,\n      (object: DisplayObject) => {\n        object.cullable.visibilityPlaneMask = -1;\n      },\n    );\n  }\n}\n","import { isUndefined } from '@antv/util';\nimport type { FederatedMouseEvent, ICanvas, IEventTarget } from '../dom';\nimport { FederatedPointerEvent } from '../dom/FederatedPointerEvent';\nimport { FederatedWheelEvent } from '../dom/FederatedWheelEvent';\nimport type { RenderingPlugin, RenderingPluginContext } from '../services';\nimport type { Cursor, EventPosition, InteractivePointerEvent } from '../types';\nimport type { FormattedPointerEvent, FormattedTouch } from '../utils/event';\nimport { MOUSE_POINTER_ID, TOUCH_TO_POINTER, clock } from '../utils/event';\n\n/**\n * support mouse & touch events\n * @see https://github.com/pixijs/pixi.js/blob/dev/packages/interaction/README.md\n *\n * also provide some extra events such as `drag`\n */\nexport class EventPlugin implements RenderingPlugin {\n  static tag = 'Event';\n\n  private autoPreventDefault = false;\n  private rootPointerEvent = new FederatedPointerEvent(null);\n  private rootWheelEvent = new FederatedWheelEvent(null);\n\n  private context: RenderingPluginContext;\n\n  apply(context: RenderingPluginContext) {\n    this.context = context;\n    const { renderingService } = context;\n\n    const canvas = this.context.renderingContext.root.ownerDocument.defaultView;\n\n    this.context.eventService.setPickHandler((position: EventPosition) => {\n      const { picked } = this.context.renderingService.hooks.pickSync.call({\n        position,\n        picked: [],\n        topmost: true, // we only concern the topmost element\n      });\n      return picked[0] || null;\n    });\n\n    renderingService.hooks.pointerWheel.tap(\n      EventPlugin.tag,\n      (nativeEvent: InteractivePointerEvent) => {\n        const wheelEvent = this.normalizeWheelEvent(nativeEvent as WheelEvent);\n\n        this.context.eventService.mapEvent(wheelEvent);\n      },\n    );\n\n    renderingService.hooks.pointerDown.tap(\n      EventPlugin.tag,\n      (nativeEvent: InteractivePointerEvent) => {\n        if (\n          canvas.supportsTouchEvents &&\n          (nativeEvent as PointerEvent).pointerType === 'touch'\n        )\n          return;\n\n        const events = this.normalizeToPointerEvent(nativeEvent, canvas);\n\n        if (this.autoPreventDefault && (events[0] as any).isNormalized) {\n          const cancelable =\n            nativeEvent.cancelable || !('cancelable' in nativeEvent);\n\n          if (cancelable) {\n            nativeEvent.preventDefault();\n          }\n        }\n\n        for (const event of events) {\n          const federatedEvent = this.bootstrapEvent(\n            this.rootPointerEvent,\n            event,\n            canvas,\n            nativeEvent,\n          );\n          this.context.eventService.mapEvent(federatedEvent);\n        }\n\n        this.setCursor(this.context.eventService.cursor);\n      },\n    );\n\n    renderingService.hooks.pointerUp.tap(\n      EventPlugin.tag,\n      (nativeEvent: InteractivePointerEvent) => {\n        if (\n          canvas.supportsTouchEvents &&\n          (nativeEvent as PointerEvent).pointerType === 'touch'\n        )\n          return;\n\n        // account for element in SVG\n        const $element =\n          this.context.contextService.getDomElement() as HTMLCanvasElement;\n\n        const isNativeEventFromCanvas =\n          this.context.eventService.isNativeEventFromCanvas(\n            $element,\n            nativeEvent,\n          );\n        const outside = !isNativeEventFromCanvas ? 'outside' : '';\n        const normalizedEvents = this.normalizeToPointerEvent(\n          nativeEvent,\n          canvas,\n        );\n\n        for (const normalizedEvent of normalizedEvents) {\n          const event = this.bootstrapEvent(\n            this.rootPointerEvent,\n            normalizedEvent,\n            canvas,\n            nativeEvent,\n          );\n          event.type += outside;\n          this.context.eventService.mapEvent(event);\n        }\n\n        this.setCursor(this.context.eventService.cursor);\n      },\n    );\n\n    renderingService.hooks.pointerMove.tap(EventPlugin.tag, this.onPointerMove);\n\n    renderingService.hooks.pointerOver.tap(EventPlugin.tag, this.onPointerMove);\n\n    renderingService.hooks.pointerOut.tap(EventPlugin.tag, this.onPointerMove);\n\n    renderingService.hooks.click.tap(EventPlugin.tag, this.onClick);\n\n    renderingService.hooks.pointerCancel.tap(\n      EventPlugin.tag,\n      (nativeEvent: InteractivePointerEvent) => {\n        const normalizedEvents = this.normalizeToPointerEvent(\n          nativeEvent,\n          canvas,\n        );\n\n        for (const normalizedEvent of normalizedEvents) {\n          const event = this.bootstrapEvent(\n            this.rootPointerEvent,\n            normalizedEvent,\n            canvas,\n            nativeEvent,\n          );\n          this.context.eventService.mapEvent(event);\n        }\n        this.setCursor(this.context.eventService.cursor);\n      },\n    );\n  }\n\n  private onPointerMove = (nativeEvent: InteractivePointerEvent) => {\n    const canvas =\n      this.context.renderingContext.root?.ownerDocument?.defaultView;\n    if (\n      canvas.supportsTouchEvents &&\n      (nativeEvent as PointerEvent).pointerType === 'touch'\n    )\n      return;\n\n    const normalizedEvents = this.normalizeToPointerEvent(nativeEvent, canvas);\n\n    for (const normalizedEvent of normalizedEvents) {\n      const event = this.bootstrapEvent(\n        this.rootPointerEvent,\n        normalizedEvent,\n        canvas,\n        nativeEvent,\n      );\n\n      this.context.eventService.mapEvent(event);\n    }\n\n    this.setCursor(this.context.eventService.cursor);\n  };\n\n  private onClick = (nativeEvent: InteractivePointerEvent) => {\n    const canvas =\n      this.context.renderingContext.root?.ownerDocument?.defaultView;\n\n    const normalizedEvents = this.normalizeToPointerEvent(nativeEvent, canvas);\n\n    for (const normalizedEvent of normalizedEvents) {\n      const event = this.bootstrapEvent(\n        this.rootPointerEvent,\n        normalizedEvent,\n        canvas,\n        nativeEvent,\n      );\n\n      this.context.eventService.mapEvent(event);\n    }\n\n    this.setCursor(this.context.eventService.cursor);\n  };\n\n  private bootstrapEvent(\n    event: FederatedPointerEvent,\n    normalizedEvent: PointerEvent,\n    view: ICanvas,\n    nativeEvent: PointerEvent | MouseEvent | TouchEvent,\n  ): FederatedPointerEvent {\n    event.view = view;\n    event.originalEvent = null;\n    event.nativeEvent = nativeEvent;\n\n    event.pointerId = normalizedEvent.pointerId;\n    event.width = normalizedEvent.width;\n    event.height = normalizedEvent.height;\n    event.isPrimary = normalizedEvent.isPrimary;\n    event.pointerType = normalizedEvent.pointerType;\n    event.pressure = normalizedEvent.pressure;\n    event.tangentialPressure = normalizedEvent.tangentialPressure;\n    event.tiltX = normalizedEvent.tiltX;\n    event.tiltY = normalizedEvent.tiltY;\n    event.twist = normalizedEvent.twist;\n    this.transferMouseData(event, normalizedEvent);\n\n    const { x, y } = this.context.eventService.client2Viewport({\n      x: normalizedEvent.clientX,\n      y: normalizedEvent.clientY,\n    });\n    event.viewport.x = x;\n    event.viewport.y = y;\n    const { x: canvasX, y: canvasY } =\n      this.context.eventService.viewport2Canvas(event.viewport);\n    event.canvas.x = canvasX;\n    event.canvas.y = canvasY;\n    event.global.copyFrom(event.canvas);\n    event.offset.copyFrom(event.canvas);\n\n    event.isTrusted = nativeEvent.isTrusted;\n    if (event.type === 'pointerleave') {\n      event.type = 'pointerout';\n    }\n    if (event.type.startsWith('mouse')) {\n      event.type = event.type.replace('mouse', 'pointer');\n    }\n    if (event.type.startsWith('touch')) {\n      event.type = TOUCH_TO_POINTER[event.type] || event.type;\n    }\n    return event;\n  }\n\n  private normalizeWheelEvent(nativeEvent: WheelEvent): FederatedWheelEvent {\n    const event = this.rootWheelEvent;\n\n    this.transferMouseData(event, nativeEvent);\n\n    event.deltaMode = nativeEvent.deltaMode;\n    event.deltaX = nativeEvent.deltaX;\n    event.deltaY = nativeEvent.deltaY;\n    event.deltaZ = nativeEvent.deltaZ;\n\n    const { x, y } = this.context.eventService.client2Viewport({\n      x: nativeEvent.clientX,\n      y: nativeEvent.clientY,\n    });\n    event.viewport.x = x;\n    event.viewport.y = y;\n    const { x: canvasX, y: canvasY } =\n      this.context.eventService.viewport2Canvas(event.viewport);\n    event.canvas.x = canvasX;\n    event.canvas.y = canvasY;\n    event.global.copyFrom(event.canvas);\n    event.offset.copyFrom(event.canvas);\n\n    event.nativeEvent = nativeEvent;\n    event.type = nativeEvent.type;\n\n    return event;\n  }\n\n  /**\n   * Transfers base & mouse event data from the nativeEvent to the federated event.\n   */\n  private transferMouseData(\n    event: FederatedMouseEvent,\n    nativeEvent: MouseEvent,\n  ): void {\n    event.isTrusted = nativeEvent.isTrusted;\n    event.srcElement = nativeEvent.srcElement as IEventTarget;\n    event.timeStamp = clock.now();\n    event.type = nativeEvent.type;\n\n    event.altKey = nativeEvent.altKey;\n    event.metaKey = nativeEvent.metaKey;\n    event.shiftKey = nativeEvent.shiftKey;\n    event.ctrlKey = nativeEvent.ctrlKey;\n    event.button = nativeEvent.button;\n    event.buttons = nativeEvent.buttons;\n    event.client.x = nativeEvent.clientX;\n    event.client.y = nativeEvent.clientY;\n    event.movement.x = nativeEvent.movementX;\n    event.movement.y = nativeEvent.movementY;\n    event.page.x = nativeEvent.pageX;\n    event.page.y = nativeEvent.pageY;\n    event.screen.x = nativeEvent.screenX;\n    event.screen.y = nativeEvent.screenY;\n    event.relatedTarget = null;\n  }\n\n  private setCursor(cursor: Cursor | null) {\n    this.context.contextService.applyCursorStyle(\n      cursor || this.context.config.cursor || 'default',\n    );\n  }\n\n  private normalizeToPointerEvent(\n    event: InteractivePointerEvent,\n    canvas: ICanvas,\n  ): PointerEvent[] {\n    const normalizedEvents = [];\n    if (canvas.isTouchEvent(event)) {\n      for (let i = 0; i < event.changedTouches.length; i++) {\n        const touch = event.changedTouches[i] as FormattedTouch;\n\n        // use changedTouches instead of touches since touchend has no touches\n        // @see https://stackoverflow.com/a/10079076\n        if (isUndefined(touch.button)) touch.button = 0;\n        if (isUndefined(touch.buttons)) touch.buttons = 1;\n        if (isUndefined(touch.isPrimary)) {\n          touch.isPrimary =\n            event.touches.length === 1 && event.type === 'touchstart';\n        }\n        if (isUndefined(touch.width)) touch.width = touch.radiusX || 1;\n        if (isUndefined(touch.height)) touch.height = touch.radiusY || 1;\n        if (isUndefined(touch.tiltX)) touch.tiltX = 0;\n        if (isUndefined(touch.tiltY)) touch.tiltY = 0;\n        if (isUndefined(touch.pointerType)) touch.pointerType = 'touch';\n        // @see https://developer.mozilla.org/zh-CN/docs/Web/API/Touch/identifier\n        if (isUndefined(touch.pointerId))\n          touch.pointerId = touch.identifier || 0;\n        if (isUndefined(touch.pressure)) touch.pressure = touch.force || 0.5;\n        if (isUndefined(touch.twist)) touch.twist = 0;\n        if (isUndefined(touch.tangentialPressure)) touch.tangentialPressure = 0;\n        touch.isNormalized = true;\n        touch.type = event.type;\n\n        normalizedEvents.push(touch);\n      }\n    } else if (canvas.isMouseEvent(event)) {\n      const tempEvent = event as FormattedPointerEvent;\n      if (isUndefined(tempEvent.isPrimary)) tempEvent.isPrimary = true;\n      if (isUndefined(tempEvent.width)) tempEvent.width = 1;\n      if (isUndefined(tempEvent.height)) tempEvent.height = 1;\n      if (isUndefined(tempEvent.tiltX)) tempEvent.tiltX = 0;\n      if (isUndefined(tempEvent.tiltY)) tempEvent.tiltY = 0;\n      if (isUndefined(tempEvent.pointerType)) tempEvent.pointerType = 'mouse';\n      if (isUndefined(tempEvent.pointerId))\n        tempEvent.pointerId = MOUSE_POINTER_ID;\n      if (isUndefined(tempEvent.pressure)) tempEvent.pressure = 0.5;\n      if (isUndefined(tempEvent.twist)) tempEvent.twist = 0;\n      if (isUndefined(tempEvent.tangentialPressure))\n        tempEvent.tangentialPressure = 0;\n      tempEvent.isNormalized = true;\n\n      normalizedEvents.push(tempEvent);\n    } else {\n      normalizedEvents.push(event);\n    }\n\n    return normalizedEvents as PointerEvent[];\n  }\n}\n","import { vec3 } from 'gl-matrix';\nimport type { ICamera } from '../camera';\nimport type { DisplayObject } from '../display-objects/DisplayObject';\nimport type { Element } from '../dom';\nimport type { Plane } from '../shapes';\nimport { AABB, Mask } from '../shapes';\nimport { Shape } from '../types';\nimport type { CullingStrategyContribution } from './CullingPlugin';\n\n// group is not a 2d shape\nconst shape2D = [\n  Shape.CIRCLE,\n  Shape.ELLIPSE,\n  Shape.IMAGE,\n  Shape.RECT,\n  Shape.LINE,\n  Shape.POLYLINE,\n  Shape.POLYGON,\n  Shape.TEXT,\n  Shape.PATH,\n  Shape.HTML,\n];\n\nexport class FrustumCullingStrategy implements CullingStrategyContribution {\n  isVisible(camera: ICamera, object: DisplayObject) {\n    // return true;\n\n    const { cullable } = object;\n    if (!cullable.enable) {\n      return true;\n    }\n\n    const renderBounds = object.getRenderBounds();\n\n    if (AABB.isEmpty(renderBounds)) {\n      return false;\n    }\n\n    // get VP matrix from camera\n    const frustum = camera.getFrustum();\n\n    const parentVisibilityPlaneMask = (object.parentNode as Element)?.cullable\n      ?.visibilityPlaneMask;\n    cullable.visibilityPlaneMask = this.computeVisibilityWithPlaneMask(\n      object,\n      renderBounds,\n      parentVisibilityPlaneMask || Mask.INDETERMINATE,\n      frustum.planes,\n    );\n\n    cullable.visible = cullable.visibilityPlaneMask !== Mask.OUTSIDE;\n\n    return cullable.visible;\n  }\n\n  /**\n   *\n   * @see「Optimized View Frustum Culling Algorithms for Bounding Boxes」\n   * @see https://github.com/antvis/GWebGPUEngine/issues/3\n   *\n   * * 基础相交测试 the basic intersection test\n   * * 标记 masking @see https://cesium.com/blog/2015/08/04/fast-hierarchical-culling/\n   * * TODO: 平面一致性测试 the plane-coherency test\n   * * TODO: 支持 mesh 指定自身的剔除策略，参考 Babylon.js @see https://doc.babylonjs.com/how_to/optimizing_your_scene#changing-mesh-culling-strategy\n   *\n   * @param aabb aabb\n   * @param parentPlaneMask mask of parent\n   * @param planes planes of frustum\n   */\n  private computeVisibilityWithPlaneMask(\n    object: DisplayObject,\n    aabb: AABB,\n    parentPlaneMask: Mask,\n    planes: Plane[],\n  ) {\n    if (parentPlaneMask === Mask.OUTSIDE || parentPlaneMask === Mask.INSIDE) {\n      // 父节点完全位于视锥内或者外部，直接返回\n      return parentPlaneMask;\n    }\n\n    // Start with MASK_INSIDE (all zeros) so that after the loop, the return value can be compared with MASK_INSIDE.\n    // (Because if there are fewer than 31 planes, the upper bits wont be changed.)\n    let mask = Mask.INSIDE;\n\n    const isShape2D = shape2D.indexOf(object.nodeName as Shape) > -1;\n\n    // Use viewport culling for 2D shapes\n    // @see https://github.com/antvis/g/issues/914\n    for (let k = 0, len = planes.length; k < len; ++k) {\n      // For k greater than 31 (since 31 is the maximum number of INSIDE/INTERSECTING bits we can store), skip the optimization.\n      const flag = 1 << k;\n\n      if ((parentPlaneMask & flag) === 0) {\n        // 父节点处于当前面内部，可以跳过\n        continue;\n      }\n\n      // skip near & far planes when testing 2D shapes\n      if (isShape2D && (k === 4 || k === 5)) {\n        continue;\n      }\n\n      // p-vertex n-vertex <-|plane p-vertex n-vertex\n      // 使用 p-vertex 和 n-vertex 加速，避免进行平面和 aabb 全部顶点的相交检测\n      const { normal, distance } = planes[k];\n      if (\n        vec3.dot(normal, aabb.getPositiveFarPoint(planes[k])) + distance <\n        0\n      ) {\n        return Mask.OUTSIDE;\n      }\n      if (\n        vec3.dot(normal, aabb.getNegativeFarPoint(planes[k])) + distance <\n        0\n      ) {\n        // 和当前面相交，对应位置为1，继续检测下一个面\n        mask |= flag;\n      }\n    }\n\n    return mask;\n  }\n}\n","import type RBush from 'rbush';\nimport { runtime } from '../global-runtime';\nimport type { RBushNodeAABB } from '../components';\nimport { DisplayObject } from '../display-objects';\nimport type { FederatedEvent } from '../dom';\nimport { ElementEvent } from '../dom';\nimport type { RenderingPlugin, RenderingPluginContext } from '../services';\nimport { raf } from '../utils';\nimport { AABB } from '../shapes';\n\nexport class PrepareRendererPlugin implements RenderingPlugin {\n  static tag = 'Prepare';\n  private rBush: RBush<RBushNodeAABB>;\n\n  private syncTasks = new Map<DisplayObject, boolean>();\n\n  private isFirstTimeRendering = true;\n  private syncing = false;\n\n  isFirstTimeRenderingFinished = false;\n\n  apply(context: RenderingPluginContext) {\n    const { renderingService, renderingContext, rBushRoot } = context;\n    const canvas = renderingContext.root.ownerDocument.defaultView;\n\n    this.rBush = rBushRoot;\n\n    const handleAttributeChanged = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n      object.renderable.dirty = true;\n      renderingService.dirtify();\n    };\n\n    const handleBoundsChanged = (e: FederatedEvent) => {\n      this.syncTasks.set(e.target as DisplayObject, e.detail.affectChildren);\n\n      renderingService.dirtify();\n    };\n\n    const handleMounted = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n\n      if (runtime.enableSizeAttenuation) {\n        runtime.styleValueRegistry.updateSizeAttenuation(\n          object,\n          canvas.getCamera().getZoom(),\n        );\n      }\n    };\n\n    const handleUnmounted = (e: FederatedEvent) => {\n      const object = e.target as DisplayObject;\n      const { rBushNode } = object;\n      if (rBushNode.aabb) {\n        this.rBush.remove(rBushNode.aabb);\n      }\n\n      this.syncTasks.delete(object);\n\n      runtime.sceneGraphService.dirtifyToRoot(object);\n      renderingService.dirtify();\n    };\n\n    renderingService.hooks.init.tap(PrepareRendererPlugin.tag, () => {\n      canvas.addEventListener(ElementEvent.MOUNTED, handleMounted);\n      canvas.addEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.addEventListener(\n        ElementEvent.ATTR_MODIFIED,\n        handleAttributeChanged,\n      );\n      canvas.addEventListener(ElementEvent.BOUNDS_CHANGED, handleBoundsChanged);\n    });\n\n    renderingService.hooks.destroy.tap(PrepareRendererPlugin.tag, () => {\n      canvas.removeEventListener(ElementEvent.MOUNTED, handleMounted);\n      canvas.removeEventListener(ElementEvent.UNMOUNTED, handleUnmounted);\n      canvas.removeEventListener(\n        ElementEvent.ATTR_MODIFIED,\n        handleAttributeChanged,\n      );\n      canvas.removeEventListener(\n        ElementEvent.BOUNDS_CHANGED,\n        handleBoundsChanged,\n      );\n      this.syncTasks.clear();\n    });\n\n    const ric =\n      runtime.globalThis.requestIdleCallback ?? raf.bind(runtime.globalThis);\n    renderingService.hooks.endFrame.tap(PrepareRendererPlugin.tag, () => {\n      if (this.isFirstTimeRendering) {\n        this.isFirstTimeRendering = false;\n        this.syncing = true;\n        ric(() => {\n          this.syncRTree(true);\n          this.isFirstTimeRenderingFinished = true;\n        });\n      } else {\n        this.syncRTree();\n      }\n    });\n  }\n\n  private syncNode(node: DisplayObject, force = false) {\n    if (!node.isConnected) return;\n\n    const rBushNode = node.rBushNode;\n\n    // clear dirty node\n    if (rBushNode.aabb) this.rBush.remove(rBushNode.aabb);\n\n    const renderBounds = node.getRenderBounds();\n    if (renderBounds) {\n      const renderable = node.renderable;\n\n      if (force) {\n        if (!renderable.dirtyRenderBounds) {\n          renderable.dirtyRenderBounds = new AABB();\n        }\n        // save last dirty aabb\n        renderable.dirtyRenderBounds.update(\n          renderBounds.center,\n          renderBounds.halfExtents,\n        );\n      }\n\n      const [minX, minY] = renderBounds.getMin();\n      const [maxX, maxY] = renderBounds.getMax();\n\n      if (!rBushNode.aabb) {\n        rBushNode.aabb = {} as RBushNodeAABB;\n      }\n      rBushNode.aabb.displayObject = node;\n      rBushNode.aabb.minX = minX;\n      rBushNode.aabb.minY = minY;\n      rBushNode.aabb.maxX = maxX;\n      rBushNode.aabb.maxY = maxY;\n    }\n\n    if (rBushNode.aabb) {\n      // TODO: NaN occurs when width/height of Rect is 0\n      if (\n        !isNaN(rBushNode.aabb.maxX) &&\n        !isNaN(rBushNode.aabb.maxX) &&\n        !isNaN(rBushNode.aabb.minX) &&\n        !isNaN(rBushNode.aabb.minY)\n      ) {\n        return rBushNode.aabb;\n      }\n    }\n  }\n\n  private syncRTree(force = false) {\n    if (!force && (this.syncing || this.syncTasks.size === 0)) {\n      return;\n    }\n\n    this.syncing = true;\n\n    // bounds changed, need re-inserting its children\n    const bulk: RBushNodeAABB[] = [];\n    const synced = new Set<DisplayObject>();\n\n    const sync = (node: DisplayObject) => {\n      if (!synced.has(node) && node.renderable) {\n        const aabb = this.syncNode(node, force);\n        if (aabb) {\n          bulk.push(aabb);\n          synced.add(node);\n        }\n      }\n    };\n\n    this.syncTasks.forEach((affectChildren, node) => {\n      if (affectChildren) {\n        node.forEach(sync);\n      }\n\n      let parent = node;\n      while (parent) {\n        sync(parent);\n        parent = parent.parentElement as DisplayObject;\n      }\n    });\n\n    // use bulk inserting, which is ~2-3 times faster\n    // @see https://github.com/mourner/rbush#bulk-inserting-data\n    this.rBush.load(bulk);\n\n    bulk.length = 0;\n    this.syncing = false;\n  }\n}\n","// eslint-disable-next-line import/extensions\nimport RBush from 'rbush/rbush.js';\nimport type { IRenderer } from './AbstractRenderer';\nimport {\n  CameraEvent,\n  CameraProjectionMode,\n  CameraTrackingMode,\n  CameraType,\n} from './camera';\nimport type { RBushNodeAABB } from './components';\nimport type { CustomElement } from './display-objects';\nimport { DisplayObject } from './display-objects/DisplayObject';\nimport type { CanvasContext, Element, IChildNode } from './dom';\nimport { CustomEvent, Document, ElementEvent, EventTarget } from './dom';\nimport { CustomElementRegistry } from './dom/CustomElementRegistry';\nimport type { ICanvas } from './dom/interfaces';\nimport { runtime } from './global-runtime';\nimport { CullingPlugin } from './plugins/CullingPlugin';\nimport { EventPlugin } from './plugins/EventPlugin';\nimport { FrustumCullingStrategy } from './plugins/FrustumCullingStrategy';\nimport { PrepareRendererPlugin } from './plugins/PrepareRendererPlugin';\nimport { EventService, RenderReason, RenderingService } from './services';\nimport type { PointLike } from './shapes';\nimport {\n  type CanvasConfig,\n  type ClipSpaceNearZ,\n  type Cursor,\n  type InteractivePointerEvent,\n} from './types';\nimport {\n  caf,\n  cleanExistedCanvas,\n  getHeight,\n  getWidth,\n  isBrowser,\n  isInFragment,\n  raf,\n} from './utils';\n\nexport function isCanvas(value: any): value is Canvas {\n  return !!(value as Canvas).document;\n}\n\nexport enum CanvasEvent {\n  READY = 'ready',\n  BEFORE_RENDER = 'beforerender',\n  RERENDER = 'rerender',\n  AFTER_RENDER = 'afterrender',\n  BEFORE_DESTROY = 'beforedestroy',\n  AFTER_DESTROY = 'afterdestroy',\n  RESIZE = 'resize',\n  DIRTY_RECTANGLE = 'dirtyrectangle',\n  RENDERER_CHANGED = 'rendererchanged',\n}\n\nconst DEFAULT_CAMERA_Z = 500;\nconst DEFAULT_CAMERA_NEAR = 0.1;\nconst DEFAULT_CAMERA_FAR = 1000;\n\n/**\n * reuse custom event preventing from re-create them in every frame\n */\nconst mountedEvent = new CustomEvent(ElementEvent.MOUNTED);\nconst unmountedEvent = new CustomEvent(ElementEvent.UNMOUNTED);\nconst beforeRenderEvent = new CustomEvent(CanvasEvent.BEFORE_RENDER);\nconst rerenderEvent = new CustomEvent(CanvasEvent.RERENDER);\nconst afterRenderEvent = new CustomEvent(CanvasEvent.AFTER_RENDER);\n\n/**\n * can be treated like Window in DOM\n * provide some extra methods like `window`, such as:\n * * `window.requestAnimationFrame`\n * * `window.devicePixelRatio`\n *\n * prototype chains: Canvas(Window) -> EventTarget\n */\nexport class Canvas extends EventTarget implements ICanvas {\n  /**\n   * window.document\n   */\n  document: Document;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry\n   */\n  customElements: CustomElementRegistry;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame\n   */\n  requestAnimationFrame: (callback: FrameRequestCallback) => number;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/cancelAnimationFrame\n   */\n  cancelAnimationFrame: (handle: number) => void;\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\n   */\n  devicePixelRatio: number;\n\n  /**\n   * whether the runtime supports PointerEvent?\n   * if not, the event system won't trigger pointer events like `pointerdown`\n   */\n  supportsPointerEvents: boolean;\n\n  /**\n   * whether the runtime supports TouchEvent?\n   * if not, the event system won't trigger touch events like `touchstart`\n   */\n  supportsTouchEvents: boolean;\n\n  /**\n   * is this native event a TouchEvent?\n   */\n  isTouchEvent: (event: InteractivePointerEvent) => event is TouchEvent;\n\n  /**\n   * is this native event a MouseEvent?\n   */\n  isMouseEvent: (event: InteractivePointerEvent) => event is MouseEvent;\n\n  /**\n   * double click speed (ms), default is 200ms\n   */\n  dblClickSpeed?: CanvasConfig['dblClickSpeed'];\n\n  /**\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Element\n   */\n  Element = DisplayObject;\n\n  /**\n   * rAF in auto rendering\n   */\n  private frameId?: number;\n\n  private inited = false;\n  private readyPromise: Promise<any> | undefined;\n  private resolveReadyPromise: () => void;\n\n  context = {} as CanvasContext;\n\n  constructor(config: CanvasConfig) {\n    super();\n\n    // create document\n    this.document = new Document();\n    this.document.defaultView = this;\n\n    // create registry of custom elements\n    this.customElements = new CustomElementRegistry();\n\n    const {\n      container,\n      canvas,\n      offscreenCanvas,\n      width,\n      height,\n      devicePixelRatio,\n      renderer,\n      background,\n      cursor,\n      document,\n      requestAnimationFrame,\n      cancelAnimationFrame,\n      createImage,\n      enableLargeImageOptimization,\n      supportsPointerEvents,\n      supportsTouchEvents,\n      supportsCSSTransform,\n      cleanUpOnDestroy = true,\n      supportsMutipleCanvasesInOneContainer,\n      useNativeClickEvent,\n      alwaysTriggerPointerEventOnCanvas,\n      isTouchEvent,\n      isMouseEvent,\n      dblClickSpeed,\n    } = config;\n\n    if (!supportsMutipleCanvasesInOneContainer) {\n      cleanExistedCanvas(container, this, cleanUpOnDestroy);\n    }\n\n    let canvasWidth = width;\n    let canvasHeight = height;\n    let dpr = devicePixelRatio;\n    // use user-defined <canvas> or OffscreenCanvas\n    if (canvas) {\n      // infer width & height with dpr\n      dpr = devicePixelRatio || (isBrowser && window.devicePixelRatio) || 1;\n      dpr = dpr >= 1 ? Math.ceil(dpr) : 1;\n      canvasWidth = width || getWidth(canvas) || canvas.width / dpr;\n      canvasHeight = height || getHeight(canvas) || canvas.height / dpr;\n    }\n\n    // override it in runtime\n    if (offscreenCanvas) {\n      runtime.offscreenCanvas = offscreenCanvas;\n    }\n\n    /**\n     * implements `Window` interface\n     */\n    this.devicePixelRatio = dpr;\n    this.requestAnimationFrame =\n      requestAnimationFrame ?? raf.bind(runtime.globalThis);\n    this.cancelAnimationFrame =\n      cancelAnimationFrame ?? caf.bind(runtime.globalThis);\n\n    /**\n     * limits query\n     */\n    // the following feature-detect from hammer.js\n    // @see https://github.com/hammerjs/hammer.js/blob/master/src/inputjs/input-consts.js#L5\n    this.supportsTouchEvents =\n      supportsTouchEvents ?? 'ontouchstart' in runtime.globalThis;\n    this.supportsPointerEvents =\n      supportsPointerEvents ?? !!runtime.globalThis.PointerEvent;\n    this.isTouchEvent =\n      isTouchEvent ??\n      ((event: InteractivePointerEvent): event is TouchEvent =>\n        this.supportsTouchEvents &&\n        event instanceof runtime.globalThis.TouchEvent);\n    this.isMouseEvent =\n      isMouseEvent ??\n      ((event: InteractivePointerEvent): event is MouseEvent =>\n        !runtime.globalThis.MouseEvent ||\n        (event instanceof runtime.globalThis.MouseEvent &&\n          (!this.supportsPointerEvents ||\n            !(event instanceof runtime.globalThis.PointerEvent))));\n\n    this.dblClickSpeed = dblClickSpeed ?? 200;\n\n    this.initRenderingContext({\n      container,\n      canvas,\n      width: canvasWidth,\n      height: canvasHeight,\n      renderer,\n      offscreenCanvas,\n      devicePixelRatio: dpr,\n      cursor: cursor || ('default' as Cursor),\n      background: background || 'transparent',\n      createImage,\n      enableLargeImageOptimization,\n      document,\n      supportsCSSTransform,\n      useNativeClickEvent,\n      cleanUpOnDestroy,\n      alwaysTriggerPointerEventOnCanvas,\n    });\n\n    this.initDefaultCamera(canvasWidth, canvasHeight, renderer.clipSpaceNearZ);\n\n    this.initRenderer(renderer, true);\n  }\n\n  private initRenderingContext(mergedConfig: CanvasConfig) {\n    this.context.config = mergedConfig;\n\n    // bind rendering context, shared by all renderers\n    this.context.renderingContext = {\n      /**\n       * the root node in scene graph\n       */\n      root: this.document.documentElement,\n      renderListCurrentFrame: [],\n      unculledEntities: [],\n\n      renderReasons: new Set(),\n\n      force: false,\n      dirty: false,\n    };\n  }\n\n  private initDefaultCamera(\n    width: number,\n    height: number,\n    clipSpaceNearZ: ClipSpaceNearZ,\n  ) {\n    // set a default ortho camera\n    const camera = new runtime.CameraContribution();\n    camera.clipSpaceNearZ = clipSpaceNearZ;\n\n    camera\n      .setType(CameraType.EXPLORING, CameraTrackingMode.DEFAULT)\n      .setPosition(width / 2, height / 2, DEFAULT_CAMERA_Z)\n      .setFocalPoint(width / 2, height / 2, 0)\n      .setOrthographic(\n        width / -2,\n        width / 2,\n        height / 2,\n        height / -2,\n        DEFAULT_CAMERA_NEAR,\n        DEFAULT_CAMERA_FAR,\n      );\n\n    // keep ref since it will use raf in camera animation\n    camera.canvas = this;\n\n    // redraw when camera changed\n    camera.eventEmitter.on(CameraEvent.UPDATED, () => {\n      this.context.renderingContext.renderReasons.add(\n        RenderReason.CAMERA_CHANGED,\n      );\n\n      if (\n        runtime.enableSizeAttenuation &&\n        this.getConfig().renderer.getConfig().enableSizeAttenuation\n      ) {\n        this.updateSizeAttenuation();\n      }\n    });\n\n    // bind camera\n    this.context.camera = camera;\n  }\n\n  private updateSizeAttenuation() {\n    const zoom = this.getCamera().getZoom();\n    this.document.documentElement.forEach((node: DisplayObject) => {\n      runtime.styleValueRegistry.updateSizeAttenuation(node, zoom);\n    });\n  }\n\n  getConfig() {\n    return this.context.config;\n  }\n\n  /**\n   * get the root displayObject in scenegraph\n   * @alias this.document.documentElement\n   */\n  getRoot() {\n    return this.document.documentElement;\n  }\n\n  /**\n   * get the camera of canvas\n   */\n  getCamera() {\n    return this.context.camera;\n  }\n\n  getContextService() {\n    return this.context.contextService;\n  }\n\n  getEventService() {\n    return this.context.eventService;\n  }\n\n  getRenderingService() {\n    return this.context.renderingService;\n  }\n\n  getRenderingContext() {\n    return this.context.renderingContext;\n  }\n\n  getStats() {\n    return this.getRenderingService().getStats();\n  }\n\n  // /**\n  //  * @see https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getComputedStyle\n  //  */\n  // getComputedStyle(node: DisplayObject) {\n  //   return node.computedStyle;\n  // }\n\n  get ready() {\n    if (!this.readyPromise) {\n      this.readyPromise = new Promise((resolve) => {\n        this.resolveReadyPromise = () => {\n          resolve(this);\n        };\n      });\n      if (this.inited) {\n        this.resolveReadyPromise();\n      }\n    }\n    return this.readyPromise;\n  }\n\n  /**\n   * `cleanUp` means clean all the internal services of Canvas which happens when calling `canvas.destroy()`.\n   */\n  destroy(cleanUp = true, skipTriggerEvent?: boolean) {\n    if (skipTriggerEvent === undefined)\n      skipTriggerEvent = this.getConfig().fastCleanExistingCanvas;\n\n    if (!skipTriggerEvent) {\n      this.dispatchEvent(new CustomEvent(CanvasEvent.BEFORE_DESTROY));\n    }\n    if (this.frameId) {\n      const cancelRAF =\n        this.getConfig().cancelAnimationFrame || cancelAnimationFrame;\n      cancelRAF(this.frameId);\n    }\n\n    // unmount all children\n    const root = this.getRoot();\n    this.unmountChildren(root);\n\n    if (cleanUp) {\n      // destroy Document\n      this.document.destroy();\n      this.getEventService().destroy();\n    }\n\n    // destroy services\n    this.getRenderingService().destroy();\n    this.getContextService().destroy();\n\n    // clear root after renderservice destroyed\n    if (cleanUp && this.context.rBushRoot) {\n      // clear rbush\n      this.context.rBushRoot.clear();\n      this.context.rBushRoot = null;\n      this.context.renderingContext.root = null;\n    }\n\n    if (!skipTriggerEvent) {\n      this.dispatchEvent(new CustomEvent(CanvasEvent.AFTER_DESTROY));\n    }\n\n    const clearEventRetain = (event: CustomEvent) => {\n      event.currentTarget = null;\n      event.manager = null;\n      event.target = null;\n    };\n\n    clearEventRetain(mountedEvent);\n    clearEventRetain(unmountedEvent);\n    clearEventRetain(beforeRenderEvent);\n    clearEventRetain(rerenderEvent);\n    clearEventRetain(afterRenderEvent);\n\n    this.cancelAnimationFrame(this.frameId);\n  }\n\n  /**\n   * compatible with G 3.0\n   * @deprecated\n   * @alias resize\n   */\n  changeSize(width: number, height: number) {\n    this.resize(width, height);\n  }\n  resize(width: number, height: number) {\n    // update canvas' config\n    const canvasConfig = this.context.config;\n    canvasConfig.width = width;\n    canvasConfig.height = height;\n\n    // resize context\n    this.getContextService().resize(width, height);\n\n    // resize camera\n    const { camera } = this.context;\n    const projectionMode = camera.getProjectionMode();\n    camera\n      .setPosition(width / 2, height / 2, DEFAULT_CAMERA_Z)\n      .setFocalPoint(width / 2, height / 2, 0);\n    if (projectionMode === CameraProjectionMode.ORTHOGRAPHIC) {\n      camera.setOrthographic(\n        width / -2,\n        width / 2,\n        height / 2,\n        height / -2,\n        camera.getNear(),\n        camera.getFar(),\n      );\n    } else {\n      camera.setAspect(width / height);\n    }\n\n    this.dispatchEvent(new CustomEvent(CanvasEvent.RESIZE, { width, height }));\n  }\n\n  // proxy to document.documentElement\n  appendChild<T extends IChildNode>(child: T, index?: number): T {\n    return this.document.documentElement.appendChild(child, index);\n  }\n  insertBefore<T extends IChildNode, N extends IChildNode>(\n    newChild: T,\n    refChild: N | null,\n  ): T {\n    return this.document.documentElement.insertBefore(newChild, refChild);\n  }\n  removeChild<T extends IChildNode>(child: T): T {\n    return this.document.documentElement.removeChild(child);\n  }\n\n  /**\n   * Remove all children which can be appended to its original parent later again.\n   */\n  removeChildren() {\n    this.document.documentElement.removeChildren();\n  }\n\n  /**\n   * Recursively destroy all children which can not be appended to its original parent later again.\n   * But the canvas remains running which means display objects can be appended later.\n   */\n  destroyChildren() {\n    this.document.documentElement.destroyChildren();\n  }\n\n  render(frame?: XRFrame) {\n    if (frame) {\n      beforeRenderEvent.detail = frame;\n      afterRenderEvent.detail = frame;\n    }\n\n    this.dispatchEvent(beforeRenderEvent);\n\n    const renderingService = this.getRenderingService();\n    renderingService.render(this.getConfig(), frame, () => {\n      // trigger actual rerender event\n      // @see https://github.com/antvis/G/issues/1268\n      this.dispatchEvent(rerenderEvent);\n    });\n\n    this.dispatchEvent(afterRenderEvent);\n  }\n\n  private run() {\n    const tick = (time: number, frame?: XRFrame) => {\n      this.render(frame);\n      this.frameId = this.requestAnimationFrame(tick);\n    };\n    tick(0);\n  }\n\n  private initRenderer(renderer: IRenderer, firstContentfullPaint = false) {\n    if (!renderer) {\n      throw new Error('Renderer is required.');\n    }\n\n    // reset\n    this.inited = false;\n    this.readyPromise = undefined;\n\n    // FIXME: should re-create here?\n    this.context.rBushRoot = new RBush<RBushNodeAABB>();\n\n    // reset rendering plugins\n    this.context.renderingPlugins = [];\n    this.context.renderingPlugins.push(\n      new EventPlugin(),\n      new PrepareRendererPlugin(),\n      // new DirtyCheckPlugin(),\n      new CullingPlugin([new FrustumCullingStrategy()]),\n    );\n\n    //\n    this.loadRendererContainerModule(renderer);\n\n    // init context service\n    this.context.contextService = new this.context.ContextService({\n      ...runtime,\n      ...this.context,\n    });\n\n    // init rendering service\n    this.context.renderingService = new RenderingService(runtime, this.context);\n\n    // init event service\n    this.context.eventService = new EventService(runtime, this.context);\n    this.context.eventService.init();\n\n    if (this.context.contextService.init) {\n      this.context.contextService.init();\n      this.initRenderingService(renderer, firstContentfullPaint, true);\n    } else {\n      this.context.contextService.initAsync().then(() => {\n        this.initRenderingService(renderer, firstContentfullPaint);\n      });\n    }\n  }\n\n  private initRenderingService(\n    renderer: IRenderer,\n    firstContentfullPaint = false,\n    async = false,\n  ) {\n    this.context.renderingService.init(() => {\n      this.inited = true;\n\n      if (firstContentfullPaint) {\n        if (async) {\n          this.requestAnimationFrame(() => {\n            this.dispatchEvent(new CustomEvent(CanvasEvent.READY));\n          });\n        } else {\n          this.dispatchEvent(new CustomEvent(CanvasEvent.READY));\n        }\n      } else {\n        this.dispatchEvent(new CustomEvent(CanvasEvent.RENDERER_CHANGED));\n      }\n\n      if (this.readyPromise) {\n        this.resolveReadyPromise();\n      }\n\n      if (!firstContentfullPaint) {\n        this.getRoot().forEach((node) => {\n          const { renderable } = node as Element;\n          if (renderable) {\n            renderable.renderBoundsDirty = true;\n            renderable.boundsDirty = true;\n            renderable.dirty = true;\n          }\n        });\n      }\n\n      // keep current scenegraph unchanged, just trigger mounted event\n      this.mountChildren(this.getRoot());\n\n      if (renderer.getConfig().enableAutoRendering) {\n        this.run();\n      }\n    });\n  }\n\n  private loadRendererContainerModule(renderer: IRenderer) {\n    // load other container modules provided by g-canvas/g-svg/g-webgl\n    const plugins = renderer.getPlugins();\n    plugins.forEach((plugin) => {\n      plugin.context = this.context;\n      plugin.init(runtime);\n    });\n  }\n\n  setRenderer(renderer: IRenderer) {\n    // update canvas' config\n    const canvasConfig = this.getConfig();\n    if (canvasConfig.renderer === renderer) {\n      return;\n    }\n\n    const oldRenderer = canvasConfig.renderer;\n    canvasConfig.renderer = renderer;\n\n    // keep all children undestroyed\n    this.destroy(false, true);\n\n    // destroy all plugins, reverse will mutate origin array\n    [...(oldRenderer?.getPlugins() || [])].reverse().forEach((plugin) => {\n      plugin.destroy(runtime);\n    });\n\n    this.initRenderer(renderer);\n  }\n\n  setCursor(cursor: Cursor) {\n    const canvasConfig = this.getConfig();\n    canvasConfig.cursor = cursor;\n    this.getContextService().applyCursorStyle(cursor);\n  }\n\n  unmountChildren(parent: DisplayObject) {\n    // unmountChildren recursively\n    parent.childNodes.forEach((child: DisplayObject) => {\n      this.unmountChildren(child);\n    });\n\n    if (this.inited) {\n      if (parent.isMutationObserved) {\n        parent.dispatchEvent(unmountedEvent);\n      } else {\n        unmountedEvent.target = parent;\n        this.dispatchEvent(unmountedEvent, true);\n      }\n\n      // skip document.documentElement\n      if (parent !== this.document.documentElement) {\n        parent.ownerDocument = null;\n      }\n      parent.isConnected = false;\n    }\n\n    // trigger after unmounted\n    if (parent.isCustomElement) {\n      if ((parent as CustomElement<any>).disconnectedCallback) {\n        (parent as CustomElement<any>).disconnectedCallback();\n      }\n    }\n  }\n\n  mountChildren(\n    child: DisplayObject,\n    skipTriggerEvent: boolean = isInFragment(child),\n  ) {\n    if (this.inited) {\n      if (!child.isConnected) {\n        child.ownerDocument = this.document;\n        child.isConnected = true;\n\n        if (!skipTriggerEvent) {\n          if (child.isMutationObserved) {\n            child.dispatchEvent(mountedEvent);\n          } else {\n            mountedEvent.target = child;\n            this.dispatchEvent(mountedEvent, true);\n          }\n        }\n      }\n    } else {\n      console.warn(\n        \"[g]: You are trying to call `canvas.appendChild` before canvas' initialization finished. You can either await `canvas.ready` or listen to `CanvasEvent.READY` manually.\",\n        'appended child: ',\n        child.nodeName,\n      );\n    }\n\n    // recursively mount children\n    child.childNodes.forEach((c: DisplayObject) => {\n      this.mountChildren(c, skipTriggerEvent);\n    });\n\n    // trigger after mounted\n    if (child.isCustomElement) {\n      if ((child as CustomElement<any>).connectedCallback) {\n        (child as CustomElement<any>).connectedCallback();\n      }\n    }\n  }\n\n  mountFragment(child: DisplayObject) {\n    this.mountChildren(child, false);\n  }\n\n  client2Viewport(client: PointLike): PointLike {\n    return this.getEventService().client2Viewport(client);\n  }\n\n  viewport2Client(canvas: PointLike): PointLike {\n    return this.getEventService().viewport2Client(canvas);\n  }\n\n  viewport2Canvas(viewport: PointLike): PointLike {\n    return this.getEventService().viewport2Canvas(viewport);\n  }\n\n  canvas2Viewport(canvas: PointLike): PointLike {\n    return this.getEventService().canvas2Viewport(canvas);\n  }\n\n  /**\n   * @deprecated\n   * @alias client2Viewport\n   */\n  getPointByClient(clientX: number, clientY: number): PointLike {\n    return this.client2Viewport({ x: clientX, y: clientY });\n  }\n\n  /**\n   * @deprecated\n   * @alias viewport2Client\n   */\n  getClientByPoint(x: number, y: number): PointLike {\n    return this.viewport2Client({ x, y });\n  }\n}\n"],"mappings":"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Q,CAACW;AACtB,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEjd,IAAI,EAAE,KAAK;EACX0c,SAAS,EAAEJ,QAAQ,CAACY;AACtB,CAAC;AACD;AACA;AACA;AACA;AACA;EACEld,IAAI,EAAE,MAAM;EACZ0c,SAAS,EAAEJ,QAAQ,CAACa;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA,CACD;AAEW,IAAAC,iBAAiB,0BAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjBA,iBAAiB,CAAjBA,iBAAiB;EAAjB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AE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EACtDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EACtDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EACvDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EAEvDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EACtDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EACtDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EACvDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,EAEvDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,EACxDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,EACxDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,EACzDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAAC,EAAE,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,EAEzDD,CAAC,CAAC,CAAC,CAAC,GAAGC,CAAC,CAAC,EAAE,CAAC,GAAGD,CAAC,CAA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}